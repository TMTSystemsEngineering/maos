<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>Multi-threaded Adaptive Optics Simulator: maos/wfsgrad.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="maos.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Multi-threaded Adaptive Optics Simulator
   </div>
   <div id="projectbrief">A Fast End to End Adaptive Optics Simulator</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('wfsgrad_8c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">wfsgrad.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>contains functions that computes WFS gradients in geometric or physical optics mode.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a51b7a9c320bb9b58fc5632da0a44ab84"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a51b7a9c320bb9b58fc5632da0a44ab84"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>TIMING</b>&#160;&#160;&#160;0</td></tr>
<tr class="separator:a51b7a9c320bb9b58fc5632da0a44ab84"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a52bfe1186605f34e3d77031297d538c3"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a52bfe1186605f34e3d77031297d538c3"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>TIM</b>(A)</td></tr>
<tr class="separator:a52bfe1186605f34e3d77031297d538c3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a4fb4ea648eb84af9d97863c097bda408"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="wfsgrad_8c.html#a4fb4ea648eb84af9d97863c097bda408">wfsfocusadj</a> (<a class="el" href="structSIM__T.html">SIM_T</a> *simu, int iwfs)</td></tr>
<tr class="memdesc:a4fb4ea648eb84af9d97863c097bda408"><td class="mdescLeft">&#160;</td><td class="mdescRight">Compute the focus adjustment need to apply to OPD of wfs.  <a href="#a4fb4ea648eb84af9d97863c097bda408">More...</a><br/></td></tr>
<tr class="separator:a4fb4ea648eb84af9d97863c097bda408"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5afdf7a505966f64b56d7f21bd776c8b"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a5afdf7a505966f64b56d7f21bd776c8b"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>wfslinearity</b> (const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, <a class="el" href="structPOWFS__T.html">POWFS_T</a> *powfs, const int iwfs)</td></tr>
<tr class="separator:a5afdf7a505966f64b56d7f21bd776c8b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a57fc84d03735ab8fc00b25e65f82ec86"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="wfsgrad_8c.html#a57fc84d03735ab8fc00b25e65f82ec86">maxapriori</a> (double *g, <a class="el" href="structdmat.html">dmat</a> *ints, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, const <a class="el" href="structPOWFS__T.html">POWFS_T</a> *powfs, int iwfs, int isa, int noisy, double bkgrnd, double rne)</td></tr>
<tr class="memdesc:a57fc84d03735ab8fc00b25e65f82ec86"><td class="mdescLeft">&#160;</td><td class="mdescRight">Implements MAP tracking algorithm.  <a href="#a57fc84d03735ab8fc00b25e65f82ec86">More...</a><br/></td></tr>
<tr class="separator:a57fc84d03735ab8fc00b25e65f82ec86"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adac6e4aa099aa648460c4955956acce6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="wfsgrad_8c.html#adac6e4aa099aa648460c4955956acce6">wfsgrad_iwfs</a> (<a class="el" href="structSIM__T.html">SIM_T</a> *simu, int iwfs)</td></tr>
<tr class="memdesc:adac6e4aa099aa648460c4955956acce6"><td class="mdescLeft">&#160;</td><td class="mdescRight">computes close loop and pseudo open loop gradidents for both gometric and physical optics WFS.  <a href="#adac6e4aa099aa648460c4955956acce6">More...</a><br/></td></tr>
<tr class="separator:adac6e4aa099aa648460c4955956acce6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a55019535bfb6d523008d096ab2efee68"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a55019535bfb6d523008d096ab2efee68"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>wfsgrad_fsm</b> (<a class="el" href="structSIM__T.html">SIM_T</a> *simu, int iwfs)</td></tr>
<tr class="separator:a55019535bfb6d523008d096ab2efee68"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a077de92fb8ce172c1fd3e16ee8c8b5eb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="wfsgrad_8c.html#a077de92fb8ce172c1fd3e16ee8c8b5eb">wfsgrad_mffocus</a> (<a class="el" href="structSIM__T.html">SIM_T</a> *simu)</td></tr>
<tr class="memdesc:a077de92fb8ce172c1fd3e16ee8c8b5eb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Accomplish Two tasks:  <a href="#a077de92fb8ce172c1fd3e16ee8c8b5eb">More...</a><br/></td></tr>
<tr class="separator:a077de92fb8ce172c1fd3e16ee8c8b5eb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4d6e59082a351088a4fc19ee62bfec1d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="wfsgrad_8c.html#a4d6e59082a351088a4fc19ee62bfec1d">wfsgrad_wrap</a> (<a class="el" href="structthread__t.html">thread_t</a> *info)</td></tr>
<tr class="memdesc:a4d6e59082a351088a4fc19ee62bfec1d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Every operation here should be in the Simulator not the Controller.  <a href="#a4d6e59082a351088a4fc19ee62bfec1d">More...</a><br/></td></tr>
<tr class="separator:a4d6e59082a351088a4fc19ee62bfec1d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a99e7e23b2226afc767fc176f352f6e11"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="wfsgrad_8c.html#a99e7e23b2226afc767fc176f352f6e11">wfsgrad</a> (<a class="el" href="structSIM__T.html">SIM_T</a> *simu)</td></tr>
<tr class="memdesc:a99e7e23b2226afc767fc176f352f6e11"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calls <a class="el" href="wfsgrad_8c.html#adac6e4aa099aa648460c4955956acce6" title="computes close loop and pseudo open loop gradidents for both gometric and physical optics WFS...">wfsgrad_iwfs()</a> to computes WFS gradient in parallel.  <a href="#a99e7e23b2226afc767fc176f352f6e11">More...</a><br/></td></tr>
<tr class="separator:a99e7e23b2226afc767fc176f352f6e11"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>contains functions that computes WFS gradients in geometric or physical optics mode. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a4fb4ea648eb84af9d97863c097bda408"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double wfsfocusadj </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSIM__T.html">SIM_T</a> *&#160;</td>
          <td class="paramname"><em>simu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>iwfs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Compute the focus adjustment need to apply to OPD of wfs. </p>
<p>Used in both CPU and GPU code. </p>

</div>
</div>
<a class="anchor" id="a57fc84d03735ab8fc00b25e65f82ec86"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void maxapriori </td>
          <td>(</td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>g</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structdmat.html">dmat</a> *&#160;</td>
          <td class="paramname"><em>ints</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&#160;</td>
          <td class="paramname"><em>parms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPOWFS__T.html">POWFS_T</a> *&#160;</td>
          <td class="paramname"><em>powfs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>iwfs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>isa</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>noisy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>bkgrnd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>rne</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Implements MAP tracking algorithm. </p>
<p>The polar coordinate is implicitly taken care of in mapfun if parms-&gt;powfs.radrot=0; </p>

</div>
</div>
<a class="anchor" id="adac6e4aa099aa648460c4955956acce6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void wfsgrad_iwfs </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSIM__T.html">SIM_T</a> *&#160;</td>
          <td class="paramname"><em>simu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>iwfs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>computes close loop and pseudo open loop gradidents for both gometric and physical optics WFS. </p>
<p>Calls <a class="el" href="wfsints_8c.html#a4aa8e0cc5984b2881e54c0000ae754ae" title="compute physical optics images and add to ints.">wfsints()</a> to accumulate WFS subapertures images in physical optics mode. </p>

</div>
</div>
<a class="anchor" id="a077de92fb8ce172c1fd3e16ee8c8b5eb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void wfsgrad_mffocus </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSIM__T.html">SIM_T</a> *&#160;</td>
          <td class="paramname"><em>simu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Accomplish Two tasks: </p>
<p>1) High pass filter lgs focus to remove sodium range variation effact. 2) Average LGS focus measurement to drive the trombone.</p>
<p>We trust the focus measurement of the LGS WFS at high temporal frequency where NGS cannot provide due to low frame rate. After the HPF on lgs gradients, our system is NO LONGER affected by sodium layer variation.</p>
<p>if sim.mffocus==1: The HPF is applied to each LGS WFS indepently. This largely removes the effect of differential focus. powfs.dfrs is no longer needed. (preferred).</p>
<p>if sim.mffocus==2: We apply a LPF on the average focus from six LGS WFS, and then remove this value from all LGS WFS. The differential focus is still present and powfs.dfrs need to be set to 1 to handle it in tomography. This is the original focus tracking method. </p>

</div>
</div>
<a class="anchor" id="a4d6e59082a351088a4fc19ee62bfec1d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void wfsgrad_wrap </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structthread__t.html">thread_t</a> *&#160;</td>
          <td class="paramname"><em>info</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Every operation here should be in the Simulator not the Controller. </p>

</div>
</div>
<a class="anchor" id="a99e7e23b2226afc767fc176f352f6e11"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void wfsgrad </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSIM__T.html">SIM_T</a> *&#160;</td>
          <td class="paramname"><em>simu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calls <a class="el" href="wfsgrad_8c.html#adac6e4aa099aa648460c4955956acce6" title="computes close loop and pseudo open loop gradidents for both gometric and physical optics WFS...">wfsgrad_iwfs()</a> to computes WFS gradient in parallel. </p>
<p>It also includes operations on Gradients before tomography. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->

   </ul>
 </div>
</body>
</html>
