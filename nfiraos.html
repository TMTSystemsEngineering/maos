<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>maos-1.0.2: Example: NFIRAOS</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.3 -->
<script type="text/javascript">
function hasClass(ele,cls) {
  return ele.className.match(new RegExp('(\\s|^)'+cls+'(\\s|$)'));
}

function addClass(ele,cls) {
  if (!this.hasClass(ele,cls)) ele.className += " "+cls;
}

function removeClass(ele,cls) {
  if (hasClass(ele,cls)) {
    var reg = new RegExp('(\\s|^)'+cls+'(\\s|$)');
    ele.className=ele.className.replace(reg,' ');
  }
}

function toggleVisibility(linkObj) {
 var base = linkObj.getAttribute('id');
 var summary = document.getElementById(base + '-summary');
 var content = document.getElementById(base + '-content');
 var trigger = document.getElementById(base + '-trigger');
 if ( hasClass(linkObj,'closed') ) {
   summary.style.display = 'none';
   content.style.display = 'block';
   trigger.src = 'open.png';
   removeClass(linkObj,'closed');
   addClass(linkObj,'opened');
 } else if ( hasClass(linkObj,'opened') ) {
   summary.style.display = 'block';
   content.style.display = 'none';
   trigger.src = 'closed.png';
   removeClass(linkObj,'opened');
   addClass(linkObj,'closed');
 }
 return false;
}
</script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">maos-1.0.2</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('nfiraos.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<h1>Example: NFIRAOS </h1>  </div>
</div>
<div class="contents">
<div class="textblock"><p>The following shows the content of nfiraos.conf, which is the baseline configuration of TMT NFIRAOS system</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#File nfiraos.conf</span>
<span class="preprocessor"></span>
<span class="preprocessor">#This .conf file contains the complete configuration of TMT NFIRAOS System.  You</span>
<span class="preprocessor"></span><span class="preprocessor">#can copy this .conf to another file and modify it to model different systems or</span>
<span class="preprocessor"></span><span class="preprocessor">#choose different parameters. This file is loaded by maos automatically if \c -c</span>
<span class="preprocessor"></span><span class="preprocessor">#switch is not supplied. </span>
<span class="preprocessor"></span>
<span class="preprocessor">#Notice: </span>
<span class="preprocessor"></span><span class="preprocessor">#All string must be quoted with &quot;&quot;</span>
<span class="preprocessor"></span><span class="preprocessor">#Vectors should be embraced by [].</span>
<span class="preprocessor"></span><span class="preprocessor">#Anything following # in each line is treated as comment.</span>
<span class="preprocessor"></span>
<span class="preprocessor">#The value of some key might be another .conf while, in which case the .conf</span>
<span class="preprocessor"></span><span class="preprocessor">#file is loaded automatically. like powfs.llt </span>
<span class="preprocessor"></span>
<span class="preprocessor">#defines simulation parameters.</span>
<span class="preprocessor"></span>include     = <span class="stringliteral">&quot;sim.conf&quot;</span>

<span class="preprocessor">#Tilt surfaces. Each file contains a dmat array with the following key in header.</span>
<span class="preprocessor"></span><span class="preprocessor">#dx,dy: the sampling along x and y direction, </span>
<span class="preprocessor"></span><span class="preprocessor">#ox,oy: the origin along x and y direction, </span>
<span class="preprocessor"></span><span class="preprocessor">#txdeg: the x tilt angle in degree wrt beam (90 is prep), </span>
<span class="preprocessor"></span><span class="preprocessor">#tydeg: the y tilt angle in degree wrt beam (90 is prep), </span>
<span class="preprocessor"></span><span class="preprocessor">#ftel: The telescope effective focal length, </span>
<span class="preprocessor"></span><span class="preprocessor">#fexit: the distance between the exit pupil and the focus, </span>
<span class="preprocessor"></span><span class="preprocessor">#fsurf: the distance between the M3 and the focus.</span>
<span class="preprocessor"></span>tsurf       = [] #[<span class="stringliteral">&quot;M3_PrintThrough_ZA0_AA180_YA45.bin&quot;</span>]

<span class="preprocessor">#OPD surfaces. Each file contains a dmat array with the following key in header.</span>
<span class="preprocessor"></span><span class="preprocessor">#dx: the sampling along x and y direction (must be the same)</span>
<span class="preprocessor"></span><span class="preprocessor">#ox,oy: the origin along x and y direction</span>
<span class="preprocessor"></span><span class="preprocessor">#h: height of the surface from pupil.   </span>
<span class="preprocessor"></span><span class="preprocessor">#The second cell contains the OPD array.</span>
<span class="preprocessor"></span>surf        = [] #surface OPD map. can be a list of file names.

#AO type. 
include     = <span class="stringliteral">&quot;dm_dual.conf&quot;</span> #MCAO with dual DMs

<span class="preprocessor">#Atmospheric profile</span>
<span class="preprocessor"></span><span class="preprocessor">#atm=&quot;atm_srd.conf&quot; #TMT SRD Profile</span>
<span class="preprocessor"></span>include     = <span class="stringliteral">&quot;atm_mk13n50p.conf&quot;</span> #Mauna Kea 13N 50%.

#Wavefront sensor information.
include     = <span class="stringliteral">&quot;wfs_lgs_ttf_tt.conf&quot;</span>

<span class="preprocessor">#Evaluation and fitting FoV information.</span>
<span class="preprocessor"></span>include     = <span class="stringliteral">&quot;fov_iris.conf&quot;</span>

<span class="preprocessor">#Including configurations for reconstruction (tomo/fitting)</span>
<span class="preprocessor"></span>include     = <span class="stringliteral">&quot;recon.conf&quot;</span>

<span class="preprocessor">#For debugging purpose</span>
<span class="preprocessor"></span>include     = <span class="stringliteral">&quot;dbg.conf&quot;</span>
</pre></div><p>It includes the following files to define all the parameters. <code>"sim.conf"</code> to define some general parameters: </p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#FILE sim.conf</span>
<span class="preprocessor"></span><span class="preprocessor">#Contains common parameters to all setups. </span>
<span class="preprocessor"></span>
<span class="preprocessor">#Telescope Aperture Configuration.</span>
<span class="preprocessor"></span>aper.d     = [30 3.6] #may contain one <span class="keywordflow">for</span> [d] or two numbers <span class="keywordflow">for</span> [d din]. d is
<span class="preprocessor">              #outer diameter. din is optimal inner hole diameter.</span>
<span class="preprocessor"></span>aper.fnamp    = <span class="stringliteral">&quot;TMT_CurDesign.bin&quot;</span> #The amplitude map contains a <a class="code" href="structcell.html" title="Cell of anything.">cell</a> array
<span class="preprocessor">                  # of 2 elements.  The first element is 5x1 vector,</span>
<span class="preprocessor"></span><span class="preprocessor">                  # specifying sampling dx, dy, origin coordinate ox, oy and</span>
<span class="preprocessor"></span><span class="preprocessor">                  # height (0).  The second element is a NxN square array.</span>
<span class="preprocessor"></span>aper.rotdeg   = 0     #Telescope pupil rotation CCW with respect to instrument. 
aper.misreg   = [0 0] #misregistration of the pupil. Shifts the amplitude map and atmosphere.
aper.pupmask  =       #the science pupil mask.

#defines simulation parameters.
sim.seeds     = [1]   #random seeds. a list. 0 means random seed
<a class="code" href="sim_8c.html#ab5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.start     = 0     #first time step. usually 0.
sim.end       = 500   #last time step (exclusive)
<a class="code" href="sim_8c.html#ab5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.closeloop = 1     <span class="preprocessor">#closed loop simulation</span>
<span class="preprocessor"></span><a class="code" href="sim_8c.html#ab5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.dt        = 1/800 #loop sampling time. (WFS integration time)
<a class="code" href="sim_8c.html#ab5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.zadeg     = 0     #zenith angle. moved from atm.zadeg
<a class="code" href="sim_8c.html#ab5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.cachedm   = 1     #Caching DM commands to fine sampled grids that matches
                  #the sampling of the WFS and/or science evaluation
                  #grid. speed up simulation
<a class="code" href="sim_8c.html#ab5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.fov       = 120   #The total FoV.
#Servo coefficients. There is two cycle delay.
#A is command. e is error signal. at time step n, the command is updated by
#A(n)=A(n-1)*apdm(0)+A(n-2)*ap(1)+...+e(n-2)*ep
<a class="code" href="sim_8c.html#ab5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.apdm      = [1 0] #<span class="keyword">this</span> is the <span class="keywordflow">default</span>. [0.5 0.5] is used in laos 
<a class="code" href="sim_8c.html#ab5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.epdm      = 1/2   #error gain of high order loop
<a class="code" href="sim_8c.html#ab5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.apngs     = [1 0] #<span class="keyword">this</span> is the <span class="keywordflow">default</span>. [0.5 0.5] is used in laos.
sim.epngs     = 0.5   #error gain of ngs mode in split tomography

<a class="code" href="sim_8c.html#ab5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.fuseint   = 1     #use fused integrator. <span class="keywordflow">for</span> high and low order loop.
sim.servotype_hi=1    #1: simple integrator servo <span class="keywordflow">for</span> high order loop
<a class="code" href="sim_8c.html#ab5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.servotype_lo=1    #1: simple integrator servo <span class="keywordflow">for</span> low order loop. 2: type II control.
sim.gtypeII_lo=<span class="stringliteral">&quot;&quot;</span>     #contains 3x1 or 3xnmod coeffs <span class="keywordflow">for</span> type II servo lo 
 
<span class="preprocessor">#Focus tracking gains.</span>
<span class="preprocessor"></span><a class="code" href="sim_8c.html#ab5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.lpfocus   = 0     #coefficient <span class="keywordflow">for</span> focus update low pass <a class="code" href="filter_8c.html#aafaf3cf93da63d63bd5f43be060ffa9c" title="Does the servo filtering by calling filter_cl() or filter_ol()">filter</a>
<a class="code" href="sim_8c.html#ab5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.epfocus   = 0     #coefficient <span class="keywordflow">for</span> focus update integrator error gain.
sim.mffocus   = 0     #method <span class="keywordflow">for</span> focus update. 0 to disable focus update. 1:
<span class="preprocessor">                  #default implementation in RTC block diagram. see recon.c</span>
<span class="preprocessor"></span><span class="preprocessor">                  #for details.</span>
<span class="preprocessor"></span>
<span class="preprocessor">#Uplink laser pointing servo</span>
<span class="preprocessor"></span><a class="code" href="sim_8c.html#ab5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.apupt     = [1 0] #[0.5 0.5] is used in laos.
sim.epupt     = 0.5   #uplink integrator gain
<a class="code" href="sim_8c.html#ab5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.dpupt     = 0.0   #uplink derivative gain <span class="keywordflow">if</span> use derivative control.
sim.uptideal  = 0     #ideal correction on uplink (debugging)

<span class="preprocessor">#Other</span>
<span class="preprocessor"></span><a class="code" href="sim_8c.html#ab5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.skysim    = 0     #enable presimulation <span class="keywordflow">for</span> sky coverage.
sim.parallel  = 1     #make the big loop parallel.
sim.wspsd     =       #Telescope wind shake PSD input. Nx2. First column is freq
<span class="preprocessor">              #in Hz, Second column is PSD in rad^2/Hz.</span>
<span class="preprocessor"></span><a class="code" href="sim_8c.html#ab5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.wsseq     = 1     #windshake sequency. different wsseq gives different realizations
gpu.wfs       = 1     #Use GPU <span class="keywordflow">for</span> WFS sensing
gpu.evl       = 1     #Use GPU <span class="keywordflow">for</span> Performance evaluation
gpu.tomo      = 1     #Use GPU <span class="keywordflow">for</span> tomography
gpu.fit       = 1     #Use GPU <span class="keywordflow">for</span> DM fitting
gpu.lsr       = 1     #Use GPU <span class="keywordflow">for</span> LSR
gpu.psf       = 1     #Use GPU to accumulate PSF.
#For special purpose
<a class="code" href="sim_8c.html#ab5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.noatm     = 0     #Disable atmosphere generation (to evaluate telescope errors).
sim.evlol     = 0     #evaluate open loop performance only. don<span class="stringliteral">&#39;t do wfs/tomo/recon.</span>
<span class="stringliteral">sim.psfr      = 0     #Save PSF reconstruction telemetry.</span>
<span class="stringliteral">sim.ecnn      = 0     #Estimate WF covariance due to WFS noise cov Cnn.</span>
<span class="stringliteral">sim.wfsalias  = 0     #Study the wfs aliasing effect by project turbulence onto</span>
<span class="stringliteral">                  #the orthogonal of the DM vector space.</span>
<span class="stringliteral">sim.idealfit  = 0     #evaluation ideal fit error only. no wfs, no recon. (was fitonly)</span>
<span class="stringliteral">sim.idealtomo = 0     #ideal tomography without wfs (directly propagate from turbulence).</span>
<span class="stringliteral">sim.idealwfs  = 0     #Implements ideal WFS by only using turbulence in DM range. conflicts sim.wfsalias</span>
<span class="stringliteral">sim.idealevl  = 0     #Evaluate the performance only in DM range.</span>
<span class="stringliteral">#Common atmospheric parameters</span>
<span class="stringliteral">atm.fractal   = 0     #Use fractal method to generate atmosphere screen. 0: fft method.</span>
<span class="stringliteral">atm.size      = [0 0] #size of atmosphere in meter. 0: automatic.</span>
<span class="stringliteral">atm.dx        = 1/64  #sampling of the atmosphere, match evl.dx</span>
<span class="stringliteral">atm.wdrand    = 1     #&gt;0: as additional seed to randomize wind direction </span>
<span class="stringliteral">atm.evolve    = 0     #evolve the atm in additional to frozen flow. developed</span>
<span class="stringliteral">              #for fractal since it does not wrap. Need twice as storage.</span>
<span class="stringliteral">atm.frozenflow=0      #using frozen flow screen (at OL. CL is always frozenflow)</span>
<span class="stringliteral">atm.ninit     = 17    #Initial size of the screen in fractal method. &gt;=2</span>
<span class="stringliteral">atm.share     = 1     #We share atmosphere by default.</span>
<span class="stringliteral"></span>
<span class="stringliteral">#CN2 Estimation</span>
<span class="stringliteral">cn2.pair      = []    #pairs of wfs to estimate cn2. empty to disable cn2 estimation.</span>
<span class="stringliteral">cn2.step      = 100   #do cn2 estimation every this time step</span>
<span class="stringliteral">cn2.reset     = 0     #reset the accumulated cn2 after every cn2step.</span>
<span class="stringliteral">cn2.hmax      = 18000 #maximum height to esimate at zenith</span>
<span class="stringliteral">cn2.saat      = 0.95  #subaperture area threashold to use in cn2 estimation</span>
<span class="stringliteral">cn2.keepht    = 1     #1: keep the layer ht specified by atmr.ht by</span>
<span class="stringliteral">              #interpolation. 2: do slodar directly on these layers.</span>
<span class="stringliteral">cn2.tomo      = 0     #update tomography parameters if non zero</span>
<span class="stringliteral">cn2.verbose   = 1     #output estimated r0, cn2 during simulation</span>
<span class="stringliteral">cn2.nhtomo    = 6     #number of layers to feed into reconstructor. only effective if keepht==0</span>
<span class="stringliteral">cn2.moveht    = 0     #move the ht used for reconstructor to near strongest layers. only</span>
<span class="stringliteral">                      #effective if keepht=0.</span>
<span class="stringliteral"></span>
<span class="stringliteral">#set MOAO DMs parameters.</span>
<span class="stringliteral">moao.order    = [0]   #override this if moao is required.</span>
<span class="stringliteral">moao.cubic    = [1]</span>
<span class="stringliteral">moao.iac      = [0.3]</span>
<span class="stringliteral">moao.stroke   = [inf]</span>
<span class="stringliteral">moao.actslave = [0]</span>
<span class="stringliteral">moao.lrt_ptt  = [0]</span>
<span class="stringliteral">moao.actstuck = [&quot;&quot;]</span>
<span class="stringliteral">moao.actfloat = [&quot;&quot;]</span>
<span class="stringliteral"></span>
<span class="stringliteral">#some common fov parameters</span>
<span class="stringliteral">evl.dx      = 1/64  #sampling of the aperture in simulation</span>
<span class="stringliteral">evl.misreg  = [0 0]#misregistration</span>
<span class="stringliteral">evl.psf     = [1] #output psf for this direction if psf is computed. 1 or nevl elements.</span>
<span class="stringliteral">evl.psfr    = [1] #output psf reconstruction telemetry for this direction.</span>
<span class="stringliteral">evl.hs      = [inf] #the height of the science object. normally infinity. </span>
<span class="stringliteral">evl.rmax    = 1   #max radial order in performance evaluation. </span>
<span class="stringliteral">           #1: includes piston/tip/tilt. 2: p/t/t/focus/astigmatism</span>
<span class="stringliteral">evl.tomo    = 0 #evaluate CL error for tomography</span>
<span class="stringliteral">evl.moao    = -1 #index into MOAO config in recon.conf</span>
<span class="stringliteral">evl.psfhist = 0 #output history of the psf (a lot of storage). </span>
<span class="stringliteral">evl.psfmean = 0 #output time averaged psf. for this number of psf&#39;</span>s along the
<span class="preprocessor">        #way. 1: only save in the end. n: save cumulative average every</span>
<span class="preprocessor"></span><span class="preprocessor">        #n steps (do not reset)</span>
<span class="preprocessor"></span>evl.psfol   = 1 #compute OL psf in additional to CL PSF. 0: disable 1: on axis
<span class="preprocessor">            #direction only, 2: all directions and average them.</span>
<span class="preprocessor"></span>evl.psfngsr = 0 #<span class="keyword">remove</span> NGS modes from PSF in split tomography mode. 
<span class="preprocessor">            # 1: both normal psf and psf with ngsmod removal are saved.</span>
<span class="preprocessor"></span><span class="preprocessor">        # 2: only psf with ngs mode removed is computed.</span>
<span class="preprocessor"></span>evl.opdcov  = 0 #save covariance of opd <span class="keywordflow">for</span> directions where evl.psf==1.

evl.wvl     = [1.25e-6 1.65e-6 2.2e-6]#wavelength to evaluat PSF or strehl
evl.psfpttr = [0] #<span class="keyword">remove</span> p/t/t in wavefront OPD before computing PSF.
evl.psfisim = 20  #time step to start psfmean/psfhist
evl.psfgridsize = [] #FFT grid size <span class="keywordflow">for</span> psf computation <span class="keywordflow">for each</span>
<span class="preprocessor">             #wavelength. 0,1,or nwvl number of elements. 0:</span>
<span class="preprocessor"></span><span class="preprocessor">             #automatic. This determines the sampling of the computed</span>
<span class="preprocessor"></span><span class="preprocessor">             #PSF. length matches evl.wvl</span>
<span class="preprocessor"></span>evl.psfsize = [512] #size of the psf to output. The large PSF is cut to <span class="keyword">this</span>
<span class="preprocessor">            #size. Set to 1 to compute strehl only. 1 or nwvl number of</span>
<span class="preprocessor"></span><span class="preprocessor">            #elements(for each wvl)</span>
<span class="preprocessor"></span>
<span class="preprocessor">#some common DM parameters that are usually the same for each DM. Can take either 1 or ndm values.</span>
<span class="preprocessor"></span>dm.guard  = [1]    #extra DM actuator rings in actuator grid
dm.stroke = [inf]  #surface stroke in meter. opd is [-stroke stroke]
dm.cubic  = [1]    #1: cubic influence function, with dm.iac as inter-actuator-coupling.
dm.iac    = [0.3]  #inter-actuator-coupling coefficient.  
dm.hist   = [0]    #output histogram of DM actuator commands.
dm.histbin= [1e-7] #The bin size <span class="keywordflow">for</span> DM histogram computation.
dm.histn  = [201]  #Total number of bins. odd number, centered around zero.
dm.vmisreg= [0]    #vertical misregistration. not implemented yet.
dm.misreg = [<span class="stringliteral">&quot;&quot;</span>]   #misregistration.
dm.hyst   = [<span class="stringliteral">&quot;&quot;</span>]   #File containing a matrix that describes the <a class="code" href="filter_8c.html#ad77045492f420fe6b0958cc98c2bf13d" title="Apply hysterisis.">hysterisis</a>. The
<span class="preprocessor">           #matrix should have 3 rows, and multiple columns. Each column</span>
<span class="preprocessor"></span><span class="preprocessor">           #describe the parameters for a mode, and the rows are: 1)</span>
<span class="preprocessor"></span><span class="preprocessor">           #weight 2) alpha, 3) beta. See &quot;Hysteresis Modeling and</span>
<span class="preprocessor"></span><span class="preprocessor">           #Simulation&quot; by Luc Gilles. Notice that this alpha is alpha</span>
<span class="preprocessor"></span><span class="preprocessor">           #in laos multiplied by 0.5e-6.</span>
<span class="preprocessor"></span>dm.actfloat = [<span class="stringliteral">&quot;&quot;</span>] #file containing floating actuators. nx2 coordinate
dm.actstuck = [<span class="stringliteral">&quot;&quot;</span>] #file containing stuck actuators. nx2 coordinate.
</pre></div><p><code>"aper_tmt.conf"</code> to define the TMT aperture </p>
<div class="fragment"><pre class="fragment"></pre></div><p><code>"dm_dual.conf"</code> to define the dual deformable mirrors </p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#File dm_dual.conf</span>
<span class="preprocessor"></span>
<span class="preprocessor">#Deformable Mirror Information.</span>
<span class="preprocessor"></span>dm.order  = [60 60]   #The order of the system. 2 numbers <span class="keywordflow">for</span> two DMs.
dm.ht     = [0 11200] #height conjugation in meter.
dm.offset = [0 1/2]   #0: actuator is on subaperture edge. 1/2: actuator is on
<span class="preprocessor">              #subaperture center.</span>
</pre></div><p><code>"atm_mk13n50p.conf"</code> to define the turbulence profiles using the Mauna Kea 13N median seeing </p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#File atm_mk13n50p.conf</span>
<span class="preprocessor"></span>
<span class="preprocessor">#Turbulence profile for Mauna Kea 13N median seeing condition provided by TMT</span>
<span class="preprocessor"></span><span class="preprocessor">#site testing group. DIMM/MASS results were Extrapolated to above ~50m</span>
<span class="preprocessor"></span>
<span class="preprocessor">#2010-12-14: Updated to fixed profile provided by Matthias Schoeck.</span>
<span class="preprocessor"></span><span class="preprocessor">#2010-01-03: Some common parameters have been moved to sim.conf</span>
<span class="preprocessor"></span>
atm.r0z   = 0.186 #atm r0 at zenith
atm.l0    = 30    #atm outer scale

<span class="preprocessor">#atm.ht, atm.wt, atm.ws, atm.wsdeg must have the same length</span>
<span class="preprocessor"></span>atm.ht = [0 500 1000 2000 4000 8000 16000] 
<span class="preprocessor">       #turbulence screen height.</span>
<span class="preprocessor"></span>atm.wt = [0.4557    0.1295    0.0442    0.0506    0.1167    0.0926    0.1107]
<span class="preprocessor">       #weight of each layer. (normalized Cn^2). sum to 1.</span>
<span class="preprocessor"></span>atm.ws = [5.6 5.77 6.25 7.57 13.31 19.06 12.14 ];
<span class="preprocessor">       #wind speed to height atm.ht. updated on 2010-02-19. from tony on 2009-11</span>
<span class="preprocessor"></span>atm.wddeg = [0 0 0 0 0 0 0]  
<span class="preprocessor">       #wind direction in degree. If wdrand=1, this will be irrelevant.</span>
<span class="preprocessor"></span>
<span class="preprocessor">#Reconstructor parameters</span>
<span class="preprocessor"></span>atmr.r0z = -1  #atm r0 at zenith. -1: matches atm.r0z
atmr.l0  = -1  #atm outer scale.  -1: matches atm.l0
atmr.ht  = [0 1000 2000 4000 8000 16000]#reconstructed screen height.
atmr.wt  = [0.5248    0.1136    0.0416    0.1167    0.0926    0.1107]
<span class="preprocessor">     #reconstructed screen weight. see atm.wt</span>
<span class="preprocessor"></span>atmr.os  = [2 2 2 2 1 1] #over sampling factor of XLOC over the sampling defined by
<span class="preprocessor">             #actuator spacing.</span>
</pre></div><p><code>"wfs_multi_lgs.conf"</code> to define the wavefront sensors. </p>
<div class="fragment"><pre class="fragment"></pre></div> <div class="fragment"><pre class="fragment"><span class="preprocessor">#File llt_CL.conf for center launch</span>
<span class="preprocessor"></span><span class="preprocessor">#Specifying laser launch telescope and sodium layer parameters.</span>
<span class="preprocessor"></span><span class="preprocessor">#Notice that when the options are overriden else, the key must be specified like</span>
<span class="preprocessor"></span><span class="preprocessor">#powfs0_llt.d=0.4</span>
<span class="preprocessor"></span>
llt.d=0.4      #laser launch telescope diameter in meter.
llt.widthp=0.6 #Gaussian beam width. 60 percent of d
llt.fnamp=<span class="stringliteral">&quot;&quot;</span>   #Pupil amplitude map. Overrides widthp
llt.fnsurf=<span class="stringliteral">&quot;&quot;</span>  #Pupil surface error of each LLT. <a class="code" href="structcell.html" title="Cell of anything.">cell</a> array of 2-d <a class="code" href="structmap__t.html" title="OPD or Amplitude map defined on square/rectangular grids.">map_t</a> arrays.
llt.<a class="code" href="structmap__t.html#ac7a7ed6823814624bbe926ba3dadd79a" title="Origin in x.">ox</a>=[0]     #LLT x coordinate. single number or match # of wfs belongs to
<span class="preprocessor">          #this powfs.</span>
<span class="preprocessor"></span>llt.oy=[0]     #LLT y coordinate.
llt.misreg=[0 0]#misregistration during ray tracing (<span class="keywordflow">for</span> testing purpose)
llt.fnrange=<span class="stringliteral">&quot;&quot;</span> #additional change of sodium height <span class="keywordflow">for</span> LGS. in meter. 
<span class="preprocessor">          #matrix of size nsim*1 or nsim*nLGS.</span>
<span class="preprocessor"></span>llt.fnprof=<span class="stringliteral">&quot;NapMean.bin&quot;</span> #sodium profile to build LGS elongation ETF. can
<span class="preprocessor">               #contain 2 or more columns. The first column is the</span>
<span class="preprocessor"></span><span class="preprocessor">               #altitude, the second and the rest columns are the</span>
<span class="preprocessor"></span><span class="preprocessor">               #strength of sodium layer that sum to the scaling</span>
<span class="preprocessor"></span><span class="preprocessor">               #factor of signal level, normally 1.</span>
<span class="preprocessor"></span>llt.smooth = 1 #2010-07-21: smooth sodium profile. newly introduced.
llt.colprep= 0 #which column of the profiles to use in matched <a class="code" href="filter_8c.html#aafaf3cf93da63d63bd5f43be060ffa9c" title="Does the servo filtering by calling filter_cl() or filter_ol()">filter</a>.
llt.colsim = 0 #which column of the profiles to start to use in simulation.
llt.colsimdtrat=0 #every coldsimtrat to increment to next column during
<span class="preprocessor">               #simulation and update etf. 0 means not updating.</span>
<span class="preprocessor"></span><span class="preprocessor">#For side launch, uncomment and put the following in your override .conf file</span>
<span class="preprocessor"></span><span class="preprocessor">#SL_6</span>
<span class="preprocessor"></span><span class="preprocessor">#powfs.radpix=[30 0 0]</span>
<span class="preprocessor"></span><span class="preprocessor">#llt.ox=[3.2618  -10.6046  -13.8664   -3.2618   10.6046   13.8664]</span>
<span class="preprocessor"></span><span class="preprocessor">#llt.oy=[14.1284    9.8890   -4.2394  -14.1284   -9.8890    4.2394]</span>
<span class="preprocessor"></span><span class="preprocessor">#powfs.ncomp=[128 0 0]#128 is faster than 124 by many times.</span>
</pre></div><p><code>"fov_iris.conf"</code> to define the science fov for performance evaluation with IRIS. </p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#FILE evl_iris.conf Contains performance evaluation direction defined for TMT</span>
<span class="preprocessor"></span><span class="preprocessor">#NFIRAOS IRIS Instrument which has 17x17 square FoV.</span>
<span class="preprocessor"></span>
<span class="preprocessor">#performance evaluation directions.</span>
<span class="preprocessor"></span>evl.thetax  = [0 8.5 0 -8.5 0 8.5 -8.5 -8.5 8.5]#x coordinate in arcsec
evl.thetay  = [0 0 8.5 0 -8.5 8.5 8.5 -8.5 -8.5]#y coordinate in arcsec
evl.wt      = [4/9 1/9 1/9 1/9 1/9 1/36 1/36 1/36 1/36] #weighting to compute
<span class="preprocessor">                        #field average wavefront error.</span>
<span class="preprocessor"></span>

<span class="preprocessor">#DM Fitting directions </span>
<span class="preprocessor"></span><span class="preprocessor">#Circular, 30 as to better sharpen the NGS to get good sky coverage.</span>
<span class="preprocessor"></span>fit.thetax=[0  15  10.6066    0  -10.6066  -15 -10.6066   -0   10.6066]
fit.thetay=[0  0   10.6066   15   10.6066    0 -10.6066  -15  -10.6066]
fit.wt =   [1/2 1/12 1/24 1/12 1/24 1/12 1/24 1/12 1/24]
</pre></div><p><code>"recon.conf"</code> to define the parameters about turbulence reconstruction and DM fitting </p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#FILE recon.conf</span>
<span class="preprocessor"></span>
<span class="preprocessor">#The parameters for generation reconstruction</span>
<span class="preprocessor"></span>recon.alg       = 0 #0: MVR. 1: LSR
recon.glao      = 0 #1: average gradient from wfs of same type (GLAO).
recon.split     = 1 #0: integrated reconstruction. 1: ad hoc Split. 2: mvst (only <span class="keywordflow">if</span> recon.alg==0)
<span class="preprocessor">#The parameters for minimum variance tomography reconstruction, which is</span>
<span class="preprocessor"></span><span class="preprocessor">#composed of a turbulence tomography step and a DM fitting step.</span>
<span class="preprocessor"></span>
<span class="preprocessor">#Turbulence tomography reconstruction information.</span>
<span class="preprocessor"></span>
tomo.assemble   = 0 #1: Assemble tomography matrix.  0: don<span class="stringliteral">&#39;t assemble. 0 is</span>
<span class="stringliteral">            #fast for CG. automatically set to 1 in CBS mode</span>
<span class="stringliteral">tomo.predict    = 0 #prediction through modified ray tracing direction in tomo (testing)</span>
<span class="stringliteral">tomo.tikcr      = 1e-9#tikhonov regularization. Necessary if tomo.alg=0</span>
<span class="stringliteral">tomo.svdthres   = 1e-9 #threshold of SVD inversion. 1e-9 for GLAO. 2e-4 for BGS?</span>
<span class="stringliteral">tomo.piston_cr  = 0 #single point piston constraint in tomography. degrads</span>
<span class="stringliteral">            #fdpcg. does not help cg or cbs</span>
<span class="stringliteral"></span>
<span class="stringliteral">tomo.alg        = 1 #Tomography algorithm. 0: cholesky backsubstitution (CBS) on full #matrix</span>
<span class="stringliteral">            #1: Conjugate Gradient (CG). 2: SVD Inversion.</span>
<span class="stringliteral">tomo.bgs        = 0 #block Gauss Seidel method</span>
<span class="stringliteral">tomo.precond    = 0 #Tomography CG preconditioning. 0: no precondition. 1: Fourier Domain PCG</span>
<span class="stringliteral">tomo.maxit      = 30 #max iterations in CG. 30 is RTC requirement. 300 for Open loop</span>
<span class="stringliteral">tomo.minwt      = 0.01 #minimum layer weight allowed. if less than this will force to this.</span>
<span class="stringliteral">tomo.square     = 0 #1: using square grid in tomography (xloc)</span>
<span class="stringliteral"></span>
<span class="stringliteral">#The following split_* options are only used in ad hoc split tomography</span>
<span class="stringliteral">tomo.ahst_wt    = 1 #weighting method to remove ngs modes from lgs DM commands.</span>
<span class="stringliteral">                    #1: use NGS gradient reconstruction weighting, 2:use</span>
<span class="stringliteral">                    #aperture evaluation weighting, 3: identity weighting.</span>
<span class="stringliteral">tomo.ahst_idealngs = 0 #apply ideal NGS mode correction. for skycoverage pre-simulation</span>
<span class="stringliteral">tomo.ahst_rtt      = 0 #remove tip/tilt on each DM. generally not necessary.</span>
<span class="stringliteral"></span>
<span class="stringliteral">tomo.cone     = 1 #1: using cone coordinate for tomography grid. keep at 1.</span>
<span class="stringliteral">tomo.cxx      = 0 #method to compute Cxx^-1. 0: bihormonic approx. 1: inverse psd. 2: fractal</span>
<span class="stringliteral">tomo.cxxscale = 1 #scale the Cxx^-1 term.</span>
<span class="stringliteral">tomo.guard    = 1 #rings of padding in generating reconstruction grid, not too small, not too large.</span>
<span class="stringliteral">tomo.pos      = 2 #over sampling ratio of ploc grid over actuator grid</span>
<span class="stringliteral">tomo.nxbase   = 0 #Each layer xloc grid size is tomo.os*tomo.nxbase is not zero. same for ploc.</span>
<span class="stringliteral"></span>
<span class="stringliteral">tomo.cubic    = 0 #cubic influence function in tomography (testing)</span>
<span class="stringliteral">tomo.iac      = 0 #inter-actuator-coupling in cubic influence function (testing)</span>
<span class="stringliteral">tomo.ninit    = 5 #Initial size of the screen in fractal method. &gt;=2</span>
<span class="stringliteral">tomo.psol     = 1 #Use pseudo open loop gradients in MVR. keep at 1.</span>
<span class="stringliteral">#DM Fitting</span>
<span class="stringliteral">fit.tikcr     = 1e-7 #tikhonov regularization. 1.e-9 is not enough.</span>
<span class="stringliteral">fit.svdthres  = 2e-4 #threshold of SVD inversion</span>
<span class="stringliteral">fit.actslave  = 1 #actuators that are in NULL space of HA are slaved to active ones.</span>
<span class="stringliteral">fit.lrt_piston= 1 #piston constraint</span>
<span class="stringliteral">fit.lrt_tt    = 1 #Tip/tilt constraint (2 dm system only). 0: no. 2: differential</span>
<span class="stringliteral">          #tilt on two DMs. 1: upper DM tt constraint.</span>
<span class="stringliteral">fit.assemble  = 1 #1: assemble fit matrix. fast for fit.</span>
<span class="stringliteral">fit.alg       = 1 #Fitting algorithm. see tomo.alg</span>
<span class="stringliteral">fit.bgs       = 0 #block Gauss Seidel method</span>
<span class="stringliteral">fit.precond   = 0 #CG preconditioning. see tomo.precond</span>
<span class="stringliteral">fit.maxit     = 4 #max iterations in CG.</span>
<span class="stringliteral">fit.square    = 0 #use square grid on DM grid and ploc</span>
<span class="stringliteral">fit.ht        = [inf] #the height of the science object to optimize DM fitting with. normally infinity</span>
<span class="stringliteral">fit.pos       = 2 #over sampling ratio of floc grid over actuator grid</span>
<span class="stringliteral"></span>
<span class="stringliteral">#Parameters for least square reconstructor follows tomography parameter.</span>
<span class="stringliteral">lsr.tikcr     = 1e-9</span>
<span class="stringliteral">lsr.svdthres  = 1e-5</span>
<span class="stringliteral">lsr.fnreg     = #File name for regularization. has to be sparse cell array of ndm*ndm. </span>
<span class="stringliteral">lsr.actslave  = 1</span>
<span class="stringliteral">lsr.bgs       = 0</span>
<span class="stringliteral">lsr.alg       = 2</span>
<span class="stringliteral">lsr.maxit     = 30</span>
</pre></div><p><code>"dbg.conf"</code> to define debugging and saving/loading geometry and telemetry. </p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#FILE dbg.conf</span>
<span class="preprocessor"></span>
<span class="preprocessor">###The following are parameters used for debugging</span>
<span class="preprocessor"></span>dbg.psol=0      #use dm command 1 frame in the future to form pseudo open loop
<span class="preprocessor">            #gradients (RTC scheme). Tested ok.</span>
<span class="preprocessor"></span>dbg.atm   = 0   #test special atmosphere. 1: tip/tilt. 2: diff focus. -1: use power of -4 instead of -11/3.

dbg.wamethod=0  #0: Use mod on dm. 1: use mod on science when tomo.split_wt=2
dbg.keepshm=0   #keep screens in shm even is unused.
dbg.mvstlimit=0 #limit MVST modes to the number <span class="keywordflow">if</span> none zero
dbg.annular_W=0
dbg.tomo_maxit=[]#<span class="keywordflow">if</span> not empty, will study these maxits in open loop
dbg.tomo_hxw=0  #1: force use hxw
dbg.splitlrt=1  #1: use LGS low rank terms in split tomography.
dbg.ecovxx=0    #output ecovxx used to generate ecov.
dbg.useopdr=0   #use opdr. (deprecated)
dbg.usegwr=0    #GA/GX method. 0: GP, 1: GS0
dbg.dxonedge=0  #have points on the edge of subapertures.
dbg.cmpgpu=0    #1: make cpu code follow GPU implementation.
dbg.pupmask=0   #pupil mask (<span class="keywordflow">for</span> ngs wfs, within LGS volume)
dbg.wfslinearity=-1#Study the linearity/noise <span class="keyword">property</span> of pixel processing algorithms of <span class="keyword">this</span> wfs.
#For plotting
plot.setup=0 #plot aperture,powfs,recon grids, etc.
plot.atm=0   #plot atmosphere
plot.run=0   #plot wfs opd, gradients, DM opd, science opd, etc.
plot.opdx=0  #plot turbulence projeced to xloc.
plot.all=0   #enables plot.setup, plot.atm, and plot.run

<span class="preprocessor">#The saved files can be loaded with mex routine &quot;read&quot; in MATLAB.</span>
<span class="preprocessor"></span>save.all=0   #saves everything below except gcov. mainly <span class="keywordflow">for</span> debugging
save.setup=0 #save the data structs prepared during setup in subfolder <span class="stringliteral">&quot;setup&quot;</span>.
         #They Can be loaded back in future simulation.
save.recon=0 #save reconstructor. big matrices.
save.mvst=0  #save mvst intermediate matrices in preparation to load later.
#Run time saving:
save.atm =0  #save atmosphere
save.run =0  #save run time information, also enables save.dmreal,gradcl,gradpsol


<span class="preprocessor">#The following four options takes 1) scalar values of 0 or 1 where 1 means all</span>
<span class="preprocessor"></span><span class="preprocessor">#wfs. or 2) vector values equal to the number of wfs. In the vector case, 1</span>
<span class="preprocessor"></span><span class="preprocessor">#means output, 0 means no output.</span>
<span class="preprocessor"></span>save.ints=0   #save wfs subaperture images (images). (read above)
save.grad=0   #save wfs gradients (also enabled by save.run)(read above)
save.wfsopd=0 #save wfs OPDs (read above)
save.gradgeom=0#save geometric grads in physical optics simulations (read above)

save.evlopd=0 #save evaluation directions opd every <span class="keyword">this</span> time step <span class="keywordflow">if</span> &gt;0. since 2011-02-07
save.opdr=0   #save reconstructed atmosphere. 
save.opdx=0   #save atmosphere propagated to reconstruction grid.
save.dm=0 #   total DM commands effective. including tip/tilt.(implicit <span class="keywordflow">if</span> save.run=1)
#special run time saving that need extra computation.
save.dmpttr=0 #save ptt removed DM actuator commands (implicit <span class="keywordflow">if</span> save.run=1)
save.gcovp=100#save the gcov every 100 steps to different files.
save.gcov=[]  #output covariance of psol gradient. <span class="keyword">set</span> to [1 3 2 5] to output
<span class="preprocessor">          #covariance between wfs 1 and 3, 2 and 5 drawdaemon is used to do</span>
<span class="preprocessor"></span><span class="preprocessor">          #the plotting.</span>
<span class="preprocessor"></span>
load.atm=#<span class="stringliteral">&quot;atm.fn&quot;</span> #load atmosphere. <a class="code" href="structcell.html" title="Cell of anything.">cell</a> array of <span class="keywordtype">double</span> number arrays. The
<span class="preprocessor">     #sampling must match the key atm.dx in atm_*.conf</span>
<span class="preprocessor"></span>load.locs=#<span class="stringliteral">&quot;aper_locs&quot;</span> #load aperture grid
load.aloc=#<span class="stringliteral">&quot;aloc&quot;</span> #load DM grid
load.xloc=#<span class="stringliteral">&quot;xloc&quot;</span> #load tomogrpahy grid. <a class="code" href="structcell.html" title="Cell of anything.">cell</a> array
load.ploc=#<span class="stringliteral">&quot;ploc&quot;</span> #load aperture reconstruction grid.
load.floc=#<span class="stringliteral">&quot;floc&quot;</span> #load aperture fitting grid.
load.cxx=#<span class="stringliteral">&quot;cxx^-1&quot;</span> #load laplacian or bihormonic <span class="keyword">operator</span>.
load.HXF=#<span class="stringliteral">&quot;HXF&quot;</span> #load propagation matrix from xloc to ploc along fit directions
load.HXW=#<span class="stringliteral">&quot;HXW&quot;</span> #load propagation matrix from xloc to ploc along wfs directions
load.HA=#<span class="stringliteral">&quot;HA&quot;</span> #load propagation matrix from aloc to ploc
load.GP=#<span class="stringliteral">&quot;GP&quot;</span> #load gradient operator from ploc to wfs (<span class="keywordflow">for</span> tomography)
load.GA=#<span class="stringliteral">&quot;GA&quot;</span> #load gradient operator from aloc to wfs (to compute pseudo
    #openloop gradients)
load.GS0=0  #load gradient <span class="keyword">operator</span> from WFS opd to WFS grad.
load.tomo=0 #load tomography reconstruction matrices
load.fit=0  #load fitting matrices.
load.W=0    #load aperture W0/W1 weighting matrix.
load.i0=0   #load wfs pixel intensity matrices.
load.mvst=0 #load mvst intermediate matrices to avoid CBS
</pre></div> </div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="footer">Generated on Wed Feb 15 2012 15:30:59 for maos-1.0.2 by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </li>
    </ul>
  </div>

</body>
</html>
