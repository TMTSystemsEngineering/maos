<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>maos-0.7.5: Example: NFIRAOS</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1><a class="anchor" name="nfiraos">Example: NFIRAOS </a></h1>The following shows the content of nfiraos.conf, which is the baseline configuration of TMT NFIRAOS system<p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#File nfiraos.conf</span>
<span class="preprocessor"></span>
<span class="preprocessor">#This .conf file contains the complete configuration of TMT NFIRAOS System.  You</span>
<span class="preprocessor"></span><span class="preprocessor">#can copy this .conf to another file and modify it to model different systems or</span>
<span class="preprocessor"></span><span class="preprocessor">#choose different parameters. This file is loaded by maos automatically if \c -c</span>
<span class="preprocessor"></span><span class="preprocessor">#switch is not supplied. </span>
<span class="preprocessor"></span>
<span class="preprocessor">#Notice: </span>
<span class="preprocessor"></span><span class="preprocessor">#All string must be quoted with ""</span>
<span class="preprocessor"></span><span class="preprocessor">#Vectors should be embraced by [].</span>
<span class="preprocessor"></span><span class="preprocessor">#Anything following # in each line is treated as comment.</span>
<span class="preprocessor"></span>
<span class="preprocessor">#The value of some key might be another .conf while, in which case the .conf</span>
<span class="preprocessor"></span><span class="preprocessor">#file is loaded automatically. like powfs.llt </span>
<span class="preprocessor"></span>
<span class="preprocessor">#defines simulation parameters.</span>
<span class="preprocessor"></span>include     = <span class="stringliteral">"sim.conf"</span>
<span class="preprocessor">#Telescope Aperture Configuration.</span>
<span class="preprocessor"></span>include     = <span class="stringliteral">"aper_tmt.conf"</span> #TMT.

#Tilt surfaces. Each file contains a <a class="code" href="structdmat.html" title="a double matrix object contains 2-d array of double numbers">dmat</a> array with the following key in header.
#dx,dy: the sampling along x and y direction, 
<span class="preprocessor">#ox,oy: the origin along x and y direction, </span>
<span class="preprocessor"></span><span class="preprocessor">#txdeg: the x tilt angle in degree wrt beam (90 is prep), </span>
<span class="preprocessor"></span><span class="preprocessor">#tydeg: the y tilt angle in degree wrt beam (90 is prep), </span>
<span class="preprocessor"></span><span class="preprocessor">#ftel: The telescope effective focal length, </span>
<span class="preprocessor"></span><span class="preprocessor">#fexit: the distance between the exit pupil and the focus, </span>
<span class="preprocessor"></span><span class="preprocessor">#fsurf: the distance between the M3 and the focus.</span>
<span class="preprocessor"></span>tsurf       = [] #[<span class="stringliteral">"M3_PrintThrough_ZA0_AA180_YA45.bin.gz"</span>]

<span class="preprocessor">#OPD surfaces. Each file contains a dmat array with the following key in header.</span>
<span class="preprocessor"></span><span class="preprocessor">#dx: the sampling along x and y direction (must be the same)</span>
<span class="preprocessor"></span><span class="preprocessor">#ox,oy: the origin along x and y direction</span>
<span class="preprocessor"></span><span class="preprocessor">#h: height of the surface from pupil.   </span>
<span class="preprocessor"></span><span class="preprocessor">#The second cell contains the OPD array.</span>
<span class="preprocessor"></span>surf        = [] #surface OPD map. can be a list of file names.

#AO type. 
include     = <span class="stringliteral">"dm_dual.conf"</span> #MCAO with dual DMs

<span class="preprocessor">#Atmospheric profile</span>
<span class="preprocessor"></span><span class="preprocessor">#atm="atm_srd.conf" #TMT SRD Profile</span>
<span class="preprocessor"></span>include     = <span class="stringliteral">"atm_mk13n50p.conf"</span> #Mauna Kea 13N 50%.

#Wavefront sensor information.
include     = <span class="stringliteral">"wfs_lgs_ttf_tt.conf"</span>

<span class="preprocessor">#Evaluation and fitting FoV information.</span>
<span class="preprocessor"></span>include     = <span class="stringliteral">"fov_iris.conf"</span>

<span class="preprocessor">#Including configurations for reconstruction (tomo/fitting)</span>
<span class="preprocessor"></span>include     = <span class="stringliteral">"recon.conf"</span>

<span class="preprocessor">#For debugging purpose</span>
<span class="preprocessor"></span>include     = <span class="stringliteral">"dbg.conf"</span>
</pre></div><p>
It includes the following files to define all the parameters. <code>"sim.conf"</code> to define some general parameters: <div class="fragment"><pre class="fragment"><span class="preprocessor">#FILE sim.conf</span>
<span class="preprocessor"></span>
<span class="preprocessor">#defines simulation parameters.</span>
<span class="preprocessor"></span><a class="code" href="sim_8c.html#b5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.seeds=[1]#random seeds. a list. 0 means random seed
<a class="code" href="sim_8c.html#b5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.start=0 #first time step. usually 0.
sim.end=500 #last time step (exclusive)
<a class="code" href="sim_8c.html#b5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.closeloop=1 <span class="preprocessor">#closed loop simulation</span>
<span class="preprocessor"></span><a class="code" href="sim_8c.html#b5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.dt=1/800#loop sampling time. (WFS integration time)
<a class="code" href="sim_8c.html#b5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.cachedm=1 #Caching DM commands to fine sampled grids that matches the
          #sampling of the WFS and/or science evaluation grid. speed up
          #simulation
<a class="code" href="sim_8c.html#b5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.cachesurf=1#cache OPD surface (surf, tsurf), avoid raytracing each time step
<span class="preprocessor">#Servo coefficients. There is two cycle delay.</span>
<span class="preprocessor"></span><span class="preprocessor">#A is command. e is error signal. at time step n, the command is updated by</span>
<span class="preprocessor"></span><span class="preprocessor">#A(n)=A(n-1)*apdm(0)+A(n-2)*ap(1)+...+e(n-2)*ep</span>
<span class="preprocessor"></span><a class="code" href="sim_8c.html#b5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.apdm=[1 0]#<span class="keyword">this</span> is the <span class="keywordflow">default</span>. [0.5 0.5] is used in laos 
<a class="code" href="sim_8c.html#b5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.epdm=1/2 #error gain of high order loop
<a class="code" href="sim_8c.html#b5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.apngs=[1 0]#<span class="keyword">this</span> is the <span class="keywordflow">default</span>. [0.5 0.5] is used in laos.
sim.epngs=0.5 #error gain of ngs mode in split tomography

<a class="code" href="sim_8c.html#b5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.fuseint=1 #use fused integrator. <span class="keywordflow">for</span> high and low order loop.
sim.servotype_hi=1 #1: simple integrator servo <span class="keywordflow">for</span> high order loop
<a class="code" href="sim_8c.html#b5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.servotype_lo=1 #1: simple integrator servo <span class="keywordflow">for</span> low order loop. 2: type II
<span class="preprocessor">           #control.  </span>
<span class="preprocessor"></span><a class="code" href="sim_8c.html#b5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.gtypeII_lo=<span class="stringliteral">""</span> #contains 3x1 or 3xnmod coeffs <span class="keywordflow">for</span> type II servo lo 
<a class="code" href="sim_8c.html#b5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.frozenflow=0 #<span class="keyword">using</span> frozen flow screen (at OL. CL is always frozenflow)

<span class="preprocessor">#Focus tracking gains.</span>
<span class="preprocessor"></span><a class="code" href="sim_8c.html#b5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.lpfocus=0 #coefficient <span class="keywordflow">for</span> focus update low pass <a class="code" href="filter_8c.html#afaf3cf93da63d63bd5f43be060ffa9c" title="Does the servo filtering by calling filter_cl() or filter_ol().">filter</a>
<a class="code" href="sim_8c.html#b5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.epfocus=0 #coefficient <span class="keywordflow">for</span> focus update integrator error gain.
sim.mffocus=0 #method <span class="keywordflow">for</span> focus update. 0 to disable focus update. 1: <span class="keywordflow">default</span>
<span class="preprocessor">          #implementation in RTC block diagram. see recon.c for details.</span>
<span class="preprocessor"></span>
<span class="preprocessor">#Uplink laser pointing servo</span>
<span class="preprocessor"></span><a class="code" href="sim_8c.html#b5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.apupt=[1 0]#[0.5 0.5] is used in laos.
sim.epupt=0.5 #uplink integrator gain
<a class="code" href="sim_8c.html#b5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.dpupt=0. #uplink derivative gain <span class="keywordflow">if</span> use derivative control.
sim.uptideal=0 #ideal correction on uplink (debugging)

<a class="code" href="sim_8c.html#b5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.<a class="code" href="skysim_8c.html#f8d01af26f9797cb337a56def4eaad4e" title="Setup the stars fields and then calls skysim_isky() to handle each star field.">skysim</a>=0 <span class="preprocessor">#enable presimulation for sky coverage.</span>
<span class="preprocessor"></span><a class="code" href="sim_8c.html#b5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.zadeg =0 #zenith angle. moved from atm.zadeg

<span class="preprocessor">#CN2 Estimation</span>
<span class="preprocessor"></span>cn2.pair=[]#pairs of wfs to estimate cn2. empty to disable cn2 estimation.
cn2.step =100#<span class="keywordflow">do</span> cn2 estimation every <span class="keyword">this</span> time step
cn2.reset=0#reset the accumulated cn2 after every cn2step.
cn2.tomo=0#update tomography parameters <span class="keywordflow">if</span> non zero
cn2.hmax=18000#maximum height to esimate at zenith
cn2.saat=0.95#subaperture area threashold to use in cn2 estimation
cn2.keepht=0#nonzero: keep the layer ht specified by atmr.ht. 2: <span class="keywordflow">do</span> slodar directly on these layers.
cn2.nhtrecon=6# number of layers to feed into reconstructor. only effective <span class="keywordflow">if</span> keepht=0
cn2.moveht=0#move the ht used <span class="keywordflow">for</span> reconstructor to near strongest layers. only
<span class="preprocessor">        #effective if keepht=0.</span>
</pre></div><p>
<code>"aper_tmt.conf"</code> to define the TMT aperture <div class="fragment"><pre class="fragment"><span class="preprocessor">#File aper_tmt.conf</span>
<span class="preprocessor"></span>
<span class="preprocessor">#Telescope Aperture Configuration.</span>
<span class="preprocessor"></span>aper.d   = 30  #outer diameter of the telescope.
aper.din = 3.6 #inner hole diameter of the telescope.
aper.dx  = 1/64#sampling of the aperture in simulation
aper.fnamp  = <span class="stringliteral">"TMT_CurDesign.bin.gz"</span> #The amplitude map contains a cell array
<span class="preprocessor">         # of 2 elements.  The first element is 5x1 vector, specifying</span>
<span class="preprocessor"></span><span class="preprocessor">         # sampling dx, dy, origin coordinate ox, oy and height (0).  </span>
<span class="preprocessor"></span><span class="preprocessor">         # The second element is a NxN square array.</span>
<span class="preprocessor"></span>aper.rotdeg = 0 #Telescope pupil rotation CCW with respect to instrument. 
aper.cropamp= 0 #restrict amplitude map to within aper.d. keep at zero is good.

</pre></div><p>
<code>"dm_dual.conf"</code> to define the dual deformable mirrors <div class="fragment"><pre class="fragment"><span class="preprocessor">#File dm_dual.conf</span>
<span class="preprocessor"></span>
<span class="preprocessor">#Deformable Mirror Information.</span>
<span class="preprocessor"></span>dm.order  = [60 60]   #The order of the system. 2 numbers <span class="keywordflow">for</span> two DMs.
dm.guard  = [0  0]    #extra DM actuator rings in actuator grid
dm.stroke = [inf inf] #surface stroke in meter. opd is [-stroke stroke]
dm.vmisreg= [0 0]     #vertical misregistration. not implemented yet.
dm.ht     = [0 11200] #height conjugation in meter.
dm.offset = [0 1/2]   #0: actuator is on subaperture edge. 1/2: actuator is on
<span class="preprocessor">              #subaperture center.</span>
<span class="preprocessor"></span>dm.cubic  = [1 1]     #0 to disable cubic. Always normalized. 
dm.iac    = [0.3 0.3] #inter-actuator-coupling coefficient.  

dm.hist   = [0 0]     #output histogram of DM actuator commands.
dm.histbin= [1e-7 1e-7] #The bin size <span class="keywordflow">for</span> DM histogram computation.
dm.histn  = [201 201]#Total number of bins. odd number.
</pre></div><p>
<code>"atm_mk13n50p.conf"</code> to define the turbulence profiles using the Mauna Kea 13N median seeing <div class="fragment"><pre class="fragment"><span class="preprocessor">#File atm_mk13n50p.conf</span>
<span class="preprocessor"></span>
<span class="preprocessor">#Turbulence profile for Mauna Kea 13N median seeing condition provided by TMT</span>
<span class="preprocessor"></span><span class="preprocessor">#site testing group. DIMM/MASS results were Extrapolated to above ~50m</span>
<span class="preprocessor"></span>
atm.r0z   = 0.1987#atm r0 at zenith
atm.l0    = 30    #atm outer scale

<span class="preprocessor">#atm.ht, atm.wt, atm.ws, atm.wsdeg must have the same length</span>
<span class="preprocessor"></span>atm.ht = [0 500 1000 2000 4000 8000 16000] 
<span class="preprocessor">       #turbulence screen height.</span>
<span class="preprocessor"></span>atm.wt = [0.2887 0.17795 0.06602 0.07833 0.1405 0.1216 0.1269]
<span class="preprocessor">       #weight of each layer. (normalized Cn^2). sum to 1.</span>
<span class="preprocessor"></span>atm.ws = [5.6 5.77 6.25 7.57 13.31 19.06 12.14 ];
<span class="preprocessor">       #wind speed to height atm.ht. updated on 2010-02-19. from tony on 2009-11</span>
<span class="preprocessor"></span>atm.wddeg = [0 0 0 0 0 0 0]  
<span class="preprocessor">       #wind direction in degree. If wdrand=1, this will be irrelevant.</span>
<span class="preprocessor"></span>
atm.wdrand = 1 #randomize wind direction 

atm.size  = [0 0] #size of atmosphere in meter. 0: automatic.
atm.dx    = 1/64  #sampling of the atmosphere, match aper.dx

<span class="preprocessor">#Reconstructor parameters</span>
<span class="preprocessor"></span>atmr.r0z = -1  #atm r0 at zenith. -1: matches atm.r0z
atmr.l0  = -1  #atm outer scale.  -1: matches atm.l0
atmr.ht  = [0 1000 2000 4000 8000 16000]#reconstructed screen height.
atmr.wt  = [0.38362 0.1615 0.0659 0.1405 0.1216 0.1269]
<span class="preprocessor">     #reconstructed screen weight. see atm.wt</span>
<span class="preprocessor"></span>atmr.os  = [2 2 2 2 1 1] #over sampling factor of XLOC over the sampling defined by
<span class="preprocessor">             #actuator spacing.</span>
</pre></div><p>
<code>"wfs_multi_lgs.conf"</code> to define the wavefront sensors. <div class="fragment"><pre class="fragment"></pre></div> <div class="fragment"><pre class="fragment"><span class="preprocessor">#File llt_CL.conf for center launch</span>
<span class="preprocessor"></span><span class="preprocessor">#Specifying laser launch telescope and sodium layer parameters.</span>
<span class="preprocessor"></span>
<span class="preprocessor">#The number in () is the power that uses this llt. has to match.</span>
<span class="preprocessor"></span>llt(0).d=0.4      #laser launch telescope diameter in meter.
llt(0).widthp=0.6 #Gaussian beam width. 60 percent of d
llt(0).ox=[0]     #LLT x coordinate. single number or match # of wfs belongs to
<span class="preprocessor">          #this powfs.</span>
<span class="preprocessor"></span>llt(0).oy=[0]     #LLT y coordinate.
llt(0).fnrange=<span class="stringliteral">""</span> #additional change of sodium height <span class="keywordflow">for</span> LGS. in meter. 
<span class="preprocessor">          #matrix of size nsim*1 or nsim*nLGS.</span>
<span class="preprocessor"></span>llt(0).fn=<span class="stringliteral">"NapMean.bin.gz"</span> #sodium profile to build LGS elongation ETF. can
<span class="preprocessor">               #contain 2 or more columns. The first column is the</span>
<span class="preprocessor"></span><span class="preprocessor">               #altitude, the second and the rest columns are the</span>
<span class="preprocessor"></span><span class="preprocessor">               #strength of sodium layer that sum to the scaling</span>
<span class="preprocessor"></span><span class="preprocessor">               #factor of signal level, normally 1.</span>
<span class="preprocessor"></span>llt(0).smooth = 1 #2010-07-21: smooth sodium profile. newly introduced.
llt(0).colprep= 0 #which column of the profiles to use in matched <a class="code" href="filter_8c.html#afaf3cf93da63d63bd5f43be060ffa9c" title="Does the servo filtering by calling filter_cl() or filter_ol().">filter</a>.
llt(0).colsim = 0 #which column of the profiles to start to use in simulation.
llt(0).colsimdtrat=0 #every coldsimtrat to increment to next column during
<span class="preprocessor">               #simulation and update etf. 0 means not updating.</span>
<span class="preprocessor"></span>
<span class="preprocessor">#For side launch, uncomment and put the following in your override .conf file</span>
<span class="preprocessor"></span><span class="preprocessor">#SL_6</span>
<span class="preprocessor"></span><span class="preprocessor">#powfs.radpix=[30 0 0]</span>
<span class="preprocessor"></span><span class="preprocessor">#powfs(0).llt.ox=[3.2618  -10.6046  -13.8664   -3.2618   10.6046   13.8664]</span>
<span class="preprocessor"></span><span class="preprocessor">#powfs(0).llt.oy=[14.1284    9.8890   -4.2394  -14.1284   -9.8890    4.2394]</span>
<span class="preprocessor"></span><span class="preprocessor">#powfs.ncomp=[128 0 0]#128 is faster than 124 by many times.</span>
</pre></div><p>
<code>"fov_iris.conf"</code> to define the science fov for performance evaluation with IRIS. <div class="fragment"><pre class="fragment"><span class="preprocessor">#FILE evl_iris.conf Contains performance evaluation direction defined for TMT</span>
<span class="preprocessor"></span><span class="preprocessor">#NFIRAOS IRIS Instrument which has 17x17 square FoV.</span>
<span class="preprocessor"></span>
<span class="preprocessor">#performance evaluation directions.</span>
<span class="preprocessor"></span>evl.thetax  = [0 8.5 0 -8.5 0 8.5 -8.5 -8.5 8.5]#x coordinate in arcsec
evl.thetay  = [0 0 8.5 0 -8.5 8.5 8.5 -8.5 -8.5]#y coordinate in arcsec
evl.wt      = [4/9 1/9 1/9 1/9 1/9 1/36 1/36 1/36 1/36] #weighting to compute
<span class="preprocessor">                        #field average wavefront error.</span>
<span class="preprocessor"></span>evl.psf     = [1] #output psf <span class="keywordflow">for</span> <span class="keyword">this</span> direction <span class="keywordflow">if</span> psf is computed. 1 or nevl elements.
evl.ht      = inf #the height of the science <span class="keywordtype">object</span>. normally infinity. can be at LGS range.
evl.rmax    = 1   #max radial order in performance evaluation. 
<span class="preprocessor">           #1: includes piston/tip/tilt. 2: p/t/t/focus/astigmatism</span>
<span class="preprocessor"></span>evl.tomo    = 0 #evaluate CL error <span class="keywordflow">for</span> tomography
evl.moao    = -1 #index into MOAO config in recon.conf
evl.psfhist = 0 #output history of the psf (a lot of storage). 
evl.psfmean = 0 #output time averaged psf
evl.psfsize = 512 #size of the psf to output. The large PSF is cut to <span class="keyword">this</span>
<span class="preprocessor">          #size. Set to 1 to compute strehl only</span>
<span class="preprocessor"></span>
evl.psfol   = 1   #compute OL psf in additional to CL PSF. 0: disable 1: on axis
<span class="preprocessor">              #direction only, 2: all directions and average them.</span>
<span class="preprocessor"></span>
evl.psfpttr = 1   #<span class="keyword">remove</span> p/t/t in wavefront OPD before computing PSF.
evl.psfisim = 20  #time step to start psfmean/psfhist
evl.psfwvl     = [1.25e-6 1.65e-6 2.2e-6]#wavelength to evaluat PSF or strehl
evl.psfgridsize = [] #FFT grid size <span class="keywordflow">for</span> psf computation <span class="keywordflow">for each</span>
<span class="preprocessor">             #wavelength. 0,1,or nwvl number of elements. 0:</span>
<span class="preprocessor"></span><span class="preprocessor">             #automatic. This determines the sampling of the computed</span>
<span class="preprocessor"></span><span class="preprocessor">             #PSF. length matches evl.wvl</span>
<span class="preprocessor"></span>
<span class="preprocessor">#DM Fitting directions </span>
<span class="preprocessor"></span><span class="preprocessor">#Circular, 30 as to better sharpen the NGS to get good sky coverage.</span>
<span class="preprocessor"></span><a class="code" href="recon_8c.html#861c4d9312ead5560557940f35618e17" title="Carry out DM fit.">fit</a>.thetax=[0  15  10.6066    0  -10.6066  -15 -10.6066   -0   10.6066]
<a class="code" href="recon_8c.html#861c4d9312ead5560557940f35618e17" title="Carry out DM fit.">fit</a>.thetay=[0  0   10.6066   15   10.6066    0 -10.6066  -15  -10.6066]
<a class="code" href="recon_8c.html#861c4d9312ead5560557940f35618e17" title="Carry out DM fit.">fit</a>.wt =   [1/2 1/12 1/24 1/12 1/24 1/12 1/24 1/12 1/24]
</pre></div><p>
<code>"recon.conf"</code> to define the parameters about turbulence reconstruction and DM fitting <div class="fragment"><pre class="fragment"><span class="preprocessor">#FILE recon.conf</span>
<span class="preprocessor"></span>
<span class="preprocessor">#Reconstruction information.</span>
<span class="preprocessor"></span><a class="code" href="recon_8c.html#1caeb1e38df41119be050faafe482d19" title="Carry out tomography.">tomo</a>.split      = 1 #1: ad hoc Split tomography. 0: integrated tomography. 2: mvst
<a class="code" href="recon_8c.html#1caeb1e38df41119be050faafe482d19" title="Carry out tomography.">tomo</a>.assemble   = 0 #1: Assemble tomography matrix.  0: don<span class="stringliteral">'t assemble. 0 is</span>
<span class="stringliteral">            #fast for CG. automatically set to 1 in CBS mode</span>
<span class="stringliteral">tomo.windest    = 0 #estimate wind velocity from tomography outputs. (testing)</span>
<span class="stringliteral">tomo.windshift  = 0 #shift opdr using wind velocity. (testing)</span>
<span class="stringliteral">tomo.tikcr      = 0 #1e-9#tikhonov regularization. Necessary if tomo.alg=2 or piston_cr=1</span>
<span class="stringliteral">tomo.piston_cr  = 1 #single point piston constraint in tomography.</span>
<span class="stringliteral"></span>
<span class="stringliteral">tomo.alg        = 1 #Tomography algorithm. 0: cholesky backsubstitution (CBS) on full #matrix</span>
<span class="stringliteral">            #1: Conjugate Gradient (CG).</span>
<span class="stringliteral">tomo.precond    = 0 #Tomography CG preconditioning. 0: no precondition. 1: Fourier Domain PCG</span>
<span class="stringliteral">tomo.maxit      = 30 #max iterations in CG. 30 is RTC requirement. 300 for Open loop</span>
<span class="stringliteral">tomo.minwt      = 0.01 #minimum layer weight allowed. if less than this will force to this.</span>
<span class="stringliteral">tomo.square     = 0 #1: using square grid in tomography (xloc)</span>
<span class="stringliteral"></span>
<span class="stringliteral">#The following split_* options are only used in ad hoc split tomography</span>
<span class="stringliteral">tomo.ahst_wt   = 1 #weighting method to remove ngs modes from lgs DM commands.</span>
<span class="stringliteral">                   #1: use NGS gradient reconstruction weighting, 2:use</span>
<span class="stringliteral">                   #aperture evaluation weighting, 3: identity weighting.</span>
<span class="stringliteral">tomo.ahst_idealngs = 0 #apply ideal NGS mode correction. for skycoverage pre-simulation</span>
<span class="stringliteral">tomo.ahst_rtt      = 0 #remove tip/tilt on each DM. generally not necessary.</span>
<span class="stringliteral"></span>
<span class="stringliteral">tomo.cone   = 1 #1: using cone coordinate for tomography grid. keep at 1.</span>
<span class="stringliteral">tomo.invpsd = 0 #use inverse PSD to do regularization instead of the bi-harmonic apprixmation.</span>
<span class="stringliteral">tomo.guard  = 1 #rings of padding in generating reconstruction grid, not too small, not too large.</span>
<span class="stringliteral">tomo.pos    = 2 #over sampling ratio of ploc grid over actuator grid</span>
<span class="stringliteral"></span>
<span class="stringliteral">fit.tikcr     = 1e-7 #tikhonov regularization. 1.e-9 is not enough.</span>
<span class="stringliteral">fit.actslave  = 1 #actuators that are in NULL space of HA are slaved to active ones.</span>
<span class="stringliteral">fit.lrt_piston= 1 #piston constraint</span>
<span class="stringliteral">fit.lrt_tt    = 1 #Tip/tilt constraint (2 dm system only). 0: no. 2: differential</span>
<span class="stringliteral">          #tilt on two DMs. 1: upper DM tt constraint.</span>
<span class="stringliteral">fit.alg       = 1 #Fitting algorithm. see tomo.alg</span>
<span class="stringliteral">fit.precond   = 0 #CG preconditioning. see tomo.precond</span>
<span class="stringliteral">fit.maxit     = 4 #max iterations in CG.</span>
<span class="stringliteral">fit.square    = 0 #use square grid on DM grid and ploc</span>
<span class="stringliteral"></span>
<span class="stringliteral">#set MOAO DMs parameters.</span>
<span class="stringliteral">moao.order    = [60]</span>
<span class="stringliteral">moao.cubic    = [1]</span>
<span class="stringliteral">moao.iac      = [0.3]</span>
<span class="stringliteral">moao.stroke   = [inf]</span>
<span class="stringliteral">moao.actslave = [0]</span>
<span class="stringliteral">moao.lrt_ptt  = [0]</span>
</pre></div><p>
<code>"dbg.conf"</code> to define debugging and saving/loading geometry and telemetry. <div class="fragment"><pre class="fragment"><span class="preprocessor">#FILE dbg.conf</span>
<span class="preprocessor"></span>
<span class="preprocessor">###The following are parameters used for debugging</span>
<span class="preprocessor"></span>dbg.psol=0  #use dm command 1 frame in the future to form pseudo open loop
<span class="preprocessor">        #gradients (RTC scheme). Tested ok.</span>
<span class="preprocessor"></span>dbg.evlol=0     #evaluate open loop performance only. don<span class="stringliteral">'t do wfs/tomo/recon.</span>
<span class="stringliteral">dbg.clemp_all=0 #evaluate LGS mode error in all directions.</span>
<span class="stringliteral">dbg.noatm = 0   #Disable atmosphere generation (to evaluate telescope errors).</span>
<span class="stringliteral">dbg.atm   = 0   #test special atmosphere. 1: tip/tilt. 2: diff focus. -1: use power of -4 instead of -11/3.</span>
<span class="stringliteral"></span>
<span class="stringliteral">dbg.wamethod=0 #0: Use mod on dm. 1: use mod on science when tomo.split_wt=2</span>
<span class="stringliteral">dbg.fitonly=0  #evaluation fitting error only. no wfs, no recon.</span>
<span class="stringliteral">dbg.keepshm=0  #keep screens in shm even is unused.</span>
<span class="stringliteral">dbg.mvstlimit=0#limit MVST modes to the number if none zero</span>
<span class="stringliteral">dbg.annular_W=0</span>
<span class="stringliteral">dbg.tomo_maxit=[]#if not empty, will study these maxits in open loop</span>
<span class="stringliteral">plot.setup=0 #plot aperture,powfs,recon grids, etc.</span>
<span class="stringliteral">plot.atm=0   #plot atmosphere</span>
<span class="stringliteral">plot.run=0   #plot wfs opd, gradients, DM opd, science opd, etc.</span>
<span class="stringliteral">plot.opdx=0  #plot turbulence projeced to xloc.</span>
<span class="stringliteral">#The saved files can be loaded with mex routine "read" in MATLAB.</span>
<span class="stringliteral">save.all=0   #saves everything below except gcov. mainly for debugging</span>
<span class="stringliteral">save.setup=0 #save the data structs prepared during setup in subfolder "setup".</span>
<span class="stringliteral">         #They Can be loaded back in future simulation.</span>
<span class="stringliteral">save.recon=0 #save reconstructor. big matrices.</span>
<span class="stringliteral">save.mvst=0  #save mvst intermediate matrices in preparation to load later.</span>
<span class="stringliteral">#Run time saving:</span>
<span class="stringliteral">save.atm =0  #save atmosphere</span>
<span class="stringliteral">save.run =0  #save run time information, also enables save.dmreal,gradcl,gradpsol</span>
<span class="stringliteral"></span>
<span class="stringliteral">#The following four options takes values of 1, 2, 3. The enable different level. </span>
<span class="stringliteral">#1 means all wfs. 2 means high order wfs only. 3 means low order wfs only.</span>
<span class="stringliteral">save.ints=0 #save wfs subaperture images (images).</span>
<span class="stringliteral">save.grad=0 #save wfs gradients (also enabled by save.run) for high order wfs</span>
<span class="stringliteral">save.wfsopd=0 #save wfs OPDs for hi order wfs</span>
<span class="stringliteral">save.gradgeom=0#save geometric grads in physical optics simulation for low order wfs</span>
<span class="stringliteral"></span>
<span class="stringliteral">save.evlopd=0 #save evaluation directions opd.</span>
<span class="stringliteral">save.opdr=0 #save reconstructed atmosphere. </span>
<span class="stringliteral">save.opdx=0 #save atmosphere propagated to reconstruction grid.</span>
<span class="stringliteral">save.dm=0 #total DM commands effective. including tip/tilt.(implicit if save.run=1)</span>
<span class="stringliteral">#special run time saving that need extra computation.</span>
<span class="stringliteral">save.dmpttr=0 #save ptt removed DM actuator commands (implicit if save.run=1)</span>
<span class="stringliteral">save.gcovp=100#save the gcov every 100 steps to different files.</span>
<span class="stringliteral">save.gcov=[]#output covariance of psol gradient. set to [1 3 2 5] to output</span>
<span class="stringliteral">       #covariance between wfs 1 and 3, 2 and 5 drawdaemon is used to do the</span>
<span class="stringliteral">       #plotting.</span>
<span class="stringliteral"></span>
<span class="stringliteral">load.atm=#"atm.fn" #load atmosphere. cell array of double number arrays. The</span>
<span class="stringliteral">     #sampling must match the key atm.dx in atm_*.conf</span>
<span class="stringliteral">load.locs=#"aper_locs" #load aperture grid</span>
<span class="stringliteral">load.aloc=#"aloc" #load DM grid</span>
<span class="stringliteral">load.xloc=#"xloc" #load tomogrpahy grid. cell array</span>
<span class="stringliteral">load.ploc=#"ploc" #load aperture reconstruction grid.</span>
<span class="stringliteral">load.L2=#"L2" #load laplacian operator.</span>
<span class="stringliteral">load.HXF=#"HXF" #load propagation matrix from xloc to ploc along fit directions</span>
<span class="stringliteral">load.HXW=#"HXW" #load propagation matrix from xloc to ploc along wfs directions</span>
<span class="stringliteral">load.HA=#"HA" #load propagation matrix from aloc to ploc</span>
<span class="stringliteral">load.GP=#"GP" #load gradient operator from ploc to wfs (for tomography)</span>
<span class="stringliteral">load.GA=#"GA" #load gradient operator from aloc to wfs (to compute pseudo</span>
<span class="stringliteral">    #openloop gradients)</span>
<span class="stringliteral">load.GS0=0  #load gradient operator from WFS opd to WFS grad.</span>
<span class="stringliteral">load.tomo=0 #load tomography reconstruction matrices</span>
<span class="stringliteral">load.fit=0  #load fitting matrices.</span>
<span class="stringliteral">load.W=0    #load aperture W0/W1 weighting matrix.</span>
<span class="stringliteral">load.i0=0   #load wfs pixel intensity matrices.</span>
<span class="stringliteral">load.mvst=0 #load mvst intermediate matrices to avoid CBS</span>
</pre></div> </div>
<hr size="1"><address style="text-align: right;"><small>Generated on Wed Nov 24 14:46:54 2010 for maos-0.7.5 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
