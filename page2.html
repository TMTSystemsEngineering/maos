<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>maos-1.2.0: Compile and Run the Code</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="/home/lianqiw/work/programming/aos/doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">maos-1.2.0
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript" src="dynsections.js"></script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('page2.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Compile and Run the Code </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="sect-requirement"></a>
Requirements</h2>
<ul>
<li>C99 compliant compiler: GCC4 or ICC.</li>
</ul>
<ul>
<li>(Optional) GTK+ and Cairo. For drawdaemon and monitor.</li>
</ul>
<ul>
<li>(Optional in Linux/Mac) FFTW version 3. Will download from MAOS site if not available in the system.</li>
</ul>
<ul>
<li>(Optional in Linux/Mac) Optimized blas and lapack. Blas and lapack can usually be installed through the linux distribution official repository. Will download from MAOS site if not available in the system.</li>
</ul>
<h2><a class="anchor" id="sect-prep"></a>
Preparing the folders and compiling</h2>
<p>We recommend using three different folders to 1) store the source tree, 2) compile the code, and 3) run the simulation.</p>
<p>The source tree is where the source is extracted. Obtain the software in the form of the compressed tar ball: maos_version.tar.gz. Extract it into some directory and name the directory src_dir. Example:</p>
<div class="fragment"><pre class="fragment">
    cd ~/work/programming
    tar zxvf maos_version.tar.gz 
    cd maos_version
    export src_dir=$(pwd)
    </pre></div><p>Next we create another folder, where we are going to compile the code. example:</p>
<div class="fragment"><pre class="fragment">
    cd ~/work/maos
    mkdir comp_optim &amp;&amp; cd comp_optim
    $src_dir/configure
    make -j4 #this will compile using 4 threads.
    </pre></div><p>which will config the compiling folder with GCC compiler and default optimization flags and compile the code.</p>
<p>Intel C++ compiler icc will be automatically used if it exists in the system. To disable it, do the following</p>
<div class="fragment"><pre class="fragment">
    cd ~/work/maos
    $src_dir/configure --disable-icc
    make
    </pre></div><p>To for using the redistributed Intel MKL library (for fast cholesky decomposition) </p>
<div class="fragment"><pre class="fragment">
    $src_dir/configure --enable-mkl
    </pre></div><p>To enable debug mode </p>
<div class="fragment"><pre class="fragment">
    $src_dir/configure --enable-debug
    </pre></div><p>To specify your own compiler using gcc4.1 which is not the system default </p>
<div class="fragment"><pre class="fragment">
    CC=gcc4.1 $src_dir/configure
    </pre></div><p>The compiled executable is maos in the sub-folder “bin” of the compiling folder. You do not have to do "make install" to run the simulations.</p>
<h3><a class="anchor" id="sect-mac-gtk"></a>
Installing GTK+ in MAC OS and Compile Monitor, Drawdaemon</h3>
<p>First, if xcode is not installed in full, make sure the following packages are installed </p>
<div class="fragment"><pre class="fragment">
    DeveloperToolsCLI.pkg
    gcc4.2.pkg
    MACOSX10.5.pkg
    DevSDK.pkg
    OpenGLSDK.pkg
    DeveloperToolsSystemSupport
    </pre></div><p> Second, download and install pkg-config from pkgconfig.freedesktop.org/releases/</p>
<p>Third, following the instructions on page gtk-osx.sourceforge.net/ to install gtk+ for osx. The environmental variables are set by jhbuild, here we take important ones and put them in our .bash_profile to avoid running jhbuild each time. Put the following in your .bash_profile. Adjust the path accordingly if you changed gtk-osx installing options. </p>
<div class="fragment"><pre class="fragment">
    export PKG_CONFIG_PATH="/usr/lib/pkgconfig:$HOME/gtk/inst/lib/pkgconfig:$HOME/gtk/inst/share/pkgconfig"
    export LD_LIBRARY_PATH="$LD_LIBRARY_PATH:$HOME/gtk/inst/lib"
    export PATH="$PATH:$HOME/gtk/inst/bin"
    export C_INCLUDE_PATH="$HOME/gtk/inst/include"
    </pre></div><p> Now rerun MAOS configure and make. Monitor and drawdaemon should appear in bin folder now.</p>
<p>To make the app bundles. First, install quartz engine and ige-mac-buildler. sourceforge.net/apps/trac/gtk-osx/wiki/Bundle jhbuild build gtk-quartz-engine</p>
<p>Second, symbolic link bin/drawdaemon and bin/monitor to $HOME/gtk/inst/bin And cd to scripts/bundle folder, run build.sh. .app files should appear in your desktop.</p>
<h3><a class="anchor" id="sect-monitor"></a>
Using the job monitor</h3>
<p>When reasonably recent GTK+ and Cairo libraries are present in the system, two additional executives will be compiled, “drawdaemon” and “monitor”. The plotting utility “drawdaemon” is located in sub-folder “lib”. It is launched automatically when plotting commands are issued in the software. The monitoring utility “monitor” is located in sub-folder “bin”. Link monitor to a folder that is in your PATH and type “monitor” in the command line to use it.</p>
<p>In order to use monitor to monitor jobs in different machines, follow these steps:</p>
<p>Create a folder .aos in your home folder, create two files in there. Put these files in all the machines you want to monitor. </p>
<div class="fragment"><pre class="fragment">
~/.aos/hosts  Each line contains a machine's hostname you want to monitor. 
              They should be the names returned by command "hostname", 
              and you should be able to log into those machines 
              with these names. Set up /etc/hosts properly to ensure this.
~/.aos/port   contains the port you want the scheduler to bind to 
              so that the monitor can connect to it. 
              Any non-previledged port numbers are fine (like 10000). 
              Different users should have different port number. 
	      The port has to be the same on all the machines. 
    </pre></div><h3><a class="anchor" id="sect-run"></a>
Run the simulation</h3>
<p>The simulation is usually done outside of the source and compilation folder by linking the maos executable into the simulation folder or link maos into a direction that is in the PATH. Example</p>
<div class="fragment"><pre class="fragment">
    cd ~/work/maos
    mkdir NFIRAOS &amp;&amp; cd NFIRAOS
    ln ~/work/aos/comp_optim/bin/maos . -s
    ./maos -o result
    </pre></div><p>You can also link “maos” into your PATH and run “maos” instead of “./maos”</p>
<div class="fragment"><pre class="fragment">
    cd ~/local/bin #make sure this is in your PATH
    ln ~/work/aos/comp_optim/bin/maos . -s 
    #Make sure you use -s to make symbolic link
    </pre></div><p>Use the following command to get the help message: </p>
<div class="fragment"><pre class="fragment">
    maos -h  #will print the help message and exit.
    </pre></div><p>If maos is launched without any parameters, it will use default.conf which contains the baseline NFIRAOS configuration nfiraos.conf. Users can change the content of default.conf to include another file to make that the default option. The valid command line arguments are as follows</p>
<div class="fragment"><pre class="fragment">
    -c scao_lgs.conf   Change the baseline config from nfiraos.conf to scao_lgs.conf
    -d     deteach from the console and run in background. You can then close
           the terminal and log out without killing the job
    -n 4   use 4 threads. (default is 1)
    -s 2   to override the seed (normally specified in sim.seed) to 2. 
           repeat to have multiple seeds (-s1 -s2 -s3)
    -f     Force starting immediately. Otherwise only proceed when cpu is available
           as controlled by the built-in "scheduler"
    a.conf Append a.conf to the config file list
    -o ABC Put the results in folder ABC (create if not already exists). If not 
           specified the default output folder name will be composed of the data 
           and time string in the form of 2010-03-05-161539.
    </pre></div><p>Example: </p>
<div class="fragment"><pre class="fragment">
    maos -c scao_lgs.conf override.conf -n 4 -d -o test 
    </pre></div><p>Will launch the software using “scao_lgs.conf” (Single conjugate, LGS system) as the baseline and override some parameters by override.conf. It will launch 4 threads in simulation, detach from the console, and output the results into folder “test”. </p>
</div></div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>

    <li class="footer">Generated on Tue Aug 14 2012 09:57:34 for maos-1.2.0 by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
