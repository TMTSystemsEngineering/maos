<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>MAOS: maos/setup_powfs.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="maos.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">MAOS
   </div>
   <div id="projectbrief">A Fast End to End Adaptive Optics Simulator</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('setup__powfs_8h.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">setup_powfs.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;common.h&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ab5c6252f2e6a017bf057d45f5447c049"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structPOWFS__T.html">POWFS_T</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup__powfs_8h.html#ab5c6252f2e6a017bf057d45f5447c049">setup_powfs_init</a> (const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, <a class="el" href="structAPER__T.html">APER_T</a> *aper)</td></tr>
<tr class="separator:ab5c6252f2e6a017bf057d45f5447c049"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae4cc18eb0a745b7719e20eef143f7995"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup__powfs_8h.html#ae4cc18eb0a745b7719e20eef143f7995">setup_powfs_misreg_tel</a> (<a class="el" href="structPOWFS__T.html">POWFS_T</a> *powfs, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, <a class="el" href="structAPER__T.html">APER_T</a> *aper, int ipowfs)</td></tr>
<tr class="separator:ae4cc18eb0a745b7719e20eef143f7995"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abe252b0e32dfa0f68d89b54cd0d9b6ac"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup__powfs_8h.html#abe252b0e32dfa0f68d89b54cd0d9b6ac">setup_powfs_misreg_dm</a> (<a class="el" href="structPOWFS__T.html">POWFS_T</a> *powfs, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, <a class="el" href="structAPER__T.html">APER_T</a> *aper, int ipowfs)</td></tr>
<tr class="separator:abe252b0e32dfa0f68d89b54cd0d9b6ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac1fbeda2f6ec733c358e17742e5029f7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup__powfs_8h.html#ac1fbeda2f6ec733c358e17742e5029f7">setup_powfs_phy</a> (const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, <a class="el" href="structPOWFS__T.html">POWFS_T</a> *powfs)</td></tr>
<tr class="separator:ac1fbeda2f6ec733c358e17742e5029f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a42012ebf6f520f76627902112ca3d09f"><td class="memItemLeft" align="right" valign="top"><a id="a42012ebf6f520f76627902112ca3d09f"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>setup_powfs_neasim</b> (const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, <a class="el" href="structPOWFS__T.html">POWFS_T</a> *powfs)</td></tr>
<tr class="separator:a42012ebf6f520f76627902112ca3d09f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0d9099fe7ab2aaf7235c8118901857dc"><td class="memItemLeft" align="right" valign="top"><a id="a0d9099fe7ab2aaf7235c8118901857dc"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>setup_powfs_calib</b> (const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, <a class="el" href="structPOWFS__T.html">POWFS_T</a> *powfs)</td></tr>
<tr class="separator:a0d9099fe7ab2aaf7235c8118901857dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa1efb9155f68b99bb156d654b57f93d6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup__powfs_8h.html#aa1efb9155f68b99bb156d654b57f93d6">free_powfs_unused</a> (const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, <a class="el" href="structPOWFS__T.html">POWFS_T</a> *powfs)</td></tr>
<tr class="separator:aa1efb9155f68b99bb156d654b57f93d6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4fdd29141f0d60af1fd7c6b2385f0031"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup__powfs_8h.html#a4fdd29141f0d60af1fd7c6b2385f0031">free_powfs</a> (const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, <a class="el" href="structPOWFS__T.html">POWFS_T</a> *powfs)</td></tr>
<tr class="separator:a4fdd29141f0d60af1fd7c6b2385f0031"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a51714ee5b7a5a44bc3b1b0639ac94b5e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup__powfs_8h.html#a51714ee5b7a5a44bc3b1b0639ac94b5e">setup_powfs_etf</a> (<a class="el" href="structPOWFS__T.html">POWFS_T</a> *powfs, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, double deltah, int ipowfs, int mode, int icol)</td></tr>
<tr class="separator:a51714ee5b7a5a44bc3b1b0639ac94b5e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a288841084a9b4fa93af59ad631299b60"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup__powfs_8h.html#a288841084a9b4fa93af59ad631299b60">wfspupmask</a> (const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, <a class="el" href="structloc__t.html">loc_t</a> *loc, <a class="el" href="structdmat.html">dmat</a> *amp, int iwfs)</td></tr>
<tr class="separator:a288841084a9b4fa93af59ad631299b60"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Setting up WFS geometry. like the subaperture location, subaperture grid points, physical optics detection transfer function, LGS elongation transfer function, etc.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000007">Todo:</a></b></dt><dd>isolate DTF, ETF, routines, make then generic interface and relocate to the lib folder.</dd></dl>
<p>Do not use sparse interpolation to replace ray tracing for fine sampled destination grid, especially cubic splines. The interpolation marix takes too much space. <br />
 TODO: This routine and <a class="el" href="structPOWFS__T.html">POWFS_T</a> should only contain information about the simulation, not about any model used during reconstruction (RTC) to avoid leaking information from the "real world (simulation)" to our knowledge (RTC). </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="ab5c6252f2e6a017bf057d45f5447c049"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab5c6252f2e6a017bf057d45f5447c049">&#9670;&nbsp;</a></span>setup_powfs_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structPOWFS__T.html">POWFS_T</a>* setup_powfs_init </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&#160;</td>
          <td class="paramname"><em>parms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structAPER__T.html">APER_T</a> *&#160;</td>
          <td class="paramname"><em>aper</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Setup the powfs struct based on parms and aper. Everything about wfs are setup here. </p>

</div>
</div>
<a id="ae4cc18eb0a745b7719e20eef143f7995"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae4cc18eb0a745b7719e20eef143f7995">&#9670;&nbsp;</a></span>setup_powfs_misreg_tel()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setup_powfs_misreg_tel </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structPOWFS__T.html">POWFS_T</a> *&#160;</td>
          <td class="paramname"><em>powfs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&#160;</td>
          <td class="paramname"><em>parms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structAPER__T.html">APER_T</a> *&#160;</td>
          <td class="paramname"><em>aper</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ipowfs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Setup telescope to WFS pupil misregistration.</p>
<p>It is tricky to implement the misregistration of the deformable mirror and the WFS.</p>
<p>Misregistration of the deformable mirror. <br />
 Denote the grid of actuators as saloc, and with misregistration, it becomes salocm.</p>
<ul>
<li>We should use saloc for DM fitting and pseudo open loop gradient computations because we are not aware of the misregistration.</li>
<li>We should use salocm for raytracing to WFS and performance evaluation because this is what happens in the system, no matter whether we know the misregistration or not.</li>
</ul>
<p>Misregistration of the WFS.</p>
<p>Denote the grid of the WFS entry pupil as loc, and with misregistration, it becomes locm. Project the telescope amplitude map onto loc, we get amp, which is what we know. Project the telescope amplitude map onto locm, we get ampm, which is what happens but we don't know.</p>
<ul>
<li>We should use loc and amp to compute the reconstructor.</li>
<li>We should use locm and ampm for tracing to WFS and performance evaluation.</li>
<li>We should use loc and ampm for matched filter, averaging gradient, or zernike tip/tilt operator computation, since this is the process that happens in the system, and the matched filter is updated through dithering to the true amplitude map. We use loc because it is our model within the WFS.</li>
<li>We should use ptsm-&gt;area (real area) to select subapertures for use in reconstruction, because in real system, the subapertures are selected by their illumination level, and is affected by the real amplitude. </li>
</ul>

</div>
</div>
<a id="abe252b0e32dfa0f68d89b54cd0d9b6ac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abe252b0e32dfa0f68d89b54cd0d9b6ac">&#9670;&nbsp;</a></span>setup_powfs_misreg_dm()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setup_powfs_misreg_dm </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structPOWFS__T.html">POWFS_T</a> *&#160;</td>
          <td class="paramname"><em>powfs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&#160;</td>
          <td class="paramname"><em>parms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structAPER__T.html">APER_T</a> *&#160;</td>
          <td class="paramname"><em>aper</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ipowfs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>setup DM to WFS misregistration. </p>

</div>
</div>
<a id="ac1fbeda2f6ec733c358e17742e5029f7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac1fbeda2f6ec733c358e17742e5029f7">&#9670;&nbsp;</a></span>setup_powfs_phy()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setup_powfs_phy </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&#160;</td>
          <td class="paramname"><em>parms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structPOWFS__T.html">POWFS_T</a> *&#160;</td>
          <td class="paramname"><em>powfs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Setup physical optics parameters for SHWFS, such as DTF, ETF, LLT, pixel processing. </p>

</div>
</div>
<a id="aa1efb9155f68b99bb156d654b57f93d6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa1efb9155f68b99bb156d654b57f93d6">&#9670;&nbsp;</a></span>free_powfs_unused()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void free_powfs_unused </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&#160;</td>
          <td class="paramname"><em>parms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structPOWFS__T.html">POWFS_T</a> *&#160;</td>
          <td class="paramname"><em>powfs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>free unused parameters before simulation starts </p>

</div>
</div>
<a id="a4fdd29141f0d60af1fd7c6b2385f0031"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4fdd29141f0d60af1fd7c6b2385f0031">&#9670;&nbsp;</a></span>free_powfs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void free_powfs </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&#160;</td>
          <td class="paramname"><em>parms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structPOWFS__T.html">POWFS_T</a> *&#160;</td>
          <td class="paramname"><em>powfs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Free all parameters of powfs at the end of simulation. </p>

</div>
</div>
<a id="a51714ee5b7a5a44bc3b1b0639ac94b5e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a51714ee5b7a5a44bc3b1b0639ac94b5e">&#9670;&nbsp;</a></span>setup_powfs_etf()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setup_powfs_etf </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structPOWFS__T.html">POWFS_T</a> *&#160;</td>
          <td class="paramname"><em>powfs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&#160;</td>
          <td class="paramname"><em>parms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>deltah</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ipowfs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>icol</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Compute Elongation Transfer function.</p><ul>
<li>mode=0: for preparation.</li>
<li>mode=1: for simulation. </li>
</ul>

</div>
</div>
<a id="a288841084a9b4fa93af59ad631299b60"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a288841084a9b4fa93af59ad631299b60">&#9670;&nbsp;</a></span>wfspupmask()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void wfspupmask </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&#160;</td>
          <td class="paramname"><em>parms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structloc__t.html">loc_t</a> *&#160;</td>
          <td class="paramname"><em>loc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structdmat.html">dmat</a> *&#160;</td>
          <td class="paramname"><em>amp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>iwfs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Creates WFS pupil mask. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->

   </ul>
 </div>
</body>
</html>
