<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>maos-0.6.1: maos/setup_parms.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>maos/setup_parms.c File Reference</h1>This file contains necessary routines to read parametes for WFS, DM and wavefront reconstruction.  
<a href="#_details">More...</a>
<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="e4047f5ab4c815a73a7cd3b481f62308"></a><!-- doxytag: member="maos/setup_parms.c::FREE_IF_NOT_NULL" ref="e4047f5ab4c815a73a7cd3b481f62308" args="(p)" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>FREE_IF_NOT_NULL</b>(p)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="e381522e1d10c3730b356f1ac5d2dccb"></a><!-- doxytag: member="maos/setup_parms.c::MAX_STRLEN" ref="e381522e1d10c3730b356f1ac5d2dccb" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>MAX_STRLEN</b></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="6b1cebc0c19b95519324e40eee466bb8"></a><!-- doxytag: member="maos/setup_parms.c::READ_INT" ref="6b1cebc0c19b95519324e40eee466bb8" args="(A)" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>READ_INT</b>(A)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="f718a871315bd372063bbbeee477b396"></a><!-- doxytag: member="maos/setup_parms.c::READ_DBL" ref="f718a871315bd372063bbbeee477b396" args="(A)" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>READ_DBL</b>(A)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="50c89029f94fb2b378c6499bdbdb61f3"></a><!-- doxytag: member="maos/setup_parms.c::READ_STR" ref="50c89029f94fb2b378c6499bdbdb61f3" args="(A)" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>READ_STR</b>(A)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="0588bde7efe6ccb7af8053fca795d916"></a><!-- doxytag: member="maos/setup_parms.c::READ_POWFS" ref="0588bde7efe6ccb7af8053fca795d916" args="(A, B)" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>READ_POWFS</b>(A, B)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="40f3ff53c4da32bd18c3d93cfa123af1"></a><!-- doxytag: member="maos/setup_parms.c::READ_WFS" ref="40f3ff53c4da32bd18c3d93cfa123af1" args="(A, B)" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>READ_WFS</b>(A, B)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a0d9bc4ec29e9c8a88c7895c68239852"></a><!-- doxytag: member="maos/setup_parms.c::READ_DM" ref="a0d9bc4ec29e9c8a88c7895c68239852" args="(A, B)" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>READ_DM</b>(A, B)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="20d6621bb89367e31323fe400eaa0246"></a><!-- doxytag: member="maos/setup_parms.c::READ_MOAO" ref="20d6621bb89367e31323fe400eaa0246" args="(A, B)" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>READ_MOAO</b>(A, B)</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="fad950a4f059f347cede7c2f97c7e0bd"></a><!-- doxytag: member="maos/setup_parms.c::free_parms" ref="fad950a4f059f347cede7c2f97c7e0bd" args="(PARMS_T *parms)" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><b>free_parms</b> (<a class="el" href="structPARMS__T.html">PARMS_T</a> *parms)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__parms_8c.html#cd97c28fc8c6bbd40c145372f94254bb">readcfg_dblarr_n</a> (int n, double **p, const char *format,...)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read in double array of n elements from the configuration files.  <a href="#cd97c28fc8c6bbd40c145372f94254bb"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__parms_8c.html#985838f6490cf2e60012e8853932477b">readcfg_intarr_n</a> (int n, int **p, const char *format,...)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read in int array of n elements from the configuration files.  <a href="#985838f6490cf2e60012e8853932477b"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__parms_8c.html#78380466affab6eff0b8332e2add0cc9">readcfg_powfs</a> (<a class="el" href="structPARMS__T.html">PARMS_T</a> *parms)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read wfs geometry.  <a href="#78380466affab6eff0b8332e2add0cc9"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__parms_8c.html#e7e9d392b0aefa689b1fbe0f5502610e">readcfg_wfs</a> (<a class="el" href="structPARMS__T.html">PARMS_T</a> *parms)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read in parameters of wfs, including GS direction, signal level, wvlwts, etc.  <a href="#e7e9d392b0aefa689b1fbe0f5502610e"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__parms_8c.html#4eba5db3782bce354528692093a5c886">readcfg_dm</a> (<a class="el" href="structPARMS__T.html">PARMS_T</a> *parms)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read in deformable mirror parameters.  <a href="#4eba5db3782bce354528692093a5c886"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__parms_8c.html#f1b51ba63bd9c8ce31aad0b3ddecb49b">readcfg_moao</a> (<a class="el" href="structPARMS__T.html">PARMS_T</a> *parms)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read in MOAO parameters.  <a href="#f1b51ba63bd9c8ce31aad0b3ddecb49b"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__parms_8c.html#0e11886cea89f186fee8923def4794e6">readcfg_atm</a> (<a class="el" href="structPARMS__T.html">PARMS_T</a> *parms)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read in atmosphere parameters.  <a href="#0e11886cea89f186fee8923def4794e6"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__parms_8c.html#501db4099d54887195219e49cba2cbe5">readcfg_atmr</a> (<a class="el" href="structPARMS__T.html">PARMS_T</a> *parms)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read in atmosphere reconstruction parameters.  <a href="#501db4099d54887195219e49cba2cbe5"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__parms_8c.html#1e298f863e10bdcb8f23abc5eab36a5a">readcfg_aper</a> (<a class="el" href="structPARMS__T.html">PARMS_T</a> *parms)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read in aperture definitions.  <a href="#1e298f863e10bdcb8f23abc5eab36a5a"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__parms_8c.html#133d470dc6f43fbc5690c9f8e0046ff6">readcfg_evl</a> (<a class="el" href="structPARMS__T.html">PARMS_T</a> *parms)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read in performance evaluation science point parameters.  <a href="#133d470dc6f43fbc5690c9f8e0046ff6"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__parms_8c.html#9a5f9a428f3b04060a1f80ba6b319039">readcfg_tomo</a> (<a class="el" href="structPARMS__T.html">PARMS_T</a> *parms)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read in turbulence tomography parameters.  <a href="#9a5f9a428f3b04060a1f80ba6b319039"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__parms_8c.html#6a5bda1804c407f53ca9e36f6bb6f1d5">readcfg_fit</a> (<a class="el" href="structPARMS__T.html">PARMS_T</a> *parms)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read in DM fit parameters.  <a href="#6a5bda1804c407f53ca9e36f6bb6f1d5"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__parms_8c.html#427962208b0462b3c477798ac97783d6">readcfg_sim</a> (<a class="el" href="structPARMS__T.html">PARMS_T</a> *parms)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read in simulation parameters.  <a href="#427962208b0462b3c477798ac97783d6"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__parms_8c.html#f045265022d49edfbfceea0f6f4950a8">readcfg_cn2</a> (<a class="el" href="structPARMS__T.html">PARMS_T</a> *parms)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read in parameters for Cn2 estimation.  <a href="#f045265022d49edfbfceea0f6f4950a8"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__parms_8c.html#1b39e7e3bf45af24d385587415f54a11">readcfg_plot</a> (<a class="el" href="structPARMS__T.html">PARMS_T</a> *parms)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Specify which variables to plot.  <a href="#1b39e7e3bf45af24d385587415f54a11"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__parms_8c.html#290f919909b9bbb347962e8a7a31a327">readcfg_dbg</a> (<a class="el" href="structPARMS__T.html">PARMS_T</a> *parms)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read in debugging parameters.  <a href="#290f919909b9bbb347962e8a7a31a327"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__parms_8c.html#c35c651f34a6a45cd536e1f4f9d11116">readcfg_save</a> (<a class="el" href="structPARMS__T.html">PARMS_T</a> *parms)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Specify which variables to save.  <a href="#c35c651f34a6a45cd536e1f4f9d11116"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__parms_8c.html#8159d82edd710777ee375cc766476975">readcfg_load</a> (<a class="el" href="structPARMS__T.html">PARMS_T</a> *parms)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Specify which variables to load from saved files (Usually from LAOS simulations).  <a href="#8159d82edd710777ee375cc766476975"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__parms_8c.html#440919651fb4c4c963da4c6fb7561ecb">setup_parms_postproc_sim</a> (<a class="el" href="structPARMS__T.html">PARMS_T</a> *parms)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Process simulation parameters to find incompatibility.  <a href="#440919651fb4c4c963da4c6fb7561ecb"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__parms_8c.html#4d667799364159d4a473d9159682309d">setup_parms_postproc_wfs</a> (<a class="el" href="structPARMS__T.html">PARMS_T</a> *parms)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">postproc various WFS parameters based on other input information  <a href="#4d667799364159d4a473d9159682309d"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__parms_8c.html#9d7c10a75b4fc50ab68e473968cbde4a">setup_parms_postproc_atm</a> (<a class="el" href="structPARMS__T.html">PARMS_T</a> *parms)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">postproc atmosphere parameters.  <a href="#9d7c10a75b4fc50ab68e473968cbde4a"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__parms_8c.html#56adfa3b5440332125f22d5e3216d6c0">setup_parms_postproc_za</a> (<a class="el" href="structPARMS__T.html">PARMS_T</a> *parms)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Scaling necessary values for non-zero zenith angle (za).  <a href="#56adfa3b5440332125f22d5e3216d6c0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__parms_8c.html#72305d3fc8ccc4871e74ac9f0701303d">setup_parms_postproc_atm_size</a> (<a class="el" href="structPARMS__T.html">PARMS_T</a> *parms)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">compute minimum size of atm screen to cover all the beam path.  <a href="#72305d3fc8ccc4871e74ac9f0701303d"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__parms_8c.html#aa02b87b76c12eaec2e3f3884f558a83">setup_parms_postproc_dm</a> (<a class="el" href="structPARMS__T.html">PARMS_T</a> *parms)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Setting up DM parameters in order to do DM caching during simulation.  <a href="#aa02b87b76c12eaec2e3f3884f558a83"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__parms_8c.html#e88e42b64bcd2103556c239fb38d61b3">setup_parms_postproc_recon</a> (<a class="el" href="structPARMS__T.html">PARMS_T</a> *parms)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Setting up the cone coordinate for MCAO LGS simulation.  <a href="#e88e42b64bcd2103556c239fb38d61b3"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__parms_8c.html#698c26e1ac55798491764865d39a6758">setup_parms_postproc_siglev</a> (<a class="el" href="structPARMS__T.html">PARMS_T</a> *parms)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The siglev is always specified in 800 Hz.  <a href="#698c26e1ac55798491764865d39a6758"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__parms_8c.html#33d94712102ef4690b9338e902e829ae">setup_parms_postproc_misc</a> (<a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, <a class="el" href="structARG__T.html">ARG_T</a> *arg)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">postproc misc parameters.  <a href="#33d94712102ef4690b9338e902e829ae"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__parms_8c.html#52f022b8c4512d9bd20674de845593a2">setup_parms_postproc_save</a> (<a class="el" href="structPARMS__T.html">PARMS_T</a> *parms)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">postproc parameters for save.  <a href="#52f022b8c4512d9bd20674de845593a2"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__parms_8c.html#e8e239acbf0b52604d181c19aae55f54">print_parms</a> (const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Selectively print out parameters for easy diagnose of possible mistakes.  <a href="#e8e239acbf0b52604d181c19aae55f54"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__parms_8c.html#6a205952ab13986513b3ee36e1765a14">check_parms</a> (const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Limited sanity check of the parameters to prevent obvious mistakes.  <a href="#6a205952ab13986513b3ee36e1765a14"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__parms_8c.html#21d63a1d0ee519d5d503183f6d0d5665">setup_config</a> (<a class="el" href="structARG__T.html">ARG_T</a> *arg)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Load embeded configuration files specified by config=file.conf.  <a href="#21d63a1d0ee519d5d503183f6d0d5665"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structPARMS__T.html">PARMS_T</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__parms_8c.html#97bc282d28009f59b0b4e51013062588">setup_parms</a> (<a class="el" href="structARG__T.html">ARG_T</a> *arg)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This routine calles other routines in this file to setup the parms parameter struct parms and check for possible errors.  <a href="#97bc282d28009f59b0b4e51013062588"></a><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
This file contains necessary routines to read parametes for WFS, DM and wavefront reconstruction. 
<p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="cd97c28fc8c6bbd40c145372f94254bb"></a><!-- doxytag: member="setup_parms.c::readcfg_dblarr_n" ref="cd97c28fc8c6bbd40c145372f94254bb" args="(int n, double **p, const char *format,...)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int readcfg_dblarr_n           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double **&nbsp;</td>
          <td class="paramname"> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>format</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>...</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Read in double array of n elements from the configuration files. 
<p>
<div class="fragment"><pre class="fragment"><a name="l00124"></a>00124                                                                      {
<a name="l00125"></a>00125     format2key;
<a name="l00126"></a>00126     <span class="keywordtype">int</span> m=<a class="code" href="readcfg_8h.html#969fc72b01334d0fe97e6faaa562c9bf" title="Read a double array from config hash table.">readcfg_dblarr</a>(p,<span class="stringliteral">"%s"</span>,key);
<a name="l00127"></a>00127     <span class="keywordflow">if</span>(m!=n){
<a name="l00128"></a>00128     error(<span class="stringliteral">"Wrong # of elements for 'key' %s.\n"</span>
<a name="l00129"></a>00129           <span class="stringliteral">"Required %d, got %d\n"</span>,format,n,m);
<a name="l00130"></a>00130     }
<a name="l00131"></a>00131     <span class="keywordflow">return</span> 0;
<a name="l00132"></a>00132 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="985838f6490cf2e60012e8853932477b"></a><!-- doxytag: member="setup_parms.c::readcfg_intarr_n" ref="985838f6490cf2e60012e8853932477b" args="(int n, int **p, const char *format,...)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int readcfg_intarr_n           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int **&nbsp;</td>
          <td class="paramname"> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>format</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>...</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Read in int array of n elements from the configuration files. 
<p>
<div class="fragment"><pre class="fragment"><a name="l00137"></a>00137                                                                  {
<a name="l00138"></a>00138     format2key;
<a name="l00139"></a>00139     <span class="keywordtype">int</span> m=<a class="code" href="readcfg_8h.html#2ea9d60b32c652ce4fad03c84d08c3f6" title="Read an int array from config hash table.">readcfg_intarr</a>(p,<span class="stringliteral">"%s"</span>,key);
<a name="l00140"></a>00140     <span class="keywordflow">if</span>(m!=n){
<a name="l00141"></a>00141     error(<span class="stringliteral">"Wrong # of elements for 'key' %s.\n"</span>
<a name="l00142"></a>00142           <span class="stringliteral">"Required %d, got %d\n"</span>,format,n,m);
<a name="l00143"></a>00143     }
<a name="l00144"></a>00144     <span class="keywordflow">return</span> 0;
<a name="l00145"></a>00145     }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="78380466affab6eff0b8332e2add0cc9"></a><!-- doxytag: member="setup_parms.c::readcfg_powfs" ref="78380466affab6eff0b8332e2add0cc9" args="(PARMS_T *parms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void readcfg_powfs           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structPARMS__T.html">PARMS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>parms</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Read wfs geometry. 
<p>
powfs stands for physical optics wfs, it is used to represent the types of WFS. <div class="fragment"><pre class="fragment"><a name="l00164"></a>00164                                          {
<a name="l00165"></a>00165     <span class="keywordtype">double</span> *dbljunk;
<a name="l00166"></a>00166     <span class="keywordtype">int</span> *intjunk;
<a name="l00167"></a>00167     <span class="keywordtype">char</span> **strjunk;
<a name="l00168"></a>00168     <span class="keywordtype">int</span> npowfs,i;
<a name="l00169"></a>00169     <span class="keywordtype">char</span> temp[MAX_STRLEN];
<a name="l00170"></a>00170     parms-&gt;<a class="code" href="structPARMS__T.html#184dc967ffbedc29f2d48cd49889ddd2" title="Number of wfs types.">npowfs</a>=<a class="code" href="readcfg_8h.html#f90add8965ad5b713f08e85d11ea70a0" title="Read an int number from config hash table.">readcfg_int</a>(<span class="stringliteral">"npowfs"</span>);
<a name="l00171"></a>00171     parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>=calloc(parms-&gt;<a class="code" href="structPARMS__T.html#184dc967ffbedc29f2d48cd49889ddd2" title="Number of wfs types.">npowfs</a>,<span class="keyword">sizeof</span>(<a class="code" href="structPOWFS__CFG__T.html" title="contains input parameters for each type of wfs (powfs).">POWFS_CFG_T</a>));
<a name="l00172"></a>00172     npowfs=parms-&gt;<a class="code" href="structPARMS__T.html#184dc967ffbedc29f2d48cd49889ddd2" title="Number of wfs types.">npowfs</a>;
<a name="l00173"></a>00173     READ_POWFS(<span class="keywordtype">int</span>,nwvl);
<a name="l00174"></a>00174     <span class="keywordtype">double</span> *wvllist=NULL;
<a name="l00175"></a>00175     <span class="keywordtype">int</span> nwvllist=<a class="code" href="readcfg_8h.html#969fc72b01334d0fe97e6faaa562c9bf" title="Read a double array from config hash table.">readcfg_dblarr</a>(&amp;wvllist,<span class="stringliteral">"powfs.wvl"</span>);
<a name="l00176"></a>00176     <span class="keywordtype">int</span> count=0;
<a name="l00177"></a>00177     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ipowfs=0; ipowfs&lt;parms-&gt;<a class="code" href="structPARMS__T.html#184dc967ffbedc29f2d48cd49889ddd2" title="Number of wfs types.">npowfs</a>; ipowfs++){
<a name="l00178"></a>00178     <span class="keywordtype">int</span> nwvl=parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#6e5b056212ee8f0d6c64d447b87f19e7" title="Number of wavelength.">nwvl</a>;
<a name="l00179"></a>00179     parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#086be0f3919fffb2809d891e895bab83" title="list of wavelength">wvl</a>=calloc(nwvl, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00180"></a>00180     memcpy(parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#086be0f3919fffb2809d891e895bab83" title="list of wavelength">wvl</a>,wvllist+count,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)*nwvl);
<a name="l00181"></a>00181     count+=nwvl;
<a name="l00182"></a>00182     }
<a name="l00183"></a>00183     <span class="keywordflow">if</span>(count!=nwvllist){
<a name="l00184"></a>00184     error(<span class="stringliteral">"powfs.wvl has wrong value\n"</span>);
<a name="l00185"></a>00185     }
<a name="l00186"></a>00186     free(wvllist);
<a name="l00187"></a>00187 
<a name="l00188"></a>00188     READ_POWFS(str,piinfile);
<a name="l00189"></a>00189     READ_POWFS(str,sninfile);
<a name="l00190"></a>00190     READ_POWFS(dbl,hs);
<a name="l00191"></a>00191     READ_POWFS(dbl,saat);
<a name="l00192"></a>00192     READ_POWFS(<span class="keywordtype">int</span>,neaphy);
<a name="l00193"></a>00193     READ_POWFS(str,neareconfile);
<a name="l00194"></a>00194     READ_POWFS(dbl,nearecon);
<a name="l00195"></a>00195     READ_POWFS(dbl,neasim);
<a name="l00196"></a>00196     READ_POWFS(dbl,bkgrnd);
<a name="l00197"></a>00197     READ_POWFS(str,bkgrndfn);
<a name="l00198"></a>00198     READ_POWFS(dbl,bkgrndrm);
<a name="l00199"></a>00199     READ_POWFS(dbl,pixblur);
<a name="l00200"></a>00200     READ_POWFS(dbl,rne);
<a name="l00201"></a>00201     READ_POWFS(dbl,dx);
<a name="l00202"></a>00202     READ_POWFS(dbl,pixtheta);
<a name="l00203"></a>00203     READ_POWFS(dbl,pixoffx);
<a name="l00204"></a>00204     READ_POWFS(dbl,pixoffy);
<a name="l00205"></a>00205     READ_POWFS(<span class="keywordtype">int</span>,phyusenea);
<a name="l00206"></a>00206     READ_POWFS(str,fnllt);
<a name="l00207"></a>00207     READ_POWFS(<span class="keywordtype">int</span>,order);
<a name="l00208"></a>00208     READ_POWFS(<span class="keywordtype">int</span>,trs);
<a name="l00209"></a>00209     READ_POWFS(<span class="keywordtype">int</span>,dfrs);
<a name="l00210"></a>00210     READ_POWFS(<span class="keywordtype">int</span>,lo);
<a name="l00211"></a>00211     READ_POWFS(<span class="keywordtype">int</span>,pixpsa);
<a name="l00212"></a>00212     READ_POWFS(<span class="keywordtype">int</span>,radpix);
<a name="l00213"></a>00213     READ_POWFS(<span class="keywordtype">int</span>,radrot);
<a name="l00214"></a>00214     READ_POWFS(<span class="keywordtype">int</span>,ncomp);
<a name="l00215"></a>00215     READ_POWFS(<span class="keywordtype">int</span>,embfac);
<a name="l00216"></a>00216     READ_POWFS(<span class="keywordtype">int</span>,psfout);
<a name="l00217"></a>00217     READ_POWFS(<span class="keywordtype">int</span>,pistatout);
<a name="l00218"></a>00218     READ_POWFS(<span class="keywordtype">int</span>,pistatstart);
<a name="l00219"></a>00219     READ_POWFS(<span class="keywordtype">int</span>,pistatstc);
<a name="l00220"></a>00220     READ_POWFS(<span class="keywordtype">int</span>,gtype_sim);
<a name="l00221"></a>00221     READ_POWFS(<span class="keywordtype">int</span>,gtype_recon);
<a name="l00222"></a>00222     READ_POWFS(<span class="keywordtype">int</span>,gmethod);
<a name="l00223"></a>00223     READ_POWFS(<span class="keywordtype">int</span>,phytype);
<a name="l00224"></a>00224     READ_POWFS(<span class="keywordtype">int</span>,phytypesim);
<a name="l00225"></a>00225     READ_POWFS(dbl,mtchcrx);
<a name="l00226"></a>00226     READ_POWFS(dbl,mtchcry);
<a name="l00227"></a>00227     READ_POWFS(<span class="keywordtype">int</span>,mtchcpl);
<a name="l00228"></a>00228     READ_POWFS(<span class="keywordtype">int</span>,mtchstc);
<a name="l00229"></a>00229     READ_POWFS(<span class="keywordtype">int</span>,mtchscl);
<a name="l00230"></a>00230     READ_POWFS(<span class="keywordtype">int</span>,phystep);
<a name="l00231"></a>00231     READ_POWFS(<span class="keywordtype">int</span>,noisy);
<a name="l00232"></a>00232     READ_POWFS(str,misreg);
<a name="l00233"></a>00233     READ_POWFS(str,ncpa);
<a name="l00234"></a>00234     READ_POWFS(<span class="keywordtype">int</span>,ncpa_method);
<a name="l00235"></a>00235     READ_POWFS(<span class="keywordtype">int</span>,dtrat);
<a name="l00236"></a>00236     READ_POWFS(<span class="keywordtype">int</span>,i0scale);
<a name="l00237"></a>00237     READ_POWFS(dbl,sigscale);
<a name="l00238"></a>00238     READ_POWFS(<span class="keywordtype">int</span>,moao);
<a name="l00239"></a>00239     <span class="keywordtype">int</span> illt=0;
<a name="l00240"></a>00240     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ipowfs=0; ipowfs&lt;npowfs; ipowfs++){
<a name="l00241"></a>00241     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#dda15852928fb63ca969d831309a8299" title="filename of LLT configuration.">fnllt</a>){
<a name="l00242"></a>00242         parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#649a628036ca2785673990cc5af15c13" title="whether having llt.">hasllt</a>=1;
<a name="l00243"></a>00243         open_config(parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#dda15852928fb63ca969d831309a8299" title="filename of LLT configuration.">fnllt</a>,0);
<a name="l00244"></a>00244         parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#13e13c12137584448baeae372526550e" title="configuration for LLT">llt</a>=calloc(1, <span class="keyword">sizeof</span>(<a class="code" href="structLLT__CFG__T.html" title="contains input parameters for laser launch telescope">LLT_CFG_T</a>));
<a name="l00245"></a>00245         parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#13e13c12137584448baeae372526550e" title="configuration for LLT">llt</a>-&gt;<a class="code" href="structLLT__CFG__T.html#45577fb34c3fb5753225c7417276d0eb" title="LLT clear aperture diameter.">d</a>=<a class="code" href="readcfg_8h.html#2b13907448b0ece4c728fd1f4d2eab30" title="Read a double number from config hash table.">readcfg_dbl</a>(<span class="stringliteral">"llt(%d).d"</span>,illt);
<a name="l00246"></a>00246         parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#13e13c12137584448baeae372526550e" title="configuration for LLT">llt</a>-&gt;<a class="code" href="structLLT__CFG__T.html#44ba41f20ea071d782ff70c5fbdc5aaa" title="Gaussian beam width percentage of d.">widthp</a>=<a class="code" href="readcfg_8h.html#2b13907448b0ece4c728fd1f4d2eab30" title="Read a double number from config hash table.">readcfg_dbl</a>(<span class="stringliteral">"llt(%d).widthp"</span>,illt);
<a name="l00247"></a>00247         parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#13e13c12137584448baeae372526550e" title="configuration for LLT">llt</a>-&gt;<a class="code" href="structLLT__CFG__T.html#c169cd8bd15a4ee86824d5d40ec9038d" title="File contains range to sodium layer.">fnrange</a>=readcfg_str(<span class="stringliteral">"llt(%d).fnrange"</span>,illt);
<a name="l00248"></a>00248         parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#13e13c12137584448baeae372526550e" title="configuration for LLT">llt</a>-&gt;<a class="code" href="structLLT__CFG__T.html#70eb04f0807122abd12ef33b39c30b76" title="File contains sodium profile.">fn</a>=readcfg_str(<span class="stringliteral">"llt(%d).fn"</span>,illt);
<a name="l00249"></a>00249         parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#13e13c12137584448baeae372526550e" title="configuration for LLT">llt</a>-&gt;<a class="code" href="structLLT__CFG__T.html#7597ec8512d1f9c6b4ae809b09c3d9e7" title="smooth the sodium profile or not">smooth</a>=<a class="code" href="readcfg_8h.html#f90add8965ad5b713f08e85d11ea70a0" title="Read an int number from config hash table.">readcfg_int</a>(<span class="stringliteral">"llt(%d).smooth"</span>,illt);
<a name="l00250"></a>00250         parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#13e13c12137584448baeae372526550e" title="configuration for LLT">llt</a>-&gt;<a class="code" href="structLLT__CFG__T.html#5248186f49c163e6b557564e17125807" title="starting column to use in fn for ETF in preparation of matched filter">colprep</a>=<a class="code" href="readcfg_8h.html#f90add8965ad5b713f08e85d11ea70a0" title="Read an int number from config hash table.">readcfg_int</a>(<span class="stringliteral">"llt(%d).colprep"</span>,illt);
<a name="l00251"></a>00251         parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#13e13c12137584448baeae372526550e" title="configuration for LLT">llt</a>-&gt;<a class="code" href="structLLT__CFG__T.html#b98cc62458a0880ce23196c961b11008" title="starting column to use in fn for ETF in simulation">colsim</a>=<a class="code" href="readcfg_8h.html#f90add8965ad5b713f08e85d11ea70a0" title="Read an int number from config hash table.">readcfg_int</a>(<span class="stringliteral">"llt(%d).colsim"</span>,illt);
<a name="l00252"></a>00252         parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#13e13c12137584448baeae372526550e" title="configuration for LLT">llt</a>-&gt;<a class="code" href="structLLT__CFG__T.html#c8b3e202f9c4be878eb3a9a599c1de4f" title="change to next sodium profile during simulation every colsimdtrat time step">colsimdtrat</a>=<a class="code" href="readcfg_8h.html#f90add8965ad5b713f08e85d11ea70a0" title="Read an int number from config hash table.">readcfg_int</a>(<span class="stringliteral">"llt(%d).colsimdtrat"</span>,illt);
<a name="l00253"></a>00253         
<a name="l00254"></a>00254         parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#13e13c12137584448baeae372526550e" title="configuration for LLT">llt</a>-&gt;<a class="code" href="structLLT__CFG__T.html#4b3cd998f117485fdcb8de6805fef38b" title="number of launch telescopes in this powfs">n</a>=<a class="code" href="readcfg_8h.html#969fc72b01334d0fe97e6faaa562c9bf" title="Read a double array from config hash table.">readcfg_dblarr</a> 
<a name="l00255"></a>00255         (&amp;(parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#13e13c12137584448baeae372526550e" title="configuration for LLT">llt</a>-&gt;<a class="code" href="structLLT__CFG__T.html#ef2483dcc582462f3eb512d8afacbb0a" title="location x of LLT center wrt telescope aperture center">ox</a>),<span class="stringliteral">"llt(%d).ox"</span>,illt);
<a name="l00256"></a>00256         snprintf(temp,MAX_STRLEN,<span class="stringliteral">"llt(%d).oy"</span>,illt);
<a name="l00257"></a>00257         <a class="code" href="maos_2setup__parms_8c.html#cd97c28fc8c6bbd40c145372f94254bb" title="Read in double array of n elements from the configuration files.">readcfg_dblarr_n</a>(parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#13e13c12137584448baeae372526550e" title="configuration for LLT">llt</a>-&gt;<a class="code" href="structLLT__CFG__T.html#4b3cd998f117485fdcb8de6805fef38b" title="number of launch telescopes in this powfs">n</a>,
<a name="l00258"></a>00258                  &amp;(parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#13e13c12137584448baeae372526550e" title="configuration for LLT">llt</a>-&gt;<a class="code" href="structLLT__CFG__T.html#14e57fee894c978e597da00a6c0c092c" title="see ox.">oy</a>),<span class="stringliteral">"llt(%d).oy"</span>,illt);
<a name="l00259"></a>00259         illt++;
<a name="l00260"></a>00260     }<span class="keywordflow">else</span>{
<a name="l00261"></a>00261         parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#13e13c12137584448baeae372526550e" title="configuration for LLT">llt</a>=NULL;
<a name="l00262"></a>00262         <span class="keywordflow">if</span>(!isinf(parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#3b65158c197ddc07b117b5f8b1aa567b" title="height of guide star">hs</a>)){
<a name="l00263"></a>00263         warning(<span class="stringliteral">"powfs%d has finite hs at %g,"</span>
<a name="l00264"></a>00264             <span class="stringliteral">" but no llt specified\n"</span>,
<a name="l00265"></a>00265             ipowfs, parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#3b65158c197ddc07b117b5f8b1aa567b" title="height of guide star">hs</a>);
<a name="l00266"></a>00266         }
<a name="l00267"></a>00267     }
<a name="l00268"></a>00268     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#421d5f37ceb33e1a40262faf7ec4ef1d" title="For radial format CCD, rotate OTF into coordinate plane.">radrot</a> &amp;&amp; !parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#beacabf44ba95b84fa2ec6b4460f5364" title="number of detector pixels along radial direction if radial CCD">radpix</a>){
<a name="l00269"></a>00269         parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#421d5f37ceb33e1a40262faf7ec4ef1d" title="For radial format CCD, rotate OTF into coordinate plane.">radrot</a>=0;
<a name="l00270"></a>00270         warning(<span class="stringliteral">"powfs%d does not have polar ccd. radrot should be zero. changed\n"</span>,ipowfs);
<a name="l00271"></a>00271     }
<a name="l00272"></a>00272     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#649a628036ca2785673990cc5af15c13" title="whether having llt.">hasllt</a> 
<a name="l00273"></a>00273        &amp;&amp; !parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#beacabf44ba95b84fa2ec6b4460f5364" title="number of detector pixels along radial direction if radial CCD">radpix</a>
<a name="l00274"></a>00274        &amp;&amp; !parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#d4d4430a7f1ecd79ead4a000521a5f47" title="use coupling between r/a measure error">mtchcpl</a>){
<a name="l00275"></a>00275         parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#d4d4430a7f1ecd79ead4a000521a5f47" title="use coupling between r/a measure error">mtchcpl</a>=1;
<a name="l00276"></a>00276         warning(<span class="stringliteral">"powfs%d has llt, but no polar ccd or mtchrot=1, we need mtchcpl to be 1. changed\n"</span>,ipowfs);
<a name="l00277"></a>00277     }
<a name="l00278"></a>00278     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#bd9d4d4a65743daf24311e58bc91fc67" title="physical optics type for simulation.">phytypesim</a>==-1){
<a name="l00279"></a>00279         parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#bd9d4d4a65743daf24311e58bc91fc67" title="physical optics type for simulation.">phytypesim</a>=parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#45900019b0a0d7d362460592c2c34775" title="physical optics type.">phytype</a>;
<a name="l00280"></a>00280     }
<a name="l00281"></a>00281     }
<a name="l00282"></a>00282 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="e7e9d392b0aefa689b1fbe0f5502610e"></a><!-- doxytag: member="setup_parms.c::readcfg_wfs" ref="e7e9d392b0aefa689b1fbe0f5502610e" args="(PARMS_T *parms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void readcfg_wfs           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structPARMS__T.html">PARMS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>parms</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Read in parameters of wfs, including GS direction, signal level, wvlwts, etc. 
<p>
<div class="fragment"><pre class="fragment"><a name="l00296"></a>00296                                        {
<a name="l00297"></a>00297     <span class="keywordtype">double</span> *dbljunk;
<a name="l00298"></a>00298     <span class="keywordtype">int</span> *intjunk;
<a name="l00299"></a>00299     <span class="keywordtype">int</span> i;
<a name="l00300"></a>00300     parms-&gt;<a class="code" href="structPARMS__T.html#b6833beca5a29a5936d41ac934e66d24" title="Number of wfs.">nwfs</a>=<a class="code" href="readcfg_8h.html#969fc72b01334d0fe97e6faaa562c9bf" title="Read a double array from config hash table.">readcfg_dblarr</a>(&amp;dbljunk, <span class="stringliteral">"wfs.thetax"</span>);
<a name="l00301"></a>00301     parms-&gt;<a class="code" href="structPARMS__T.html#19246602a8b7d0261d79416e281d6ca4" title="Array of wfs.">wfs</a>=calloc(parms-&gt;<a class="code" href="structPARMS__T.html#b6833beca5a29a5936d41ac934e66d24" title="Number of wfs.">nwfs</a>,<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structWFS__CFG__T.html" title="contains input parmaeters for each wfs">WFS_CFG_T</a>));
<a name="l00302"></a>00302     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iwfs=0; iwfs&lt;parms-&gt;<a class="code" href="structPARMS__T.html#b6833beca5a29a5936d41ac934e66d24" title="Number of wfs.">nwfs</a>; iwfs++){
<a name="l00303"></a>00303     parms-&gt;<a class="code" href="structPARMS__T.html#19246602a8b7d0261d79416e281d6ca4" title="Array of wfs.">wfs</a>[iwfs].<a class="code" href="structWFS__CFG__T.html#ebd74c669d9a3f057f4d4b4a43eda163" title="x direction">thetax</a>=dbljunk[iwfs];
<a name="l00304"></a>00304     }
<a name="l00305"></a>00305     free(dbljunk);
<a name="l00306"></a>00306     READ_WFS(dbl,thetay);
<a name="l00307"></a>00307     READ_WFS(dbl,siglev);
<a name="l00308"></a>00308     <span class="keywordflow">for</span>(i=0; i&lt;parms-&gt;<a class="code" href="structPARMS__T.html#b6833beca5a29a5936d41ac934e66d24" title="Number of wfs.">nwfs</a>; i++){
<a name="l00309"></a>00309     parms-&gt;<a class="code" href="structPARMS__T.html#19246602a8b7d0261d79416e281d6ca4" title="Array of wfs.">wfs</a>[i].<a class="code" href="structWFS__CFG__T.html#ebd74c669d9a3f057f4d4b4a43eda163" title="x direction">thetax</a>/=206265.;
<a name="l00310"></a>00310     parms-&gt;<a class="code" href="structPARMS__T.html#19246602a8b7d0261d79416e281d6ca4" title="Array of wfs.">wfs</a>[i].<a class="code" href="structWFS__CFG__T.html#3344f596561dfaf1d9d197112e2cefbd" title="y direction">thetay</a>/=206265.;
<a name="l00311"></a>00311     }
<a name="l00312"></a>00312     READ_WFS(<span class="keywordtype">int</span>,powfs);
<a name="l00313"></a>00313     <span class="keywordtype">double</span> *wvlwts=0;
<a name="l00314"></a>00314     <span class="keywordtype">int</span> nwvlwts=<a class="code" href="readcfg_8h.html#969fc72b01334d0fe97e6faaa562c9bf" title="Read a double array from config hash table.">readcfg_dblarr</a>(&amp;wvlwts,<span class="stringliteral">"wfs.wvlwts"</span>);
<a name="l00315"></a>00315     <span class="keywordtype">int</span> count=0;
<a name="l00316"></a>00316     <span class="keywordflow">for</span>(i=0; i&lt;parms-&gt;<a class="code" href="structPARMS__T.html#b6833beca5a29a5936d41ac934e66d24" title="Number of wfs.">nwfs</a>; i++){
<a name="l00317"></a>00317     <span class="keywordtype">int</span> ipowfs=parms-&gt;<a class="code" href="structPARMS__T.html#19246602a8b7d0261d79416e281d6ca4" title="Array of wfs.">wfs</a>[i].<a class="code" href="structWFS__CFG__T.html#c6eeef5eba99a8dea64c1692bb60f5ff" title="powfs type">powfs</a>;
<a name="l00318"></a>00318     <span class="keywordtype">int</span> nwvl=parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#6e5b056212ee8f0d6c64d447b87f19e7" title="Number of wavelength.">nwvl</a>;
<a name="l00319"></a>00319     parms-&gt;<a class="code" href="structPARMS__T.html#19246602a8b7d0261d79416e281d6ca4" title="Array of wfs.">wfs</a>[i].<a class="code" href="structWFS__CFG__T.html#8c33157663ab4c88862edbb6c6150c2f" title="Weights of signal value for each wavelength.">wvlwts</a>=malloc(nwvl*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00320"></a>00320     memcpy(parms-&gt;<a class="code" href="structPARMS__T.html#19246602a8b7d0261d79416e281d6ca4" title="Array of wfs.">wfs</a>[i].<a class="code" href="structWFS__CFG__T.html#8c33157663ab4c88862edbb6c6150c2f" title="Weights of signal value for each wavelength.">wvlwts</a>,wvlwts+count,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)*nwvl);
<a name="l00321"></a>00321     count+=nwvl;
<a name="l00322"></a>00322     }
<a name="l00323"></a>00323     free(wvlwts);
<a name="l00324"></a>00324     <span class="keywordflow">if</span>(count!=nwvlwts){
<a name="l00325"></a>00325     error(<span class="stringliteral">"Supplied %d wvlwts but need %d for all wfs.\n"</span>,nwvlwts,count);
<a name="l00326"></a>00326     }
<a name="l00327"></a>00327 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="4eba5db3782bce354528692093a5c886"></a><!-- doxytag: member="setup_parms.c::readcfg_dm" ref="4eba5db3782bce354528692093a5c886" args="(PARMS_T *parms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void readcfg_dm           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structPARMS__T.html">PARMS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>parms</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Read in deformable mirror parameters. 
<p>
<div class="fragment"><pre class="fragment"><a name="l00341"></a>00341                                       {
<a name="l00342"></a>00342     <span class="keywordtype">double</span> *dbljunk;
<a name="l00343"></a>00343     <span class="keywordtype">int</span> *intjunk;
<a name="l00344"></a>00344     <span class="keywordtype">int</span> ndm,i;
<a name="l00345"></a>00345  
<a name="l00346"></a>00346     ndm=parms-&gt;<a class="code" href="structPARMS__T.html#6492c3b89e0243fe23d88ebedb044b0e" title="Number of DMs.">ndm</a>=<a class="code" href="readcfg_8h.html#2ea9d60b32c652ce4fad03c84d08c3f6" title="Read an int array from config hash table.">readcfg_intarr</a>(&amp;intjunk,<span class="stringliteral">"dm.order"</span>);
<a name="l00347"></a>00347     parms-&gt;<a class="code" href="structPARMS__T.html#c2f69a649e1ac2d2e55e790ac067d46c" title="Array of DM.">dm</a>=calloc(parms-&gt;<a class="code" href="structPARMS__T.html#6492c3b89e0243fe23d88ebedb044b0e" title="Number of DMs.">ndm</a>,<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structDM__CFG__T.html" title="contains input parameters for each deformable mirror.">DM_CFG_T</a>));
<a name="l00348"></a>00348     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> idm=0; idm&lt;ndm; idm++){
<a name="l00349"></a>00349     parms-&gt;<a class="code" href="structPARMS__T.html#c2f69a649e1ac2d2e55e790ac067d46c" title="Array of DM.">dm</a>[idm].<a class="code" href="structDM__CFG__T.html#d51c7bdc88ea34b8b9b7577186f689de" title="Order of the DM within telescope clear subaperture.">order</a>=intjunk[idm];
<a name="l00350"></a>00350     }
<a name="l00351"></a>00351     free(intjunk);
<a name="l00352"></a>00352     READ_DM(dbl,guard);
<a name="l00353"></a>00353     READ_DM(dbl,stroke);
<a name="l00354"></a>00354     READ_DM(dbl,vmisreg);
<a name="l00355"></a>00355     READ_DM(dbl,ht);
<a name="l00356"></a>00356     READ_DM(dbl,offset);
<a name="l00357"></a>00357     READ_DM(dbl,histbin);
<a name="l00358"></a>00358     READ_DM(<span class="keywordtype">int</span>,histn);
<a name="l00359"></a>00359     READ_DM(<span class="keywordtype">int</span>,hist);
<a name="l00360"></a>00360     READ_DM(<span class="keywordtype">int</span>,cubic);
<a name="l00361"></a>00361     READ_DM(dbl,iac);
<a name="l00362"></a>00362 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="f1b51ba63bd9c8ce31aad0b3ddecb49b"></a><!-- doxytag: member="setup_parms.c::readcfg_moao" ref="f1b51ba63bd9c8ce31aad0b3ddecb49b" args="(PARMS_T *parms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void readcfg_moao           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structPARMS__T.html">PARMS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>parms</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Read in MOAO parameters. 
<p>
<div class="fragment"><pre class="fragment"><a name="l00376"></a>00376                                         {
<a name="l00377"></a>00377     <span class="keywordtype">int</span> nmoao,i;
<a name="l00378"></a>00378     <span class="keywordtype">double</span> *dbljunk;
<a name="l00379"></a>00379     <span class="keywordtype">int</span> *intjunk;
<a name="l00380"></a>00380     nmoao=parms-&gt;<a class="code" href="structPARMS__T.html#477936fb54c33badc9ec9bf34db0e17f" title="Number of different MOAO type.">nmoao</a>=<a class="code" href="readcfg_8h.html#2ea9d60b32c652ce4fad03c84d08c3f6" title="Read an int array from config hash table.">readcfg_intarr</a>(&amp;intjunk, <span class="stringliteral">"moao.order"</span>);
<a name="l00381"></a>00381     parms-&gt;<a class="code" href="structPARMS__T.html#2de7b678eb1df1bcc6fd4af8a3340fd0" title="Array of MOAO.">moao</a>=calloc(nmoao, <span class="keyword">sizeof</span>(<a class="code" href="structMOAO__CFG__T.html" title="contains input parameters for each MOAO type.">MOAO_CFG_T</a>));
<a name="l00382"></a>00382     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> imoao=0; imoao&lt;nmoao; imoao++){
<a name="l00383"></a>00383     parms-&gt;<a class="code" href="structPARMS__T.html#2de7b678eb1df1bcc6fd4af8a3340fd0" title="Array of MOAO.">moao</a>[imoao].<a class="code" href="structMOAO__CFG__T.html#d48b40cc8fa331e50d718f6ac50a2de3" title="Order of this MOAO.">order</a>=intjunk[imoao];
<a name="l00384"></a>00384     }
<a name="l00385"></a>00385     free(intjunk);
<a name="l00386"></a>00386     READ_MOAO(<span class="keywordtype">int</span>,cubic);
<a name="l00387"></a>00387     READ_MOAO(dbl,iac);
<a name="l00388"></a>00388     READ_MOAO(dbl,stroke);
<a name="l00389"></a>00389     READ_MOAO(<span class="keywordtype">int</span>,actslave);
<a name="l00390"></a>00390     READ_MOAO(<span class="keywordtype">int</span>,lrt_ptt);
<a name="l00391"></a>00391 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="0e11886cea89f186fee8923def4794e6"></a><!-- doxytag: member="setup_parms.c::readcfg_atm" ref="0e11886cea89f186fee8923def4794e6" args="(PARMS_T *parms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void readcfg_atm           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structPARMS__T.html">PARMS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>parms</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Read in atmosphere parameters. 
<p>
<div class="fragment"><pre class="fragment"><a name="l00395"></a>00395                                        {
<a name="l00396"></a>00396 
<a name="l00397"></a>00397     READ_DBL(atm.r0z);
<a name="l00398"></a>00398     READ_DBL(atm.l0);
<a name="l00399"></a>00399     READ_DBL(atm.dx);
<a name="l00400"></a>00400     READ_INT(atm.wdrand);
<a name="l00401"></a>00401     <a class="code" href="maos_2setup__parms_8c.html#cd97c28fc8c6bbd40c145372f94254bb" title="Read in double array of n elements from the configuration files.">readcfg_dblarr_n</a>(2, &amp;(parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#f2ab92f574c7c57c62315008a38d7200" title="size of atm in meter, [0 0]: automatic">size</a>),<span class="stringliteral">"atm.size"</span>);
<a name="l00402"></a>00402     parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#f377ac265c4e8778949386b5c78c9ba6" title="number of phase screens">nps</a>=<a class="code" href="readcfg_8h.html#969fc72b01334d0fe97e6faaa562c9bf" title="Read a double array from config hash table.">readcfg_dblarr</a>(&amp;(parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#59642a891abc1d24aaeee4521a82c91b" title="height of each layer">ht</a>),<span class="stringliteral">"atm.ht"</span>);
<a name="l00403"></a>00403     <a class="code" href="maos_2setup__parms_8c.html#cd97c28fc8c6bbd40c145372f94254bb" title="Read in double array of n elements from the configuration files.">readcfg_dblarr_n</a>(parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#f377ac265c4e8778949386b5c78c9ba6" title="number of phase screens">nps</a>,&amp;(parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#d539b2f97fd31f5e5dc999b852b71228" title="weight of each layer (relative strength of )">wt</a>),<span class="stringliteral">"atm.wt"</span>);
<a name="l00404"></a>00404     <a class="code" href="maos_2setup__parms_8c.html#cd97c28fc8c6bbd40c145372f94254bb" title="Read in double array of n elements from the configuration files.">readcfg_dblarr_n</a>(parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#f377ac265c4e8778949386b5c78c9ba6" title="number of phase screens">nps</a>,&amp;(parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#a9a86b3cc0c73d0d27cbad43f9706108" title="wind speed of each layer">ws</a>),<span class="stringliteral">"atm.ws"</span>);
<a name="l00405"></a>00405     <a class="code" href="maos_2setup__parms_8c.html#cd97c28fc8c6bbd40c145372f94254bb" title="Read in double array of n elements from the configuration files.">readcfg_dblarr_n</a>(parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#f377ac265c4e8778949386b5c78c9ba6" title="number of phase screens">nps</a>,&amp;(parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#c14a4c67cce4eab1f36b6cf7cd497754" title="wind direction of each layer">wddeg</a>),<span class="stringliteral">"atm.wddeg"</span>);
<a name="l00406"></a>00406     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ih=0; ih&lt;parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#f377ac265c4e8778949386b5c78c9ba6" title="number of phase screens">nps</a>; ih++){
<a name="l00407"></a>00407     <span class="keywordflow">if</span>(fabs(parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#c14a4c67cce4eab1f36b6cf7cd497754" title="wind direction of each layer">wddeg</a>[ih])&gt;1){
<a name="l00408"></a>00408         warning(<span class="stringliteral">"wddeg is not zero. Disable wdrand\n"</span>);
<a name="l00409"></a>00409         parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#9816d084ed9a1126c1edbcf2f38955f6" title="randomize wind direction">wdrand</a>=0;
<a name="l00410"></a>00410         <span class="keywordflow">break</span>;
<a name="l00411"></a>00411     }
<a name="l00412"></a>00412     }
<a name="l00413"></a>00413 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="501db4099d54887195219e49cba2cbe5"></a><!-- doxytag: member="setup_parms.c::readcfg_atmr" ref="501db4099d54887195219e49cba2cbe5" args="(PARMS_T *parms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void readcfg_atmr           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structPARMS__T.html">PARMS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>parms</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Read in atmosphere reconstruction parameters. 
<p>
<div class="fragment"><pre class="fragment"><a name="l00417"></a>00417                                         {
<a name="l00418"></a>00418   
<a name="l00419"></a>00419     READ_DBL(atmr.r0z);
<a name="l00420"></a>00420     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#654d89a9becf3ea9e32d11e470416f7c" title="information about reconstructed atm">atmr</a>.<a class="code" href="structATMR__CFG__T.html#e618e9ed799835a769be75de3a26bcc0" title="r0 at zenith">r0z</a>&lt;=0){
<a name="l00421"></a>00421     parms-&gt;<a class="code" href="structPARMS__T.html#654d89a9becf3ea9e32d11e470416f7c" title="information about reconstructed atm">atmr</a>.<a class="code" href="structATMR__CFG__T.html#e618e9ed799835a769be75de3a26bcc0" title="r0 at zenith">r0z</a>=parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#311b33269454ff4d1dbbb5e1d84abf41" title="r0 at zenith">r0z</a>;
<a name="l00422"></a>00422     }
<a name="l00423"></a>00423     READ_DBL(atmr.l0);
<a name="l00424"></a>00424     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#654d89a9becf3ea9e32d11e470416f7c" title="information about reconstructed atm">atmr</a>.<a class="code" href="structATMR__CFG__T.html#a1183e41c8d866fc77dfc08b5b229684" title="outer scale">l0</a>&lt;=0){
<a name="l00425"></a>00425     parms-&gt;<a class="code" href="structPARMS__T.html#654d89a9becf3ea9e32d11e470416f7c" title="information about reconstructed atm">atmr</a>.<a class="code" href="structATMR__CFG__T.html#a1183e41c8d866fc77dfc08b5b229684" title="outer scale">l0</a>=parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#d6a52fa85cd299be46eef6c58bc426b0" title="outer scale">l0</a>;
<a name="l00426"></a>00426     }
<a name="l00427"></a>00427     parms-&gt;<a class="code" href="structPARMS__T.html#654d89a9becf3ea9e32d11e470416f7c" title="information about reconstructed atm">atmr</a>.<a class="code" href="structATMR__CFG__T.html#14584f027f0a847b43f47fbbf53e6324" title="number of phase screens">nps</a>=<a class="code" href="readcfg_8h.html#969fc72b01334d0fe97e6faaa562c9bf" title="Read a double array from config hash table.">readcfg_dblarr</a>(&amp;(parms-&gt;<a class="code" href="structPARMS__T.html#654d89a9becf3ea9e32d11e470416f7c" title="information about reconstructed atm">atmr</a>.<a class="code" href="structATMR__CFG__T.html#c2d70c6f4dd690896de2145333728abc" title="height of each layer">ht</a>),<span class="stringliteral">"atmr.ht"</span>);
<a name="l00428"></a>00428     <a class="code" href="maos_2setup__parms_8c.html#cd97c28fc8c6bbd40c145372f94254bb" title="Read in double array of n elements from the configuration files.">readcfg_dblarr_n</a>(parms-&gt;<a class="code" href="structPARMS__T.html#654d89a9becf3ea9e32d11e470416f7c" title="information about reconstructed atm">atmr</a>.<a class="code" href="structATMR__CFG__T.html#14584f027f0a847b43f47fbbf53e6324" title="number of phase screens">nps</a>, &amp;(parms-&gt;<a class="code" href="structPARMS__T.html#654d89a9becf3ea9e32d11e470416f7c" title="information about reconstructed atm">atmr</a>.<a class="code" href="structATMR__CFG__T.html#a49819f62905b8043d11d4a2fe512bfa" title="weight of each layer (relative strength of )">wt</a>),<span class="stringliteral">"atmr.wt"</span>);
<a name="l00429"></a>00429     <a class="code" href="maos_2setup__parms_8c.html#985838f6490cf2e60012e8853932477b" title="Read in int array of n elements from the configuration files.">readcfg_intarr_n</a>(parms-&gt;<a class="code" href="structPARMS__T.html#654d89a9becf3ea9e32d11e470416f7c" title="information about reconstructed atm">atmr</a>.<a class="code" href="structATMR__CFG__T.html#14584f027f0a847b43f47fbbf53e6324" title="number of phase screens">nps</a>, &amp;(parms-&gt;<a class="code" href="structPARMS__T.html#654d89a9becf3ea9e32d11e470416f7c" title="information about reconstructed atm">atmr</a>.<a class="code" href="structATMR__CFG__T.html#7ef59da57ba267630d5fc5e067f75c99" title="over sampling factor of xloc over actuator spacing">os</a>),<span class="stringliteral">"atmr.os"</span>);
<a name="l00430"></a>00430     READ_INT(atmr.pos);
<a name="l00431"></a>00431     READ_INT(atmr.cone);
<a name="l00432"></a>00432     READ_INT(atmr.square);
<a name="l00433"></a>00433     READ_INT(atmr.invpsd);
<a name="l00434"></a>00434     READ_INT(atmr.guard);
<a name="l00435"></a>00435 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="1e298f863e10bdcb8f23abc5eab36a5a"></a><!-- doxytag: member="setup_parms.c::readcfg_aper" ref="1e298f863e10bdcb8f23abc5eab36a5a" args="(PARMS_T *parms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void readcfg_aper           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structPARMS__T.html">PARMS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>parms</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Read in aperture definitions. 
<p>
<div class="fragment"><pre class="fragment"><a name="l00440"></a>00440                                         {
<a name="l00441"></a>00441     READ_DBL(aper.d);
<a name="l00442"></a>00442     READ_DBL(aper.din);
<a name="l00443"></a>00443     READ_DBL(aper.dx);
<a name="l00444"></a>00444     READ_DBL(aper.rotdeg);
<a name="l00445"></a>00445     READ_INT(aper.cropamp);
<a name="l00446"></a>00446     READ_STR(aper.fnamp);
<a name="l00447"></a>00447 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="133d470dc6f43fbc5690c9f8e0046ff6"></a><!-- doxytag: member="setup_parms.c::readcfg_evl" ref="133d470dc6f43fbc5690c9f8e0046ff6" args="(PARMS_T *parms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void readcfg_evl           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structPARMS__T.html">PARMS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>parms</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Read in performance evaluation science point parameters. 
<p>
<div class="fragment"><pre class="fragment"><a name="l00452"></a>00452                                        {
<a name="l00453"></a>00453  
<a name="l00454"></a>00454     parms-&gt;<a class="code" href="structPARMS__T.html#4121e9dc728705be0ad2c58dcaf4cd75" title="Performance evaluation parameters.">evl</a>.<a class="code" href="structEVL__CFG__T.html#9f76679213a98ac7e3eb0fe92d645799" title="Number of evaluation directions.">nevl</a>=<a class="code" href="readcfg_8h.html#969fc72b01334d0fe97e6faaa562c9bf" title="Read a double array from config hash table.">readcfg_dblarr</a>((<span class="keywordtype">double</span>**)(<span class="keywordtype">void</span>*)&amp;(parms-&gt;<a class="code" href="structPARMS__T.html#4121e9dc728705be0ad2c58dcaf4cd75" title="Performance evaluation parameters.">evl</a>.<a class="code" href="structEVL__CFG__T.html#dcb390bcffd7629411575788c77de50e" title="x Coordinate of evaluation directions">thetax</a>),<span class="stringliteral">"evl.thetax"</span>);
<a name="l00455"></a>00455     <a class="code" href="maos_2setup__parms_8c.html#cd97c28fc8c6bbd40c145372f94254bb" title="Read in double array of n elements from the configuration files.">readcfg_dblarr_n</a>(parms-&gt;<a class="code" href="structPARMS__T.html#4121e9dc728705be0ad2c58dcaf4cd75" title="Performance evaluation parameters.">evl</a>.<a class="code" href="structEVL__CFG__T.html#9f76679213a98ac7e3eb0fe92d645799" title="Number of evaluation directions.">nevl</a>, (<span class="keywordtype">double</span>**)(<span class="keywordtype">void</span>*)&amp;(parms-&gt;<a class="code" href="structPARMS__T.html#4121e9dc728705be0ad2c58dcaf4cd75" title="Performance evaluation parameters.">evl</a>.<a class="code" href="structEVL__CFG__T.html#76b3e6506ff40743e8e28ad6aa36afa4" title="y Coordinate of evaluation directions">thetay</a>),<span class="stringliteral">"evl.thetay"</span>);
<a name="l00456"></a>00456     <a class="code" href="maos_2setup__parms_8c.html#cd97c28fc8c6bbd40c145372f94254bb" title="Read in double array of n elements from the configuration files.">readcfg_dblarr_n</a>(parms-&gt;<a class="code" href="structPARMS__T.html#4121e9dc728705be0ad2c58dcaf4cd75" title="Performance evaluation parameters.">evl</a>.<a class="code" href="structEVL__CFG__T.html#9f76679213a98ac7e3eb0fe92d645799" title="Number of evaluation directions.">nevl</a>, &amp;(parms-&gt;<a class="code" href="structPARMS__T.html#4121e9dc728705be0ad2c58dcaf4cd75" title="Performance evaluation parameters.">evl</a>.<a class="code" href="structEVL__CFG__T.html#1099d0a05e59fced8655347bbb50b9c8" title="weight of each direction">wt</a>), <span class="stringliteral">"evl.wt"</span>);
<a name="l00457"></a>00457     <a class="code" href="maos_2setup__parms_8c.html#985838f6490cf2e60012e8853932477b" title="Read in int array of n elements from the configuration files.">readcfg_intarr_n</a>(parms-&gt;<a class="code" href="structPARMS__T.html#4121e9dc728705be0ad2c58dcaf4cd75" title="Performance evaluation parameters.">evl</a>.<a class="code" href="structEVL__CFG__T.html#9f76679213a98ac7e3eb0fe92d645799" title="Number of evaluation directions.">nevl</a>, &amp;(parms-&gt;<a class="code" href="structPARMS__T.html#4121e9dc728705be0ad2c58dcaf4cd75" title="Performance evaluation parameters.">evl</a>.<a class="code" href="structEVL__CFG__T.html#653e8a6165a7a3a7918554c6482ddab0" title="1: participant in psf evaluation.">psf</a>), <span class="stringliteral">"evl.psf"</span>);
<a name="l00458"></a>00458     parms-&gt;<a class="code" href="structPARMS__T.html#4121e9dc728705be0ad2c58dcaf4cd75" title="Performance evaluation parameters.">evl</a>.<a class="code" href="structEVL__CFG__T.html#efa7d339640d46e883615e2de461ea60" title="Number of wavelength.">nwvl</a> = <a class="code" href="readcfg_8h.html#969fc72b01334d0fe97e6faaa562c9bf" title="Read a double array from config hash table.">readcfg_dblarr</a>(&amp;(parms-&gt;<a class="code" href="structPARMS__T.html#4121e9dc728705be0ad2c58dcaf4cd75" title="Performance evaluation parameters.">evl</a>.<a class="code" href="structEVL__CFG__T.html#e36c873b00a4bbc1a3dae8a6aa1549fd" title="wavelength for PSF and strehl computation">wvl</a>), <span class="stringliteral">"evl.wvl"</span>);
<a name="l00459"></a>00459     <a class="code" href="maos_2setup__parms_8c.html#985838f6490cf2e60012e8853932477b" title="Read in int array of n elements from the configuration files.">readcfg_intarr_n</a>(parms-&gt;<a class="code" href="structPARMS__T.html#4121e9dc728705be0ad2c58dcaf4cd75" title="Performance evaluation parameters.">evl</a>.<a class="code" href="structEVL__CFG__T.html#efa7d339640d46e883615e2de461ea60" title="Number of wavelength.">nwvl</a>, &amp;(parms-&gt;<a class="code" href="structPARMS__T.html#4121e9dc728705be0ad2c58dcaf4cd75" title="Performance evaluation parameters.">evl</a>.<a class="code" href="structEVL__CFG__T.html#37a1a5330f6e8e56af0a724024e19a46" title="grid size for FFT to generate PSF.">psfgridsize</a>),<span class="stringliteral">"evl.psfgridsize"</span>);
<a name="l00460"></a>00460     <span class="keywordtype">int</span> ievl;
<a name="l00461"></a>00461     parms-&gt;<a class="code" href="structPARMS__T.html#4121e9dc728705be0ad2c58dcaf4cd75" title="Performance evaluation parameters.">evl</a>.<a class="code" href="structEVL__CFG__T.html#1a4adc47bdaa62f95418783e1506ac67" title="index of the on axis evluation point.">indoa</a>=-1;
<a name="l00462"></a>00462     <span class="keywordflow">for</span>(ievl=0; ievl&lt;parms-&gt;<a class="code" href="structPARMS__T.html#4121e9dc728705be0ad2c58dcaf4cd75" title="Performance evaluation parameters.">evl</a>.<a class="code" href="structEVL__CFG__T.html#9f76679213a98ac7e3eb0fe92d645799" title="Number of evaluation directions.">nevl</a>; ievl++){
<a name="l00463"></a>00463     parms-&gt;<a class="code" href="structPARMS__T.html#4121e9dc728705be0ad2c58dcaf4cd75" title="Performance evaluation parameters.">evl</a>.<a class="code" href="structEVL__CFG__T.html#dcb390bcffd7629411575788c77de50e" title="x Coordinate of evaluation directions">thetax</a>[ievl]/=206265.;
<a name="l00464"></a>00464     parms-&gt;<a class="code" href="structPARMS__T.html#4121e9dc728705be0ad2c58dcaf4cd75" title="Performance evaluation parameters.">evl</a>.<a class="code" href="structEVL__CFG__T.html#76b3e6506ff40743e8e28ad6aa36afa4" title="y Coordinate of evaluation directions">thetay</a>[ievl]/=206265.;
<a name="l00465"></a>00465     <span class="keywordflow">if</span>(fabs(parms-&gt;<a class="code" href="structPARMS__T.html#4121e9dc728705be0ad2c58dcaf4cd75" title="Performance evaluation parameters.">evl</a>.<a class="code" href="structEVL__CFG__T.html#dcb390bcffd7629411575788c77de50e" title="x Coordinate of evaluation directions">thetax</a>[ievl])&lt;1.e-15 
<a name="l00466"></a>00466        &amp;&amp;fabs(parms-&gt;<a class="code" href="structPARMS__T.html#4121e9dc728705be0ad2c58dcaf4cd75" title="Performance evaluation parameters.">evl</a>.<a class="code" href="structEVL__CFG__T.html#76b3e6506ff40743e8e28ad6aa36afa4" title="y Coordinate of evaluation directions">thetay</a>[ievl])&lt;1.e-15){
<a name="l00467"></a>00467         <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#4121e9dc728705be0ad2c58dcaf4cd75" title="Performance evaluation parameters.">evl</a>.<a class="code" href="structEVL__CFG__T.html#1a4adc47bdaa62f95418783e1506ac67" title="index of the on axis evluation point.">indoa</a>==-1){
<a name="l00468"></a>00468         parms-&gt;<a class="code" href="structPARMS__T.html#4121e9dc728705be0ad2c58dcaf4cd75" title="Performance evaluation parameters.">evl</a>.<a class="code" href="structEVL__CFG__T.html#1a4adc47bdaa62f95418783e1506ac67" title="index of the on axis evluation point.">indoa</a>=ievl;
<a name="l00469"></a>00469         }<span class="keywordflow">else</span>{
<a name="l00470"></a>00470         warning(<span class="stringliteral">"Evaluation direction %d is also on axis.\n"</span>,ievl);
<a name="l00471"></a>00471         }
<a name="l00472"></a>00472     }
<a name="l00473"></a>00473     }
<a name="l00474"></a>00474     READ_DBL(evl.ht);
<a name="l00475"></a>00475     READ_INT(evl.rmax);
<a name="l00476"></a>00476     READ_INT(evl.psfol);
<a name="l00477"></a>00477     READ_INT(evl.psfisim);
<a name="l00478"></a>00478     READ_INT(evl.psfpttr);
<a name="l00479"></a>00479     READ_INT(evl.psfmean); 
<a name="l00480"></a>00480     READ_INT(evl.psfhist); 
<a name="l00481"></a>00481     READ_INT(evl.psfsize);
<a name="l00482"></a>00482     READ_INT(evl.tomo);
<a name="l00483"></a>00483     READ_INT(evl.moao);
<a name="l00484"></a>00484     <span class="keywordflow">for</span>(ievl=0; ievl&lt;parms-&gt;<a class="code" href="structPARMS__T.html#4121e9dc728705be0ad2c58dcaf4cd75" title="Performance evaluation parameters.">evl</a>.<a class="code" href="structEVL__CFG__T.html#9f76679213a98ac7e3eb0fe92d645799" title="Number of evaluation directions.">nevl</a>; ievl++){
<a name="l00485"></a>00485     parms-&gt;<a class="code" href="structPARMS__T.html#4121e9dc728705be0ad2c58dcaf4cd75" title="Performance evaluation parameters.">evl</a>.<a class="code" href="structEVL__CFG__T.html#93a2b47b0ff2f1e9be0d9453d10c0b44" title="how many directions we compute psf for">npsf</a>+=(parms-&gt;<a class="code" href="structPARMS__T.html#4121e9dc728705be0ad2c58dcaf4cd75" title="Performance evaluation parameters.">evl</a>.<a class="code" href="structEVL__CFG__T.html#653e8a6165a7a3a7918554c6482ddab0" title="1: participant in psf evaluation.">psf</a>[ievl]&gt;0);
<a name="l00486"></a>00486     }
<a name="l00487"></a>00487   
<a name="l00488"></a>00488     parms-&gt;<a class="code" href="structPARMS__T.html#4121e9dc728705be0ad2c58dcaf4cd75" title="Performance evaluation parameters.">evl</a>.<a class="code" href="structEVL__CFG__T.html#0401d88cccdc0585b83e8cb919d82d54" title="Number of modes.">nmod</a>=(parms-&gt;<a class="code" href="structPARMS__T.html#4121e9dc728705be0ad2c58dcaf4cd75" title="Performance evaluation parameters.">evl</a>.<a class="code" href="structEVL__CFG__T.html#dca4ace9f4c301647cefd28a489320ce" title="max radial mode for performance evaluation.">rmax</a>+1)*(parms-&gt;<a class="code" href="structPARMS__T.html#4121e9dc728705be0ad2c58dcaf4cd75" title="Performance evaluation parameters.">evl</a>.<a class="code" href="structEVL__CFG__T.html#dca4ace9f4c301647cefd28a489320ce" title="max radial mode for performance evaluation.">rmax</a>+2)/2;
<a name="l00489"></a>00489 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="9a5f9a428f3b04060a1f80ba6b319039"></a><!-- doxytag: member="setup_parms.c::readcfg_tomo" ref="9a5f9a428f3b04060a1f80ba6b319039" args="(PARMS_T *parms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void readcfg_tomo           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structPARMS__T.html">PARMS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>parms</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Read in turbulence tomography parameters. 
<p>
<div class="fragment"><pre class="fragment"><a name="l00493"></a>00493                                         {
<a name="l00494"></a>00494 
<a name="l00495"></a>00495     READ_DBL(<a class="code" href="recon_8c.html#44159203334924b9277408e81a49a893" title="Carry out tomography.">tomo</a>.tik_cstr);
<a name="l00496"></a>00496     READ_INT(<a class="code" href="recon_8c.html#44159203334924b9277408e81a49a893" title="Carry out tomography.">tomo</a>.xloc_tight);
<a name="l00497"></a>00497     READ_INT(<a class="code" href="recon_8c.html#44159203334924b9277408e81a49a893" title="Carry out tomography.">tomo</a>.piston_cr);
<a name="l00498"></a>00498     READ_INT(<a class="code" href="recon_8c.html#44159203334924b9277408e81a49a893" title="Carry out tomography.">tomo</a>.split);
<a name="l00499"></a>00499     READ_INT(<a class="code" href="recon_8c.html#44159203334924b9277408e81a49a893" title="Carry out tomography.">tomo</a>.split_wt);
<a name="l00500"></a>00500     READ_INT(<a class="code" href="recon_8c.html#44159203334924b9277408e81a49a893" title="Carry out tomography.">tomo</a>.split_Rngs_svd);
<a name="l00501"></a>00501     READ_INT(<a class="code" href="recon_8c.html#44159203334924b9277408e81a49a893" title="Carry out tomography.">tomo</a>.split_idealngs);
<a name="l00502"></a>00502     READ_INT(<a class="code" href="recon_8c.html#44159203334924b9277408e81a49a893" title="Carry out tomography.">tomo</a>.split_rtt);
<a name="l00503"></a>00503     READ_INT(<a class="code" href="recon_8c.html#44159203334924b9277408e81a49a893" title="Carry out tomography.">tomo</a>.alg);
<a name="l00504"></a>00504     READ_INT(<a class="code" href="recon_8c.html#44159203334924b9277408e81a49a893" title="Carry out tomography.">tomo</a>.precond);
<a name="l00505"></a>00505     READ_INT(<a class="code" href="recon_8c.html#44159203334924b9277408e81a49a893" title="Carry out tomography.">tomo</a>.maxit);
<a name="l00506"></a>00506     READ_INT(<a class="code" href="recon_8c.html#44159203334924b9277408e81a49a893" title="Carry out tomography.">tomo</a>.assemble);
<a name="l00507"></a>00507     READ_INT(<a class="code" href="recon_8c.html#44159203334924b9277408e81a49a893" title="Carry out tomography.">tomo</a>.windest);
<a name="l00508"></a>00508     READ_INT(<a class="code" href="recon_8c.html#44159203334924b9277408e81a49a893" title="Carry out tomography.">tomo</a>.windshift);
<a name="l00509"></a>00509     READ_DBL(<a class="code" href="recon_8c.html#44159203334924b9277408e81a49a893" title="Carry out tomography.">tomo</a>.minwt);
<a name="l00510"></a>00510 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="6a5bda1804c407f53ca9e36f6bb6f1d5"></a><!-- doxytag: member="setup_parms.c::readcfg_fit" ref="6a5bda1804c407f53ca9e36f6bb6f1d5" args="(PARMS_T *parms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void readcfg_fit           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structPARMS__T.html">PARMS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>parms</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Read in DM fit parameters. 
<p>
MOAO is specified elsewhere in <a class="el" href="maos_2setup__parms_8c.html#f1b51ba63bd9c8ce31aad0b3ddecb49b" title="Read in MOAO parameters.">readcfg_moao()</a> <div class="fragment"><pre class="fragment"><a name="l00514"></a>00514                                        {
<a name="l00515"></a>00515  
<a name="l00516"></a>00516     parms-&gt;<a class="code" href="structPARMS__T.html#3b8ffe6fa411ea23ef7c1383fe61abbf" title="DM fit parameters.">fit</a>.<a class="code" href="structFIT__CFG__T.html#6e582e718e6c2418d8b9238fdcdfcb9d" title="Number of DM fit directions.">nfit</a>=<a class="code" href="readcfg_8h.html#969fc72b01334d0fe97e6faaa562c9bf" title="Read a double array from config hash table.">readcfg_dblarr</a>((<span class="keywordtype">double</span>**)(<span class="keywordtype">void</span>*)&amp;(parms-&gt;<a class="code" href="structPARMS__T.html#3b8ffe6fa411ea23ef7c1383fe61abbf" title="DM fit parameters.">fit</a>.<a class="code" href="structFIT__CFG__T.html#e546272f69aa60a0f5c435d438641001" title="x Coordinate of DM fitting directions.">thetax</a>), <span class="stringliteral">"fit.thetax"</span>);
<a name="l00517"></a>00517     <a class="code" href="maos_2setup__parms_8c.html#cd97c28fc8c6bbd40c145372f94254bb" title="Read in double array of n elements from the configuration files.">readcfg_dblarr_n</a>(parms-&gt;<a class="code" href="structPARMS__T.html#3b8ffe6fa411ea23ef7c1383fe61abbf" title="DM fit parameters.">fit</a>.<a class="code" href="structFIT__CFG__T.html#6e582e718e6c2418d8b9238fdcdfcb9d" title="Number of DM fit directions.">nfit</a>,
<a name="l00518"></a>00518              (<span class="keywordtype">double</span>**)(<span class="keywordtype">void</span>*)&amp;(parms-&gt;<a class="code" href="structPARMS__T.html#3b8ffe6fa411ea23ef7c1383fe61abbf" title="DM fit parameters.">fit</a>.<a class="code" href="structFIT__CFG__T.html#4c47b74e14e1521755410a9183d3ef6c" title="y Coordinate of DM fitting directions.">thetay</a>), <span class="stringliteral">"fit.thetay"</span>);
<a name="l00519"></a>00519     <a class="code" href="maos_2setup__parms_8c.html#cd97c28fc8c6bbd40c145372f94254bb" title="Read in double array of n elements from the configuration files.">readcfg_dblarr_n</a>(parms-&gt;<a class="code" href="structPARMS__T.html#3b8ffe6fa411ea23ef7c1383fe61abbf" title="DM fit parameters.">fit</a>.<a class="code" href="structFIT__CFG__T.html#6e582e718e6c2418d8b9238fdcdfcb9d" title="Number of DM fit directions.">nfit</a>,
<a name="l00520"></a>00520              (<span class="keywordtype">double</span>**)(<span class="keywordtype">void</span>*)&amp;(parms-&gt;<a class="code" href="structPARMS__T.html#3b8ffe6fa411ea23ef7c1383fe61abbf" title="DM fit parameters.">fit</a>.<a class="code" href="structFIT__CFG__T.html#e921bb24d3f1439f4023b4009a004cd0" title="weight of each direction">wt</a>), <span class="stringliteral">"fit.wt"</span>);
<a name="l00521"></a>00521     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ifit=0; ifit&lt;parms-&gt;<a class="code" href="structPARMS__T.html#3b8ffe6fa411ea23ef7c1383fe61abbf" title="DM fit parameters.">fit</a>.<a class="code" href="structFIT__CFG__T.html#6e582e718e6c2418d8b9238fdcdfcb9d" title="Number of DM fit directions.">nfit</a>; ifit++){
<a name="l00522"></a>00522     parms-&gt;<a class="code" href="structPARMS__T.html#3b8ffe6fa411ea23ef7c1383fe61abbf" title="DM fit parameters.">fit</a>.<a class="code" href="structFIT__CFG__T.html#e546272f69aa60a0f5c435d438641001" title="x Coordinate of DM fitting directions.">thetax</a>[ifit]/=206265;
<a name="l00523"></a>00523     parms-&gt;<a class="code" href="structPARMS__T.html#3b8ffe6fa411ea23ef7c1383fe61abbf" title="DM fit parameters.">fit</a>.<a class="code" href="structFIT__CFG__T.html#4c47b74e14e1521755410a9183d3ef6c" title="y Coordinate of DM fitting directions.">thetay</a>[ifit]/=206265;
<a name="l00524"></a>00524     }
<a name="l00525"></a>00525 
<a name="l00526"></a>00526     READ_DBL(<a class="code" href="recon_8c.html#861c4d9312ead5560557940f35618e17" title="Carry out DM fit.">fit</a>.tik_cstr);
<a name="l00527"></a>00527     READ_INT(<a class="code" href="recon_8c.html#861c4d9312ead5560557940f35618e17" title="Carry out DM fit.">fit</a>.actslave);
<a name="l00528"></a>00528     READ_INT(<a class="code" href="recon_8c.html#861c4d9312ead5560557940f35618e17" title="Carry out DM fit.">fit</a>.lrt_piston);
<a name="l00529"></a>00529     READ_INT(<a class="code" href="recon_8c.html#861c4d9312ead5560557940f35618e17" title="Carry out DM fit.">fit</a>.lrt_tt);
<a name="l00530"></a>00530     READ_INT(<a class="code" href="recon_8c.html#861c4d9312ead5560557940f35618e17" title="Carry out DM fit.">fit</a>.alg);
<a name="l00531"></a>00531     READ_INT(<a class="code" href="recon_8c.html#861c4d9312ead5560557940f35618e17" title="Carry out DM fit.">fit</a>.precond);
<a name="l00532"></a>00532     READ_INT(<a class="code" href="recon_8c.html#861c4d9312ead5560557940f35618e17" title="Carry out DM fit.">fit</a>.maxit);
<a name="l00533"></a>00533     READ_INT(<a class="code" href="recon_8c.html#861c4d9312ead5560557940f35618e17" title="Carry out DM fit.">fit</a>.square);
<a name="l00534"></a>00534 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="427962208b0462b3c477798ac97783d6"></a><!-- doxytag: member="setup_parms.c::readcfg_sim" ref="427962208b0462b3c477798ac97783d6" args="(PARMS_T *parms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void readcfg_sim           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structPARMS__T.html">PARMS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>parms</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Read in simulation parameters. 
<p>
<div class="fragment"><pre class="fragment"><a name="l00538"></a>00538                                        {
<a name="l00539"></a>00539    
<a name="l00540"></a>00540     READ_DBL(<a class="code" href="sim_8c.html#b5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.epdm);
<a name="l00541"></a>00541     READ_DBL(<a class="code" href="sim_8c.html#b5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.epngs);
<a name="l00542"></a>00542     READ_DBL(<a class="code" href="sim_8c.html#b5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.epupt);
<a name="l00543"></a>00543     READ_DBL(<a class="code" href="sim_8c.html#b5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.dpupt);
<a name="l00544"></a>00544     READ_DBL(<a class="code" href="sim_8c.html#b5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.epfocus);
<a name="l00545"></a>00545     READ_DBL(<a class="code" href="sim_8c.html#b5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.lpfocus);
<a name="l00546"></a>00546     READ_INT(<a class="code" href="sim_8c.html#b5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.mffocus);
<a name="l00547"></a>00547     READ_INT(<a class="code" href="sim_8c.html#b5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.uptideal);
<a name="l00548"></a>00548     parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#953c553bdd3d3252dd833702d2b9fe1c" title="number of entries in apdm">napdm</a>=<a class="code" href="readcfg_8h.html#969fc72b01334d0fe97e6faaa562c9bf" title="Read a double array from config hash table.">readcfg_dblarr</a>(&amp;parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#4be58c3c2eb209ecdc69103539564fd4" title="servo coefficient for high order dm.">apdm</a>,<span class="stringliteral">"sim.apdm"</span>);
<a name="l00549"></a>00549     parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#18721e88bd6e37b5710bce0d5d6399e8" title="number of entries in apngs">napngs</a>=<a class="code" href="readcfg_8h.html#969fc72b01334d0fe97e6faaa562c9bf" title="Read a double array from config hash table.">readcfg_dblarr</a>(&amp;parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#622c97555ba7a5e6117c0ebc94019274" title="servo coefficient for ngs modes.">apngs</a>,<span class="stringliteral">"sim.apngs"</span>);
<a name="l00550"></a>00550     parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#21abf2c17974a27111b44429091940d8" title="number of entries in apupt">napupt</a>=<a class="code" href="readcfg_8h.html#969fc72b01334d0fe97e6faaa562c9bf" title="Read a double array from config hash table.">readcfg_dblarr</a>(&amp;parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#c28c47f283a17d156dd77abe224a203d" title="servo coefficient for for LGS uplink pointing loop.">apupt</a>,<span class="stringliteral">"sim.apupt"</span>);
<a name="l00551"></a>00551     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#953c553bdd3d3252dd833702d2b9fe1c" title="number of entries in apdm">napdm</a>==1){
<a name="l00552"></a>00552     <span class="comment">//We append a 0 so that we keep a time history of the integrator.</span>
<a name="l00553"></a>00553     parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#4be58c3c2eb209ecdc69103539564fd4" title="servo coefficient for high order dm.">apdm</a>=realloc(parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#4be58c3c2eb209ecdc69103539564fd4" title="servo coefficient for high order dm.">apdm</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)*2);
<a name="l00554"></a>00554     parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#4be58c3c2eb209ecdc69103539564fd4" title="servo coefficient for high order dm.">apdm</a>[1]=0;
<a name="l00555"></a>00555     parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#953c553bdd3d3252dd833702d2b9fe1c" title="number of entries in apdm">napdm</a>=2;
<a name="l00556"></a>00556     }
<a name="l00557"></a>00557     <span class="keywordflow">if</span>(fabs(<a class="code" href="mathmisc_8c.html#2e90f5760bd508b1e45e25ca9f2c39f4" title="Compute the sum of double vector.">dblsum</a>(parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#4be58c3c2eb209ecdc69103539564fd4" title="servo coefficient for high order dm.">apdm</a>, parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#953c553bdd3d3252dd833702d2b9fe1c" title="number of entries in apdm">napdm</a>)-1)&gt;1.e-10){
<a name="l00558"></a>00558     error(<span class="stringliteral">"sum(sim.apdm)=%g. Should be 1.\n"</span>, 
<a name="l00559"></a>00559           <a class="code" href="mathmisc_8c.html#2e90f5760bd508b1e45e25ca9f2c39f4" title="Compute the sum of double vector.">dblsum</a>(parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#4be58c3c2eb209ecdc69103539564fd4" title="servo coefficient for high order dm.">apdm</a>, parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#953c553bdd3d3252dd833702d2b9fe1c" title="number of entries in apdm">napdm</a>));
<a name="l00560"></a>00560     }
<a name="l00561"></a>00561     <span class="keywordflow">if</span>(fabs(<a class="code" href="mathmisc_8c.html#2e90f5760bd508b1e45e25ca9f2c39f4" title="Compute the sum of double vector.">dblsum</a>(parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#622c97555ba7a5e6117c0ebc94019274" title="servo coefficient for ngs modes.">apngs</a>, parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#18721e88bd6e37b5710bce0d5d6399e8" title="number of entries in apngs">napngs</a>)-1)&gt;1.e-10){
<a name="l00562"></a>00562     error(<span class="stringliteral">"sum(sim.apngs)=%g. Should be 1.\n"</span>, 
<a name="l00563"></a>00563           <a class="code" href="mathmisc_8c.html#2e90f5760bd508b1e45e25ca9f2c39f4" title="Compute the sum of double vector.">dblsum</a>(parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#622c97555ba7a5e6117c0ebc94019274" title="servo coefficient for ngs modes.">apngs</a>, parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#18721e88bd6e37b5710bce0d5d6399e8" title="number of entries in apngs">napngs</a>));
<a name="l00564"></a>00564     }
<a name="l00565"></a>00565     <span class="keywordflow">if</span>(fabs(<a class="code" href="mathmisc_8c.html#2e90f5760bd508b1e45e25ca9f2c39f4" title="Compute the sum of double vector.">dblsum</a>(parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#c28c47f283a17d156dd77abe224a203d" title="servo coefficient for for LGS uplink pointing loop.">apupt</a>, parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#21abf2c17974a27111b44429091940d8" title="number of entries in apupt">napupt</a>)-1)&gt;1.e-10){
<a name="l00566"></a>00566     error(<span class="stringliteral">"sum(sim.apupt)=%g. Should be 1.\n"</span>, 
<a name="l00567"></a>00567           <a class="code" href="mathmisc_8c.html#2e90f5760bd508b1e45e25ca9f2c39f4" title="Compute the sum of double vector.">dblsum</a>(parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#c28c47f283a17d156dd77abe224a203d" title="servo coefficient for for LGS uplink pointing loop.">apupt</a>, parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#21abf2c17974a27111b44429091940d8" title="number of entries in apupt">napupt</a>));
<a name="l00568"></a>00568     }
<a name="l00569"></a>00569     parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#6021b395d1b8ca9bb3f3449b67ed7935" title="How many simulation seed.">nseed</a>=<a class="code" href="readcfg_8h.html#2ea9d60b32c652ce4fad03c84d08c3f6" title="Read an int array from config hash table.">readcfg_intarr</a>(&amp;parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#483429d04a2de324a443780025083dda" title="simulation seeds">seeds</a>,<span class="stringliteral">"sim.seeds"</span>);
<a name="l00570"></a>00570     READ_DBL(<a class="code" href="sim_8c.html#b5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.dt);
<a name="l00571"></a>00571     READ_INT(<a class="code" href="sim_8c.html#b5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.start);
<a name="l00572"></a>00572     READ_INT(<a class="code" href="sim_8c.html#b5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.end);
<a name="l00573"></a>00573     READ_INT(<a class="code" href="sim_8c.html#b5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.servotype_hi);
<a name="l00574"></a>00574     READ_INT(<a class="code" href="sim_8c.html#b5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.servotype_lo);
<a name="l00575"></a>00575     READ_STR(<a class="code" href="sim_8c.html#b5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.gtypeII_lo);
<a name="l00576"></a>00576     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#50827ebc23e85d5b8c052af5436827d9" title="servo type for low order loop.">servotype_lo</a>==2 &amp;&amp; !parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#f0e66665827c92aefc31d47c000069ec" title="contains 3x1 or 3xnmod type II gains.">gtypeII_lo</a>){
<a name="l00577"></a>00577     error(<span class="stringliteral">"Must supply parms-&gt;sim.gtypeII_lo when sim.servotype_lo=%d\n"</span>,
<a name="l00578"></a>00578           parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#50827ebc23e85d5b8c052af5436827d9" title="servo type for low order loop.">servotype_lo</a>);
<a name="l00579"></a>00579     }
<a name="l00580"></a>00580     READ_INT(<a class="code" href="sim_8c.html#b5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.frozenflow);
<a name="l00581"></a>00581     READ_INT(<a class="code" href="sim_8c.html#b5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.cachedm);
<a name="l00582"></a>00582     READ_INT(<a class="code" href="sim_8c.html#b5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.cachesurf);
<a name="l00583"></a>00583     READ_INT(<a class="code" href="sim_8c.html#b5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.fuseint);
<a name="l00584"></a>00584     READ_INT(<a class="code" href="sim_8c.html#b5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.closeloop);
<a name="l00585"></a>00585     READ_INT(<a class="code" href="sim_8c.html#b5fd8ff2c1fe7a6270dad89ec5da4873" title="Closed loop simulation main loop.">sim</a>.skysim);
<a name="l00586"></a>00586     parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#8bec09f88dc7ab71730f50f54bca225e" title="zenith angle in radian">za</a> = <a class="code" href="readcfg_8h.html#2b13907448b0ece4c728fd1f4d2eab30" title="Read a double number from config hash table.">readcfg_dbl</a>(<span class="stringliteral">"sim.zadeg"</span>)*M_PI/180.;
<a name="l00587"></a>00587     parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#c524d5bd3cfcdc5ca45ba1641c8d1b0e" title="frozen flow.">frozenflow</a> = (parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#c524d5bd3cfcdc5ca45ba1641c8d1b0e" title="frozen flow.">frozenflow</a> || parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#0408bb89e89669682cba86f7fb98b2dc" title="closed loop or open loop">closeloop</a>);
<a name="l00588"></a>00588 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="f045265022d49edfbfceea0f6f4950a8"></a><!-- doxytag: member="setup_parms.c::readcfg_cn2" ref="f045265022d49edfbfceea0f6f4950a8" args="(PARMS_T *parms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void readcfg_cn2           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structPARMS__T.html">PARMS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>parms</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Read in parameters for Cn2 estimation. 
<p>
<div class="fragment"><pre class="fragment"><a name="l00592"></a>00592                                        {
<a name="l00593"></a>00593 <span class="comment">//for Cn2 Estimation.</span>
<a name="l00594"></a>00594     parms-&gt;<a class="code" href="structPARMS__T.html#bc0c4384664b89b6777b64d77f18a0bc" title="Parameters for Cn2 estimation.">cn2</a>.npair = <a class="code" href="readcfg_8h.html#2ea9d60b32c652ce4fad03c84d08c3f6" title="Read an int array from config hash table.">readcfg_intarr</a>(&amp;parms-&gt;<a class="code" href="structPARMS__T.html#bc0c4384664b89b6777b64d77f18a0bc" title="Parameters for Cn2 estimation.">cn2</a>.pair,<span class="stringliteral">"cn2.pair"</span>);
<a name="l00595"></a>00595     READ_INT(cn2.step);
<a name="l00596"></a>00596     READ_INT(cn2.reset);
<a name="l00597"></a>00597     READ_INT(cn2.tomo);
<a name="l00598"></a>00598     READ_INT(cn2.keepht);
<a name="l00599"></a>00599     READ_INT(cn2.nhtrecon);
<a name="l00600"></a>00600     READ_INT(cn2.moveht);
<a name="l00601"></a>00601     READ_DBL(cn2.hmax);
<a name="l00602"></a>00602     READ_DBL(cn2.saat);
<a name="l00603"></a>00603     <span class="keywordflow">if</span>(!parms-&gt;<a class="code" href="structPARMS__T.html#bc0c4384664b89b6777b64d77f18a0bc" title="Parameters for Cn2 estimation.">cn2</a>.pair){<span class="comment">//we are not doing cn2 estimation.</span>
<a name="l00604"></a>00604     parms-&gt;<a class="code" href="structPARMS__T.html#bc0c4384664b89b6777b64d77f18a0bc" title="Parameters for Cn2 estimation.">cn2</a>.tomo=0;
<a name="l00605"></a>00605     }
<a name="l00606"></a>00606 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="1b39e7e3bf45af24d385587415f54a11"></a><!-- doxytag: member="setup_parms.c::readcfg_plot" ref="1b39e7e3bf45af24d385587415f54a11" args="(PARMS_T *parms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void readcfg_plot           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structPARMS__T.html">PARMS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>parms</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Specify which variables to plot. 
<p>
<div class="fragment"><pre class="fragment"><a name="l00610"></a>00610                                         {
<a name="l00611"></a>00611   
<a name="l00612"></a>00612     READ_INT(plot.setup);
<a name="l00613"></a>00613     READ_INT(plot.atm);
<a name="l00614"></a>00614     READ_INT(plot.run);
<a name="l00615"></a>00615 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="290f919909b9bbb347962e8a7a31a327"></a><!-- doxytag: member="setup_parms.c::readcfg_dbg" ref="290f919909b9bbb347962e8a7a31a327" args="(PARMS_T *parms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void readcfg_dbg           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structPARMS__T.html">PARMS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>parms</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Read in debugging parameters. 
<p>
<div class="fragment"><pre class="fragment"><a name="l00619"></a>00619                                        {
<a name="l00620"></a>00620   
<a name="l00621"></a>00621     READ_INT(dbg.psol);
<a name="l00622"></a>00622     READ_INT(dbg.evlol);
<a name="l00623"></a>00623     READ_INT(dbg.noatm);
<a name="l00624"></a>00624     READ_INT(dbg.clemp_all);
<a name="l00625"></a>00625     READ_INT(dbg.wamethod);
<a name="l00626"></a>00626     READ_INT(dbg.opdx);
<a name="l00627"></a>00627     READ_INT(dbg.atm);
<a name="l00628"></a>00628     parms-&gt;<a class="code" href="structPARMS__T.html#8fdfce1e68e018f54640c3d7214fcc33" title="Specify debugging parameters.">dbg</a>.<a class="code" href="structDBG__CFG__T.html#7b62e7127ef7c49d9dda1a7d1f4c7910" title="number of pairs of gradient covariance to compute">ngcov</a>=<a class="code" href="readcfg_8h.html#2ea9d60b32c652ce4fad03c84d08c3f6" title="Read an int array from config hash table.">readcfg_intarr</a>(&amp;parms-&gt;<a class="code" href="structPARMS__T.html#8fdfce1e68e018f54640c3d7214fcc33" title="Specify debugging parameters.">dbg</a>.<a class="code" href="structDBG__CFG__T.html#91f7f5d1d1d97dbf460ffbf4f951837c" title="size of 2*ngcov, specifying wfs for each pair">gcov</a>,<span class="stringliteral">"dbg.gcov"</span>)/2;
<a name="l00629"></a>00629     READ_INT(dbg.gcovp);
<a name="l00630"></a>00630     READ_INT(dbg.fitonly);
<a name="l00631"></a>00631     READ_INT(dbg.keepshm);
<a name="l00632"></a>00632     READ_INT(dbg.mvstlimit);
<a name="l00633"></a>00633     READ_INT(dbg.annular_W);
<a name="l00634"></a>00634 <span class="preprocessor">#if USE_POSIX_SHM</span>
<a name="l00635"></a>00635 <span class="preprocessor"></span>    shm_keep_unused=parms-&gt;<a class="code" href="structPARMS__T.html#8fdfce1e68e018f54640c3d7214fcc33" title="Specify debugging parameters.">dbg</a>.<a class="code" href="structDBG__CFG__T.html#7937f89f3c81466aefd5b7ad526967a0" title="keep the atmospehre in the shared memory.">keepshm</a>;
<a name="l00636"></a>00636 <span class="preprocessor">#endif</span>
<a name="l00637"></a>00637 <span class="preprocessor"></span>}
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="c35c651f34a6a45cd536e1f4f9d11116"></a><!-- doxytag: member="setup_parms.c::readcfg_save" ref="c35c651f34a6a45cd536e1f4f9d11116" args="(PARMS_T *parms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void readcfg_save           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structPARMS__T.html">PARMS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>parms</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Specify which variables to save. 
<p>
<div class="fragment"><pre class="fragment"><a name="l00642"></a>00642                                         {
<a name="l00643"></a>00643   
<a name="l00644"></a>00644     READ_INT(save.setup);
<a name="l00645"></a>00645     READ_INT(save.recon);
<a name="l00646"></a>00646     READ_INT(save.mvst);
<a name="l00647"></a>00647 
<a name="l00648"></a>00648     READ_INT(save.atm);<span class="comment">//Save atmosphere</span>
<a name="l00649"></a>00649     READ_INT(save.run);
<a name="l00650"></a>00650     READ_INT(save.opdr);<span class="comment">//reconstructed OPD on XLOC</span>
<a name="l00651"></a>00651     READ_INT(save.opdx);<span class="comment">//ATM propagated to XLOC</span>
<a name="l00652"></a>00652     READ_INT(save.intshi);<span class="comment">//WFS integration</span>
<a name="l00653"></a>00653     READ_INT(save.intslo);<span class="comment">//WFS integration</span>
<a name="l00654"></a>00654     READ_INT(save.wfsopdhi);<span class="comment">//WFS OPD</span>
<a name="l00655"></a>00655     READ_INT(save.wfsopdlo);<span class="comment">//WFS OPD</span>
<a name="l00656"></a>00656     READ_INT(save.evlopd);<span class="comment">//Science OPD</span>
<a name="l00657"></a>00657     READ_INT(save.dm);<span class="comment">//save DM commands</span>
<a name="l00658"></a>00658 
<a name="l00659"></a>00659     READ_INT(save.dmpttr);
<a name="l00660"></a>00660     READ_INT(save.gradhi);
<a name="l00661"></a>00661     READ_INT(save.gradlo);
<a name="l00662"></a>00662     READ_INT(save.gradgeomhi);
<a name="l00663"></a>00663     READ_INT(save.gradgeomlo);
<a name="l00664"></a>00664     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#e8cbc9dfdcddc18df6c55c9a76edfdc2" title="Specify what to save to file for debugging.">save</a>.<a class="code" href="structSAVE__CFG__T.html#34a4c23843708f2e41eae5d31718112a" title="save run time informaton for each time step">run</a>){
<a name="l00665"></a>00665     parms-&gt;<a class="code" href="structPARMS__T.html#e8cbc9dfdcddc18df6c55c9a76edfdc2" title="Specify what to save to file for debugging.">save</a>.<a class="code" href="structSAVE__CFG__T.html#758d4e6367bf5ecb3574be68505cf7d0" title="save computed DM actuator commands for each time step">dm</a>=1;
<a name="l00666"></a>00666     parms-&gt;<a class="code" href="structPARMS__T.html#e8cbc9dfdcddc18df6c55c9a76edfdc2" title="Specify what to save to file for debugging.">save</a>.<a class="code" href="structSAVE__CFG__T.html#e62e9ccee9da7a163ada86892a3a118c" title="save WFS gradients for high order wfs">gradhi</a>=1;
<a name="l00667"></a>00667     parms-&gt;<a class="code" href="structPARMS__T.html#e8cbc9dfdcddc18df6c55c9a76edfdc2" title="Specify what to save to file for debugging.">save</a>.<a class="code" href="structSAVE__CFG__T.html#9c7561530faefcb0f199b7415bb9e322" title="save WFS gradients for low order wfs">gradlo</a>=1;
<a name="l00668"></a>00668     }
<a name="l00669"></a>00669 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="8159d82edd710777ee375cc766476975"></a><!-- doxytag: member="setup_parms.c::readcfg_load" ref="8159d82edd710777ee375cc766476975" args="(PARMS_T *parms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void readcfg_load           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structPARMS__T.html">PARMS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>parms</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Specify which variables to load from saved files (Usually from LAOS simulations). 
<p>
<div class="fragment"><pre class="fragment"><a name="l00674"></a>00674                                         {
<a name="l00675"></a>00675   
<a name="l00676"></a>00676     READ_STR(load.atm);
<a name="l00677"></a>00677     READ_STR(load.locs);
<a name="l00678"></a>00678     READ_STR(load.aloc);
<a name="l00679"></a>00679     READ_STR(load.xloc);
<a name="l00680"></a>00680     READ_STR(load.ploc);
<a name="l00681"></a>00681     READ_STR(load.L2);
<a name="l00682"></a>00682     READ_STR(load.HX);
<a name="l00683"></a>00683     READ_STR(load.HA);
<a name="l00684"></a>00684     READ_STR(load.G0);
<a name="l00685"></a>00685     READ_STR(load.GA);
<a name="l00686"></a>00686     READ_INT(load.mvst);
<a name="l00687"></a>00687     READ_INT(load.GS0);
<a name="l00688"></a>00688     READ_INT(load.tomo);
<a name="l00689"></a>00689     READ_INT(load.fit);
<a name="l00690"></a>00690     READ_INT(load.W);
<a name="l00691"></a>00691     READ_INT(load.i0);
<a name="l00692"></a>00692 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="440919651fb4c4c963da4c6fb7561ecb"></a><!-- doxytag: member="setup_parms.c::setup_parms_postproc_sim" ref="440919651fb4c4c963da4c6fb7561ecb" args="(PARMS_T *parms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void setup_parms_postproc_sim           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structPARMS__T.html">PARMS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>parms</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Process simulation parameters to find incompatibility. 
<p>
<div class="fragment"><pre class="fragment"><a name="l00696"></a>00696                                                     {
<a name="l00697"></a>00697     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#8615676f068e88311d6f774e6cb92354" title="1: we are doing skycoverage preprocessing">skysim</a>){
<a name="l00698"></a>00698     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#6492c3b89e0243fe23d88ebedb044b0e" title="Number of DMs.">ndm</a>&gt;0 &amp;&amp; parms-&gt;<a class="code" href="structPARMS__T.html#97445ce9015e982a22199e400b2271e4" title="tomography parameters">tomo</a>.<a class="code" href="structTOMO__CFG__T.html#0b1183e68cda2c750bc3aa9b23648685" title="split tomography type.">split</a>!=1){
<a name="l00699"></a>00699         warning(<span class="stringliteral">"Can only do skysim in split tomography mode 1. Changed\n"</span>);
<a name="l00700"></a>00700         parms-&gt;<a class="code" href="structPARMS__T.html#97445ce9015e982a22199e400b2271e4" title="tomography parameters">tomo</a>.<a class="code" href="structTOMO__CFG__T.html#0b1183e68cda2c750bc3aa9b23648685" title="split tomography type.">split</a>=1;
<a name="l00701"></a>00701     }
<a name="l00702"></a>00702     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ipowfs=0; ipowfs&lt;parms-&gt;<a class="code" href="structPARMS__T.html#184dc967ffbedc29f2d48cd49889ddd2" title="Number of wfs types.">npowfs</a>; ipowfs++){
<a name="l00703"></a>00703         <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#0324889316992d35cd3e1e3df9d17382" title="whether this is a low order wfs.">lo</a>){
<a name="l00704"></a>00704         parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#d0e06b302154b9b7a4a81bfdfd35a3d8" title="output time history of low order wfs PSF.">psfout</a>=1;
<a name="l00705"></a>00705         <span class="comment">//parms-&gt;powfs[ipowfs].pistatout=1;//also output pistat. need gstat as well</span>
<a name="l00706"></a>00706         }
<a name="l00707"></a>00707     }
<a name="l00708"></a>00708     }
<a name="l00709"></a>00709 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="4d667799364159d4a473d9159682309d"></a><!-- doxytag: member="setup_parms.c::setup_parms_postproc_wfs" ref="4d667799364159d4a473d9159682309d" args="(PARMS_T *parms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void setup_parms_postproc_wfs           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structPARMS__T.html">PARMS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>parms</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
postproc various WFS parameters based on other input information 
<p>
<ol type=1>
<li>pixtheta if automatic</li><li>whether doing GS0.</li><li>whether doing phy.</li><li>which wfs belongs to which powfs.</li><li>necessary adjustments if outputing WFS PSF. </li></ol>
<div class="fragment"><pre class="fragment"><a name="l00719"></a>00719                                                     {
<a name="l00720"></a>00720   
<a name="l00721"></a>00721     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ipowfs=0; ipowfs&lt;parms-&gt;<a class="code" href="structPARMS__T.html#184dc967ffbedc29f2d48cd49889ddd2" title="Number of wfs types.">npowfs</a>; ipowfs++){
<a name="l00722"></a>00722     <span class="comment">/*Figure out order of High order WFS if not specified.*/</span>
<a name="l00723"></a>00723     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#27c7dcb36cf4ff0b070eab1b80491266" title="order of wavefront sensing along one dimension.">order</a>==0){
<a name="l00724"></a>00724         <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#6492c3b89e0243fe23d88ebedb044b0e" title="Number of DMs.">ndm</a>&gt;0){
<a name="l00725"></a>00725         parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#27c7dcb36cf4ff0b070eab1b80491266" title="order of wavefront sensing along one dimension.">order</a>=parms-&gt;<a class="code" href="structPARMS__T.html#c2f69a649e1ac2d2e55e790ac067d46c" title="Array of DM.">dm</a>[0].<a class="code" href="structDM__CFG__T.html#d51c7bdc88ea34b8b9b7577186f689de" title="Order of the DM within telescope clear subaperture.">order</a>;
<a name="l00726"></a>00726         }<span class="keywordflow">else</span>{
<a name="l00727"></a>00727         error(<span class="stringliteral">"Please specify powfs[%d].order"</span>, ipowfs);
<a name="l00728"></a>00728         }
<a name="l00729"></a>00729     }
<a name="l00730"></a>00730     <span class="comment">/* </span>
<a name="l00731"></a>00731 <span class="comment">       Figure out pixtheta if specified to be auto (&lt;0).</span>
<a name="l00732"></a>00732 <span class="comment">      -pixtheta is the ratio to nominal value.</span>
<a name="l00733"></a>00733 <span class="comment">    */</span>
<a name="l00734"></a>00734     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#adf117b796aef86ac0b1759f81ad59fd" title="size of pixel pitch along x or y in radian">pixtheta</a>&lt;0){
<a name="l00735"></a>00735         <span class="keyword">const</span> <span class="keywordtype">double</span> dxsa 
<a name="l00736"></a>00736         = parms-&gt;<a class="code" href="structPARMS__T.html#674d3d0b966b2d7c27767e909dfcb30f" title="aperture parameters">aper</a>.<a class="code" href="structAPER__CFG__T.html#ce3d5df3fe365f555ce1b851f833e961" title="Telescope aperture diameter.">d</a>/(double)parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#27c7dcb36cf4ff0b070eab1b80491266" title="order of wavefront sensing along one dimension.">order</a>;
<a name="l00737"></a>00737         <span class="keywordtype">double</span> wvl=0;
<a name="l00738"></a>00738         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iwvl=0; iwvl&lt;parms-&gt;powfs[ipowfs].nwvl; iwvl++){
<a name="l00739"></a>00739         <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#086be0f3919fffb2809d891e895bab83" title="list of wavelength">wvl</a>[iwvl]&gt;wvl)
<a name="l00740"></a>00740             wvl=parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#086be0f3919fffb2809d891e895bab83" title="list of wavelength">wvl</a>[iwvl];
<a name="l00741"></a>00741         }
<a name="l00742"></a>00742         <span class="keywordtype">double</span> ratio=(-parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#adf117b796aef86ac0b1759f81ad59fd" title="size of pixel pitch along x or y in radian">pixtheta</a>);
<a name="l00743"></a>00743         parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#adf117b796aef86ac0b1759f81ad59fd" title="size of pixel pitch along x or y in radian">pixtheta</a>=ratio*wvl/dxsa;
<a name="l00744"></a>00744         warning2(<span class="stringliteral">"powfs %d pixtheta set to %.1fx %g/%g: %g mas\n"</span>,
<a name="l00745"></a>00745              ipowfs, ratio, wvl,dxsa,parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#adf117b796aef86ac0b1759f81ad59fd" title="size of pixel pitch along x or y in radian">pixtheta</a>*206265000);
<a name="l00746"></a>00746     }
<a name="l00747"></a>00747     <span class="keywordflow">if</span> (parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#97585440f1dc5d79451e775697d52452" title="frames to start using physical optics.">phystep</a>!=0){
<a name="l00748"></a>00748         parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#b490b1da338cd038e98d39547a2e75b8" title="need to compute GS0 (derived parameter)">hasGS0</a>=1;
<a name="l00749"></a>00749     }<span class="keywordflow">else</span>{
<a name="l00750"></a>00750         parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#b490b1da338cd038e98d39547a2e75b8" title="need to compute GS0 (derived parameter)">hasGS0</a>=0;
<a name="l00751"></a>00751     }
<a name="l00752"></a>00752     <span class="comment">/*Do we ever do physical optics.*/</span>
<a name="l00753"></a>00753     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#97585440f1dc5d79451e775697d52452" title="frames to start using physical optics.">phystep</a>&gt;=0
<a name="l00754"></a>00754        &amp;&amp;(parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#97585440f1dc5d79451e775697d52452" title="frames to start using physical optics.">phystep</a>&lt;parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#7939a4003b5c376eb09702a8a1572ce5" title="time step to stop simulation.">end</a>||parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#7939a4003b5c376eb09702a8a1572ce5" title="time step to stop simulation.">end</a>==0)){
<a name="l00755"></a>00755         parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#3ed2651dd13ae9327644808da9ac6cb3" title="whether physical optics is used at all during simulation.">usephy</a>=1;
<a name="l00756"></a>00756     }<span class="keywordflow">else</span>{
<a name="l00757"></a>00757         parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#3ed2651dd13ae9327644808da9ac6cb3" title="whether physical optics is used at all during simulation.">usephy</a>=0;
<a name="l00758"></a>00758     }
<a name="l00759"></a>00759     <span class="keywordflow">if</span>(!parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#3ed2651dd13ae9327644808da9ac6cb3" title="whether physical optics is used at all during simulation.">usephy</a> &amp;&amp; parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#515dc9bdd5e364e97d32a0c58c30531d" title="file contains sky background/rayleigh scatter input for each subaperture in each...">bkgrndfn</a>){
<a name="l00760"></a>00760         warning(<span class="stringliteral">"powfs %d: there is sky background, but is using geometric wfs. background won't be effective.\n"</span>, ipowfs);
<a name="l00761"></a>00761     } 
<a name="l00762"></a>00762     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#fcc8c1a482355c14b07ecf887212afc5" title="misregistration from DM to WFS, described by file containing a cell array A of 2xp...">ncpa</a> &amp;&amp; parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#943debf6f291b09a0c05c59c5e8de8f3" title="shift peak in the time averaged short exposure PSF to center using fft.">mtchstc</a>){
<a name="l00763"></a>00763         warning(<span class="stringliteral">"Disabling shifting i0 to center in the presence of NCPA.\n"</span>);
<a name="l00764"></a>00764         parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#943debf6f291b09a0c05c59c5e8de8f3" title="shift peak in the time averaged short exposure PSF to center using fft.">mtchstc</a>=0;
<a name="l00765"></a>00765     }
<a name="l00766"></a>00766     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#fcc8c1a482355c14b07ecf887212afc5" title="misregistration from DM to WFS, described by file containing a cell array A of 2xp...">ncpa</a> &amp;&amp; !parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#3ed2651dd13ae9327644808da9ac6cb3" title="whether physical optics is used at all during simulation.">usephy</a> 
<a name="l00767"></a>00767        &amp;&amp; parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#beee70263e01f8571a2c5884760e6051" title="Method to correct ncpa.">ncpa_method</a>==2){
<a name="l00768"></a>00768         warning(<span class="stringliteral">"ncpa_method changed from 2 to 1 in geometric wfs mdoe\n"</span>);
<a name="l00769"></a>00769         parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#beee70263e01f8571a2c5884760e6051" title="Method to correct ncpa.">ncpa_method</a>=1;
<a name="l00770"></a>00770     }
<a name="l00771"></a>00771     }
<a name="l00772"></a>00772     <span class="comment">/*link wfs with powfs*/</span>
<a name="l00773"></a>00773     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ipowfs=0; ipowfs&lt;parms-&gt;<a class="code" href="structPARMS__T.html#184dc967ffbedc29f2d48cd49889ddd2" title="Number of wfs types.">npowfs</a>; ipowfs++){
<a name="l00774"></a>00774     parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#be03195a4e1fece4903a6297931ac09c" title="array of wfs belongs to this powfs">wfs</a>=calloc(parms-&gt;<a class="code" href="structPARMS__T.html#b6833beca5a29a5936d41ac934e66d24" title="Number of wfs.">nwfs</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00775"></a>00775     parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#ac1b34e2f1f4455c53212bc350f5064b" title="indwfs[iwfs] gives the index of the wfs in this powfs group">indwfs</a>=calloc(parms-&gt;<a class="code" href="structPARMS__T.html#b6833beca5a29a5936d41ac934e66d24" title="Number of wfs.">nwfs</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00776"></a>00776     <span class="keywordtype">int</span> count=0;
<a name="l00777"></a>00777     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iwfs=0; iwfs&lt;parms-&gt;<a class="code" href="structPARMS__T.html#b6833beca5a29a5936d41ac934e66d24" title="Number of wfs.">nwfs</a>; iwfs++){
<a name="l00778"></a>00778         <span class="keywordtype">int</span> kpowfs=parms-&gt;<a class="code" href="structPARMS__T.html#19246602a8b7d0261d79416e281d6ca4" title="Array of wfs.">wfs</a>[iwfs].<a class="code" href="structWFS__CFG__T.html#c6eeef5eba99a8dea64c1692bb60f5ff" title="powfs type">powfs</a>;
<a name="l00779"></a>00779         <span class="keywordflow">if</span>(kpowfs==ipowfs){
<a name="l00780"></a>00780         parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#be03195a4e1fece4903a6297931ac09c" title="array of wfs belongs to this powfs">wfs</a>[count]=iwfs;
<a name="l00781"></a>00781         parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#ac1b34e2f1f4455c53212bc350f5064b" title="indwfs[iwfs] gives the index of the wfs in this powfs group">indwfs</a>[iwfs]=count;
<a name="l00782"></a>00782         count++;
<a name="l00783"></a>00783         }<span class="keywordflow">else</span>{
<a name="l00784"></a>00784         parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#ac1b34e2f1f4455c53212bc350f5064b" title="indwfs[iwfs] gives the index of the wfs in this powfs group">indwfs</a>[iwfs]=-1;<span class="comment">//not belong</span>
<a name="l00785"></a>00785         }
<a name="l00786"></a>00786     }
<a name="l00787"></a>00787     parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#a27c8ce02a72294c46d8db61c68c4e61" title="number of wfs belonging to this powfs">nwfs</a>=count;
<a name="l00788"></a>00788     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#13e13c12137584448baeae372526550e" title="configuration for LLT">llt</a>){
<a name="l00789"></a>00789         parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#13e13c12137584448baeae372526550e" title="configuration for LLT">llt</a>-&gt;<a class="code" href="structLLT__CFG__T.html#8b48a0d2966a34279ed54edf5f5ed7a0" title="Index into llt for this iwfs.">i</a>
<a name="l00790"></a>00790         =calloc(count, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));<span class="comment">//default to zero.</span>
<a name="l00791"></a>00791         <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#13e13c12137584448baeae372526550e" title="configuration for LLT">llt</a>-&gt;<a class="code" href="structLLT__CFG__T.html#4b3cd998f117485fdcb8de6805fef38b" title="number of launch telescopes in this powfs">n</a>&gt;1){
<a name="l00792"></a>00792         <span class="comment">//this is single llt for this powfs.</span>
<a name="l00793"></a>00793         <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#13e13c12137584448baeae372526550e" title="configuration for LLT">llt</a>-&gt;<a class="code" href="structLLT__CFG__T.html#4b3cd998f117485fdcb8de6805fef38b" title="number of launch telescopes in this powfs">n</a>!=count)
<a name="l00794"></a>00794             error(<span class="stringliteral">"# of llts should either be 1 or match nwfs for this powfs"</span>);
<a name="l00795"></a>00795         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iwfs=0; iwfs&lt;parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#13e13c12137584448baeae372526550e" title="configuration for LLT">llt</a>-&gt;<a class="code" href="structLLT__CFG__T.html#4b3cd998f117485fdcb8de6805fef38b" title="number of launch telescopes in this powfs">n</a>; iwfs++){
<a name="l00796"></a>00796             parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#13e13c12137584448baeae372526550e" title="configuration for LLT">llt</a>-&gt;<a class="code" href="structLLT__CFG__T.html#8b48a0d2966a34279ed54edf5f5ed7a0" title="Index into llt for this iwfs.">i</a>[iwfs]=iwfs;
<a name="l00797"></a>00797         }
<a name="l00798"></a>00798         }
<a name="l00799"></a>00799     }
<a name="l00800"></a>00800     }
<a name="l00801"></a>00801     <span class="keywordtype">int</span> disable_split_tomo=0;
<a name="l00802"></a>00802     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#97445ce9015e982a22199e400b2271e4" title="tomography parameters">tomo</a>.<a class="code" href="structTOMO__CFG__T.html#0b1183e68cda2c750bc3aa9b23648685" title="split tomography type.">split</a>){
<a name="l00803"></a>00803     <span class="keywordtype">int</span> hi_found=0;
<a name="l00804"></a>00804     <span class="keywordtype">int</span> lo_found=0;
<a name="l00805"></a>00805     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#97445ce9015e982a22199e400b2271e4" title="tomography parameters">tomo</a>.<a class="code" href="structTOMO__CFG__T.html#0b1183e68cda2c750bc3aa9b23648685" title="split tomography type.">split</a> == 1 &amp;&amp; !parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#0408bb89e89669682cba86f7fb98b2dc" title="closed loop or open loop">closeloop</a>){
<a name="l00806"></a>00806         warning(<span class="stringliteral">"split tomography does not work in open loop\n"</span>);
<a name="l00807"></a>00807     }
<a name="l00808"></a>00808     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ipowfs=0; ipowfs&lt;parms-&gt;<a class="code" href="structPARMS__T.html#184dc967ffbedc29f2d48cd49889ddd2" title="Number of wfs types.">npowfs</a>; ipowfs++){
<a name="l00809"></a>00809         <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#0324889316992d35cd3e1e3df9d17382" title="whether this is a low order wfs.">lo</a>){
<a name="l00810"></a>00810         lo_found=1;
<a name="l00811"></a>00811         }<span class="keywordflow">else</span>{
<a name="l00812"></a>00812         hi_found=1;
<a name="l00813"></a>00813         }
<a name="l00814"></a>00814     }
<a name="l00815"></a>00815     <span class="keywordflow">if</span>(!lo_found || !hi_found){
<a name="l00816"></a>00816         warning(<span class="stringliteral">"There are either no high order or no low order wfs. Disable split tomo.\n"</span>);
<a name="l00817"></a>00817         parms-&gt;<a class="code" href="structPARMS__T.html#97445ce9015e982a22199e400b2271e4" title="tomography parameters">tomo</a>.<a class="code" href="structTOMO__CFG__T.html#0b1183e68cda2c750bc3aa9b23648685" title="split tomography type.">split</a>=0;
<a name="l00818"></a>00818         disable_split_tomo=1;
<a name="l00819"></a>00819     }
<a name="l00820"></a>00820     <span class="keywordflow">if</span>(!hi_found){
<a name="l00821"></a>00821         warning(<span class="stringliteral">"There is no high order WFS!!!\n"</span>);
<a name="l00822"></a>00822     }
<a name="l00823"></a>00823     }
<a name="l00824"></a>00824     <span class="comment">/*Setting up parameters for psfout.*/</span>
<a name="l00825"></a>00825     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ipowfs=0; ipowfs&lt;parms-&gt;<a class="code" href="structPARMS__T.html#184dc967ffbedc29f2d48cd49889ddd2" title="Number of wfs types.">npowfs</a>; ipowfs++){
<a name="l00826"></a>00826     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#d0e06b302154b9b7a4a81bfdfd35a3d8" title="output time history of low order wfs PSF.">psfout</a>==1){
<a name="l00827"></a>00827         <span class="keywordflow">if</span>(!parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#0324889316992d35cd3e1e3df9d17382" title="whether this is a low order wfs.">lo</a> || parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#979789ab45a1f87cf251469dbedebe00" title="tip/tilt removal flag.">trs</a>==1) 
<a name="l00828"></a>00828         warning(<span class="stringliteral">"Usually only output psf for lo wfs\n"</span>);
<a name="l00829"></a>00829         <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#97445ce9015e982a22199e400b2271e4" title="tomography parameters">tomo</a>.<a class="code" href="structTOMO__CFG__T.html#0b1183e68cda2c750bc3aa9b23648685" title="split tomography type.">split</a>!=1){
<a name="l00830"></a>00830         warning(<span class="stringliteral">"Can only output psf in split tomography mode 1. Changed\n"</span>);
<a name="l00831"></a>00831         <span class="keywordflow">if</span>(disable_split_tomo){
<a name="l00832"></a>00832             error(<span class="stringliteral">"But split tomography is not possible\n"</span>);
<a name="l00833"></a>00833         }
<a name="l00834"></a>00834         parms-&gt;<a class="code" href="structPARMS__T.html#97445ce9015e982a22199e400b2271e4" title="tomography parameters">tomo</a>.<a class="code" href="structTOMO__CFG__T.html#0b1183e68cda2c750bc3aa9b23648685" title="split tomography type.">split</a>=1;
<a name="l00835"></a>00835         }
<a name="l00836"></a>00836         <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#97445ce9015e982a22199e400b2271e4" title="tomography parameters">tomo</a>.<a class="code" href="structTOMO__CFG__T.html#a9d49170afccefe4bdbf0507759dab89" title="0: use Wg, 1: using Wa">split_wt</a>==1){
<a name="l00837"></a>00837         warning(<span class="stringliteral">"split_wt changed from 1 to 3 when outputing PSF for NGS.\n"</span>);
<a name="l00838"></a>00838         parms-&gt;<a class="code" href="structPARMS__T.html#97445ce9015e982a22199e400b2271e4" title="tomography parameters">tomo</a>.<a class="code" href="structTOMO__CFG__T.html#a9d49170afccefe4bdbf0507759dab89" title="0: use Wg, 1: using Wa">split_wt</a>=3;
<a name="l00839"></a>00839         }
<a name="l00840"></a>00840         <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#97445ce9015e982a22199e400b2271e4" title="tomography parameters">tomo</a>.<a class="code" href="structTOMO__CFG__T.html#a518c9befdd8bd0bb179ef516ff20f19" title="ideal correction on NGS modes.">split_idealngs</a>!=1){
<a name="l00841"></a>00841         warning(<span class="stringliteral">"Can only output psf with ideal correction on NGS modes. Changed\n"</span>);
<a name="l00842"></a>00842         parms-&gt;<a class="code" href="structPARMS__T.html#97445ce9015e982a22199e400b2271e4" title="tomography parameters">tomo</a>.<a class="code" href="structTOMO__CFG__T.html#a518c9befdd8bd0bb179ef516ff20f19" title="ideal correction on NGS modes.">split_idealngs</a>=1;
<a name="l00843"></a>00843         }
<a name="l00844"></a>00844     }
<a name="l00845"></a>00845     }
<a name="l00846"></a>00846     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#97445ce9015e982a22199e400b2271e4" title="tomography parameters">tomo</a>.<a class="code" href="structTOMO__CFG__T.html#0b1183e68cda2c750bc3aa9b23648685" title="split tomography type.">split</a> &amp;&amp; parms-&gt;<a class="code" href="structPARMS__T.html#6492c3b89e0243fe23d88ebedb044b0e" title="Number of DMs.">ndm</a>==0){
<a name="l00847"></a>00847     warning(<span class="stringliteral">"Disable split tomography since there is no common DM\n"</span>);
<a name="l00848"></a>00848     parms-&gt;<a class="code" href="structPARMS__T.html#97445ce9015e982a22199e400b2271e4" title="tomography parameters">tomo</a>.<a class="code" href="structTOMO__CFG__T.html#0b1183e68cda2c750bc3aa9b23648685" title="split tomography type.">split</a>=0;
<a name="l00849"></a>00849     }
<a name="l00850"></a>00850 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="9d7c10a75b4fc50ab68e473968cbde4a"></a><!-- doxytag: member="setup_parms.c::setup_parms_postproc_atm" ref="9d7c10a75b4fc50ab68e473968cbde4a" args="(PARMS_T *parms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void setup_parms_postproc_atm           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structPARMS__T.html">PARMS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>parms</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
postproc atmosphere parameters. 
<p>
1) drop weak layers. 2) find ground layer <div class="fragment"><pre class="fragment"><a name="l00856"></a>00856                                                     {
<a name="l00857"></a>00857   
<a name="l00858"></a>00858     <span class="comment">/*</span>
<a name="l00859"></a>00859 <span class="comment">      Drop weak turbulence layers in simulation.</span>
<a name="l00860"></a>00860 <span class="comment">     */</span>
<a name="l00861"></a>00861     <span class="keywordtype">int</span> jps=0;
<a name="l00862"></a>00862     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ips=0; ips&lt;parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#f377ac265c4e8778949386b5c78c9ba6" title="number of phase screens">nps</a>; ips++){
<a name="l00863"></a>00863     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#d539b2f97fd31f5e5dc999b852b71228" title="weight of each layer (relative strength of )">wt</a>[ips]&gt;1.e-3){
<a name="l00864"></a>00864         <span class="keywordflow">if</span>(ips!=jps){
<a name="l00865"></a>00865         parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#59642a891abc1d24aaeee4521a82c91b" title="height of each layer">ht</a>[jps]=parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#59642a891abc1d24aaeee4521a82c91b" title="height of each layer">ht</a>[ips];
<a name="l00866"></a>00866         parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#d539b2f97fd31f5e5dc999b852b71228" title="weight of each layer (relative strength of )">wt</a>[jps]=parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#d539b2f97fd31f5e5dc999b852b71228" title="weight of each layer (relative strength of )">wt</a>[ips];
<a name="l00867"></a>00867         parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#a9a86b3cc0c73d0d27cbad43f9706108" title="wind speed of each layer">ws</a>[jps]=parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#a9a86b3cc0c73d0d27cbad43f9706108" title="wind speed of each layer">ws</a>[ips];
<a name="l00868"></a>00868         parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#c14a4c67cce4eab1f36b6cf7cd497754" title="wind direction of each layer">wddeg</a>[jps]=parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#c14a4c67cce4eab1f36b6cf7cd497754" title="wind direction of each layer">wddeg</a>[ips];
<a name="l00869"></a>00869         }
<a name="l00870"></a>00870         jps++;
<a name="l00871"></a>00871     }<span class="keywordflow">else</span>{
<a name="l00872"></a>00872         warning(<span class="stringliteral">"Layer %d has very small weight of %g, will drop it.\n"</span>, 
<a name="l00873"></a>00873             ips, parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#d539b2f97fd31f5e5dc999b852b71228" title="weight of each layer (relative strength of )">wt</a>[ips]);
<a name="l00874"></a>00874     }
<a name="l00875"></a>00875     }
<a name="l00876"></a>00876     <span class="keywordflow">if</span>(jps==0){
<a name="l00877"></a>00877     error(<span class="stringliteral">"There are no valid atmosphere layer\n"</span>);
<a name="l00878"></a>00878     }
<a name="l00879"></a>00879     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#f377ac265c4e8778949386b5c78c9ba6" title="number of phase screens">nps</a>!=jps){
<a name="l00880"></a>00880     warning(<span class="stringliteral">"nlayer changed from %d to %d\n"</span>, parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#f377ac265c4e8778949386b5c78c9ba6" title="number of phase screens">nps</a>, jps);
<a name="l00881"></a>00881     parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#f377ac265c4e8778949386b5c78c9ba6" title="number of phase screens">nps</a>=jps;
<a name="l00882"></a>00882     parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#59642a891abc1d24aaeee4521a82c91b" title="height of each layer">ht</a>=realloc(parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#59642a891abc1d24aaeee4521a82c91b" title="height of each layer">ht</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)*jps);
<a name="l00883"></a>00883     parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#d539b2f97fd31f5e5dc999b852b71228" title="weight of each layer (relative strength of )">wt</a>=realloc(parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#d539b2f97fd31f5e5dc999b852b71228" title="weight of each layer (relative strength of )">wt</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)*jps);
<a name="l00884"></a>00884     parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#a9a86b3cc0c73d0d27cbad43f9706108" title="wind speed of each layer">ws</a>=realloc(parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#a9a86b3cc0c73d0d27cbad43f9706108" title="wind speed of each layer">ws</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)*jps);
<a name="l00885"></a>00885     parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#c14a4c67cce4eab1f36b6cf7cd497754" title="wind direction of each layer">wddeg</a>=realloc(parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#c14a4c67cce4eab1f36b6cf7cd497754" title="wind direction of each layer">wddeg</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)*jps);
<a name="l00886"></a>00886     }
<a name="l00887"></a>00887     <a class="code" href="mathmisc_8c.html#c80bb740d5184ab44318b505ee66d13b" title="normalize vector to sum to norm;">normalize</a>(parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#d539b2f97fd31f5e5dc999b852b71228" title="weight of each layer (relative strength of )">wt</a>, parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#f377ac265c4e8778949386b5c78c9ba6" title="number of phase screens">nps</a>, 1);
<a name="l00888"></a>00888     <span class="comment">/*</span>
<a name="l00889"></a>00889 <span class="comment">      We don't drop weak turbulence layers in reconstruction. Instead, we make</span>
<a name="l00890"></a>00890 <span class="comment">      it as least parms-&gt;tomo.minwt in setup_recon_tomo_prep</span>
<a name="l00891"></a>00891 <span class="comment">    */</span>
<a name="l00892"></a>00892  
<a name="l00893"></a>00893     <span class="comment">/*</span>
<a name="l00894"></a>00894 <span class="comment">      Find ground turbulence layer. The ray tracing can be shared.</span>
<a name="l00895"></a>00895 <span class="comment">     */</span>
<a name="l00896"></a>00896     parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#d776c7ea8c0f802bd0e025afc6202083" title="index into the ground layer">iground</a>=-1;
<a name="l00897"></a>00897     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ips=0; ips&lt;parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#f377ac265c4e8778949386b5c78c9ba6" title="number of phase screens">nps</a>; ips++){
<a name="l00898"></a>00898     <span class="keywordflow">if</span>(fabs(parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#59642a891abc1d24aaeee4521a82c91b" title="height of each layer">ht</a>[ips])&lt;1.e-10){
<a name="l00899"></a>00899         <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#d776c7ea8c0f802bd0e025afc6202083" title="index into the ground layer">iground</a>==-1)
<a name="l00900"></a>00900         parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#d776c7ea8c0f802bd0e025afc6202083" title="index into the ground layer">iground</a>=ips;
<a name="l00901"></a>00901         <span class="keywordflow">else</span>
<a name="l00902"></a>00902         error(<span class="stringliteral">"Multiple grounds atm. Please combine them together.\n"</span>);
<a name="l00903"></a>00903     }
<a name="l00904"></a>00904     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#59642a891abc1d24aaeee4521a82c91b" title="height of each layer">ht</a>[ips]&lt;0){
<a name="l00905"></a>00905         warning(<span class="stringliteral">"Layer %d height %g is below ground\n"</span>,ips,parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#59642a891abc1d24aaeee4521a82c91b" title="height of each layer">ht</a>[ips]);
<a name="l00906"></a>00906     }
<a name="l00907"></a>00907     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#59642a891abc1d24aaeee4521a82c91b" title="height of each layer">ht</a>[ips]&gt;0 &amp;&amp; parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#59642a891abc1d24aaeee4521a82c91b" title="height of each layer">ht</a>[ips]&lt;100){
<a name="l00908"></a>00908         error(<span class="stringliteral">"Layer %d height %g is too close to the ground\n"</span>,ips,parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#59642a891abc1d24aaeee4521a82c91b" title="height of each layer">ht</a>[ips]);
<a name="l00909"></a>00909     }
<a name="l00910"></a>00910     }
<a name="l00911"></a>00911     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#d776c7ea8c0f802bd0e025afc6202083" title="index into the ground layer">iground</a>==-1){
<a name="l00912"></a>00912     warning(<span class="stringliteral">"There is no ground layer\n"</span>);
<a name="l00913"></a>00913     }
<a name="l00914"></a>00914 
<a name="l00915"></a>00915 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="56adfa3b5440332125f22d5e3216d6c0"></a><!-- doxytag: member="setup_parms.c::setup_parms_postproc_za" ref="56adfa3b5440332125f22d5e3216d6c0" args="(PARMS_T *parms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void setup_parms_postproc_za           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structPARMS__T.html">PARMS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>parms</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Scaling necessary values for non-zero zenith angle (za). 
<p>
<ol type=1>
<li>r0</li><li>turbulence height</li><li>WFS height</li><li>WFS siglev</li><li>reconstruction height.</li></ol>
<p>
DM conjugation range is not changed! <div class="fragment"><pre class="fragment"><a name="l00926"></a>00926                                                    {
<a name="l00927"></a>00927  
<a name="l00928"></a>00928     <span class="comment">/*</span>
<a name="l00929"></a>00929 <span class="comment">      The input r0z is the r0 at zenith. Scale it if off zenith</span>
<a name="l00930"></a>00930 <span class="comment">    */</span>
<a name="l00931"></a>00931  
<a name="l00932"></a>00932     parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#ea9e24d04a414ec33916763092f6a486" title="derived from r0z for zenith angle za">r0</a>=parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#311b33269454ff4d1dbbb5e1d84abf41" title="r0 at zenith">r0z</a>*pow(cos(parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#8bec09f88dc7ab71730f50f54bca225e" title="zenith angle in radian">za</a>),3./5.);
<a name="l00933"></a>00933     parms-&gt;<a class="code" href="structPARMS__T.html#654d89a9becf3ea9e32d11e470416f7c" title="information about reconstructed atm">atmr</a>.<a class="code" href="structATMR__CFG__T.html#26e119edbff7cfa6dfbd397181fde2ac" title="derived from r0z for zenith angle za">r0</a>=parms-&gt;<a class="code" href="structPARMS__T.html#654d89a9becf3ea9e32d11e470416f7c" title="information about reconstructed atm">atmr</a>.<a class="code" href="structATMR__CFG__T.html#e618e9ed799835a769be75de3a26bcc0" title="r0 at zenith">r0z</a>*pow(cos(parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#8bec09f88dc7ab71730f50f54bca225e" title="zenith angle in radian">za</a>),3./5.);
<a name="l00934"></a>00934 
<a name="l00935"></a>00935     <span class="keywordflow">if</span>(fabs(parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#8bec09f88dc7ab71730f50f54bca225e" title="zenith angle in radian">za</a>)&gt;1.e-14){
<a name="l00936"></a>00936     warning(<span class="stringliteral">"Scaling turbulence height and LGS hs to zenith angle %gdeg\n"</span>,
<a name="l00937"></a>00937         parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#8bec09f88dc7ab71730f50f54bca225e" title="zenith angle in radian">za</a>*180./M_PI);
<a name="l00938"></a>00938     <span class="keywordtype">double</span> cosz=cos(parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#8bec09f88dc7ab71730f50f54bca225e" title="zenith angle in radian">za</a>);
<a name="l00939"></a>00939     <span class="keywordtype">double</span> secz=1./cosz;
<a name="l00940"></a>00940     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ips=0; ips&lt;parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#f377ac265c4e8778949386b5c78c9ba6" title="number of phase screens">nps</a>; ips++){
<a name="l00941"></a>00941         parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#59642a891abc1d24aaeee4521a82c91b" title="height of each layer">ht</a>[ips] *= secz;
<a name="l00942"></a>00942     }
<a name="l00943"></a>00943     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ipowfs=0; ipowfs&lt;parms-&gt;<a class="code" href="structPARMS__T.html#184dc967ffbedc29f2d48cd49889ddd2" title="Number of wfs types.">npowfs</a>; ipowfs++){
<a name="l00944"></a>00944         <span class="keywordflow">if</span>(!isinf(parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#3b65158c197ddc07b117b5f8b1aa567b" title="height of guide star">hs</a>)){
<a name="l00945"></a>00945         parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#3b65158c197ddc07b117b5f8b1aa567b" title="height of guide star">hs</a> *= secz;
<a name="l00946"></a>00946         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> indwfs=0; indwfs&lt;parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#a27c8ce02a72294c46d8db61c68c4e61" title="number of wfs belonging to this powfs">nwfs</a>; indwfs++){
<a name="l00947"></a>00947             <span class="keywordtype">int</span> iwfs=parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#be03195a4e1fece4903a6297931ac09c" title="array of wfs belongs to this powfs">wfs</a>[indwfs];
<a name="l00948"></a>00948             <span class="keywordtype">double</span> siglev=parms-&gt;<a class="code" href="structPARMS__T.html#19246602a8b7d0261d79416e281d6ca4" title="Array of wfs.">wfs</a>[iwfs].<a class="code" href="structWFS__CFG__T.html#ac67dd456e4d3d31400fc9830daf9735" title="Total signal value for all wavelength.">siglev</a>;
<a name="l00949"></a>00949             parms-&gt;<a class="code" href="structPARMS__T.html#19246602a8b7d0261d79416e281d6ca4" title="Array of wfs.">wfs</a>[iwfs].<a class="code" href="structWFS__CFG__T.html#ac67dd456e4d3d31400fc9830daf9735" title="Total signal value for all wavelength.">siglev</a>=siglev*cosz;
<a name="l00950"></a>00950             info(<span class="stringliteral">"iwfs%d: siglev scaled from %g to %g\n"</span>, 
<a name="l00951"></a>00951              iwfs,siglev,parms-&gt;<a class="code" href="structPARMS__T.html#19246602a8b7d0261d79416e281d6ca4" title="Array of wfs.">wfs</a>[iwfs].<a class="code" href="structWFS__CFG__T.html#ac67dd456e4d3d31400fc9830daf9735" title="Total signal value for all wavelength.">siglev</a>);
<a name="l00952"></a>00952             warning(<span class="stringliteral">"Need to update to account for the transmittance\n"</span>);
<a name="l00953"></a>00953         }
<a name="l00954"></a>00954         }
<a name="l00955"></a>00955     }
<a name="l00956"></a>00956     warning(<span class="stringliteral">"Scaling reconstruction height to zenith angle %gdeg\n"</span>,parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#8bec09f88dc7ab71730f50f54bca225e" title="zenith angle in radian">za</a>*180./M_PI);
<a name="l00957"></a>00957     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ips=0; ips&lt;parms-&gt;<a class="code" href="structPARMS__T.html#654d89a9becf3ea9e32d11e470416f7c" title="information about reconstructed atm">atmr</a>.<a class="code" href="structATMR__CFG__T.html#14584f027f0a847b43f47fbbf53e6324" title="number of phase screens">nps</a>; ips++){
<a name="l00958"></a>00958         parms-&gt;<a class="code" href="structPARMS__T.html#654d89a9becf3ea9e32d11e470416f7c" title="information about reconstructed atm">atmr</a>.<a class="code" href="structATMR__CFG__T.html#c2d70c6f4dd690896de2145333728abc" title="height of each layer">ht</a>[ips] *= secz;
<a name="l00959"></a>00959     }
<a name="l00960"></a>00960     parms-&gt;<a class="code" href="structPARMS__T.html#bc0c4384664b89b6777b64d77f18a0bc" title="Parameters for Cn2 estimation.">cn2</a>.hmax*=secz;
<a name="l00961"></a>00961     }
<a name="l00962"></a>00962 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="72305d3fc8ccc4871e74ac9f0701303d"></a><!-- doxytag: member="setup_parms.c::setup_parms_postproc_atm_size" ref="72305d3fc8ccc4871e74ac9f0701303d" args="(PARMS_T *parms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void setup_parms_postproc_atm_size           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structPARMS__T.html">PARMS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>parms</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
compute minimum size of atm screen to cover all the beam path. 
<p>
same for all layers. todo:may need to consider l0 Must be after setup_parms_postproc_za. <div class="fragment"><pre class="fragment"><a name="l00968"></a>00968                                                          {
<a name="l00969"></a>00969     <span class="keywordflow">if</span>(fabs(parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#f2ab92f574c7c57c62315008a38d7200" title="size of atm in meter, [0 0]: automatic">size</a>[0])&lt;EPS ||fabs(parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#f2ab92f574c7c57c62315008a38d7200" title="size of atm in meter, [0 0]: automatic">size</a>[1])&lt;EPS){
<a name="l00970"></a>00970     <span class="keywordtype">int</span> Nmax=0;
<a name="l00971"></a>00971     <span class="keywordtype">long</span> nxout,nyout;
<a name="l00972"></a>00972     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ips=0; ips&lt;parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#f377ac265c4e8778949386b5c78c9ba6" title="number of phase screens">nps</a>; ips++){
<a name="l00973"></a>00973         <a class="code" href="maos_2utils_8c.html#480912f463af16b1beec7b915c32acde" title="create a metapupil map, with size nx*ny, origin at (ox,oy), sampling of dx, height...">create_metapupil</a>(parms,parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#59642a891abc1d24aaeee4521a82c91b" title="height of each layer">ht</a>[ips],parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#b47d65c892430196c01fa5c05c802608" title="sampling of turbulence screens">dx</a>,0.5,
<a name="l00974"></a>00974                  &amp;nxout,&amp;nyout,NULL,NULL,NULL,parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#b47d65c892430196c01fa5c05c802608" title="sampling of turbulence screens">dx</a>*3,0,T_ATM,0,1);
<a name="l00975"></a>00975         <span class="keywordflow">if</span>(nxout&gt;Nmax) Nmax=nxout;
<a name="l00976"></a>00976         <span class="keywordflow">if</span>(nyout&gt;Nmax) Nmax=nyout;
<a name="l00977"></a>00977     }
<a name="l00978"></a>00978     parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#17d5dd2613f05038cccb672e12671459" title="turbulence screen size alog x">nx</a>=1&lt;&lt;iceil(log2((<span class="keywordtype">double</span>)Nmax));
<a name="l00979"></a>00979     parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#bcdc09a016c8d4bfe1a0b6c6f8a261a4" title="turbulence screen size along y">ny</a>=parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#17d5dd2613f05038cccb672e12671459" title="turbulence screen size alog x">nx</a>;
<a name="l00980"></a>00980     }<span class="keywordflow">else</span>{
<a name="l00981"></a>00981     parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#17d5dd2613f05038cccb672e12671459" title="turbulence screen size alog x">nx</a>=2*(int)round(0.5*parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#f2ab92f574c7c57c62315008a38d7200" title="size of atm in meter, [0 0]: automatic">size</a>[0]/parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#b47d65c892430196c01fa5c05c802608" title="sampling of turbulence screens">dx</a>);
<a name="l00982"></a>00982     parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#bcdc09a016c8d4bfe1a0b6c6f8a261a4" title="turbulence screen size along y">ny</a>=2*(int)round(0.5*parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#f2ab92f574c7c57c62315008a38d7200" title="size of atm in meter, [0 0]: automatic">size</a>[1]/parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#b47d65c892430196c01fa5c05c802608" title="sampling of turbulence screens">dx</a>);
<a name="l00983"></a>00983     }
<a name="l00984"></a>00984 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="aa02b87b76c12eaec2e3f3884f558a83"></a><!-- doxytag: member="setup_parms.c::setup_parms_postproc_dm" ref="aa02b87b76c12eaec2e3f3884f558a83" args="(PARMS_T *parms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void setup_parms_postproc_dm           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structPARMS__T.html">PARMS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>parms</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Setting up DM parameters in order to do DM caching during simulation. 
<p>
High resolution metapupils are created for each DM at each magnitude level to match the science field or WFS.<p>
For a MCAO system like NFIRAOS, the WFS and science all have 1/64 sampling. The ground DM has only 1 metapupil matched to the science field and WFS. The upper DM has two metapupils, one for science and NGS and another one to match LGS WFS in a reduce sampling depending on the DM altitude and guide star range.. <div class="fragment"><pre class="fragment"><a name="l01000"></a>01000                                                    {
<a name="l01001"></a>01001     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> idm=0; idm&lt;parms-&gt;<a class="code" href="structPARMS__T.html#6492c3b89e0243fe23d88ebedb044b0e" title="Number of DMs.">ndm</a>; idm++){
<a name="l01002"></a>01002     parms-&gt;<a class="code" href="structPARMS__T.html#c2f69a649e1ac2d2e55e790ac067d46c" title="Array of DM.">dm</a>[idm].<a class="code" href="structDM__CFG__T.html#094b4f74b4260b1fac411e66d352146a" title="actuator separation">dx</a>=parms-&gt;<a class="code" href="structPARMS__T.html#674d3d0b966b2d7c27767e909dfcb30f" title="aperture parameters">aper</a>.<a class="code" href="structAPER__CFG__T.html#ce3d5df3fe365f555ce1b851f833e961" title="Telescope aperture diameter.">d</a>/parms-&gt;<a class="code" href="structPARMS__T.html#c2f69a649e1ac2d2e55e790ac067d46c" title="Array of DM.">dm</a>[idm].<a class="code" href="structDM__CFG__T.html#d51c7bdc88ea34b8b9b7577186f689de" title="Order of the DM within telescope clear subaperture.">order</a>;
<a name="l01003"></a>01003     }
<a name="l01004"></a>01004     <span class="comment">/*</span>
<a name="l01005"></a>01005 <span class="comment">      Setup the parameters used to do DM caching on a finer grid.</span>
<a name="l01006"></a>01006 <span class="comment">     */</span>
<a name="l01007"></a>01007     parms-&gt;<a class="code" href="structPARMS__T.html#4121e9dc728705be0ad2c58dcaf4cd75" title="Performance evaluation parameters.">evl</a>.<a class="code" href="structEVL__CFG__T.html#73bc37fc71476060bed54a1e64a10ff5" title="scale group for dm cache.">scalegroup</a>=calloc(parms-&gt;<a class="code" href="structPARMS__T.html#6492c3b89e0243fe23d88ebedb044b0e" title="Number of DMs.">ndm</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l01008"></a>01008     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> idm=0; idm&lt;parms-&gt;<a class="code" href="structPARMS__T.html#6492c3b89e0243fe23d88ebedb044b0e" title="Number of DMs.">ndm</a>; idm++){
<a name="l01009"></a>01009     <span class="keywordtype">double</span> ht=parms-&gt;<a class="code" href="structPARMS__T.html#c2f69a649e1ac2d2e55e790ac067d46c" title="Array of DM.">dm</a>[idm].<a class="code" href="structDM__CFG__T.html#bf49acebd195a6705ddf3ed1c3f662ea" title="height conjugation range">ht</a>;
<a name="l01010"></a>01010     <span class="keywordflow">if</span>(fabs(ht)&lt;1.e-10){
<a name="l01011"></a>01011         parms-&gt;<a class="code" href="structPARMS__T.html#c2f69a649e1ac2d2e55e790ac067d46c" title="Array of DM.">dm</a>[idm].<a class="code" href="structDM__CFG__T.html#b3eca0a0f00d7e45fb842d4a8dace867" title="Is this DM the ground DM (derived).">isground</a>=1;
<a name="l01012"></a>01012     }
<a name="l01013"></a>01013     <span class="keywordtype">int</span> nscale=0;
<a name="l01014"></a>01014     <span class="keywordtype">int</span> nscalemax=parms-&gt;<a class="code" href="structPARMS__T.html#184dc967ffbedc29f2d48cd49889ddd2" title="Number of wfs types.">npowfs</a>+1;<span class="comment">//maximum number of possible scalings</span>
<a name="l01015"></a>01015     <span class="keywordtype">double</span> scale[nscalemax];
<a name="l01016"></a>01016     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ipowfs=0; ipowfs&lt;parms-&gt;<a class="code" href="structPARMS__T.html#184dc967ffbedc29f2d48cd49889ddd2" title="Number of wfs types.">npowfs</a>; ipowfs++){
<a name="l01017"></a>01017         <span class="keywordtype">double</span> iscl=1.-ht/parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#3b65158c197ddc07b117b5f8b1aa567b" title="height of guide star">hs</a>;
<a name="l01018"></a>01018         <span class="keywordflow">if</span>(idm==0){
<a name="l01019"></a>01019         parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#cb0326b5a4892b72a2af2219e0daf063" title="scale group for dm propergation cache.">scalegroup</a> =calloc(parms-&gt;<a class="code" href="structPARMS__T.html#6492c3b89e0243fe23d88ebedb044b0e" title="Number of DMs.">ndm</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l01020"></a>01020         }
<a name="l01021"></a>01021         <span class="keywordtype">int</span> fnd=0;
<a name="l01022"></a>01022         <span class="comment">//search for existing scale</span>
<a name="l01023"></a>01023         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iscale=0; iscale&lt;nscale; iscale++){
<a name="l01024"></a>01024         <span class="keywordflow">if</span>(fabs(scale[iscale]-iscl)&lt;1.e-10){
<a name="l01025"></a>01025             fnd=1;
<a name="l01026"></a>01026             parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#cb0326b5a4892b72a2af2219e0daf063" title="scale group for dm propergation cache.">scalegroup</a>[idm]=iscale;
<a name="l01027"></a>01027         }
<a name="l01028"></a>01028         }
<a name="l01029"></a>01029         <span class="comment">//not found, add one.</span>
<a name="l01030"></a>01030         <span class="keywordflow">if</span>(fnd==0){
<a name="l01031"></a>01031         scale[nscale]=iscl;
<a name="l01032"></a>01032         parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#cb0326b5a4892b72a2af2219e0daf063" title="scale group for dm propergation cache.">scalegroup</a>[idm]=nscale;
<a name="l01033"></a>01033         nscale++;
<a name="l01034"></a>01034         }
<a name="l01035"></a>01035     }
<a name="l01036"></a>01036     <span class="comment">//evl;</span>
<a name="l01037"></a>01037     <span class="keywordtype">double</span> iscl=1. - ht/parms-&gt;<a class="code" href="structPARMS__T.html#4121e9dc728705be0ad2c58dcaf4cd75" title="Performance evaluation parameters.">evl</a>.<a class="code" href="structEVL__CFG__T.html#fced233c290f612daff73a97daa7b4ae">ht</a>;
<a name="l01038"></a>01038     <span class="keywordtype">int</span> fnd=0;
<a name="l01039"></a>01039     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iscale=0; iscale&lt;nscale; iscale++){
<a name="l01040"></a>01040         <span class="keywordflow">if</span>(fabs(scale[iscale]-1.)&lt;1.e-10){
<a name="l01041"></a>01041         fnd=1;
<a name="l01042"></a>01042         parms-&gt;<a class="code" href="structPARMS__T.html#4121e9dc728705be0ad2c58dcaf4cd75" title="Performance evaluation parameters.">evl</a>.<a class="code" href="structEVL__CFG__T.html#73bc37fc71476060bed54a1e64a10ff5" title="scale group for dm cache.">scalegroup</a>[idm]=iscale;
<a name="l01043"></a>01043         }
<a name="l01044"></a>01044         
<a name="l01045"></a>01045     }
<a name="l01046"></a>01046     <span class="keywordflow">if</span>(fnd==0){
<a name="l01047"></a>01047         scale[nscale]=iscl;
<a name="l01048"></a>01048         parms-&gt;<a class="code" href="structPARMS__T.html#4121e9dc728705be0ad2c58dcaf4cd75" title="Performance evaluation parameters.">evl</a>.<a class="code" href="structEVL__CFG__T.html#73bc37fc71476060bed54a1e64a10ff5" title="scale group for dm cache.">scalegroup</a>[idm]=nscale;
<a name="l01049"></a>01049         nscale++;   
<a name="l01050"></a>01050     }
<a name="l01051"></a>01051     <span class="comment">//info2("idm=%d, nscale=%d\n", idm, nscale);</span>
<a name="l01052"></a>01052     parms-&gt;<a class="code" href="structPARMS__T.html#c2f69a649e1ac2d2e55e790ac067d46c" title="Array of DM.">dm</a>[idm].<a class="code" href="structDM__CFG__T.html#87daddffcd964b97cfae786a7c9efaff" title="number of scale group for DM propagation cache.">nscale</a>=nscale;
<a name="l01053"></a>01053     parms-&gt;<a class="code" href="structPARMS__T.html#c2f69a649e1ac2d2e55e790ac067d46c" title="Array of DM.">dm</a>[idm].<a class="code" href="structDM__CFG__T.html#f8903a5291d9132441eab9a862c70e68" title="the scale for each scale group.">scales</a>=calloc(1, nscale*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l01054"></a>01054     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iscale=0; iscale&lt;nscale; iscale++){
<a name="l01055"></a>01055         parms-&gt;<a class="code" href="structPARMS__T.html#c2f69a649e1ac2d2e55e790ac067d46c" title="Array of DM.">dm</a>[idm].<a class="code" href="structDM__CFG__T.html#f8903a5291d9132441eab9a862c70e68" title="the scale for each scale group.">scales</a>[iscale]=scale[iscale];
<a name="l01056"></a>01056     }
<a name="l01057"></a>01057     }
<a name="l01058"></a>01058 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="e88e42b64bcd2103556c239fb38d61b3"></a><!-- doxytag: member="setup_parms.c::setup_parms_postproc_recon" ref="e88e42b64bcd2103556c239fb38d61b3" args="(PARMS_T *parms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void setup_parms_postproc_recon           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structPARMS__T.html">PARMS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>parms</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Setting up the cone coordinate for MCAO LGS simulation. 
<p>
First find out the guide star conjugate. Only 1 altitude is allowed. <div class="fragment"><pre class="fragment"><a name="l01065"></a>01065                                                       {    
<a name="l01066"></a>01066     {
<a name="l01067"></a>01067     <span class="keywordtype">double</span> hs=INFINITY;
<a name="l01068"></a>01068     <span class="comment">//find out the height to setup cone coordinate.</span>
<a name="l01069"></a>01069     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#654d89a9becf3ea9e32d11e470416f7c" title="information about reconstructed atm">atmr</a>.<a class="code" href="structATMR__CFG__T.html#e0ec245d13404e08afcb1c4670f54348" title="use cone coordinate">cone</a>){
<a name="l01070"></a>01070         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ipowfs=0; ipowfs&lt;parms-&gt;<a class="code" href="structPARMS__T.html#184dc967ffbedc29f2d48cd49889ddd2" title="Number of wfs types.">npowfs</a>; ipowfs++){
<a name="l01071"></a>01071         <span class="keywordflow">if</span> (parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#0324889316992d35cd3e1e3df9d17382" title="whether this is a low order wfs.">lo</a>){
<a name="l01072"></a>01072             <span class="keywordflow">continue</span>;
<a name="l01073"></a>01073         }
<a name="l01074"></a>01074         <span class="keywordflow">if</span>(isinf(parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#3b65158c197ddc07b117b5f8b1aa567b" title="height of guide star">hs</a>)){
<a name="l01075"></a>01075             <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#654d89a9becf3ea9e32d11e470416f7c" title="information about reconstructed atm">atmr</a>.<a class="code" href="structATMR__CFG__T.html#e0ec245d13404e08afcb1c4670f54348" title="use cone coordinate">cone</a>){
<a name="l01076"></a>01076             parms-&gt;<a class="code" href="structPARMS__T.html#654d89a9becf3ea9e32d11e470416f7c" title="information about reconstructed atm">atmr</a>.<a class="code" href="structATMR__CFG__T.html#e0ec245d13404e08afcb1c4670f54348" title="use cone coordinate">cone</a>=0;
<a name="l01077"></a>01077             info2(<span class="stringliteral">"High order ipowfs=%d is at infinity,"</span>
<a name="l01078"></a>01078                   <span class="stringliteral">" cone coordinate is invalid, changed.\n"</span>,ipowfs);
<a name="l01079"></a>01079             }
<a name="l01080"></a>01080         }<span class="keywordflow">else</span>{
<a name="l01081"></a>01081             <span class="keywordflow">if</span>(!parms-&gt;<a class="code" href="structPARMS__T.html#654d89a9becf3ea9e32d11e470416f7c" title="information about reconstructed atm">atmr</a>.<a class="code" href="structATMR__CFG__T.html#e0ec245d13404e08afcb1c4670f54348" title="use cone coordinate">cone</a>){
<a name="l01082"></a>01082             warning2(<span class="stringliteral">"High order ipowfs=%d is at finite range,"</span>
<a name="l01083"></a>01083                  <span class="stringliteral">"but is not using cone coordinate.\n"</span>,ipowfs);
<a name="l01084"></a>01084             }
<a name="l01085"></a>01085             <span class="keywordflow">if</span>(!isinf(hs) &amp;&amp; fabs(hs-parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#3b65158c197ddc07b117b5f8b1aa567b" title="height of guide star">hs</a>)&gt;1.e-6){
<a name="l01086"></a>01086             error(<span class="stringliteral">"Two high order POWFS with different hs found"</span>);
<a name="l01087"></a>01087             }<span class="keywordflow">else</span>{
<a name="l01088"></a>01088             hs = parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#3b65158c197ddc07b117b5f8b1aa567b" title="height of guide star">hs</a>;
<a name="l01089"></a>01089             }
<a name="l01090"></a>01090         }
<a name="l01091"></a>01091         }
<a name="l01092"></a>01092     }<span class="keywordflow">else</span>{
<a name="l01093"></a>01093         hs=INFINITY;
<a name="l01094"></a>01094     }
<a name="l01095"></a>01095     parms-&gt;<a class="code" href="structPARMS__T.html#654d89a9becf3ea9e32d11e470416f7c" title="information about reconstructed atm">atmr</a>.<a class="code" href="structATMR__CFG__T.html#66c8146bade9913a842849b7579bef4e" title="height of the high order guide star.">hs</a>=hs;
<a name="l01096"></a>01096     }
<a name="l01097"></a>01097     {
<a name="l01098"></a>01098     <span class="comment">//find out the sampling to setup tomography grid using the maximum order of the wfs and DMs.</span>
<a name="l01099"></a>01099     <span class="keywordtype">double</span> maxorder=0;
<a name="l01100"></a>01100     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ipowfs=0; ipowfs&lt;parms-&gt;<a class="code" href="structPARMS__T.html#184dc967ffbedc29f2d48cd49889ddd2" title="Number of wfs types.">npowfs</a>; ipowfs++){
<a name="l01101"></a>01101         <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#27c7dcb36cf4ff0b070eab1b80491266" title="order of wavefront sensing along one dimension.">order</a>&gt;maxorder){
<a name="l01102"></a>01102         maxorder=parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#27c7dcb36cf4ff0b070eab1b80491266" title="order of wavefront sensing along one dimension.">order</a>;
<a name="l01103"></a>01103         }
<a name="l01104"></a>01104     }
<a name="l01105"></a>01105     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> idm=0; idm&lt;parms-&gt;<a class="code" href="structPARMS__T.html#6492c3b89e0243fe23d88ebedb044b0e" title="Number of DMs.">ndm</a>; idm++){
<a name="l01106"></a>01106         <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#c2f69a649e1ac2d2e55e790ac067d46c" title="Array of DM.">dm</a>[idm].<a class="code" href="structDM__CFG__T.html#d51c7bdc88ea34b8b9b7577186f689de" title="Order of the DM within telescope clear subaperture.">order</a> &gt; maxorder){
<a name="l01107"></a>01107         maxorder=parms-&gt;<a class="code" href="structPARMS__T.html#c2f69a649e1ac2d2e55e790ac067d46c" title="Array of DM.">dm</a>[idm].<a class="code" href="structDM__CFG__T.html#d51c7bdc88ea34b8b9b7577186f689de" title="Order of the DM within telescope clear subaperture.">order</a>;
<a name="l01108"></a>01108         }
<a name="l01109"></a>01109     }
<a name="l01110"></a>01110     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> imoao=0; imoao&lt;parms-&gt;<a class="code" href="structPARMS__T.html#477936fb54c33badc9ec9bf34db0e17f" title="Number of different MOAO type.">nmoao</a>; imoao++){
<a name="l01111"></a>01111         <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#2de7b678eb1df1bcc6fd4af8a3340fd0" title="Array of MOAO.">moao</a>[imoao].<a class="code" href="structMOAO__CFG__T.html#d48b40cc8fa331e50d718f6ac50a2de3" title="Order of this MOAO.">order</a>&gt;maxorder){
<a name="l01112"></a>01112         maxorder=parms-&gt;<a class="code" href="structPARMS__T.html#2de7b678eb1df1bcc6fd4af8a3340fd0" title="Array of MOAO.">moao</a>[imoao].<a class="code" href="structMOAO__CFG__T.html#d48b40cc8fa331e50d718f6ac50a2de3" title="Order of this MOAO.">order</a>;
<a name="l01113"></a>01113         }
<a name="l01114"></a>01114     }
<a name="l01115"></a>01115     parms-&gt;<a class="code" href="structPARMS__T.html#654d89a9becf3ea9e32d11e470416f7c" title="information about reconstructed atm">atmr</a>.<a class="code" href="structATMR__CFG__T.html#000509803902f7629b9ba04a57cb75e5" title="baseline sampling (when os=1).">dx</a>=parms-&gt;<a class="code" href="structPARMS__T.html#674d3d0b966b2d7c27767e909dfcb30f" title="aperture parameters">aper</a>.<a class="code" href="structAPER__CFG__T.html#ce3d5df3fe365f555ce1b851f833e961" title="Telescope aperture diameter.">d</a>/maxorder;
<a name="l01116"></a>01116     }
<a name="l01117"></a>01117     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#97445ce9015e982a22199e400b2271e4" title="tomography parameters">tomo</a>.<a class="code" href="structTOMO__CFG__T.html#0b1183e68cda2c750bc3aa9b23648685" title="split tomography type.">split</a>==2 &amp;&amp; parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#16a3a1b709068ad2f3ed43b343cce6d6" title="fuse the high and low order integrators in split tomography">fuseint</a>==1){
<a name="l01118"></a>01118     warning(<span class="stringliteral">"MVST Mode can only use separated integrator for the moment. Changed\n"</span>);
<a name="l01119"></a>01119     parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#16a3a1b709068ad2f3ed43b343cce6d6" title="fuse the high and low order integrators in split tomography">fuseint</a>=0;
<a name="l01120"></a>01120     }
<a name="l01121"></a>01121     <span class="keywordflow">if</span>(!parms-&gt;<a class="code" href="structPARMS__T.html#97445ce9015e982a22199e400b2271e4" title="tomography parameters">tomo</a>.<a class="code" href="structTOMO__CFG__T.html#0b1183e68cda2c750bc3aa9b23648685" title="split tomography type.">split</a> &amp;&amp; !parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#16a3a1b709068ad2f3ed43b343cce6d6" title="fuse the high and low order integrators in split tomography">fuseint</a>){
<a name="l01122"></a>01122     parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#16a3a1b709068ad2f3ed43b343cce6d6" title="fuse the high and low order integrators in split tomography">fuseint</a>=1;<span class="comment">//integrated tomo. only 1 integrator.</span>
<a name="l01123"></a>01123     }
<a name="l01124"></a>01124     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#97445ce9015e982a22199e400b2271e4" title="tomography parameters">tomo</a>.<a class="code" href="structTOMO__CFG__T.html#55e4197464d1963dbff66662ec83f4b1" title="Tomography preconditioner.">precond</a>==1 &amp;&amp; parms-&gt;<a class="code" href="structPARMS__T.html#654d89a9becf3ea9e32d11e470416f7c" title="information about reconstructed atm">atmr</a>.<a class="code" href="structATMR__CFG__T.html#2a286e84160801fd89366d02f005a39e" title="use square/rectangular grid instead of tighter irregular grid">square</a>!=1){
<a name="l01125"></a>01125     warning(<span class="stringliteral">"FDPCG requires square XLOC. changed\n"</span>);
<a name="l01126"></a>01126     parms-&gt;<a class="code" href="structPARMS__T.html#654d89a9becf3ea9e32d11e470416f7c" title="information about reconstructed atm">atmr</a>.<a class="code" href="structATMR__CFG__T.html#2a286e84160801fd89366d02f005a39e" title="use square/rectangular grid instead of tighter irregular grid">square</a>=1;
<a name="l01127"></a>01127     }
<a name="l01128"></a>01128     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#97445ce9015e982a22199e400b2271e4" title="tomography parameters">tomo</a>.<a class="code" href="structTOMO__CFG__T.html#ca7b490ba52cfa6226d84a4248cfc65b" title="estimate wind.">windest</a> &amp;&amp; parms-&gt;<a class="code" href="structPARMS__T.html#654d89a9becf3ea9e32d11e470416f7c" title="information about reconstructed atm">atmr</a>.<a class="code" href="structATMR__CFG__T.html#2a286e84160801fd89366d02f005a39e" title="use square/rectangular grid instead of tighter irregular grid">square</a>!=1){
<a name="l01129"></a>01129     warning(<span class="stringliteral">"Wind estimation requires square XLOC. changed\n"</span>);
<a name="l01130"></a>01130     parms-&gt;<a class="code" href="structPARMS__T.html#654d89a9becf3ea9e32d11e470416f7c" title="information about reconstructed atm">atmr</a>.<a class="code" href="structATMR__CFG__T.html#2a286e84160801fd89366d02f005a39e" title="use square/rectangular grid instead of tighter irregular grid">square</a>=1;
<a name="l01131"></a>01131     }
<a name="l01132"></a>01132     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#97445ce9015e982a22199e400b2271e4" title="tomography parameters">tomo</a>.<a class="code" href="structTOMO__CFG__T.html#ca7b490ba52cfa6226d84a4248cfc65b" title="estimate wind.">windest</a> &amp;&amp; parms-&gt;<a class="code" href="structPARMS__T.html#97445ce9015e982a22199e400b2271e4" title="tomography parameters">tomo</a>.<a class="code" href="structTOMO__CFG__T.html#b55475bb28aee1940de2fe860707e33f" title="shift opdr using wind velocity (from input if windest=0)">windshift</a>==0){
<a name="l01133"></a>01133     warning(<span class="stringliteral">"Windest=1 but windshift=0\n"</span>);
<a name="l01134"></a>01134     }
<a name="l01135"></a>01135     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#bf0ce35fd4cdfa16eefa42aea7c3300e" title="method for focus tracing.">mffocus</a> &amp;&amp; (!parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#0408bb89e89669682cba86f7fb98b2dc" title="closed loop or open loop">closeloop</a> || parms-&gt;<a class="code" href="structPARMS__T.html#8fdfce1e68e018f54640c3d7214fcc33" title="Specify debugging parameters.">dbg</a>.<a class="code" href="structDBG__CFG__T.html#8c69a219924faa60ddf33137b2d35633" title="do DM fitting only, by replacing opdr with opdx.">fitonly</a>)){
<a name="l01136"></a>01136     warning(<span class="stringliteral">"mffocus is set, but we are in open loop mode or doing fitting only. disable\n"</span>);
<a name="l01137"></a>01137     parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#bf0ce35fd4cdfa16eefa42aea7c3300e" title="method for focus tracing.">mffocus</a>=0;
<a name="l01138"></a>01138     }
<a name="l01139"></a>01139 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="698c26e1ac55798491764865d39a6758"></a><!-- doxytag: member="setup_parms.c::setup_parms_postproc_siglev" ref="698c26e1ac55798491764865d39a6758" args="(PARMS_T *parms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void setup_parms_postproc_siglev           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structPARMS__T.html">PARMS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>parms</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
The siglev is always specified in 800 Hz. 
<p>
If sim.dt is not 1/800, rescale the siglev. <div class="fragment"><pre class="fragment"><a name="l01144"></a>01144                                                        {
<a name="l01145"></a>01145     <span class="keywordtype">double</span> sigscale=parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#345f9deab3e2b21f28284e29732af51e" title="sampling period.">dt</a>*800;
<a name="l01146"></a>01146     <span class="keywordflow">if</span>(fabs(sigscale-1.)&gt;EPS){
<a name="l01147"></a>01147     info(<span class="stringliteral">"sim.dt is 1/%g, need to scale siglev.\n"</span>,1/parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#345f9deab3e2b21f28284e29732af51e" title="sampling period.">dt</a>);
<a name="l01148"></a>01148     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iwfs=0; iwfs&lt;parms-&gt;<a class="code" href="structPARMS__T.html#b6833beca5a29a5936d41ac934e66d24" title="Number of wfs.">nwfs</a>; iwfs++){
<a name="l01149"></a>01149         <span class="keywordtype">double</span> siglev=parms-&gt;<a class="code" href="structPARMS__T.html#19246602a8b7d0261d79416e281d6ca4" title="Array of wfs.">wfs</a>[iwfs].<a class="code" href="structWFS__CFG__T.html#ac67dd456e4d3d31400fc9830daf9735" title="Total signal value for all wavelength.">siglev</a>;
<a name="l01150"></a>01150         parms-&gt;<a class="code" href="structPARMS__T.html#19246602a8b7d0261d79416e281d6ca4" title="Array of wfs.">wfs</a>[iwfs].<a class="code" href="structWFS__CFG__T.html#ac67dd456e4d3d31400fc9830daf9735" title="Total signal value for all wavelength.">siglev</a>=siglev*sigscale;
<a name="l01151"></a>01151         info(<span class="stringliteral">"wfs%d: siglev scaled from %g to %g\n"</span>, iwfs,siglev,parms-&gt;<a class="code" href="structPARMS__T.html#19246602a8b7d0261d79416e281d6ca4" title="Array of wfs.">wfs</a>[iwfs].<a class="code" href="structWFS__CFG__T.html#ac67dd456e4d3d31400fc9830daf9735" title="Total signal value for all wavelength.">siglev</a>);
<a name="l01152"></a>01152     } 
<a name="l01153"></a>01153     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ipowfs=0; ipowfs&lt;parms-&gt;<a class="code" href="structPARMS__T.html#184dc967ffbedc29f2d48cd49889ddd2" title="Number of wfs types.">npowfs</a>; ipowfs++){
<a name="l01154"></a>01154         <span class="keywordtype">double</span> bkgrnd=parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#847860bab1665b17b5e85d502a4485e0" title="background in electron per pixel per LGS frame">bkgrnd</a>;
<a name="l01155"></a>01155         <span class="keywordflow">if</span>(fabs(bkgrnd)&gt;1.e-50){
<a name="l01156"></a>01156         parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#847860bab1665b17b5e85d502a4485e0" title="background in electron per pixel per LGS frame">bkgrnd</a>=bkgrnd*sigscale;
<a name="l01157"></a>01157         info(<span class="stringliteral">"powfs%d: siglev scaled from %g to %g\n"</span>, 
<a name="l01158"></a>01158              ipowfs,bkgrnd,parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#847860bab1665b17b5e85d502a4485e0" title="background in electron per pixel per LGS frame">bkgrnd</a>);
<a name="l01159"></a>01159         }
<a name="l01160"></a>01160     }
<a name="l01161"></a>01161     }
<a name="l01162"></a>01162     
<a name="l01163"></a>01163     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iwfs=0; iwfs&lt;parms-&gt;<a class="code" href="structPARMS__T.html#b6833beca5a29a5936d41ac934e66d24" title="Number of wfs.">nwfs</a>; iwfs++){
<a name="l01164"></a>01164     <span class="keywordtype">int</span> ipowfs=parms-&gt;<a class="code" href="structPARMS__T.html#19246602a8b7d0261d79416e281d6ca4" title="Array of wfs.">wfs</a>[iwfs].<a class="code" href="structWFS__CFG__T.html#c6eeef5eba99a8dea64c1692bb60f5ff" title="powfs type">powfs</a>;
<a name="l01165"></a>01165     sigscale=parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#16439197d31f292f4ed5b62a5f8ed80d" title="scale the signal level for simulation.">sigscale</a>;
<a name="l01166"></a>01166     <span class="keywordflow">if</span>(fabs(sigscale-1)&gt;0.5){
<a name="l01167"></a>01167         warning(<span class="stringliteral">"powfs[%d].sigscale=%g\n"</span>,ipowfs,sigscale);
<a name="l01168"></a>01168     }
<a name="l01169"></a>01169     <span class="keywordtype">double</span> siglev=parms-&gt;<a class="code" href="structPARMS__T.html#19246602a8b7d0261d79416e281d6ca4" title="Array of wfs.">wfs</a>[iwfs].<a class="code" href="structWFS__CFG__T.html#ac67dd456e4d3d31400fc9830daf9735" title="Total signal value for all wavelength.">siglev</a>;
<a name="l01170"></a>01170     parms-&gt;<a class="code" href="structPARMS__T.html#19246602a8b7d0261d79416e281d6ca4" title="Array of wfs.">wfs</a>[iwfs].<a class="code" href="structWFS__CFG__T.html#83582e7e6916eee3a62304b0dae680f8" title="Signal value used for simulation.">siglevsim</a>=siglev*sigscale;
<a name="l01171"></a>01171     <span class="keywordflow">if</span>(fabs(sigscale-1)&gt;1.e-12){
<a name="l01172"></a>01172         warning(<span class="stringliteral">"wfs%d: siglev in simulation scaled from %g to %g\n"</span>, 
<a name="l01173"></a>01173          iwfs,siglev,parms-&gt;<a class="code" href="structPARMS__T.html#19246602a8b7d0261d79416e281d6ca4" title="Array of wfs.">wfs</a>[iwfs].<a class="code" href="structWFS__CFG__T.html#83582e7e6916eee3a62304b0dae680f8" title="Signal value used for simulation.">siglevsim</a>);
<a name="l01174"></a>01174     }
<a name="l01175"></a>01175     }
<a name="l01176"></a>01176 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="33d94712102ef4690b9338e902e829ae"></a><!-- doxytag: member="setup_parms.c::setup_parms_postproc_misc" ref="33d94712102ef4690b9338e902e829ae" args="(PARMS_T *parms, ARG_T *arg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void setup_parms_postproc_misc           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structPARMS__T.html">PARMS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>parms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structARG__T.html">ARG_T</a> *&nbsp;</td>
          <td class="paramname"> <em>arg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
postproc misc parameters. 
<p>
<div class="fragment"><pre class="fragment"><a name="l01180"></a>01180                                                                  {
<a name="l01181"></a>01181     parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#7691a6a576a70e837fa68092a6ca26de" title="Number of threads to run the simulation.">nthread</a>=arg-&gt;<a class="code" href="structARG__T.html#18bb19154482544ae53621864bab3756" title="Number of threads.">nthread</a>;
<a name="l01182"></a>01182     <span class="comment">//setup seeds.</span>
<a name="l01183"></a>01183     <span class="keywordflow">if</span>(arg-&gt;<a class="code" href="structARG__T.html#1b6b5a8ef6b705c9f1462b9c4eaed72e" title="Number of seeds.">nseed</a>&gt;0){
<a name="l01184"></a>01184     parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#6021b395d1b8ca9bb3f3449b67ed7935" title="How many simulation seed.">nseed</a>=arg-&gt;<a class="code" href="structARG__T.html#1b6b5a8ef6b705c9f1462b9c4eaed72e" title="Number of seeds.">nseed</a>;
<a name="l01185"></a>01185     parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#483429d04a2de324a443780025083dda" title="simulation seeds">seeds</a>=realloc(parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#483429d04a2de324a443780025083dda" title="simulation seeds">seeds</a>, arg-&gt;<a class="code" href="structARG__T.html#1b6b5a8ef6b705c9f1462b9c4eaed72e" title="Number of seeds.">nseed</a>*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l01186"></a>01186     memcpy(parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#483429d04a2de324a443780025083dda" title="simulation seeds">seeds</a>, arg-&gt;<a class="code" href="structARG__T.html#e850f463984604b4981a0f3020554613" title="Array of seeds.">seeds</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>)*arg-&gt;<a class="code" href="structARG__T.html#1b6b5a8ef6b705c9f1462b9c4eaed72e" title="Number of seeds.">nseed</a>);
<a name="l01187"></a>01187     }
<a name="l01188"></a>01188     info2(<span class="stringliteral">"There are %d simulation seeds supplied by "</span>,parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#6021b395d1b8ca9bb3f3449b67ed7935" title="How many simulation seed.">nseed</a>);
<a name="l01189"></a>01189     <span class="keywordflow">if</span>(arg-&gt;<a class="code" href="structARG__T.html#1b6b5a8ef6b705c9f1462b9c4eaed72e" title="Number of seeds.">nseed</a>&gt;0){
<a name="l01190"></a>01190     info2(<span class="stringliteral">"command line:"</span>);
<a name="l01191"></a>01191     }<span class="keywordflow">else</span>{
<a name="l01192"></a>01192     info2(<span class="stringliteral">"conf files:"</span>);
<a name="l01193"></a>01193     }
<a name="l01194"></a>01194     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#6021b395d1b8ca9bb3f3449b67ed7935" title="How many simulation seed.">nseed</a>; i++){
<a name="l01195"></a>01195     info2(<span class="stringliteral">" %d"</span>, parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#483429d04a2de324a443780025083dda" title="simulation seeds">seeds</a>[i]);
<a name="l01196"></a>01196     }
<a name="l01197"></a>01197     info2(<span class="stringliteral">"\n"</span>);
<a name="l01198"></a>01198     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#8fdfce1e68e018f54640c3d7214fcc33" title="Specify debugging parameters.">dbg</a>.<a class="code" href="structDBG__CFG__T.html#d9d946845f79d17d253a152437f8347e" title="output cumulative gradient covariance average every gcovp step">gcovp</a>&lt;10){
<a name="l01199"></a>01199     warning(<span class="stringliteral">"parms-&gt;dbg.gcovp=%d is too small. You will fill your disk!\n"</span>,
<a name="l01200"></a>01200         parms-&gt;<a class="code" href="structPARMS__T.html#8fdfce1e68e018f54640c3d7214fcc33" title="Specify debugging parameters.">dbg</a>.<a class="code" href="structDBG__CFG__T.html#d9d946845f79d17d253a152437f8347e" title="output cumulative gradient covariance average every gcovp step">gcovp</a>);
<a name="l01201"></a>01201     }
<a name="l01202"></a>01202     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#8fdfce1e68e018f54640c3d7214fcc33" title="Specify debugging parameters.">dbg</a>.<a class="code" href="structDBG__CFG__T.html#d9d946845f79d17d253a152437f8347e" title="output cumulative gradient covariance average every gcovp step">gcovp</a>&gt;parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#7939a4003b5c376eb09702a8a1572ce5" title="time step to stop simulation.">end</a>){
<a name="l01203"></a>01203     parms-&gt;<a class="code" href="structPARMS__T.html#8fdfce1e68e018f54640c3d7214fcc33" title="Specify debugging parameters.">dbg</a>.<a class="code" href="structDBG__CFG__T.html#d9d946845f79d17d253a152437f8347e" title="output cumulative gradient covariance average every gcovp step">gcovp</a>=parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#7939a4003b5c376eb09702a8a1572ce5" title="time step to stop simulation.">end</a>;
<a name="l01204"></a>01204     }
<a name="l01205"></a>01205     
<a name="l01206"></a>01206     <span class="comment">/*Fitting tip/tilt constraint is only intended for multi DM*/</span>
<a name="l01207"></a>01207     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#6492c3b89e0243fe23d88ebedb044b0e" title="Number of DMs.">ndm</a>&lt;2 &amp;&amp; parms-&gt;<a class="code" href="structPARMS__T.html#3b8ffe6fa411ea23ef7c1383fe61abbf" title="DM fit parameters.">fit</a>.<a class="code" href="structFIT__CFG__T.html#ca277d524c4b2254cabecf77adfe5827" title="differential tip/tilt constraint on two DMs or tt on upper dms.">lrt_tt</a>){
<a name="l01208"></a>01208     warning(<span class="stringliteral">"for single dm, lrt_tt must be zero. changed\n"</span>);
<a name="l01209"></a>01209     parms-&gt;<a class="code" href="structPARMS__T.html#3b8ffe6fa411ea23ef7c1383fe61abbf" title="DM fit parameters.">fit</a>.<a class="code" href="structFIT__CFG__T.html#ca277d524c4b2254cabecf77adfe5827" title="differential tip/tilt constraint on two DMs or tt on upper dms.">lrt_tt</a>=0;
<a name="l01210"></a>01210     }
<a name="l01211"></a>01211     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#6492c3b89e0243fe23d88ebedb044b0e" title="Number of DMs.">ndm</a>&gt;2 &amp;&amp; parms-&gt;<a class="code" href="structPARMS__T.html#3b8ffe6fa411ea23ef7c1383fe61abbf" title="DM fit parameters.">fit</a>.<a class="code" href="structFIT__CFG__T.html#ca277d524c4b2254cabecf77adfe5827" title="differential tip/tilt constraint on two DMs or tt on upper dms.">lrt_tt</a>==2){
<a name="l01212"></a>01212     warning(<span class="stringliteral">"When there are more than 2 DMs, lrt_tt has to be 1 instead of 2. changed\n"</span>);
<a name="l01213"></a>01213     parms-&gt;<a class="code" href="structPARMS__T.html#3b8ffe6fa411ea23ef7c1383fe61abbf" title="DM fit parameters.">fit</a>.<a class="code" href="structFIT__CFG__T.html#ca277d524c4b2254cabecf77adfe5827" title="differential tip/tilt constraint on two DMs or tt on upper dms.">lrt_tt</a>=1;
<a name="l01214"></a>01214     }
<a name="l01215"></a>01215     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#3b8ffe6fa411ea23ef7c1383fe61abbf" title="DM fit parameters.">fit</a>.<a class="code" href="structFIT__CFG__T.html#ca277d524c4b2254cabecf77adfe5827" title="differential tip/tilt constraint on two DMs or tt on upper dms.">lrt_tt</a>&lt;0 || parms-&gt;<a class="code" href="structPARMS__T.html#3b8ffe6fa411ea23ef7c1383fe61abbf" title="DM fit parameters.">fit</a>.<a class="code" href="structFIT__CFG__T.html#ca277d524c4b2254cabecf77adfe5827" title="differential tip/tilt constraint on two DMs or tt on upper dms.">lrt_tt</a>&gt;2){
<a name="l01216"></a>01216     error(<span class="stringliteral">"parms-&gt;fit.lrt_tt=%d is invalid\n"</span>, parms-&gt;<a class="code" href="structPARMS__T.html#3b8ffe6fa411ea23ef7c1383fe61abbf" title="DM fit parameters.">fit</a>.<a class="code" href="structFIT__CFG__T.html#ca277d524c4b2254cabecf77adfe5827" title="differential tip/tilt constraint on two DMs or tt on upper dms.">lrt_tt</a>);
<a name="l01217"></a>01217     }
<a name="l01218"></a>01218     <span class="comment">/*load.tomo==1 loads tomography matrix saved by LAOS for debugging purpose.*/</span>
<a name="l01219"></a>01219     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#81b69d85af4c28961cc299c618dd4124" title="Specify what matrices to load for debugging.">load</a>.<a class="code" href="structLOAD__CFG__T.html#6300bd2144c25191aa100662d299234f" title="if 1, load tomo matrix">tomo</a> || parms-&gt;<a class="code" href="structPARMS__T.html#97445ce9015e982a22199e400b2271e4" title="tomography parameters">tomo</a>.<a class="code" href="structTOMO__CFG__T.html#78278efa786e9d15e8de3a3af9525101" title="Tomography algorithm to solve the linear equation.">alg</a>!=1){
<a name="l01220"></a>01220     parms-&gt;<a class="code" href="structPARMS__T.html#97445ce9015e982a22199e400b2271e4" title="tomography parameters">tomo</a>.<a class="code" href="structTOMO__CFG__T.html#b3d83877db6d942c80c35d3ae0829e78" title="force assemble tomography matrix in CG">assemble</a>=1;
<a name="l01221"></a>01221     }
<a name="l01222"></a>01222     <span class="comment">//disable cache for low order systems.</span>
<a name="l01223"></a>01223     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#4121e9dc728705be0ad2c58dcaf4cd75" title="Performance evaluation parameters.">evl</a>.<a class="code" href="structEVL__CFG__T.html#9f76679213a98ac7e3eb0fe92d645799" title="Number of evaluation directions.">nevl</a>&lt;2){
<a name="l01224"></a>01224     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#1e7a8af66d62b8d1c0e6b1c31e1c248f" title="cache dm shape on fine sampled grid matched WFS or Science grid">cachedm</a>){
<a name="l01225"></a>01225         parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#1e7a8af66d62b8d1c0e6b1c31e1c248f" title="cache dm shape on fine sampled grid matched WFS or Science grid">cachedm</a>=0;
<a name="l01226"></a>01226         warning(<span class="stringliteral">"cachedm disabled for SCAO\n"</span>);
<a name="l01227"></a>01227     }
<a name="l01228"></a>01228     }
<a name="l01229"></a>01229     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#8fdfce1e68e018f54640c3d7214fcc33" title="Specify debugging parameters.">dbg</a>.<a class="code" href="structDBG__CFG__T.html#8c69a219924faa60ddf33137b2d35633" title="do DM fitting only, by replacing opdr with opdx.">fitonly</a>){
<a name="l01230"></a>01230     parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#26569c7a3b382ec5e71016b2719f6734" title="corresponding reconstruction layer">ipsr</a>=calloc(parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#f377ac265c4e8778949386b5c78c9ba6" title="number of phase screens">nps</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l01231"></a>01231     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ips=0; ips&lt;parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#f377ac265c4e8778949386b5c78c9ba6" title="number of phase screens">nps</a>; ips++){
<a name="l01232"></a>01232         <span class="keywordtype">double</span> dist=INFINITY;
<a name="l01233"></a>01233         <span class="keywordtype">int</span> kpsr=-1;
<a name="l01234"></a>01234         <span class="keywordtype">double</span> ht=parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#59642a891abc1d24aaeee4521a82c91b" title="height of each layer">ht</a>[ips];
<a name="l01235"></a>01235         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ipsr=0; ipsr&lt;parms-&gt;<a class="code" href="structPARMS__T.html#654d89a9becf3ea9e32d11e470416f7c" title="information about reconstructed atm">atmr</a>.<a class="code" href="structATMR__CFG__T.html#14584f027f0a847b43f47fbbf53e6324" title="number of phase screens">nps</a>; ipsr++){
<a name="l01236"></a>01236         <span class="keywordtype">double</span> htr=parms-&gt;<a class="code" href="structPARMS__T.html#654d89a9becf3ea9e32d11e470416f7c" title="information about reconstructed atm">atmr</a>.<a class="code" href="structATMR__CFG__T.html#c2d70c6f4dd690896de2145333728abc" title="height of each layer">ht</a>[ipsr];
<a name="l01237"></a>01237         <span class="keywordtype">double</span> dist2=fabs(ht-htr);
<a name="l01238"></a>01238         <span class="keywordflow">if</span>(dist2&lt;dist){
<a name="l01239"></a>01239             dist=dist2;
<a name="l01240"></a>01240             kpsr=ipsr;
<a name="l01241"></a>01241         }
<a name="l01242"></a>01242         }
<a name="l01243"></a>01243         parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#26569c7a3b382ec5e71016b2719f6734" title="corresponding reconstruction layer">ipsr</a>[ips]=kpsr;
<a name="l01244"></a>01244         info(<span class="stringliteral">"atm layer %d is maped to atmr %d\n"</span>, ips,kpsr);
<a name="l01245"></a>01245     }
<a name="l01246"></a>01246     }
<a name="l01247"></a>01247     <span class="keywordflow">if</span>(!parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#0408bb89e89669682cba86f7fb98b2dc" title="closed loop or open loop">closeloop</a>){
<a name="l01248"></a>01248     warning2(<span class="stringliteral">"psfisim is set from %d to 0 in openloop mode\n"</span>, parms-&gt;<a class="code" href="structPARMS__T.html#4121e9dc728705be0ad2c58dcaf4cd75" title="Performance evaluation parameters.">evl</a>.<a class="code" href="structEVL__CFG__T.html#b5a659df6062a81bed28af92cdda3b7f" title="time step to start psfmean.">psfisim</a>);
<a name="l01249"></a>01249     parms-&gt;<a class="code" href="structPARMS__T.html#4121e9dc728705be0ad2c58dcaf4cd75" title="Performance evaluation parameters.">evl</a>.<a class="code" href="structEVL__CFG__T.html#b5a659df6062a81bed28af92cdda3b7f" title="time step to start psfmean.">psfisim</a>=0;
<a name="l01250"></a>01250     }
<a name="l01251"></a>01251 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="52f022b8c4512d9bd20674de845593a2"></a><!-- doxytag: member="setup_parms.c::setup_parms_postproc_save" ref="52f022b8c4512d9bd20674de845593a2" args="(PARMS_T *parms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void setup_parms_postproc_save           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structPARMS__T.html">PARMS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>parms</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
postproc parameters for save. 
<p>
<div class="fragment"><pre class="fragment"><a name="l01255"></a>01255                                                      {
<a name="l01256"></a>01256     <span class="keyword">const</span> <span class="keywordtype">int</span> npowfs=parms-&gt;<a class="code" href="structPARMS__T.html#184dc967ffbedc29f2d48cd49889ddd2" title="Number of wfs types.">npowfs</a>;
<a name="l01257"></a>01257     parms-&gt;<a class="code" href="structPARMS__T.html#e8cbc9dfdcddc18df6c55c9a76edfdc2" title="Specify what to save to file for debugging.">save</a>.<a class="code" href="structSAVE__CFG__T.html#fc81107952639fb2bf16950bc6ec2bc6" title="derived parameter to specify which powfs to save opd">powfs_opd</a>  = calloc(npowfs, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l01258"></a>01258     parms-&gt;<a class="code" href="structPARMS__T.html#e8cbc9dfdcddc18df6c55c9a76edfdc2" title="Specify what to save to file for debugging.">save</a>.<a class="code" href="structSAVE__CFG__T.html#77c3cafec871ddaf2d3212581f565d69" title="derived parameter to specify which powfs to save ints">wfsints</a> = calloc(npowfs, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l01259"></a>01259     parms-&gt;<a class="code" href="structPARMS__T.html#e8cbc9dfdcddc18df6c55c9a76edfdc2" title="Specify what to save to file for debugging.">save</a>.<a class="code" href="structSAVE__CFG__T.html#7903037b1cc5e3f3d57f0511d39de605" title="derived parameter to specify which powfs to save grad">powfs_grad</a> = calloc(npowfs, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l01260"></a>01260     parms-&gt;<a class="code" href="structPARMS__T.html#e8cbc9dfdcddc18df6c55c9a76edfdc2" title="Specify what to save to file for debugging.">save</a>.<a class="code" href="structSAVE__CFG__T.html#a759e594e608dac31bec3f18e1d830bb" title="derived parameter to specify which powfs to save geometric grad">powfs_gradgeom</a> = calloc(npowfs, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l01261"></a>01261     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ipowfs=0; ipowfs&lt;npowfs; ipowfs++){
<a name="l01262"></a>01262     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#0324889316992d35cd3e1e3df9d17382" title="whether this is a low order wfs.">lo</a>){<span class="comment">//low order wfs</span>
<a name="l01263"></a>01263         <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#e8cbc9dfdcddc18df6c55c9a76edfdc2" title="Specify what to save to file for debugging.">save</a>.<a class="code" href="structSAVE__CFG__T.html#10d1345f20457fbeae19109b83c5d9d8" title="save low order WFS OPD">wfsopdlo</a>)
<a name="l01264"></a>01264         parms-&gt;<a class="code" href="structPARMS__T.html#e8cbc9dfdcddc18df6c55c9a76edfdc2" title="Specify what to save to file for debugging.">save</a>.<a class="code" href="structSAVE__CFG__T.html#fc81107952639fb2bf16950bc6ec2bc6" title="derived parameter to specify which powfs to save opd">powfs_opd</a>[ipowfs]=1;
<a name="l01265"></a>01265         <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#e8cbc9dfdcddc18df6c55c9a76edfdc2" title="Specify what to save to file for debugging.">save</a>.<a class="code" href="structSAVE__CFG__T.html#581b02d30795c0e1549fdd803d7911af" title="save low orrder WFS integration">intslo</a>)
<a name="l01266"></a>01266         parms-&gt;<a class="code" href="structPARMS__T.html#e8cbc9dfdcddc18df6c55c9a76edfdc2" title="Specify what to save to file for debugging.">save</a>.<a class="code" href="structSAVE__CFG__T.html#77c3cafec871ddaf2d3212581f565d69" title="derived parameter to specify which powfs to save ints">wfsints</a>[ipowfs]=1;
<a name="l01267"></a>01267         <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#e8cbc9dfdcddc18df6c55c9a76edfdc2" title="Specify what to save to file for debugging.">save</a>.<a class="code" href="structSAVE__CFG__T.html#9c7561530faefcb0f199b7415bb9e322" title="save WFS gradients for low order wfs">gradlo</a>)
<a name="l01268"></a>01268         parms-&gt;<a class="code" href="structPARMS__T.html#e8cbc9dfdcddc18df6c55c9a76edfdc2" title="Specify what to save to file for debugging.">save</a>.<a class="code" href="structSAVE__CFG__T.html#7903037b1cc5e3f3d57f0511d39de605" title="derived parameter to specify which powfs to save grad">powfs_grad</a>[ipowfs]=1;
<a name="l01269"></a>01269         <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#e8cbc9dfdcddc18df6c55c9a76edfdc2" title="Specify what to save to file for debugging.">save</a>.<a class="code" href="structSAVE__CFG__T.html#b21009e665fc49489f6f9f1e4bd3b024" title="save WFS geometric gradient during physical optics simulations.">gradgeomlo</a>)
<a name="l01270"></a>01270         parms-&gt;<a class="code" href="structPARMS__T.html#e8cbc9dfdcddc18df6c55c9a76edfdc2" title="Specify what to save to file for debugging.">save</a>.<a class="code" href="structSAVE__CFG__T.html#a759e594e608dac31bec3f18e1d830bb" title="derived parameter to specify which powfs to save geometric grad">powfs_gradgeom</a>[ipowfs]=1;
<a name="l01271"></a>01271     }<span class="keywordflow">else</span>{<span class="comment">//high order wfs</span>
<a name="l01272"></a>01272         <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#e8cbc9dfdcddc18df6c55c9a76edfdc2" title="Specify what to save to file for debugging.">save</a>.<a class="code" href="structSAVE__CFG__T.html#176c03585612472231ab6a4be1211817" title="save high order WFS OPD">wfsopdhi</a>)
<a name="l01273"></a>01273         parms-&gt;<a class="code" href="structPARMS__T.html#e8cbc9dfdcddc18df6c55c9a76edfdc2" title="Specify what to save to file for debugging.">save</a>.<a class="code" href="structSAVE__CFG__T.html#fc81107952639fb2bf16950bc6ec2bc6" title="derived parameter to specify which powfs to save opd">powfs_opd</a>[ipowfs]=1;
<a name="l01274"></a>01274         <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#e8cbc9dfdcddc18df6c55c9a76edfdc2" title="Specify what to save to file for debugging.">save</a>.<a class="code" href="structSAVE__CFG__T.html#95a38cc1b078f10ba097b03a0ac8109d" title="save high orrder WFS integration">intshi</a>)
<a name="l01275"></a>01275         parms-&gt;<a class="code" href="structPARMS__T.html#e8cbc9dfdcddc18df6c55c9a76edfdc2" title="Specify what to save to file for debugging.">save</a>.<a class="code" href="structSAVE__CFG__T.html#77c3cafec871ddaf2d3212581f565d69" title="derived parameter to specify which powfs to save ints">wfsints</a>[ipowfs]=1;
<a name="l01276"></a>01276         <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#e8cbc9dfdcddc18df6c55c9a76edfdc2" title="Specify what to save to file for debugging.">save</a>.<a class="code" href="structSAVE__CFG__T.html#e62e9ccee9da7a163ada86892a3a118c" title="save WFS gradients for high order wfs">gradhi</a>)
<a name="l01277"></a>01277         parms-&gt;<a class="code" href="structPARMS__T.html#e8cbc9dfdcddc18df6c55c9a76edfdc2" title="Specify what to save to file for debugging.">save</a>.<a class="code" href="structSAVE__CFG__T.html#7903037b1cc5e3f3d57f0511d39de605" title="derived parameter to specify which powfs to save grad">powfs_grad</a>[ipowfs]=1;
<a name="l01278"></a>01278         <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#e8cbc9dfdcddc18df6c55c9a76edfdc2" title="Specify what to save to file for debugging.">save</a>.<a class="code" href="structSAVE__CFG__T.html#0d62d847fd7526f9b95844891342bbdd" title="save WFS geometric gradient during physical optics simulations.">gradgeomhi</a>)
<a name="l01279"></a>01279         parms-&gt;<a class="code" href="structPARMS__T.html#e8cbc9dfdcddc18df6c55c9a76edfdc2" title="Specify what to save to file for debugging.">save</a>.<a class="code" href="structSAVE__CFG__T.html#a759e594e608dac31bec3f18e1d830bb" title="derived parameter to specify which powfs to save geometric grad">powfs_gradgeom</a>[ipowfs]=1;
<a name="l01280"></a>01280     }
<a name="l01281"></a>01281     info(<span class="stringliteral">"powfs %d: %d %d %d %d\n"</span>,
<a name="l01282"></a>01282          ipowfs, parms-&gt;<a class="code" href="structPARMS__T.html#e8cbc9dfdcddc18df6c55c9a76edfdc2" title="Specify what to save to file for debugging.">save</a>.<a class="code" href="structSAVE__CFG__T.html#fc81107952639fb2bf16950bc6ec2bc6" title="derived parameter to specify which powfs to save opd">powfs_opd</a>[ipowfs], parms-&gt;<a class="code" href="structPARMS__T.html#e8cbc9dfdcddc18df6c55c9a76edfdc2" title="Specify what to save to file for debugging.">save</a>.<a class="code" href="structSAVE__CFG__T.html#77c3cafec871ddaf2d3212581f565d69" title="derived parameter to specify which powfs to save ints">wfsints</a>[ipowfs],
<a name="l01283"></a>01283          parms-&gt;<a class="code" href="structPARMS__T.html#e8cbc9dfdcddc18df6c55c9a76edfdc2" title="Specify what to save to file for debugging.">save</a>.<a class="code" href="structSAVE__CFG__T.html#7903037b1cc5e3f3d57f0511d39de605" title="derived parameter to specify which powfs to save grad">powfs_grad</a>[ipowfs],parms-&gt;<a class="code" href="structPARMS__T.html#e8cbc9dfdcddc18df6c55c9a76edfdc2" title="Specify what to save to file for debugging.">save</a>.<a class="code" href="structSAVE__CFG__T.html#a759e594e608dac31bec3f18e1d830bb" title="derived parameter to specify which powfs to save geometric grad">powfs_gradgeom</a>[ipowfs]);
<a name="l01284"></a>01284     }
<a name="l01285"></a>01285 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="e8e239acbf0b52604d181c19aae55f54"></a><!-- doxytag: member="setup_parms.c::print_parms" ref="e8e239acbf0b52604d181c19aae55f54" args="(const PARMS_T *parms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void print_parms           </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>parms</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Selectively print out parameters for easy diagnose of possible mistakes. 
<p>
<div class="fragment"><pre class="fragment"><a name="l01289"></a>01289                                              {
<a name="l01290"></a>01290     
<a name="l01291"></a>01291     <span class="keywordtype">int</span> i;
<a name="l01292"></a>01292     <span class="keyword">const</span> <span class="keywordtype">char</span> *phytype[]={
<a name="l01293"></a>01293     <span class="stringliteral">"\033[0;32mmatched filter\033[0;0m"</span>,
<a name="l01294"></a>01294     <span class="stringliteral">"\033[0;31mthresholded center of gravity\033[0;0m"</span>
<a name="l01295"></a>01295     };
<a name="l01296"></a>01296     <span class="keyword">const</span> <span class="keywordtype">char</span>* tomo_precond[]={
<a name="l01297"></a>01297     <span class="stringliteral">"\033[0;32mNo\033[0;0m"</span>,
<a name="l01298"></a>01298     <span class="stringliteral">"\033[0;32mFourer Domain\033[0;0m"</span>,
<a name="l01299"></a>01299     <span class="stringliteral">"\033[0;32mInvalid\033[0;0m"</span>
<a name="l01300"></a>01300     };
<a name="l01301"></a>01301     <span class="keyword">const</span> <span class="keywordtype">char</span> *closeloop[]={
<a name="l01302"></a>01302     <span class="stringliteral">"\033[0;31mopen\033[0;0m"</span>,
<a name="l01303"></a>01303     <span class="stringliteral">"\033[0;32mclose\033[0;0m"</span>
<a name="l01304"></a>01304     };
<a name="l01305"></a>01305 
<a name="l01306"></a>01306     info2(<span class="stringliteral">"\033[0;32mAperture\033[0;0m is %g m with sampling 1/%g m\n"</span>,
<a name="l01307"></a>01307       parms-&gt;<a class="code" href="structPARMS__T.html#674d3d0b966b2d7c27767e909dfcb30f" title="aperture parameters">aper</a>.<a class="code" href="structAPER__CFG__T.html#ce3d5df3fe365f555ce1b851f833e961" title="Telescope aperture diameter.">d</a>, 1/parms-&gt;<a class="code" href="structPARMS__T.html#674d3d0b966b2d7c27767e909dfcb30f" title="aperture parameters">aper</a>.<a class="code" href="structAPER__CFG__T.html#66e6d80a7720a91f8e4e13c1cfde9de6" title="sampling of aperture evaluation grid aper_locs">dx</a>);
<a name="l01308"></a>01308     <span class="keywordtype">double</span> wh=0;
<a name="l01309"></a>01309     <span class="keywordtype">double</span> wv=0;
<a name="l01310"></a>01310     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ips=0; ips&lt;parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#f377ac265c4e8778949386b5c78c9ba6" title="number of phase screens">nps</a>; ips++){
<a name="l01311"></a>01311     wh+=pow(parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#59642a891abc1d24aaeee4521a82c91b" title="height of each layer">ht</a>[ips],5./3.)*parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#d539b2f97fd31f5e5dc999b852b71228" title="weight of each layer (relative strength of )">wt</a>[ips];
<a name="l01312"></a>01312     wv+=pow(parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#a9a86b3cc0c73d0d27cbad43f9706108" title="wind speed of each layer">ws</a>[ips],5./3.)*parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#d539b2f97fd31f5e5dc999b852b71228" title="weight of each layer (relative strength of )">wt</a>[ips];
<a name="l01313"></a>01313     }
<a name="l01314"></a>01314     <span class="keywordtype">double</span> theta0z=0.3144*parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#311b33269454ff4d1dbbb5e1d84abf41" title="r0 at zenith">r0z</a>*pow(wh,-3./5.);
<a name="l01315"></a>01315     <span class="keywordtype">double</span> fgreen=0.426/parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#311b33269454ff4d1dbbb5e1d84abf41" title="r0 at zenith">r0z</a>*pow(wv,3./5.);
<a name="l01316"></a>01316     <span class="keywordtype">double</span> theta2z=0;
<a name="l01317"></a>01317     
<a name="l01318"></a>01318     info2(<span class="stringliteral">"\033[0;32mTurbulence at zenith:\033[0;0m\n"</span>
<a name="l01319"></a>01319       <span class="stringliteral">"Fried parameter r0 is %gm, Outer scale is %gm Greenwood freq is %.1fHz\n"</span>
<a name="l01320"></a>01320       <span class="stringliteral">"Anisoplanatic angle is %.2f\""</span>,
<a name="l01321"></a>01321       parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#ea9e24d04a414ec33916763092f6a486" title="derived from r0z for zenith angle za">r0</a>, parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#d6a52fa85cd299be46eef6c58bc426b0" title="outer scale">l0</a>, fgreen, theta0z*206265);
<a name="l01322"></a>01322     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#6492c3b89e0243fe23d88ebedb044b0e" title="Number of DMs.">ndm</a>==2){
<a name="l01323"></a>01323     <span class="keywordtype">double</span> wf=0;
<a name="l01324"></a>01324     <span class="keywordtype">double</span> H1=parms-&gt;<a class="code" href="structPARMS__T.html#c2f69a649e1ac2d2e55e790ac067d46c" title="Array of DM.">dm</a>[0].<a class="code" href="structDM__CFG__T.html#bf49acebd195a6705ddf3ed1c3f662ea" title="height conjugation range">ht</a>;
<a name="l01325"></a>01325     <span class="keywordtype">double</span> H2=parms-&gt;<a class="code" href="structPARMS__T.html#c2f69a649e1ac2d2e55e790ac067d46c" title="Array of DM.">dm</a>[1].<a class="code" href="structDM__CFG__T.html#bf49acebd195a6705ddf3ed1c3f662ea" title="height conjugation range">ht</a>;
<a name="l01326"></a>01326     <span class="keywordtype">double</span> HH=pow(H2-H1,5./3.);
<a name="l01327"></a>01327     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ips=0; ips&lt;parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#f377ac265c4e8778949386b5c78c9ba6" title="number of phase screens">nps</a>; ips++){
<a name="l01328"></a>01328         <span class="keywordtype">double</span> ht=parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#59642a891abc1d24aaeee4521a82c91b" title="height of each layer">ht</a>[ips];
<a name="l01329"></a>01329         <span class="keywordtype">double</span> t1=0.5*pow(fabs(ht-H1),5./3.)+0.5*pow(fabs(ht-H2),5./3.);
<a name="l01330"></a>01330         <span class="keywordtype">double</span> t2=-0.25*HH-0.25/HH*pow(pow(fabs(ht-H1),5./3.)-pow(fabs(ht-H2),5./3.),2);
<a name="l01331"></a>01331         wf+=parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#d539b2f97fd31f5e5dc999b852b71228" title="weight of each layer (relative strength of )">wt</a>[ips]*(t1+t2);
<a name="l01332"></a>01332     }
<a name="l01333"></a>01333     theta2z=0.3144*parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#311b33269454ff4d1dbbb5e1d84abf41" title="r0 at zenith">r0z</a>*pow(wf,-3./5.);
<a name="l01334"></a>01334     info2(<span class="stringliteral">", generalized is %.2f\""</span>, theta2z*206265);
<a name="l01335"></a>01335     }
<a name="l01336"></a>01336     info2(<span class="stringliteral">"\n"</span>);
<a name="l01337"></a>01337     info2(<span class="stringliteral">"There are %d layers, sampled %dx%d at 1/%gm, ZA is %g deg, wind dir is%s randomized.\n"</span>,
<a name="l01338"></a>01338       parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#f377ac265c4e8778949386b5c78c9ba6" title="number of phase screens">nps</a>, parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#17d5dd2613f05038cccb672e12671459" title="turbulence screen size alog x">nx</a>, parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#bcdc09a016c8d4bfe1a0b6c6f8a261a4" title="turbulence screen size along y">ny</a>,  1./parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#b47d65c892430196c01fa5c05c802608" title="sampling of turbulence screens">dx</a>,  
<a name="l01339"></a>01339       parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#8bec09f88dc7ab71730f50f54bca225e" title="zenith angle in radian">za</a>*180/M_PI, (parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#9816d084ed9a1126c1edbcf2f38955f6" title="randomize wind direction">wdrand</a>?<span class="stringliteral">""</span>:<span class="stringliteral">" not"</span>));
<a name="l01340"></a>01340     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#f377ac265c4e8778949386b5c78c9ba6" title="number of phase screens">nps</a>&gt;1 &amp;&amp; theta0z*206265&gt;4){
<a name="l01341"></a>01341     warning(<span class="stringliteral">"Atmosphere theta0 maybe wrong\n"</span>);
<a name="l01342"></a>01342     }
<a name="l01343"></a>01343     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ips=0; ips&lt;parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#f377ac265c4e8778949386b5c78c9ba6" title="number of phase screens">nps</a>; ips++){
<a name="l01344"></a>01344     info2(<span class="stringliteral">"layer %d: ht= %6.0f m, wt= %5.3f, ws= %4.1f m/s\n"</span>,
<a name="l01345"></a>01345           ips,parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#59642a891abc1d24aaeee4521a82c91b" title="height of each layer">ht</a>[ips],parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#d539b2f97fd31f5e5dc999b852b71228" title="weight of each layer (relative strength of )">wt</a>[ips],parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#a9a86b3cc0c73d0d27cbad43f9706108" title="wind speed of each layer">ws</a>[ips]);
<a name="l01346"></a>01346     }
<a name="l01347"></a>01347     info2(<span class="stringliteral">"\033[0;32mTomography\033[0;0m: r0=%gm l0=%gm "</span>
<a name="l01348"></a>01348       <span class="stringliteral">"ZA is %g deg. %d layers.%s\n"</span>, 
<a name="l01349"></a>01349       parms-&gt;<a class="code" href="structPARMS__T.html#654d89a9becf3ea9e32d11e470416f7c" title="information about reconstructed atm">atmr</a>.<a class="code" href="structATMR__CFG__T.html#26e119edbff7cfa6dfbd397181fde2ac" title="derived from r0z for zenith angle za">r0</a>, parms-&gt;<a class="code" href="structPARMS__T.html#654d89a9becf3ea9e32d11e470416f7c" title="information about reconstructed atm">atmr</a>.<a class="code" href="structATMR__CFG__T.html#a1183e41c8d866fc77dfc08b5b229684" title="outer scale">l0</a>,  
<a name="l01350"></a>01350       parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#8bec09f88dc7ab71730f50f54bca225e" title="zenith angle in radian">za</a>*180/M_PI, 
<a name="l01351"></a>01351       parms-&gt;<a class="code" href="structPARMS__T.html#654d89a9becf3ea9e32d11e470416f7c" title="information about reconstructed atm">atmr</a>.<a class="code" href="structATMR__CFG__T.html#14584f027f0a847b43f47fbbf53e6324" title="number of phase screens">nps</a>,(parms-&gt;<a class="code" href="structPARMS__T.html#654d89a9becf3ea9e32d11e470416f7c" title="information about reconstructed atm">atmr</a>.<a class="code" href="structATMR__CFG__T.html#e0ec245d13404e08afcb1c4670f54348" title="use cone coordinate">cone</a>?<span class="stringliteral">" use cone coordinate."</span>:<span class="stringliteral">""</span>));
<a name="l01352"></a>01352   
<a name="l01353"></a>01353     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ips=0; ips&lt;parms-&gt;<a class="code" href="structPARMS__T.html#654d89a9becf3ea9e32d11e470416f7c" title="information about reconstructed atm">atmr</a>.<a class="code" href="structATMR__CFG__T.html#14584f027f0a847b43f47fbbf53e6324" title="number of phase screens">nps</a>; ips++){
<a name="l01354"></a>01354     info2(<span class="stringliteral">"layer %d: ht= %6.0f m, wt= %5.3f\n"</span>,
<a name="l01355"></a>01355           ips,parms-&gt;<a class="code" href="structPARMS__T.html#654d89a9becf3ea9e32d11e470416f7c" title="information about reconstructed atm">atmr</a>.<a class="code" href="structATMR__CFG__T.html#c2d70c6f4dd690896de2145333728abc" title="height of each layer">ht</a>[ips],parms-&gt;<a class="code" href="structPARMS__T.html#654d89a9becf3ea9e32d11e470416f7c" title="information about reconstructed atm">atmr</a>.<a class="code" href="structATMR__CFG__T.html#a49819f62905b8043d11d4a2fe512bfa" title="weight of each layer (relative strength of )">wt</a>[ips]);
<a name="l01356"></a>01356     }
<a name="l01357"></a>01357     info2(<span class="stringliteral">"\033[0;32mThere are %d powfs\033[0;0m\n"</span>, parms-&gt;<a class="code" href="structPARMS__T.html#184dc967ffbedc29f2d48cd49889ddd2" title="Number of wfs types.">npowfs</a>);
<a name="l01358"></a>01358     <span class="keywordflow">for</span>(i=0; i&lt;parms-&gt;<a class="code" href="structPARMS__T.html#184dc967ffbedc29f2d48cd49889ddd2" title="Number of wfs types.">npowfs</a>; i++){
<a name="l01359"></a>01359     info2(<span class="stringliteral">"powfs %d: Order %2d, %sGS at %3.3g km. Thres %g%%"</span>,
<a name="l01360"></a>01360           i,parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[i].<a class="code" href="structPOWFS__CFG__T.html#27c7dcb36cf4ff0b070eab1b80491266" title="order of wavefront sensing along one dimension.">order</a>, (parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[i].<a class="code" href="structPOWFS__CFG__T.html#13e13c12137584448baeae372526550e" title="configuration for LLT">llt</a>?<span class="stringliteral">"L"</span>:<span class="stringliteral">"N"</span>),
<a name="l01361"></a>01361           parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[i].<a class="code" href="structPOWFS__CFG__T.html#3b65158c197ddc07b117b5f8b1aa567b" title="height of guide star">hs</a>/1000,parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[i].<a class="code" href="structPOWFS__CFG__T.html#97262ee0e2c8b1200594b70cd28b0325" title="subaperture area (normalized) threshold to drop subaperture.">saat</a>*100);
<a name="l01362"></a>01362     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[i].<a class="code" href="structPOWFS__CFG__T.html#979789ab45a1f87cf251469dbedebe00" title="tip/tilt removal flag.">trs</a>){
<a name="l01363"></a>01363         info2(<span class="stringliteral">"\033[0;31m Tip/tilt is removed.\033[0;0m"</span>);
<a name="l01364"></a>01364     }
<a name="l01365"></a>01365     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[i].<a class="code" href="structPOWFS__CFG__T.html#4f79eb8e4c1f3ad39eebeeb845bdc7d5" title="differential focus removal flag.">dfrs</a>){
<a name="l01366"></a>01366         info2(<span class="stringliteral">"\033[0;31m Diff focus is removed.\033[0;0m"</span>);
<a name="l01367"></a>01367         <span class="keywordflow">if</span>(!parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[i].<a class="code" href="structPOWFS__CFG__T.html#649a628036ca2785673990cc5af15c13" title="whether having llt.">hasllt</a>){
<a name="l01368"></a>01368         warning(<span class="stringliteral">"\n\ndfrs=1, but this powfs doesn't have LLT!\n\n"</span>);
<a name="l01369"></a>01369         }
<a name="l01370"></a>01370     }
<a name="l01371"></a>01371     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[i].<a class="code" href="structPOWFS__CFG__T.html#4094009000b266064441565ba5f02407" title="pixel bluring due to leakage.">pixblur</a>&gt;1.e-12){
<a name="l01372"></a>01372         info2(<span class="stringliteral">"\033[0;31m Pixel is blurred by %g.\033[0;0m"</span>, parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[i].<a class="code" href="structPOWFS__CFG__T.html#4094009000b266064441565ba5f02407" title="pixel bluring due to leakage.">pixblur</a>);
<a name="l01373"></a>01373     }
<a name="l01374"></a>01374     info2(<span class="stringliteral">"\n"</span>);
<a name="l01375"></a>01375     info2(<span class="stringliteral">"    CCD image is %dx%d @ %gmas, %gHz, "</span>, 
<a name="l01376"></a>01376           (parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[i].<a class="code" href="structPOWFS__CFG__T.html#beacabf44ba95b84fa2ec6b4460f5364" title="number of detector pixels along radial direction if radial CCD">radpix</a>?parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[i].<a class="code" href="structPOWFS__CFG__T.html#beacabf44ba95b84fa2ec6b4460f5364" title="number of detector pixels along radial direction if radial CCD">radpix</a>:parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[i].<a class="code" href="structPOWFS__CFG__T.html#38299ac6010a75cf1c8132217746890e" title="number of detector pixels along x/y or azimuthal if radial CCD.">pixpsa</a>), 
<a name="l01377"></a>01377           parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[i].<a class="code" href="structPOWFS__CFG__T.html#38299ac6010a75cf1c8132217746890e" title="number of detector pixels along x/y or azimuthal if radial CCD.">pixpsa</a>, parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[i].<a class="code" href="structPOWFS__CFG__T.html#adf117b796aef86ac0b1759f81ad59fd" title="size of pixel pitch along x or y in radian">pixtheta</a>*206265000,
<a name="l01378"></a>01378          1./parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#345f9deab3e2b21f28284e29732af51e" title="sampling period.">dt</a>/parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[i].<a class="code" href="structPOWFS__CFG__T.html#998a10ce3a6ac1154b764e31bc2e9470" title="ratio of sample period over fast loop (LGS)">dtrat</a>);
<a name="l01379"></a>01379     info2(<span class="stringliteral">"wvl: ["</span>);
<a name="l01380"></a>01380     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iwvl=0; iwvl&lt;parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[i].<a class="code" href="structPOWFS__CFG__T.html#6e5b056212ee8f0d6c64d447b87f19e7" title="Number of wavelength.">nwvl</a>; iwvl++){
<a name="l01381"></a>01381         info2(<span class="stringliteral">" %g"</span>,parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[i].<a class="code" href="structPOWFS__CFG__T.html#086be0f3919fffb2809d891e895bab83" title="list of wavelength">wvl</a>[iwvl]);
<a name="l01382"></a>01382     }
<a name="l01383"></a>01383     info2(<span class="stringliteral">"]\n"</span>);
<a name="l01384"></a>01384     info2(<span class="stringliteral">"    %s in reconstruction. "</span>, 
<a name="l01385"></a>01385           parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[i].<a class="code" href="structPOWFS__CFG__T.html#7d2eaa30681d91e3267fe953462270c4" title="wfs type if not using physical optics in simulation.">gtype_recon</a>==0?<span class="stringliteral">"Gtilt"</span>:<span class="stringliteral">"Ztilt"</span>);
<a name="l01386"></a>01386     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[i].<a class="code" href="structPOWFS__CFG__T.html#97585440f1dc5d79451e775697d52452" title="frames to start using physical optics.">phystep</a>&gt;-1){
<a name="l01387"></a>01387         info2(<span class="stringliteral">"Physical optics start at %d with '%s' %s"</span>,
<a name="l01388"></a>01388           parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[i].<a class="code" href="structPOWFS__CFG__T.html#97585440f1dc5d79451e775697d52452" title="frames to start using physical optics.">phystep</a>, 
<a name="l01389"></a>01389           phytype[parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[i].<a class="code" href="structPOWFS__CFG__T.html#bd9d4d4a65743daf24311e58bc91fc67" title="physical optics type for simulation.">phytypesim</a>-1],
<a name="l01390"></a>01390           parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[i].<a class="code" href="structPOWFS__CFG__T.html#2955dfacba62c468c7cc4028439c6eee" title="scale subaperture image to have the same intensity as i0.">mtchscl</a>?<span class="stringliteral">"scaled"</span>:<span class="stringliteral">""</span>);
<a name="l01391"></a>01391     }<span class="keywordflow">else</span>{
<a name="l01392"></a>01392         info2(<span class="stringliteral">"Geomtric optics uses %s "</span>,
<a name="l01393"></a>01393           parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[i].<a class="code" href="structPOWFS__CFG__T.html#129c1dda529b641aac48415a110235b7" title="wfs type if not using physical optics in reconstruction.">gtype_sim</a>==0?<span class="stringliteral">"gtilt"</span>:<span class="stringliteral">"ztilt"</span>);
<a name="l01394"></a>01394     }
<a name="l01395"></a>01395     
<a name="l01396"></a>01396     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[i].<a class="code" href="structPOWFS__CFG__T.html#df2e5e35af169d9d5e702ef4c42b7163" title="noisy or not during *simulation*">noisy</a>){
<a name="l01397"></a>01397         info2(<span class="stringliteral">"\033[0;32m(noisy)\033[0;0m\n"</span>);
<a name="l01398"></a>01398     }<span class="keywordflow">else</span>{
<a name="l01399"></a>01399         info2(<span class="stringliteral">"\033[0;31m(noise free)\033[0;0m\n"</span>);
<a name="l01400"></a>01400     }
<a name="l01401"></a>01401     info2(<span class="stringliteral">"wvl: ["</span>);
<a name="l01402"></a>01402     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iwvl=0; iwvl&lt;parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[i].<a class="code" href="structPOWFS__CFG__T.html#6e5b056212ee8f0d6c64d447b87f19e7" title="Number of wavelength.">nwvl</a>; iwvl++){
<a name="l01403"></a>01403         info2(<span class="stringliteral">" %g"</span>,parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[i].<a class="code" href="structPOWFS__CFG__T.html#086be0f3919fffb2809d891e895bab83" title="list of wavelength">wvl</a>[iwvl]);
<a name="l01404"></a>01404     }
<a name="l01405"></a>01405     info2(<span class="stringliteral">"]\n"</span>);
<a name="l01406"></a>01406     
<a name="l01407"></a>01407     }
<a name="l01408"></a>01408     info2(<span class="stringliteral">"\033[0;32mThere are %d wfs\033[0;0m\n"</span>, parms-&gt;<a class="code" href="structPARMS__T.html#b6833beca5a29a5936d41ac934e66d24" title="Number of wfs.">nwfs</a>);
<a name="l01409"></a>01409     <span class="keywordflow">for</span>(i=0; i&lt;parms-&gt;<a class="code" href="structPARMS__T.html#b6833beca5a29a5936d41ac934e66d24" title="Number of wfs.">nwfs</a>; i++){
<a name="l01410"></a>01410     info2(<span class="stringliteral">"wfs %d: type is %d, at (%7.2f, %7.2f) arcsec\n"</span>,
<a name="l01411"></a>01411          i,parms-&gt;<a class="code" href="structPARMS__T.html#19246602a8b7d0261d79416e281d6ca4" title="Array of wfs.">wfs</a>[i].<a class="code" href="structWFS__CFG__T.html#c6eeef5eba99a8dea64c1692bb60f5ff" title="powfs type">powfs</a>,parms-&gt;<a class="code" href="structPARMS__T.html#19246602a8b7d0261d79416e281d6ca4" title="Array of wfs.">wfs</a>[i].<a class="code" href="structWFS__CFG__T.html#ebd74c669d9a3f057f4d4b4a43eda163" title="x direction">thetax</a>*206265,
<a name="l01412"></a>01412          parms-&gt;<a class="code" href="structPARMS__T.html#19246602a8b7d0261d79416e281d6ca4" title="Array of wfs.">wfs</a>[i].<a class="code" href="structWFS__CFG__T.html#3344f596561dfaf1d9d197112e2cefbd" title="y direction">thetay</a>*206265);
<a name="l01413"></a>01413     <span class="keywordflow">if</span>(fabs(parms-&gt;<a class="code" href="structPARMS__T.html#19246602a8b7d0261d79416e281d6ca4" title="Array of wfs.">wfs</a>[i].<a class="code" href="structWFS__CFG__T.html#ebd74c669d9a3f057f4d4b4a43eda163" title="x direction">thetax</a>)&gt;1 || fabs(parms-&gt;<a class="code" href="structPARMS__T.html#19246602a8b7d0261d79416e281d6ca4" title="Array of wfs.">wfs</a>[i].<a class="code" href="structWFS__CFG__T.html#3344f596561dfaf1d9d197112e2cefbd" title="y direction">thetay</a>)&gt;1){
<a name="l01414"></a>01414         error(<span class="stringliteral">"wfs thetax or thetay is too large\n"</span>);
<a name="l01415"></a>01415     }
<a name="l01416"></a>01416     }
<a name="l01417"></a>01417     info2(<span class="stringliteral">"\033[0;32mThere are %d DMs\033[0;0m\n"</span>,parms-&gt;<a class="code" href="structPARMS__T.html#6492c3b89e0243fe23d88ebedb044b0e" title="Number of DMs.">ndm</a>);
<a name="l01418"></a>01418     <span class="keywordflow">for</span>(i=0; i&lt;parms-&gt;<a class="code" href="structPARMS__T.html#6492c3b89e0243fe23d88ebedb044b0e" title="Number of DMs.">ndm</a>; i++){
<a name="l01419"></a>01419     info2(<span class="stringliteral">"DM %d: at %4gkm, actuator spacing %gm, offset %3g, with %f micron stroke.\n"</span>,
<a name="l01420"></a>01420           i, parms-&gt;<a class="code" href="structPARMS__T.html#c2f69a649e1ac2d2e55e790ac067d46c" title="Array of DM.">dm</a>[i].<a class="code" href="structDM__CFG__T.html#bf49acebd195a6705ddf3ed1c3f662ea" title="height conjugation range">ht</a>/1000, parms-&gt;<a class="code" href="structPARMS__T.html#c2f69a649e1ac2d2e55e790ac067d46c" title="Array of DM.">dm</a>[i].<a class="code" href="structDM__CFG__T.html#094b4f74b4260b1fac411e66d352146a" title="actuator separation">dx</a>,
<a name="l01421"></a>01421           parms-&gt;<a class="code" href="structPARMS__T.html#c2f69a649e1ac2d2e55e790ac067d46c" title="Array of DM.">dm</a>[i].<a class="code" href="structDM__CFG__T.html#aaf7ff0a674b9a13c9c4bd8158a500e4" title="Center-most actuator offset from origin=0 means there is a act on center.">offset</a>, 
<a name="l01422"></a>01422           parms-&gt;<a class="code" href="structPARMS__T.html#c2f69a649e1ac2d2e55e790ac067d46c" title="Array of DM.">dm</a>[i].<a class="code" href="structDM__CFG__T.html#42395a1163463214a0eaae2400ccdcc1" title="Stroke of DM.">stroke</a>*1e6);
<a name="l01423"></a>01423     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#c2f69a649e1ac2d2e55e790ac067d46c" title="Array of DM.">dm</a>[i].<a class="code" href="structDM__CFG__T.html#cf71d816fd769fe830d2e03f82c28b12" title="use cubic spline.">cubic</a>){
<a name="l01424"></a>01424         info2(<span class="stringliteral">"     Normalized cubic influence function with inter-actuator coupling of %g\n"</span>,
<a name="l01425"></a>01425           parms-&gt;<a class="code" href="structPARMS__T.html#c2f69a649e1ac2d2e55e790ac067d46c" title="Array of DM.">dm</a>[i].<a class="code" href="structDM__CFG__T.html#fca1c9ed9b0f9ce5a25147eb5906947b" title="Inter-Actuator Coupling coefficient.">iac</a>);
<a name="l01426"></a>01426     }<span class="keywordflow">else</span>{
<a name="l01427"></a>01427         info2(<span class="stringliteral">"     Bilinear influence function.\n"</span>);
<a name="l01428"></a>01428     }
<a name="l01429"></a>01429     }
<a name="l01430"></a>01430     info2(<span class="stringliteral">"\033[0;32mTomography\033[0;0m is using "</span>);
<a name="l01431"></a>01431     <span class="keywordflow">switch</span>(parms-&gt;<a class="code" href="structPARMS__T.html#97445ce9015e982a22199e400b2271e4" title="tomography parameters">tomo</a>.<a class="code" href="structTOMO__CFG__T.html#78278efa786e9d15e8de3a3af9525101" title="Tomography algorithm to solve the linear equation.">alg</a>){
<a name="l01432"></a>01432     <span class="keywordflow">case</span> 0:
<a name="l01433"></a>01433     info2(<span class="stringliteral">"Cholesky back solve "</span>);
<a name="l01434"></a>01434     <span class="keywordflow">break</span>;
<a name="l01435"></a>01435     <span class="keywordflow">case</span> 1:
<a name="l01436"></a>01436     info2(<span class="stringliteral">"CG, with %s preconditioner, \033[0;32m%d\033[0;0m iterations, "</span>,
<a name="l01437"></a>01437           tomo_precond[parms-&gt;<a class="code" href="structPARMS__T.html#97445ce9015e982a22199e400b2271e4" title="tomography parameters">tomo</a>.<a class="code" href="structTOMO__CFG__T.html#55e4197464d1963dbff66662ec83f4b1" title="Tomography preconditioner.">precond</a>], parms-&gt;<a class="code" href="structPARMS__T.html#97445ce9015e982a22199e400b2271e4" title="tomography parameters">tomo</a>.<a class="code" href="structTOMO__CFG__T.html#51f34eccc5590bde667bc522829c5be4" title="max iterations.">maxit</a>);
<a name="l01438"></a>01438     <span class="keywordflow">break</span>;
<a name="l01439"></a>01439     <span class="keywordflow">default</span>:
<a name="l01440"></a>01440     error(<span class="stringliteral">"Invalid\n"</span>);
<a name="l01441"></a>01441     }
<a name="l01442"></a>01442     <span class="keywordflow">switch</span>(parms-&gt;<a class="code" href="structPARMS__T.html#97445ce9015e982a22199e400b2271e4" title="tomography parameters">tomo</a>.<a class="code" href="structTOMO__CFG__T.html#0b1183e68cda2c750bc3aa9b23648685" title="split tomography type.">split</a>){
<a name="l01443"></a>01443     <span class="keywordflow">case</span> 0:
<a name="l01444"></a>01444     info2(<span class="stringliteral">" integrated tomo.\n"</span>);<span class="keywordflow">break</span>;
<a name="l01445"></a>01445     <span class="keywordflow">case</span> 1:
<a name="l01446"></a>01446     info2(<span class="stringliteral">" ad hoc split tomo.\n"</span>); <span class="keywordflow">break</span>;
<a name="l01447"></a>01447     <span class="keywordflow">case</span> 2:
<a name="l01448"></a>01448     info2(<span class="stringliteral">" minimum variance split tomo\n"</span>); <span class="keywordflow">break</span>;
<a name="l01449"></a>01449     <span class="keywordflow">default</span>:
<a name="l01450"></a>01450     error(<span class="stringliteral">" Invalid\n"</span>);
<a name="l01451"></a>01451     }
<a name="l01452"></a>01452     <span class="keywordflow">switch</span>(parms-&gt;<a class="code" href="structPARMS__T.html#3b8ffe6fa411ea23ef7c1383fe61abbf" title="DM fit parameters.">fit</a>.<a class="code" href="structFIT__CFG__T.html#816490fc8c78b35c2fcd85934d7972bb" title="Fitting algorithm to solve the linear equation.">alg</a>){
<a name="l01453"></a>01453     <span class="keywordflow">case</span> 0:
<a name="l01454"></a>01454     info2(<span class="stringliteral">"Cholesky back solve"</span>);
<a name="l01455"></a>01455     <span class="keywordflow">break</span>;
<a name="l01456"></a>01456     <span class="keywordflow">case</span> 1:
<a name="l01457"></a>01457     info2(<span class="stringliteral">"CG, with %s preconditioner, \033[0;32m%d\033[0;0m iterations, "</span>,
<a name="l01458"></a>01458           tomo_precond[parms-&gt;<a class="code" href="structPARMS__T.html#3b8ffe6fa411ea23ef7c1383fe61abbf" title="DM fit parameters.">fit</a>.<a class="code" href="structFIT__CFG__T.html#8805cf375fb1262b2fd1ae00cd3d5183" title="Preconditioner.">precond</a>], parms-&gt;<a class="code" href="structPARMS__T.html#3b8ffe6fa411ea23ef7c1383fe61abbf" title="DM fit parameters.">fit</a>.<a class="code" href="structFIT__CFG__T.html#4533eef0ce553366cefd0e2d02de4b2d" title="max iterations.">maxit</a>);
<a name="l01459"></a>01459     <span class="keywordflow">break</span>;
<a name="l01460"></a>01460     <span class="keywordflow">default</span>:
<a name="l01461"></a>01461     error(<span class="stringliteral">"Invalid"</span>);
<a name="l01462"></a>01462     }
<a name="l01463"></a>01463     info2(<span class="stringliteral">"\033[0;32mSimulation\033[0;0m start at step %d, end at step %d, "</span>
<a name="l01464"></a>01464      <span class="stringliteral">"with time step 1/%gs, %s loop \n"</span>, 
<a name="l01465"></a>01465       parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#9e65d6a0d29a750075158ff470386f5e" title="time step to start simulation.">start</a>, parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#7939a4003b5c376eb09702a8a1572ce5" title="time step to stop simulation.">end</a>, 1./parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#345f9deab3e2b21f28284e29732af51e" title="sampling period.">dt</a>, 
<a name="l01466"></a>01466       closeloop[parms-&gt;<a class="code" href="structPARMS__T.html#fc4942859637870067cc23401f5eeedc" title="Simulation information.">sim</a>.<a class="code" href="structSIM__CFG__T.html#0408bb89e89669682cba86f7fb98b2dc" title="closed loop or open loop">closeloop</a>]);
<a name="l01467"></a>01467     info2(<span class="stringliteral">"\033[0;32mThere are %d fit directions\033[0;0m\n"</span>, parms-&gt;<a class="code" href="structPARMS__T.html#3b8ffe6fa411ea23ef7c1383fe61abbf" title="DM fit parameters.">fit</a>.<a class="code" href="structFIT__CFG__T.html#6e582e718e6c2418d8b9238fdcdfcb9d" title="Number of DM fit directions.">nfit</a>);
<a name="l01468"></a>01468     <span class="keywordflow">for</span>(i=0; i&lt;parms-&gt;<a class="code" href="structPARMS__T.html#3b8ffe6fa411ea23ef7c1383fe61abbf" title="DM fit parameters.">fit</a>.<a class="code" href="structFIT__CFG__T.html#6e582e718e6c2418d8b9238fdcdfcb9d" title="Number of DM fit directions.">nfit</a>; i++){
<a name="l01469"></a>01469     info2(<span class="stringliteral">"Fit %d: Fit  wt is %5.3f, at (%7.2f, %7.2f) arcsec\n"</span>,
<a name="l01470"></a>01470          i,parms-&gt;<a class="code" href="structPARMS__T.html#3b8ffe6fa411ea23ef7c1383fe61abbf" title="DM fit parameters.">fit</a>.<a class="code" href="structFIT__CFG__T.html#e921bb24d3f1439f4023b4009a004cd0" title="weight of each direction">wt</a>[i],parms-&gt;<a class="code" href="structPARMS__T.html#3b8ffe6fa411ea23ef7c1383fe61abbf" title="DM fit parameters.">fit</a>.<a class="code" href="structFIT__CFG__T.html#e546272f69aa60a0f5c435d438641001" title="x Coordinate of DM fitting directions.">thetax</a>[i]*206265, 
<a name="l01471"></a>01471          parms-&gt;<a class="code" href="structPARMS__T.html#3b8ffe6fa411ea23ef7c1383fe61abbf" title="DM fit parameters.">fit</a>.<a class="code" href="structFIT__CFG__T.html#4c47b74e14e1521755410a9183d3ef6c" title="y Coordinate of DM fitting directions.">thetay</a>[i]*206265);
<a name="l01472"></a>01472     <span class="keywordflow">if</span>(fabs(parms-&gt;<a class="code" href="structPARMS__T.html#3b8ffe6fa411ea23ef7c1383fe61abbf" title="DM fit parameters.">fit</a>.<a class="code" href="structFIT__CFG__T.html#e546272f69aa60a0f5c435d438641001" title="x Coordinate of DM fitting directions.">thetax</a>[i])&gt;1 || fabs(parms-&gt;<a class="code" href="structPARMS__T.html#3b8ffe6fa411ea23ef7c1383fe61abbf" title="DM fit parameters.">fit</a>.<a class="code" href="structFIT__CFG__T.html#4c47b74e14e1521755410a9183d3ef6c" title="y Coordinate of DM fitting directions.">thetay</a>[i])&gt;1){
<a name="l01473"></a>01473         error(<span class="stringliteral">"fit thetax or thetay is too large\n"</span>);
<a name="l01474"></a>01474     }
<a name="l01475"></a>01475     }
<a name="l01476"></a>01476     info2(<span class="stringliteral">"\033[0;32mThere are %d evaluation directions\033[0;0m\n"</span>, parms-&gt;<a class="code" href="structPARMS__T.html#4121e9dc728705be0ad2c58dcaf4cd75" title="Performance evaluation parameters.">evl</a>.<a class="code" href="structEVL__CFG__T.html#9f76679213a98ac7e3eb0fe92d645799" title="Number of evaluation directions.">nevl</a>);
<a name="l01477"></a>01477     <span class="keywordflow">for</span>(i=0; i&lt;parms-&gt;<a class="code" href="structPARMS__T.html#4121e9dc728705be0ad2c58dcaf4cd75" title="Performance evaluation parameters.">evl</a>.<a class="code" href="structEVL__CFG__T.html#9f76679213a98ac7e3eb0fe92d645799" title="Number of evaluation directions.">nevl</a>; i++){
<a name="l01478"></a>01478     info2(<span class="stringliteral">"Evl %d: Eval wt is %5.3f, at (%7.2f, %7.2f) arcsec\n"</span>,
<a name="l01479"></a>01479          i,parms-&gt;<a class="code" href="structPARMS__T.html#4121e9dc728705be0ad2c58dcaf4cd75" title="Performance evaluation parameters.">evl</a>.<a class="code" href="structEVL__CFG__T.html#1099d0a05e59fced8655347bbb50b9c8" title="weight of each direction">wt</a>[i],parms-&gt;<a class="code" href="structPARMS__T.html#4121e9dc728705be0ad2c58dcaf4cd75" title="Performance evaluation parameters.">evl</a>.<a class="code" href="structEVL__CFG__T.html#dcb390bcffd7629411575788c77de50e" title="x Coordinate of evaluation directions">thetax</a>[i]*206265, 
<a name="l01480"></a>01480          parms-&gt;<a class="code" href="structPARMS__T.html#4121e9dc728705be0ad2c58dcaf4cd75" title="Performance evaluation parameters.">evl</a>.<a class="code" href="structEVL__CFG__T.html#76b3e6506ff40743e8e28ad6aa36afa4" title="y Coordinate of evaluation directions">thetay</a>[i]*206265);
<a name="l01481"></a>01481     <span class="keywordflow">if</span>(fabs(parms-&gt;<a class="code" href="structPARMS__T.html#4121e9dc728705be0ad2c58dcaf4cd75" title="Performance evaluation parameters.">evl</a>.<a class="code" href="structEVL__CFG__T.html#dcb390bcffd7629411575788c77de50e" title="x Coordinate of evaluation directions">thetax</a>[i])&gt;1 || fabs(parms-&gt;<a class="code" href="structPARMS__T.html#4121e9dc728705be0ad2c58dcaf4cd75" title="Performance evaluation parameters.">evl</a>.<a class="code" href="structEVL__CFG__T.html#76b3e6506ff40743e8e28ad6aa36afa4" title="y Coordinate of evaluation directions">thetay</a>[i])&gt;1){
<a name="l01482"></a>01482         error(<span class="stringliteral">"evl thetax or thetay is too large\n"</span>);
<a name="l01483"></a>01483     }
<a name="l01484"></a>01484     }
<a name="l01485"></a>01485     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#8d13a796ed190abb42f190c74d52b5b1" title="Specify what to plot during simulation.">plot</a>.<a class="code" href="structPLOT__CFG__T.html#2208400c2f1150a63417cd38f3e01f53" title="Plot various information in setup process.">setup</a>){
<a name="l01486"></a>01486     <span class="keywordtype">double</span> totfov=120;<span class="comment">//total fov</span>
<a name="l01487"></a>01487     <a class="code" href="maos_2utils_8c.html#17f83b9d00296996ebdaff0335ef4340" title="ploted all the different beam directions as points.">plotdir</a>(<span class="stringliteral">"FoV"</span>,parms,totfov,<span class="stringliteral">"fov"</span>);<span class="comment">//plot wfs/evaluation direction</span>
<a name="l01488"></a>01488     }
<a name="l01489"></a>01489 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="6a205952ab13986513b3ee36e1765a14"></a><!-- doxytag: member="setup_parms.c::check_parms" ref="6a205952ab13986513b3ee36e1765a14" args="(const PARMS_T *parms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void check_parms           </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>parms</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Limited sanity check of the parameters to prevent obvious mistakes. 
<p>
<div class="fragment"><pre class="fragment"><a name="l01493"></a>01493                                              {
<a name="l01494"></a>01494     <span class="comment">/*</span>
<a name="l01495"></a>01495 <span class="comment">      if(fabs(parms-&gt;atmr.dx[0]-parms-&gt;aper.dxr)&gt;1.e-12){</span>
<a name="l01496"></a>01496 <span class="comment">      warning("Reconstructed atmosphere grid is %g, "</span>
<a name="l01497"></a>01497 <span class="comment">      "aperture PLOC sampling is %g. They don't match\n",</span>
<a name="l01498"></a>01498 <span class="comment">      parms-&gt;atmr.dx[0],parms-&gt;aper.dxr);</span>
<a name="l01499"></a>01499 <span class="comment">      }*/</span>
<a name="l01500"></a>01500     <span class="keywordtype">int</span> i;
<a name="l01501"></a>01501     <span class="keywordflow">for</span>(i=0;i&lt;parms-&gt;<a class="code" href="structPARMS__T.html#184dc967ffbedc29f2d48cd49889ddd2" title="Number of wfs types.">npowfs</a>;i++){
<a name="l01502"></a>01502     <span class="keywordflow">if</span>(fabs(parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#b47d65c892430196c01fa5c05c802608" title="sampling of turbulence screens">dx</a>-parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[i].<a class="code" href="structPOWFS__CFG__T.html#d4d9c6fffdd734c54ceb97cb450b772a" title="sampling of opd points in each subaperture.">dx</a>)&gt;1.e-12){
<a name="l01503"></a>01503         warning2(<span class="stringliteral">"Powfs %d: The grid sampling 1/%gm doesn't match "</span>
<a name="l01504"></a>01504              <span class="stringliteral">"atmosphere sampling 1/%gm\n"</span>, i,
<a name="l01505"></a>01505             1./parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[i].<a class="code" href="structPOWFS__CFG__T.html#d4d9c6fffdd734c54ceb97cb450b772a" title="sampling of opd points in each subaperture.">dx</a>,1./parms-&gt;<a class="code" href="structPARMS__T.html#cd5a6a6293cfd185c782e7d8b14365ec" title="atmospheric parameters">atm</a>.<a class="code" href="structATM__CFG__T.html#b47d65c892430196c01fa5c05c802608" title="sampling of turbulence screens">dx</a>);
<a name="l01506"></a>01506     }
<a name="l01507"></a>01507     }
<a name="l01508"></a>01508     <span class="keywordtype">int</span> hi_found=0;
<a name="l01509"></a>01509     <span class="keywordtype">int</span> lo_found=0;
<a name="l01510"></a>01510     <span class="keywordtype">int</span> hi_trs=0;
<a name="l01511"></a>01511     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ipowfs=0; ipowfs&lt;parms-&gt;<a class="code" href="structPARMS__T.html#184dc967ffbedc29f2d48cd49889ddd2" title="Number of wfs types.">npowfs</a>; ipowfs++){
<a name="l01512"></a>01512     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#649a628036ca2785673990cc5af15c13" title="whether having llt.">hasllt</a>){
<a name="l01513"></a>01513         <span class="keywordflow">if</span>(isinf(parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#3b65158c197ddc07b117b5f8b1aa567b" title="height of guide star">hs</a>)){
<a name="l01514"></a>01514         warning(<span class="stringliteral">"powfs with llt should have finite hs\n"</span>);
<a name="l01515"></a>01515         }
<a name="l01516"></a>01516         <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#979789ab45a1f87cf251469dbedebe00" title="tip/tilt removal flag.">trs</a>==0){
<a name="l01517"></a>01517         warning(<span class="stringliteral">"powfs with llt should have trs=1\n"</span>);
<a name="l01518"></a>01518         }
<a name="l01519"></a>01519     }<span class="keywordflow">else</span>{
<a name="l01520"></a>01520         <span class="keywordflow">if</span>(!isinf(parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#3b65158c197ddc07b117b5f8b1aa567b" title="height of guide star">hs</a>)){
<a name="l01521"></a>01521         warning(<span class="stringliteral">"powfs without llt should infinite hs\n"</span>);
<a name="l01522"></a>01522         }
<a name="l01523"></a>01523         <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#979789ab45a1f87cf251469dbedebe00" title="tip/tilt removal flag.">trs</a>==1){
<a name="l01524"></a>01524         warning(<span class="stringliteral">"powfs without llt should have trs=0\n"</span>);
<a name="l01525"></a>01525         }
<a name="l01526"></a>01526     }
<a name="l01527"></a>01527     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#0324889316992d35cd3e1e3df9d17382" title="whether this is a low order wfs.">lo</a>==0){
<a name="l01528"></a>01528         hi_found++;
<a name="l01529"></a>01529     }<span class="keywordflow">else</span>{
<a name="l01530"></a>01530         lo_found++;
<a name="l01531"></a>01531     }
<a name="l01532"></a>01532     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#979789ab45a1f87cf251469dbedebe00" title="tip/tilt removal flag.">trs</a>==1){
<a name="l01533"></a>01533         <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#5cfc96549c1047f9f39a888842cdef92" title="Array of wfs type.">powfs</a>[ipowfs].<a class="code" href="structPOWFS__CFG__T.html#0324889316992d35cd3e1e3df9d17382" title="whether this is a low order wfs.">lo</a>==1)
<a name="l01534"></a>01534         error(<span class="stringliteral">"Can not be both trs and lo\n"</span>);
<a name="l01535"></a>01535         hi_trs++;
<a name="l01536"></a>01536     }
<a name="l01537"></a>01537     }
<a name="l01538"></a>01538     <span class="keywordflow">if</span>(!hi_found || (hi_trs&gt;=hi_found &amp;&amp; lo_found==0)){
<a name="l01539"></a>01539     error(<span class="stringliteral">"No high order wfs found "</span>
<a name="l01540"></a>01540           <span class="stringliteral">"or trs wfs doesn't come with lo wfs\n"</span>);
<a name="l01541"></a>01541     }
<a name="l01542"></a>01542     <span class="keywordflow">for</span>(i=0; i&lt;parms-&gt;<a class="code" href="structPARMS__T.html#6492c3b89e0243fe23d88ebedb044b0e" title="Number of DMs.">ndm</a>; i++){
<a name="l01543"></a>01543     <span class="keywordflow">if</span>(!isinf(parms-&gt;<a class="code" href="structPARMS__T.html#c2f69a649e1ac2d2e55e790ac067d46c" title="Array of DM.">dm</a>[i].<a class="code" href="structDM__CFG__T.html#42395a1163463214a0eaae2400ccdcc1" title="Stroke of DM.">stroke</a>)){
<a name="l01544"></a>01544         <span class="keywordtype">double</span> strokemicron=parms-&gt;<a class="code" href="structPARMS__T.html#c2f69a649e1ac2d2e55e790ac067d46c" title="Array of DM.">dm</a>[i].<a class="code" href="structDM__CFG__T.html#42395a1163463214a0eaae2400ccdcc1" title="Stroke of DM.">stroke</a>*1e6;
<a name="l01545"></a>01545         <span class="keywordflow">if</span>(strokemicron&lt;1 || strokemicron&gt;50){
<a name="l01546"></a>01546         warning(<span class="stringliteral">"dm %d: stroke %g m is probably wrong\n"</span>,
<a name="l01547"></a>01547             i,parms-&gt;<a class="code" href="structPARMS__T.html#c2f69a649e1ac2d2e55e790ac067d46c" title="Array of DM.">dm</a>[i].<a class="code" href="structDM__CFG__T.html#42395a1163463214a0eaae2400ccdcc1" title="Stroke of DM.">stroke</a>);
<a name="l01548"></a>01548         }
<a name="l01549"></a>01549     }
<a name="l01550"></a>01550     }
<a name="l01551"></a>01551     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#4121e9dc728705be0ad2c58dcaf4cd75" title="Performance evaluation parameters.">evl</a>.<a class="code" href="structEVL__CFG__T.html#9204ffd6eaf3c92a575b306c4a401903" title="evaluate tomography performance.">tomo</a> &amp;&amp; parms-&gt;<a class="code" href="structPARMS__T.html#97445ce9015e982a22199e400b2271e4" title="tomography parameters">tomo</a>.<a class="code" href="structTOMO__CFG__T.html#0b1183e68cda2c750bc3aa9b23648685" title="split tomography type.">split</a>){
<a name="l01552"></a>01552     warning(<span class="stringliteral">"Evaluating tomography performance is best done with integrated tomography\n"</span>);
<a name="l01553"></a>01553     }
<a name="l01554"></a>01554     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#97445ce9015e982a22199e400b2271e4" title="tomography parameters">tomo</a>.<a class="code" href="structTOMO__CFG__T.html#78278efa786e9d15e8de3a3af9525101" title="Tomography algorithm to solve the linear equation.">alg</a>&lt;0 || parms-&gt;<a class="code" href="structPARMS__T.html#97445ce9015e982a22199e400b2271e4" title="tomography parameters">tomo</a>.<a class="code" href="structTOMO__CFG__T.html#78278efa786e9d15e8de3a3af9525101" title="Tomography algorithm to solve the linear equation.">alg</a>&gt;1){
<a name="l01555"></a>01555     error(<span class="stringliteral">"parms-&gt;tomo.alg=%d is invalid\n"</span>, parms-&gt;<a class="code" href="structPARMS__T.html#97445ce9015e982a22199e400b2271e4" title="tomography parameters">tomo</a>.<a class="code" href="structTOMO__CFG__T.html#78278efa786e9d15e8de3a3af9525101" title="Tomography algorithm to solve the linear equation.">alg</a>);
<a name="l01556"></a>01556     }
<a name="l01557"></a>01557     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#3b8ffe6fa411ea23ef7c1383fe61abbf" title="DM fit parameters.">fit</a>.<a class="code" href="structFIT__CFG__T.html#816490fc8c78b35c2fcd85934d7972bb" title="Fitting algorithm to solve the linear equation.">alg</a>&lt;0 || parms-&gt;<a class="code" href="structPARMS__T.html#3b8ffe6fa411ea23ef7c1383fe61abbf" title="DM fit parameters.">fit</a>.<a class="code" href="structFIT__CFG__T.html#816490fc8c78b35c2fcd85934d7972bb" title="Fitting algorithm to solve the linear equation.">alg</a>&gt;1){
<a name="l01558"></a>01558     error(<span class="stringliteral">"parms-&gt;fit.alg=%d is invalid\n"</span>, parms-&gt;<a class="code" href="structPARMS__T.html#97445ce9015e982a22199e400b2271e4" title="tomography parameters">tomo</a>.<a class="code" href="structTOMO__CFG__T.html#78278efa786e9d15e8de3a3af9525101" title="Tomography algorithm to solve the linear equation.">alg</a>);
<a name="l01559"></a>01559     }
<a name="l01560"></a>01560     <span class="keywordflow">if</span>(parms-&gt;<a class="code" href="structPARMS__T.html#8fdfce1e68e018f54640c3d7214fcc33" title="Specify debugging parameters.">dbg</a>.<a class="code" href="structDBG__CFG__T.html#8c69a219924faa60ddf33137b2d35633" title="do DM fitting only, by replacing opdr with opdx.">fitonly</a>){
<a name="l01561"></a>01561 
<a name="l01562"></a>01562     }
<a name="l01563"></a>01563 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="21d63a1d0ee519d5d503183f6d0d5665"></a><!-- doxytag: member="setup_parms.c::setup_config" ref="21d63a1d0ee519d5d503183f6d0d5665" args="(ARG_T *arg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void setup_config           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structARG__T.html">ARG_T</a> *&nbsp;</td>
          <td class="paramname"> <em>arg</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Load embeded configuration files specified by config=file.conf. 
<p>
static void open_embeded_config(const char *type){ char *fn=readcfg_str("%s",type); open_config(fn,0); free(fn); } Read in .conf configurations files specified by command line. First it opens the master configuration file. nfiraos.conf if no -c switch is specified. Then it will open additional overriding .conf files supplied in the command line. These overiding .conf files should only contain already exited keys. <div class="fragment"><pre class="fragment"><a name="l01578"></a>01578                                    {
<a name="l01579"></a>01579     open_config(arg-&gt;<a class="code" href="structARG__T.html#989ce68b27a48e963ca257974c3e720d">conf</a>,0);<span class="comment">//main .conf file.</span>
<a name="l01580"></a>01580     
<a name="l01581"></a>01581     <span class="keywordflow">if</span>(arg-&gt;<a class="code" href="structARG__T.html#5a7a939d078b18f4adef274ea091a5b1" title="derived parameter marking the starting of .conf arguments">iconf</a>&lt;arg-&gt;<a class="code" href="structARG__T.html#7f6595d404dbfe24aef49eb09edb4b62" title="argument count">argc</a>){
<a name="l01582"></a>01582     <span class="keywordtype">char</span> fntmp[PATH_MAX];
<a name="l01583"></a>01583     snprintf(fntmp,PATH_MAX,<span class="stringliteral">"/tmp/maos_%ld.conf"</span>,(<span class="keywordtype">long</span>)getpid());
<a name="l01584"></a>01584     FILE *fptmp=fopen(fntmp,<span class="stringliteral">"w"</span>);
<a name="l01585"></a>01585     <span class="keywordtype">int</span> inline_conf=0;
<a name="l01586"></a>01586     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iconf=arg-&gt;<a class="code" href="structARG__T.html#5a7a939d078b18f4adef274ea091a5b1" title="derived parameter marking the starting of .conf arguments">iconf</a>; iconf&lt;arg-&gt;argc; iconf++){
<a name="l01587"></a>01587         <span class="keywordtype">char</span> *fno=arg-&gt;<a class="code" href="structARG__T.html#e0f7df18bc6ad14f2450a4af7713b670" title="Array of arguments.">argv</a>[iconf];
<a name="l01588"></a>01588         <span class="keywordflow">if</span>(index(fno,<span class="charliteral">'='</span>)){
<a name="l01589"></a>01589         inline_conf++;
<a name="l01590"></a>01590         fprintf(fptmp,<span class="stringliteral">"%s\n"</span>,fno);
<a name="l01591"></a>01591         }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(check_suffix(fno,<span class="stringliteral">".conf"</span>)){
<a name="l01592"></a>01592         open_config(fno,1);<span class="comment">/*1 means protected. will not be overriden by</span>
<a name="l01593"></a>01593 <span class="comment">                     base .conf's, but can be overriden by user</span>
<a name="l01594"></a>01594 <span class="comment">                     supplied options.*/</span>
<a name="l01595"></a>01595         }<span class="keywordflow">else</span>{
<a name="l01596"></a>01596         error(<span class="stringliteral">"Invalid command line option: %s\n"</span>,fno);
<a name="l01597"></a>01597         }
<a name="l01598"></a>01598     }
<a name="l01599"></a>01599     fclose(fptmp);
<a name="l01600"></a>01600     <span class="keywordflow">if</span>(inline_conf&gt;0){
<a name="l01601"></a>01601         open_config(fntmp,1);
<a name="l01602"></a>01602     }
<a name="l01603"></a>01603     <span class="keywordflow">if</span>(<span class="keyword">remove</span>(fntmp)){
<a name="l01604"></a>01604         perror(<span class="stringliteral">"remove"</span>);
<a name="l01605"></a>01605         warning(<span class="stringliteral">"Unable to remove file %s\n"</span>,fntmp);
<a name="l01606"></a>01606     }
<a name="l01607"></a>01607     }<span class="keywordflow">else</span>{
<a name="l01608"></a>01608     warning2(<span class="stringliteral">"No override file is used\n"</span>);
<a name="l01609"></a>01609     }
<a name="l01610"></a>01610 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="97bc282d28009f59b0b4e51013062588"></a><!-- doxytag: member="setup_parms.c::setup_parms" ref="97bc282d28009f59b0b4e51013062588" args="(ARG_T *arg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structPARMS__T.html">PARMS_T</a>* setup_parms           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structARG__T.html">ARG_T</a> *&nbsp;</td>
          <td class="paramname"> <em>arg</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This routine calles other routines in this file to setup the parms parameter struct parms and check for possible errors. 
<p>
parms is kept constant after returned from setup_parms. <div class="fragment"><pre class="fragment"><a name="l01615"></a>01615                                  {
<a name="l01616"></a>01616     <a class="code" href="maos_2setup__parms_8c.html#21d63a1d0ee519d5d503183f6d0d5665" title="Load embeded configuration files specified by config=file.conf.">setup_config</a>(arg);
<a name="l01617"></a>01617 
<a name="l01618"></a>01618     <a class="code" href="structPARMS__T.html" title="is a wrapper of all _CFG_T data types.">PARMS_T</a>* parms=calloc(1, <span class="keyword">sizeof</span>(<a class="code" href="structPARMS__T.html" title="is a wrapper of all _CFG_T data types.">PARMS_T</a>));
<a name="l01619"></a>01619     <a class="code" href="maos_2setup__parms_8c.html#1e298f863e10bdcb8f23abc5eab36a5a" title="Read in aperture definitions.">readcfg_aper</a>(parms);
<a name="l01620"></a>01620     <a class="code" href="maos_2setup__parms_8c.html#0e11886cea89f186fee8923def4794e6" title="Read in atmosphere parameters.">readcfg_atm</a>(parms);
<a name="l01621"></a>01621     <a class="code" href="maos_2setup__parms_8c.html#78380466affab6eff0b8332e2add0cc9" title="Read wfs geometry.">readcfg_powfs</a>(parms);
<a name="l01622"></a>01622     <a class="code" href="maos_2setup__parms_8c.html#e7e9d392b0aefa689b1fbe0f5502610e" title="Read in parameters of wfs, including GS direction, signal level, wvlwts, etc.">readcfg_wfs</a>(parms);
<a name="l01623"></a>01623     <a class="code" href="maos_2setup__parms_8c.html#4eba5db3782bce354528692093a5c886" title="Read in deformable mirror parameters.">readcfg_dm</a>(parms);
<a name="l01624"></a>01624     <a class="code" href="maos_2setup__parms_8c.html#f1b51ba63bd9c8ce31aad0b3ddecb49b" title="Read in MOAO parameters.">readcfg_moao</a>(parms);
<a name="l01625"></a>01625     <a class="code" href="maos_2setup__parms_8c.html#501db4099d54887195219e49cba2cbe5" title="Read in atmosphere reconstruction parameters.">readcfg_atmr</a>(parms);
<a name="l01626"></a>01626     <a class="code" href="maos_2setup__parms_8c.html#9a5f9a428f3b04060a1f80ba6b319039" title="Read in turbulence tomography parameters.">readcfg_tomo</a>(parms);
<a name="l01627"></a>01627     <a class="code" href="maos_2setup__parms_8c.html#6a5bda1804c407f53ca9e36f6bb6f1d5" title="Read in DM fit parameters.">readcfg_fit</a>(parms);
<a name="l01628"></a>01628     <a class="code" href="maos_2setup__parms_8c.html#133d470dc6f43fbc5690c9f8e0046ff6" title="Read in performance evaluation science point parameters.">readcfg_evl</a>(parms);
<a name="l01629"></a>01629     <a class="code" href="maos_2setup__parms_8c.html#427962208b0462b3c477798ac97783d6" title="Read in simulation parameters.">readcfg_sim</a>(parms);
<a name="l01630"></a>01630     <a class="code" href="maos_2setup__parms_8c.html#f045265022d49edfbfceea0f6f4950a8" title="Read in parameters for Cn2 estimation.">readcfg_cn2</a>(parms);
<a name="l01631"></a>01631     <a class="code" href="maos_2setup__parms_8c.html#1b39e7e3bf45af24d385587415f54a11" title="Specify which variables to plot.">readcfg_plot</a>(parms);
<a name="l01632"></a>01632     <a class="code" href="maos_2setup__parms_8c.html#290f919909b9bbb347962e8a7a31a327" title="Read in debugging parameters.">readcfg_dbg</a>(parms);
<a name="l01633"></a>01633     <a class="code" href="maos_2setup__parms_8c.html#c35c651f34a6a45cd536e1f4f9d11116" title="Specify which variables to save.">readcfg_save</a>(parms);
<a name="l01634"></a>01634     <a class="code" href="maos_2setup__parms_8c.html#8159d82edd710777ee375cc766476975" title="Specify which variables to load from saved files (Usually from LAOS simulations)...">readcfg_load</a>(parms);
<a name="l01635"></a>01635     parms-&gt;<a class="code" href="structPARMS__T.html#9810b604788d4ac18f7f202096756308" title="Number of OPD surfaces.">nsurf</a>=readcfg_strarr(&amp;parms-&gt;<a class="code" href="structPARMS__T.html#0b0b6d37dbd4660e5e68021ce3dcc887" title="OPD surfaces.">surf</a>, <span class="stringliteral">"surf"</span>);
<a name="l01636"></a>01636     parms-&gt;<a class="code" href="structPARMS__T.html#635a98dc98b7c99a8cb7662bb04f1f20" title="Number of tilted surfaces.">ntsurf</a>=readcfg_strarr(&amp;parms-&gt;<a class="code" href="structPARMS__T.html#8f85b3977b13fda7201dde02c10126de" title="Tilted surfaces, surface, not OPD.">tsurf</a>,<span class="stringliteral">"tsurf"</span>);
<a name="l01637"></a>01637     <span class="comment">/*</span>
<a name="l01638"></a>01638 <span class="comment">      Output all the readed parms to a single file that can be used to reproduce</span>
<a name="l01639"></a>01639 <span class="comment">      the same simulation.</span>
<a name="l01640"></a>01640 <span class="comment">    */</span>
<a name="l01641"></a>01641     <span class="keywordtype">char</span> fnconf[PATH_MAX];
<a name="l01642"></a>01642     snprintf(fnconf, PATH_MAX, <span class="stringliteral">"maos_%ld.conf"</span>, (<span class="keywordtype">long</span>)getpid());
<a name="l01643"></a>01643     close_config(<span class="stringliteral">"%s"</span>,fnconf);
<a name="l01644"></a>01644     mysymlink(fnconf, <span class="stringliteral">"maos_recent.conf"</span>);
<a name="l01645"></a>01645     <span class="comment">/*</span>
<a name="l01646"></a>01646 <span class="comment">      Postprocess the parameters for integrity. The ordering of the following</span>
<a name="l01647"></a>01647 <span class="comment">      routines are important.</span>
<a name="l01648"></a>01648 <span class="comment">    */</span>
<a name="l01649"></a>01649     <a class="code" href="maos_2setup__parms_8c.html#440919651fb4c4c963da4c6fb7561ecb" title="Process simulation parameters to find incompatibility.">setup_parms_postproc_sim</a>(parms);
<a name="l01650"></a>01650     <a class="code" href="maos_2setup__parms_8c.html#4d667799364159d4a473d9159682309d" title="postproc various WFS parameters based on other input information">setup_parms_postproc_wfs</a>(parms);
<a name="l01651"></a>01651     <a class="code" href="maos_2setup__parms_8c.html#52f022b8c4512d9bd20674de845593a2" title="postproc parameters for save.">setup_parms_postproc_save</a>(parms);
<a name="l01652"></a>01652     <a class="code" href="maos_2setup__parms_8c.html#9d7c10a75b4fc50ab68e473968cbde4a" title="postproc atmosphere parameters.">setup_parms_postproc_atm</a>(parms);
<a name="l01653"></a>01653     <a class="code" href="maos_2setup__parms_8c.html#56adfa3b5440332125f22d5e3216d6c0" title="Scaling necessary values for non-zero zenith angle (za).">setup_parms_postproc_za</a>(parms);
<a name="l01654"></a>01654     <a class="code" href="maos_2setup__parms_8c.html#72305d3fc8ccc4871e74ac9f0701303d" title="compute minimum size of atm screen to cover all the beam path.">setup_parms_postproc_atm_size</a>(parms);
<a name="l01655"></a>01655     <a class="code" href="maos_2setup__parms_8c.html#aa02b87b76c12eaec2e3f3884f558a83" title="Setting up DM parameters in order to do DM caching during simulation.">setup_parms_postproc_dm</a>(parms);
<a name="l01656"></a>01656     <a class="code" href="maos_2setup__parms_8c.html#e88e42b64bcd2103556c239fb38d61b3" title="Setting up the cone coordinate for MCAO LGS simulation.">setup_parms_postproc_recon</a>(parms);
<a name="l01657"></a>01657     <a class="code" href="maos_2setup__parms_8c.html#698c26e1ac55798491764865d39a6758" title="The siglev is always specified in 800 Hz.">setup_parms_postproc_siglev</a>(parms);
<a name="l01658"></a>01658     <a class="code" href="maos_2setup__parms_8c.html#33d94712102ef4690b9338e902e829ae" title="postproc misc parameters.">setup_parms_postproc_misc</a>(parms, arg);
<a name="l01659"></a>01659     <a class="code" href="maos_2setup__parms_8c.html#6a205952ab13986513b3ee36e1765a14" title="Limited sanity check of the parameters to prevent obvious mistakes.">check_parms</a>(parms);
<a name="l01660"></a>01660     <a class="code" href="maos_2setup__parms_8c.html#e8e239acbf0b52604d181c19aae55f54" title="Selectively print out parameters for easy diagnose of possible mistakes.">print_parms</a>(parms);
<a name="l01661"></a>01661 
<a name="l01662"></a>01662     <span class="keywordflow">return</span> parms;
<a name="l01663"></a>01663 }
</pre></div>
<p>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Wed Oct 27 12:43:14 2010 for maos-0.6.1 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
