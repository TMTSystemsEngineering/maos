<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>MAOS: maos/sim.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="maos.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">MAOS
   </div>
   <div id="projectbrief">Mulithreaded Adaptive Optics Simulator</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('sim_8h.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">sim.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a24fb69fe8cc24a1851a6337a3875af52"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sim_8h.html#a24fb69fe8cc24a1851a6337a3875af52">perfevl_ievl</a> (<a class="el" href="structthread__t.html">thread_t</a> *info)</td></tr>
<tr class="separator:a24fb69fe8cc24a1851a6337a3875af52"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a19afa47f9c816174b2fab7b46eba5c32"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sim_8h.html#a19afa47f9c816174b2fab7b46eba5c32">perfevl</a> (<a class="el" href="structSIM__T.html">SIM_T</a> *simu)</td></tr>
<tr class="separator:a19afa47f9c816174b2fab7b46eba5c32"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2923773c14f6b8673f1b6d9f63d1ae17"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sim_8h.html#a2923773c14f6b8673f1b6d9f63d1ae17">prep_cachedm</a> (<a class="el" href="structSIM__T.html">SIM_T</a> *simu)</td></tr>
<tr class="separator:a2923773c14f6b8673f1b6d9f63d1ae17"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5adf2590e4ff92a8cd044a52cf9bd753"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sim_8h.html#a5adf2590e4ff92a8cd044a52cf9bd753">calc_cachedm</a> (<a class="el" href="structSIM__T.html">SIM_T</a> *simu)</td></tr>
<tr class="separator:a5adf2590e4ff92a8cd044a52cf9bd753"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a78085c7163dd0867b7346204222b31e9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sim_8h.html#a78085c7163dd0867b7346204222b31e9">filter_dm</a> (<a class="el" href="structSIM__T.html">SIM_T</a> *simu)</td></tr>
<tr class="separator:a78085c7163dd0867b7346204222b31e9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac5628434ad078eec069d06f97a8d9bee"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sim_8h.html#ac5628434ad078eec069d06f97a8d9bee">update_dm</a> (<a class="el" href="structSIM__T.html">SIM_T</a> *simu)</td></tr>
<tr class="separator:ac5628434ad078eec069d06f97a8d9bee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a99e7e23b2226afc767fc176f352f6e11"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sim_8h.html#a99e7e23b2226afc767fc176f352f6e11">wfsgrad</a> (<a class="el" href="structSIM__T.html">SIM_T</a> *simu)</td></tr>
<tr class="separator:a99e7e23b2226afc767fc176f352f6e11"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4aa8e0cc5984b2881e54c0000ae754ae"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sim_8h.html#a4aa8e0cc5984b2881e54c0000ae754ae">wfsints</a> (<a class="el" href="structthread__t.html">thread_t</a> *thread_data)</td></tr>
<tr class="separator:a4aa8e0cc5984b2881e54c0000ae754ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad4e12ad52903458e90428e3bf7410d59"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sim_8h.html#ad4e12ad52903458e90428e3bf7410d59">wfs_ideal_atm</a> (<a class="el" href="structSIM__T.html">SIM_T</a> *simu, <a class="el" href="structdmat.html">dmat</a> *opd, int iwfs, real alpha)</td></tr>
<tr class="separator:ad4e12ad52903458e90428e3bf7410d59"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7d7d20b6b274be139712a0c74329803d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sim_8h.html#a7d7d20b6b274be139712a0c74329803d">wfsgrad_iwfs</a> (<a class="el" href="structthread__t.html">thread_t</a> *info)</td></tr>
<tr class="separator:a7d7d20b6b274be139712a0c74329803d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a96035f15795975f539aaac8050d89b88"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sim_8h.html#a96035f15795975f539aaac8050d89b88">wfsgrad_post</a> (<a class="el" href="structthread__t.html">thread_t</a> *info)</td></tr>
<tr class="separator:a96035f15795975f539aaac8050d89b88"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a08a0162a7702d5b0752338f264b08de7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sim_8h.html#a08a0162a7702d5b0752338f264b08de7">addlow2dm</a> (<a class="el" href="structdcell.html">dcell</a> **dmval, const <a class="el" href="structSIM__T.html">SIM_T</a> *simu, const <a class="el" href="structdcell.html">dcell</a> *low_val, real gain)</td></tr>
<tr class="separator:a08a0162a7702d5b0752338f264b08de7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a72eb6a2fa1120b7b80f863767f922860"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sim_8h.html#a72eb6a2fa1120b7b80f863767f922860">filter_fsm</a> (<a class="el" href="structSIM__T.html">SIM_T</a> *simu)</td></tr>
<tr class="separator:a72eb6a2fa1120b7b80f863767f922860"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a24fb69fe8cc24a1851a6337a3875af52"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a24fb69fe8cc24a1851a6337a3875af52">&#9670;&nbsp;</a></span>perfevl_ievl()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void perfevl_ievl </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structthread__t.html">thread_t</a> *&#160;</td>
          <td class="paramname"><em>info</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Performance evaluation for each direction in parallel mode. </p>

</div>
</div>
<a id="a19afa47f9c816174b2fab7b46eba5c32"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a19afa47f9c816174b2fab7b46eba5c32">&#9670;&nbsp;</a></span>perfevl()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void perfevl </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSIM__T.html">SIM_T</a> *&#160;</td>
          <td class="paramname"><em>simu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Peformance evaluation on science FoV.</p>
<p>Evaluate performance by calling perfevl_ievl in parallel and then calls perfevl_mean to field average. Notice that the science FoV can be different from the DM fitting FoV, which is tuned to better sharpen the NGS</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000003">Todo:</a></b></dt><dd>Write a standalone routine that can plot results, using techniques developped in drawdaemon. </dd></dl>

</div>
</div>
<a id="a2923773c14f6b8673f1b6d9f63d1ae17"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2923773c14f6b8673f1b6d9f63d1ae17">&#9670;&nbsp;</a></span>prep_cachedm()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void prep_cachedm </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSIM__T.html">SIM_T</a> *&#160;</td>
          <td class="paramname"><em>simu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Prepares the DM caching structs that caches DM on fine sampled grid to speed up ray tracing with linear interpolation.</p>
<p>Because the DM has coarse sampling, and cubic influence functions, directly interpolate from the DM to the WFS and science OPD takes a lot of computation. We can speed up this process by first propagating the DM commands to a square grid that matches the sampling of the WFS or science OPD, and then propagate from the square grid to different WFS or science directions. For each sampling and each DM, we only need one fine sampled square grid that will cover all the different directions in the FoV of the WFSs or science. For the ground DM, we need a plane of 1/64m sampling that matches the WFS and science OPD. For the upper DM, we need to two planes, one at 1/64m for the LGS WFS and science OPD, and another one at 1/64 m (1-11.2/90) for the LGS due to cone effect. The square grid are on axis. </p>

</div>
</div>
<a id="a5adf2590e4ff92a8cd044a52cf9bd753"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5adf2590e4ff92a8cd044a52cf9bd753">&#9670;&nbsp;</a></span>calc_cachedm()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void calc_cachedm </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSIM__T.html">SIM_T</a> *&#160;</td>
          <td class="paramname"><em>simu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Partition the ray tracing by DM/Destination combinations, as well as segments in each combination to maximum efficiency. </p>

</div>
</div>
<a id="a78085c7163dd0867b7346204222b31e9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a78085c7163dd0867b7346204222b31e9">&#9670;&nbsp;</a></span>filter_dm()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void filter_dm </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSIM__T.html">SIM_T</a> *&#160;</td>
          <td class="paramname"><em>simu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Does the servo filtering by calling filter_cl() or filter_ol() </p>

</div>
</div>
<a id="ac5628434ad078eec069d06f97a8d9bee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac5628434ad078eec069d06f97a8d9bee">&#9670;&nbsp;</a></span>update_dm()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void update_dm </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSIM__T.html">SIM_T</a> *&#160;</td>
          <td class="paramname"><em>simu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Update various quantities upon updating dmreal. </p>

</div>
</div>
<a id="a99e7e23b2226afc767fc176f352f6e11"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a99e7e23b2226afc767fc176f352f6e11">&#9670;&nbsp;</a></span>wfsgrad()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void wfsgrad </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSIM__T.html">SIM_T</a> *&#160;</td>
          <td class="paramname"><em>simu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Calls <a class="el" href="sim_8h.html#a7d7d20b6b274be139712a0c74329803d">wfsgrad_iwfs()</a> to computes WFS gradient in parallel. It also includes operations on Gradients before tomography. </p>

</div>
</div>
<a id="a4aa8e0cc5984b2881e54c0000ae754ae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4aa8e0cc5984b2881e54c0000ae754ae">&#9670;&nbsp;</a></span>wfsints()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void wfsints </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structthread__t.html">thread_t</a> *&#160;</td>
          <td class="paramname"><em>thread_data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>compute physical optics images and add to ints. be careful that fftw inverse fft doesn't have 1/n^2 scaling. this function lives inside the threading routine wfsgradx</p>
<p>Notice that the uplink psf have to have the same sampling as the subaperture psf. uplink psf has sampling lambda/(nlwvf*ldx) subaperture has sampling lambda/(nwvf*dx) When the uplink pupil is larger than subaperture, we need to scale ldx accordingly. </p>

</div>
</div>
<a id="ad4e12ad52903458e90428e3bf7410d59"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad4e12ad52903458e90428e3bf7410d59">&#9670;&nbsp;</a></span>wfs_ideal_atm()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void wfs_ideal_atm </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSIM__T.html">SIM_T</a> *&#160;</td>
          <td class="paramname"><em>simu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structdmat.html">dmat</a> *&#160;</td>
          <td class="paramname"><em>opd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>iwfs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real&#160;</td>
          <td class="paramname"><em>alpha</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Propagate atm onto WFS subaperture grid, and then to fine lenslet grid. </p>

</div>
</div>
<a id="a7d7d20b6b274be139712a0c74329803d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7d7d20b6b274be139712a0c74329803d">&#9670;&nbsp;</a></span>wfsgrad_iwfs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void wfsgrad_iwfs </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structthread__t.html">thread_t</a> *&#160;</td>
          <td class="paramname"><em>info</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>computes close loop and pseudo open loop gradidents for both gometric and physical optics WFS. Calls <a class="el" href="sim_8h.html#a4aa8e0cc5984b2881e54c0000ae754ae">wfsints()</a> to accumulate WFS subapertures images in physical optics mode. </p>

</div>
</div>
<a id="a96035f15795975f539aaac8050d89b88"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a96035f15795975f539aaac8050d89b88">&#9670;&nbsp;</a></span>wfsgrad_post()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void wfsgrad_post </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structthread__t.html">thread_t</a> *&#160;</td>
          <td class="paramname"><em>info</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Every operation here should be in the Simulator not the Controller </p>

</div>
</div>
<a id="a08a0162a7702d5b0752338f264b08de7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a08a0162a7702d5b0752338f264b08de7">&#9670;&nbsp;</a></span>addlow2dm()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void addlow2dm </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdcell.html">dcell</a> **&#160;</td>
          <td class="paramname"><em>dmval</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structSIM__T.html">SIM_T</a> *&#160;</td>
          <td class="paramname"><em>simu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structdcell.html">dcell</a> *&#160;</td>
          <td class="paramname"><em>low_val</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real&#160;</td>
          <td class="paramname"><em>gain</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Add low order NGS modes to DM actuator commands for AHST and MVST </p>

</div>
</div>
<a id="a72eb6a2fa1120b7b80f863767f922860"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a72eb6a2fa1120b7b80f863767f922860">&#9670;&nbsp;</a></span>filter_fsm()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void filter_fsm </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSIM__T.html">SIM_T</a> *&#160;</td>
          <td class="paramname"><em>simu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Servo filter for FSM commands. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->

   </ul>
 </div>
</body>
</html>
