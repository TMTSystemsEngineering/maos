<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>Multi-threaded Adaptive Optics Simulator: Compile the Code</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="maos.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Multi-threaded Adaptive Optics Simulator
   </div>
   <div id="projectbrief">A Fast End to End Adaptive Optics Simulator</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('page20.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Compile the Code </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This step can be skipped if the user choose to use the precompiled binary files, which are available for all the popular plateforms: Windows, Mac, and Linux. Please notice that the job scheduling and monitoring utilities are not included in the released binaries.</p>
<h1><a class="anchor" id="sect-requirement"></a>
Requirements</h1>
<ul>
<li>C99 compliant compiler: GCC, Intel ICC, or llvm-clang.</li>
<li>(Optional) GTK+ and Cairo. For drawdaemon and monitor.</li>
<li>(Optional in Linux/Mac) FFTW version 3. Will download from MAOS site if not available in the system.</li>
<li>(Optional in Linux/Mac) Optimized blas and lapack. Blas and lapack can usually be installed through the linux distribution official repository. Will download from MAOS site if not available in the system.</li>
</ul>
<h1><a class="anchor" id="sect-prep"></a>
Preparing the folders and compiling</h1>
<p>We recommend using three different folders to 1) store the source tree, 2) compile the code, and 3) run the simulation.</p>
<p>The source tree is where the source is extracted. Obtain the software in the form of the compressed tar ball: maos_version.tar.gz. Extract it into some directory and name the directory src_dir. Example:</p>
<pre class="fragment">cd ~/work/programming
tar zxvf maos_version.tar.gz 
cd maos_version
export src_dir=$(pwd)
</pre><p>If you choose to use always up to date git version instead, an extra step of running autogen.sh is needed </p>
<pre class="fragment">cd ~/work/programming
git clone https://github.com/lianqiw/maos.git maos_git
cd maos_git
./autogen.sh
export src_dir=$(pwd)
</pre><p>Next we create another folder, where we are going to compile the code. example:</p>
<pre class="fragment">cd ~/work/maos
mkdir comp_optim &amp;&amp; cd comp_optim
$src_dir/configure
make -j4 #this will compile using 4 threads.
</pre><p>which will config the compiling folder with GCC compiler and default optimization flags and compile the code. There are a few optional switches or additional components that can be enabled when calling configure.</p>
<p>To use a different compiler: </p>
<pre class="fragment">$src_dir/configure CC=icc    #ICC compiler
$src_dir/configure CC=clang  #clang compiler
$src_dir/configure CC=gcc4.5 #use gcc4.5
</pre><p>To enable GPU computing, first install nvidia graphics driver and cuda runtime library. Issue the following command to ensure graphics configuration is correct: </p>
<pre class="fragment">nvidia-smi </pre><p> You should see all your nvidia graphics gpus are listed.</p>
<p>The configure can automatically detect cuda if nvcc is in the path, or if cuda is installed in /opt/cuda or /usr/local/cuda. For other locations, you need to pass the cuda directory to configure:</p>
<pre class="fragment">$src_dir/configure --with-cuda=cuda_dir </pre><p>When GPU compute is compiled in maos and Nvidia GPUs are available, maos will make use of all the GPUs to run simulation. If that is not desired, the GPU compute can be disabled at run time by passing -g-1 to maos. Different set of GPU can also be selected by passing one or multiple -gn:</p>
<pre class="fragment">$maos -g-1 #disable GPU compute 
$maos -g0 -g2 #Only use gpu 0 and 2
</pre><p>To compile mex routines for matlab, pass the matlab directory to configure:</p>
<pre class="fragment">$src_dir/configure --with-matlab=matlab_dir
</pre><p>The compiled mex routines are in <code>mex</code> folder in the compilation directory. The <code>read</code> and <code>write</code> are for handling .bin and .fits files used by maos. The <code>aolib</code> exports a few internal function of maos for use in matlab, including maos itself.</p>
<p>To enable debug mode </p>
<pre class="fragment">$src_dir/configure --enable-debug
</pre><p>For clusters that use job management tools, disable the built-in scheduler by using </p>
<pre class="fragment">$src_dir/configure --disable-scheduler
</pre><p>The compiled executable is maos in the sub-folder “bin” of the compiling folder. You do not have to do "make install" to run the simulations.</p>
<h2><a class="anchor" id="sect-mac-gtk"></a>
Installing GTK+ in MAC OS and Compile Monitor, Drawdaemon</h2>
<p>First, if xcode is not installed in full, make sure the following packages are installed</p>
<pre class="fragment">DeveloperToolsCLI.pkg
gcc4.x.pkg
MACOSX10.x.pkg
DevSDK.pkg
OpenGLSDK.pkg
DeveloperToolsSystemSupport
</pre><p> Then download and install pkg-config from pkgconfig.freedesktop.org/releases/</p>
<p>It is simpliest to install gtk using macport. For manual install, follow the instructions on page gtk-osx.sourceforge.net/ to install gtk+ for osx. The environmental variables are set by jhbuild, here we take important ones and put them in our .bash_profile to avoid running jhbuild each time. Put the following in your .bash_profile. Adjust the path accordingly if you changed gtk-osx installing options.</p>
<pre class="fragment">export PKG_CONFIG_PATH="/usr/lib/pkgconfig:$HOME/gtk/inst/lib/pkgconfig:$HOME/gtk/inst/share/pkgconfig"
export LD_LIBRARY_PATH="$LD_LIBRARY_PATH:$HOME/gtk/inst/lib"
export PATH="$PATH:$HOME/gtk/inst/bin"
export C_INCLUDE_PATH="$HOME/gtk/inst/include"
</pre><p> Now rerun MAOS configure and make. Monitor and drawdaemon should appear in bin folder now.</p>
<p>To make the app bundles. First, install quartz engine and ige-mac-buildler. sourceforge.net/apps/trac/gtk-osx/wiki/Bundle jhbuild build gtk-quartz-engine</p>
<p>Second, symbolic link bin/drawdaemon and bin/monitor to $HOME/gtk/inst/bin And cd to scripts/bundle folder, run build.sh. .app files should appear in your desktop.</p>
<h2><a class="anchor" id="sect-monitor"></a>
Using the job monitor</h2>
<p>When reasonably recent GTK+ and Cairo libraries are present in the system, two additional executives will be compiled, “drawdaemon” and “monitor”. The plotting utility “drawdaemon” is located in sub-folder “lib”. It is launched automatically when plotting commands are issued in the software. The monitoring utility “monitor” is located in sub-folder “bin”. Link monitor to a folder that is in your PATH and type “monitor” in the command line to use it.</p>
<p>In order to use monitor to monitor jobs in different machines, follow these steps:</p>
<p>Create a folder .aos in your home folder, create two files in there. Put these files in all the machines you want to monitor. </p>
<pre class="fragment">~/.aos/hosts  Each line contains a machine's hostname you want to monitor. 
They should be the names returned by command "hostname", 
and you should be able to log into those machines 
with these names. Set up /etc/hosts properly to ensure this.
~/.aos/port   contains the port you want the scheduler to bind to 
so that the monitor can connect to it. 
Any non-previledged port numbers are fine (like 10000). 
Different users should have different port number. 
The port has to be the same on all the machines. 
</pre> </div></div><!-- contents -->
</div><!-- doc-content -->

   </ul>
 </div>
</body>
</html>
