<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>maos-1.2.0: maos/setup_recon.c File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="/home/lianqiw/work/programming/aos/doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">maos-1.2.0
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript" src="dynsections.js"></script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('setup__recon_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">maos/setup_recon.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Contains routines that setup the wavefront reconstructor and DM fitting.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup__recon_8c.html#a928f34035de84ed317aa075e7a7ddac9">setup_recon_ploc</a> (<a class="el" href="structRECON__T.html">RECON_T</a> *recon, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Setting up PLOC grid, which is a coarse sampled (usually halves the subaperture spacing) grid that defines the circular aperture for wavefront reconstruction and DM fitting.  <a href="#a928f34035de84ed317aa075e7a7ddac9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a20e01255ff0fd67c2c392cb2d4e81569"></a><!-- doxytag: member="setup_recon.c::setup_recon_floc" ref="a20e01255ff0fd67c2c392cb2d4e81569" args="(RECON_T *recon, const PARMS_T *parms)" -->
static void&#160;</td><td class="memItemRight" valign="bottom"><b>setup_recon_floc</b> (<a class="el" href="structRECON__T.html">RECON_T</a> *recon, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup__recon_8c.html#a0182734530b87fcf5498aea2e8d1e5c0">setup_recon_aloc</a> (<a class="el" href="structRECON__T.html">RECON_T</a> *recon, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Setup the deformable mirrors grid aloc.  <a href="#a0182734530b87fcf5498aea2e8d1e5c0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup__recon_8c.html#a93517d5a67108f02872fea3ca166df0a">setup_recon_xloc</a> (<a class="el" href="structRECON__T.html">RECON_T</a> *recon, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Setup the tomography grids xloc which is used for Tomography.  <a href="#a93517d5a67108f02872fea3ca166df0a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup__recon_8c.html#a1b36f44d443b7450e316064e6285f83c">setup_recon_HXW</a> (<a class="el" href="structRECON__T.html">RECON_T</a> *recon, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Setup ray tracing operator from xloc to ploc for guide stars.  <a href="#a1b36f44d443b7450e316064e6285f83c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup__recon_8c.html#a47f35482d43e8136662b98feb838641e">setup_recon_GWR</a> (<a class="el" href="structRECON__T.html">RECON_T</a> *recon, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, <a class="el" href="structPOWFS__T.html">POWFS_T</a> *powfs)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Setup gradient operator from powfs.loc to wavefront sensor for least square reconstruction.  <a href="#a47f35482d43e8136662b98feb838641e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup__recon_8c.html#a55f1e5e7f62b6d0fdb075f0e08c33bf5">setup_recon_GP</a> (<a class="el" href="structRECON__T.html">RECON_T</a> *recon, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, <a class="el" href="structPOWFS__T.html">POWFS_T</a> *powfs, <a class="el" href="structAPER__T.html">APER_T</a> *aper)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Setup gradient operator from ploc to wavefront sensors.  <a href="#a55f1e5e7f62b6d0fdb075f0e08c33bf5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup__recon_8c.html#a5a56ad724a48dac3f330225d7a05f6d5">setup_recon_GA</a> (<a class="el" href="structRECON__T.html">RECON_T</a> *recon, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, <a class="el" href="structPOWFS__T.html">POWFS_T</a> *powfs)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Setup gradient operator form aloc for wfs by using GP.  <a href="#a5a56ad724a48dac3f330225d7a05f6d5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup__recon_8c.html#a33edd089f8aa145ad55a5caab515e373">setup_recon_GX</a> (<a class="el" href="structRECON__T.html">RECON_T</a> *recon, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Crate the xloc to wfs gradient operator.  <a href="#a33edd089f8aa145ad55a5caab515e373"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup__recon_8c.html#a3f6cf2f9b4c4e8dbe3cba7df6a41fa9b">setup_recon_saneai</a> (<a class="el" href="structRECON__T.html">RECON_T</a> *recon, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, const <a class="el" href="structPOWFS__T.html">POWFS_T</a> *powfs)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Setup the matrix of the inverse of gradient measurement noise equivalent angle covariance matrix.  <a href="#a3f6cf2f9b4c4e8dbe3cba7df6a41fa9b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup__recon_8c.html#ab1ee56bdc9100fcdae8743d1b9971027">setup_recon_TTR</a> (<a class="el" href="structRECON__T.html">RECON_T</a> *recon, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, const <a class="el" href="structPOWFS__T.html">POWFS_T</a> *powfs)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">setting up global tip/tilt remove operator from LGS gradients.  <a href="#ab1ee56bdc9100fcdae8743d1b9971027"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup__recon_8c.html#a9a1d613f69803903ab0cb9f29ca5a4a3">setup_recon_DFR</a> (<a class="el" href="structRECON__T.html">RECON_T</a> *recon, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, const <a class="el" href="structPOWFS__T.html">POWFS_T</a> *powfs)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">operator to remove diffrential focus modes that might be caused by sodium layer horizontal structure.  <a href="#a9a1d613f69803903ab0cb9f29ca5a4a3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup__recon_8c.html#acaa963e8fb3e5e0201f312327e4d94e8">setup_recon_TTFR</a> (<a class="el" href="structRECON__T.html">RECON_T</a> *recon, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, const <a class="el" href="structPOWFS__T.html">POWFS_T</a> *powfs)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">wrapps <a class="el" href="setup__recon_8c.html#ab1ee56bdc9100fcdae8743d1b9971027" title="setting up global tip/tilt remove operator from LGS gradients.">setup_recon_TTR()</a> and <a class="el" href="setup__recon_8c.html#a9a1d613f69803903ab0cb9f29ca5a4a3" title="operator to remove diffrential focus modes that might be caused by sodium layer horizontal structure...">setup_recon_DFR()</a> to removal global tip/tilt and differential focus.  <a href="#acaa963e8fb3e5e0201f312327e4d94e8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup__recon_8c.html#a7b4a99c91fb0c1610745603a580cedf6">free_cxx</a> (<a class="el" href="structRECON__T.html">RECON_T</a> *recon)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Frees recon-&gt;invpsd or recon-&gt;fractal.  <a href="#a7b4a99c91fb0c1610745603a580cedf6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup__recon_8c.html#a2ade74dd6feba7dba0a4b6f38fe134a8">setup_recon_tomo_prep</a> (<a class="el" href="structRECON__T.html">RECON_T</a> *recon, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Prepares for tomography.  <a href="#a2ade74dd6feba7dba0a4b6f38fe134a8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup__recon_8c.html#a6315a2cf8494166cf646588f94ce894b">setup_recon_tomo_matrix</a> (<a class="el" href="structRECON__T.html">RECON_T</a> *recon, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, <a class="el" href="structAPER__T.html">APER_T</a> *aper)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">assemble tomography matrix.  <a href="#a6315a2cf8494166cf646588f94ce894b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="af93d4b92f58f95cd947a5ad99775d2cc"></a><!-- doxytag: member="setup_recon.c::setup_recon_tomo_ecnn" ref="af93d4b92f58f95cd947a5ad99775d2cc" args="(RECON_T *recon, const PARMS_T *parms, APER_T *aper)" -->
static void&#160;</td><td class="memItemRight" valign="bottom"><b>setup_recon_tomo_ecnn</b> (<a class="el" href="structRECON__T.html">RECON_T</a> *recon, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, <a class="el" href="structAPER__T.html">APER_T</a> *aper)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup__recon_8c.html#aa860829623f5076a779fa20d62f5b6d9">setup_recon_tomo_update</a> (<a class="el" href="structRECON__T.html">RECON_T</a> *recon, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Update assembled tomography matrix with new L2.  <a href="#aa860829623f5076a779fa20d62f5b6d9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup__recon_8c.html#a855fa8cdbea7f506b823e00f362f06c5">setup_recon_HXF</a> (<a class="el" href="structRECON__T.html">RECON_T</a> *recon, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Setup ray tracing operator HXF from xloc to aperture ploc along DM fiting directions.  <a href="#a855fa8cdbea7f506b823e00f362f06c5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup__recon_8c.html#a99b595aebae8532a2893e98edd9356c2">setup_recon_HA</a> (<a class="el" href="structRECON__T.html">RECON_T</a> *recon, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Setup ray tracing operator HA from aloc to aperture ploc along DM fiting direction.  <a href="#a99b595aebae8532a2893e98edd9356c2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup__recon_8c.html#a630c6d5a66160c402a727df359300f20">fit_prep_lrt</a> (<a class="el" href="structRECON__T.html">RECON_T</a> *recon, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Setup fitting low rank terms that are in the NULL space of DM fitting operator.  <a href="#a630c6d5a66160c402a727df359300f20"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup__recon_8c.html#af7a8a7478b06b8b4f0d27784819f41c2">setup_recon_fit_matrix</a> (<a class="el" href="structRECON__T.html">RECON_T</a> *recon, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Assemble the DM fitting matrix.  <a href="#af7a8a7478b06b8b4f0d27784819f41c2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup__recon_8c.html#a4f4abf13c9b0972de67fab348bb9f470">setup_recon_focus</a> (<a class="el" href="structRECON__T.html">RECON_T</a> *recon, <a class="el" href="structPOWFS__T.html">POWFS_T</a> *powfs, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Create the reconstructor to reconstruct the residual focus error due to LGS sodium tracking error.  <a href="#a4f4abf13c9b0972de67fab348bb9f470"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup__recon_8c.html#a73a310c15901ee437d44af53a66b22a6">setup_recon_mvst</a> (<a class="el" href="structRECON__T.html">RECON_T</a> *recon, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">compute the MVST split tomography NGS mode reconstructor.  <a href="#a73a310c15901ee437d44af53a66b22a6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup__recon_8c.html#a95eec4dfd4e6369d1c7165b340f8217a">setup_recon_mvr_fit</a> (<a class="el" href="structRECON__T.html">RECON_T</a> *recon, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, <a class="el" href="structAPER__T.html">APER_T</a> *aper)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets up the tomogrpahy turbulence reconstruction structs including wavefront reconstructor and DM fitting operator.  <a href="#a95eec4dfd4e6369d1c7165b340f8217a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ace6538d0cb8eaf5f36122167fc74cc20"></a><!-- doxytag: member="setup_recon.c::setup_recon_mvr" ref="ace6538d0cb8eaf5f36122167fc74cc20" args="(RECON_T *recon, const PARMS_T *parms, POWFS_T *powfs, APER_T *aper)" -->
void&#160;</td><td class="memItemRight" valign="bottom"><b>setup_recon_mvr</b> (<a class="el" href="structRECON__T.html">RECON_T</a> *recon, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, <a class="el" href="structPOWFS__T.html">POWFS_T</a> *powfs, <a class="el" href="structAPER__T.html">APER_T</a> *aper)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup__recon_8c.html#a7f4e89b0190b622d12b9f2276b94ec47">setup_recon_lsr</a> (<a class="el" href="structRECON__T.html">RECON_T</a> *recon, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, <a class="el" href="structPOWFS__T.html">POWFS_T</a> *powfs, <a class="el" href="structAPER__T.html">APER_T</a> *aper)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Setup the least square reconstruct by directly inverting GA matrix.  <a href="#a7f4e89b0190b622d12b9f2276b94ec47"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup__recon_8c.html#a1863adc60520febdb733930f3bf32e5a">setup_recon_lsr_mvm</a> (<a class="el" href="structRECON__T.html">RECON_T</a> *recon, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, <a class="el" href="structPOWFS__T.html">POWFS_T</a> *powfs)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Use the various algorithms recon.alg to assemble a final matrix to multiply to gradients to get DM commands.  <a href="#a1863adc60520febdb733930f3bf32e5a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ab51d2bc93119f159121675bec7cbff8c"></a><!-- doxytag: member="setup_recon.c::setup_recon_mvr_mvm_iact" ref="ab51d2bc93119f159121675bec7cbff8c" args="(thread_t *info)" -->
void&#160;</td><td class="memItemRight" valign="bottom"><b>setup_recon_mvr_mvm_iact</b> (<a class="el" href="structthread__t.html">thread_t</a> *info)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup__recon_8c.html#a14a4f6e974e84b54eeff66aba40ba5d5">setup_recon_mvr_mvm</a> (<a class="el" href="structRECON__T.html">RECON_T</a> *recon, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, <a class="el" href="structPOWFS__T.html">POWFS_T</a> *powfs)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Use the various algorithms recon.alg to assemble a final matrix to multiply to gradients to get DM commands.  <a href="#a14a4f6e974e84b54eeff66aba40ba5d5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structRECON__T.html">RECON_T</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup__recon_8c.html#a6ec32666222d37047d7775b874969a2e">setup_recon</a> (const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, <a class="el" href="structPOWFS__T.html">POWFS_T</a> *powfs, <a class="el" href="structAPER__T.html">APER_T</a> *aper)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Setup either the minimum variance reconstructor by calling setup_recon_mvr() or least square reconstructor by calling <a class="el" href="setup__recon_8c.html#a7f4e89b0190b622d12b9f2276b94ec47" title="Setup the least square reconstruct by directly inverting GA matrix.">setup_recon_lsr()</a>  <a href="#a6ec32666222d37047d7775b874969a2e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup__recon_8c.html#a810c17bd7027feae0decafb93f48efcf">free_recon</a> (const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, <a class="el" href="structRECON__T.html">RECON_T</a> *recon)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Free the recon struct.  <a href="#a810c17bd7027feae0decafb93f48efcf"></a><br/></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Contains routines that setup the wavefront reconstructor and DM fitting. </p>
<p>Use parms-&gt;wfsr instead of parms-&gt;wfs for wfs information, which hands GLAO mode correctly.x</p>
<p>TOMOSCALE is only used when assembling RLM, RRM. The unassembled opeation of RLM, RRM act without this factor. The original variables, saneai, L2 are not changed. </p>
</div><hr/><h2>Function Documentation</h2>
<a class="anchor" id="a928f34035de84ed317aa075e7a7ddac9"></a><!-- doxytag: member="setup_recon.c::setup_recon_ploc" ref="a928f34035de84ed317aa075e7a7ddac9" args="(RECON_T *recon, const PARMS_T *parms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void <a class="el" href="setup__recon_8c.html#a928f34035de84ed317aa075e7a7ddac9">setup_recon_ploc</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structRECON__T.html">RECON_T</a> *&#160;</td>
          <td class="paramname"><em>recon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&#160;</td>
          <td class="paramname"><em>parms</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Setting up PLOC grid, which is a coarse sampled (usually halves the subaperture spacing) grid that defines the circular aperture for wavefront reconstruction and DM fitting. </p>

</div>
</div>
<a class="anchor" id="a0182734530b87fcf5498aea2e8d1e5c0"></a><!-- doxytag: member="setup_recon.c::setup_recon_aloc" ref="a0182734530b87fcf5498aea2e8d1e5c0" args="(RECON_T *recon, const PARMS_T *parms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void <a class="el" href="setup__recon_8c.html#a0182734530b87fcf5498aea2e8d1e5c0">setup_recon_aloc</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structRECON__T.html">RECON_T</a> *&#160;</td>
          <td class="paramname"><em>recon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&#160;</td>
          <td class="paramname"><em>parms</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Setup the deformable mirrors grid aloc. </p>
<p>This is used for DM fitting. </p>

</div>
</div>
<a class="anchor" id="a93517d5a67108f02872fea3ca166df0a"></a><!-- doxytag: member="setup_recon.c::setup_recon_xloc" ref="a93517d5a67108f02872fea3ca166df0a" args="(RECON_T *recon, const PARMS_T *parms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void <a class="el" href="setup__recon_8c.html#a93517d5a67108f02872fea3ca166df0a">setup_recon_xloc</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structRECON__T.html">RECON_T</a> *&#160;</td>
          <td class="paramname"><em>recon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&#160;</td>
          <td class="paramname"><em>parms</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Setup the tomography grids xloc which is used for Tomography. </p>

</div>
</div>
<a class="anchor" id="a1b36f44d443b7450e316064e6285f83c"></a><!-- doxytag: member="setup_recon.c::setup_recon_HXW" ref="a1b36f44d443b7450e316064e6285f83c" args="(RECON_T *recon, const PARMS_T *parms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void <a class="el" href="setup__recon_8c.html#a1b36f44d443b7450e316064e6285f83c">setup_recon_HXW</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structRECON__T.html">RECON_T</a> *&#160;</td>
          <td class="paramname"><em>recon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&#160;</td>
          <td class="paramname"><em>parms</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Setup ray tracing operator from xloc to ploc for guide stars. </p>

</div>
</div>
<a class="anchor" id="a47f35482d43e8136662b98feb838641e"></a><!-- doxytag: member="setup_recon.c::setup_recon_GWR" ref="a47f35482d43e8136662b98feb838641e" args="(RECON_T *recon, const PARMS_T *parms, POWFS_T *powfs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void <a class="el" href="setup__recon_8c.html#a47f35482d43e8136662b98feb838641e">setup_recon_GWR</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structRECON__T.html">RECON_T</a> *&#160;</td>
          <td class="paramname"><em>recon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&#160;</td>
          <td class="paramname"><em>parms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structPOWFS__T.html">POWFS_T</a> *&#160;</td>
          <td class="paramname"><em>powfs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Setup gradient operator from powfs.loc to wavefront sensor for least square reconstruction. </p>

</div>
</div>
<a class="anchor" id="a55f1e5e7f62b6d0fdb075f0e08c33bf5"></a><!-- doxytag: member="setup_recon.c::setup_recon_GP" ref="a55f1e5e7f62b6d0fdb075f0e08c33bf5" args="(RECON_T *recon, const PARMS_T *parms, POWFS_T *powfs, APER_T *aper)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void <a class="el" href="setup__recon_8c.html#a55f1e5e7f62b6d0fdb075f0e08c33bf5">setup_recon_GP</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structRECON__T.html">RECON_T</a> *&#160;</td>
          <td class="paramname"><em>recon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&#160;</td>
          <td class="paramname"><em>parms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structPOWFS__T.html">POWFS_T</a> *&#160;</td>
          <td class="paramname"><em>powfs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structAPER__T.html">APER_T</a> *&#160;</td>
          <td class="paramname"><em>aper</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Setup gradient operator from ploc to wavefront sensors. </p>

</div>
</div>
<a class="anchor" id="a5a56ad724a48dac3f330225d7a05f6d5"></a><!-- doxytag: member="setup_recon.c::setup_recon_GA" ref="a5a56ad724a48dac3f330225d7a05f6d5" args="(RECON_T *recon, const PARMS_T *parms, POWFS_T *powfs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void <a class="el" href="setup__recon_8c.html#a5a56ad724a48dac3f330225d7a05f6d5">setup_recon_GA</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structRECON__T.html">RECON_T</a> *&#160;</td>
          <td class="paramname"><em>recon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&#160;</td>
          <td class="paramname"><em>parms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structPOWFS__T.html">POWFS_T</a> *&#160;</td>
          <td class="paramname"><em>powfs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Setup gradient operator form aloc for wfs by using GP. </p>

</div>
</div>
<a class="anchor" id="a33edd089f8aa145ad55a5caab515e373"></a><!-- doxytag: member="setup_recon.c::setup_recon_GX" ref="a33edd089f8aa145ad55a5caab515e373" args="(RECON_T *recon, const PARMS_T *parms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void <a class="el" href="setup__recon_8c.html#a33edd089f8aa145ad55a5caab515e373">setup_recon_GX</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structRECON__T.html">RECON_T</a> *&#160;</td>
          <td class="paramname"><em>recon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&#160;</td>
          <td class="paramname"><em>parms</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Crate the xloc to wfs gradient operator. </p>

</div>
</div>
<a class="anchor" id="a3f6cf2f9b4c4e8dbe3cba7df6a41fa9b"></a><!-- doxytag: member="setup_recon.c::setup_recon_saneai" ref="a3f6cf2f9b4c4e8dbe3cba7df6a41fa9b" args="(RECON_T *recon, const PARMS_T *parms, const POWFS_T *powfs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void <a class="el" href="setup__recon_8c.html#a3f6cf2f9b4c4e8dbe3cba7df6a41fa9b">setup_recon_saneai</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structRECON__T.html">RECON_T</a> *&#160;</td>
          <td class="paramname"><em>recon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&#160;</td>
          <td class="paramname"><em>parms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPOWFS__T.html">POWFS_T</a> *&#160;</td>
          <td class="paramname"><em>powfs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Setup the matrix of the inverse of gradient measurement noise equivalent angle covariance matrix. </p>
<p>For physical optics wfs, the NEA is computed using matched filter output. For geometric optics, the NEA is from input. </p>

</div>
</div>
<a class="anchor" id="ab1ee56bdc9100fcdae8743d1b9971027"></a><!-- doxytag: member="setup_recon.c::setup_recon_TTR" ref="ab1ee56bdc9100fcdae8743d1b9971027" args="(RECON_T *recon, const PARMS_T *parms, const POWFS_T *powfs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void <a class="el" href="setup__recon_8c.html#ab1ee56bdc9100fcdae8743d1b9971027">setup_recon_TTR</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structRECON__T.html">RECON_T</a> *&#160;</td>
          <td class="paramname"><em>recon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&#160;</td>
          <td class="paramname"><em>parms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPOWFS__T.html">POWFS_T</a> *&#160;</td>
          <td class="paramname"><em>powfs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>setting up global tip/tilt remove operator from LGS gradients. </p>

</div>
</div>
<a class="anchor" id="a9a1d613f69803903ab0cb9f29ca5a4a3"></a><!-- doxytag: member="setup_recon.c::setup_recon_DFR" ref="a9a1d613f69803903ab0cb9f29ca5a4a3" args="(RECON_T *recon, const PARMS_T *parms, const POWFS_T *powfs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void <a class="el" href="setup__recon_8c.html#a9a1d613f69803903ab0cb9f29ca5a4a3">setup_recon_DFR</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structRECON__T.html">RECON_T</a> *&#160;</td>
          <td class="paramname"><em>recon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&#160;</td>
          <td class="paramname"><em>parms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPOWFS__T.html">POWFS_T</a> *&#160;</td>
          <td class="paramname"><em>powfs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>operator to remove diffrential focus modes that might be caused by sodium layer horizontal structure. </p>

</div>
</div>
<a class="anchor" id="acaa963e8fb3e5e0201f312327e4d94e8"></a><!-- doxytag: member="setup_recon.c::setup_recon_TTFR" ref="acaa963e8fb3e5e0201f312327e4d94e8" args="(RECON_T *recon, const PARMS_T *parms, const POWFS_T *powfs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void <a class="el" href="setup__recon_8c.html#acaa963e8fb3e5e0201f312327e4d94e8">setup_recon_TTFR</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structRECON__T.html">RECON_T</a> *&#160;</td>
          <td class="paramname"><em>recon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&#160;</td>
          <td class="paramname"><em>parms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPOWFS__T.html">POWFS_T</a> *&#160;</td>
          <td class="paramname"><em>powfs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>wrapps <a class="el" href="setup__recon_8c.html#ab1ee56bdc9100fcdae8743d1b9971027" title="setting up global tip/tilt remove operator from LGS gradients.">setup_recon_TTR()</a> and <a class="el" href="setup__recon_8c.html#a9a1d613f69803903ab0cb9f29ca5a4a3" title="operator to remove diffrential focus modes that might be caused by sodium layer horizontal structure...">setup_recon_DFR()</a> to removal global tip/tilt and differential focus. </p>

</div>
</div>
<a class="anchor" id="a7b4a99c91fb0c1610745603a580cedf6"></a><!-- doxytag: member="setup_recon.c::free_cxx" ref="a7b4a99c91fb0c1610745603a580cedf6" args="(RECON_T *recon)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void <a class="el" href="setup__recon_8c.html#a7b4a99c91fb0c1610745603a580cedf6">free_cxx</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structRECON__T.html">RECON_T</a> *&#160;</td>
          <td class="paramname"><em>recon</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Frees recon-&gt;invpsd or recon-&gt;fractal. </p>

</div>
</div>
<a class="anchor" id="a2ade74dd6feba7dba0a4b6f38fe134a8"></a><!-- doxytag: member="setup_recon.c::setup_recon_tomo_prep" ref="a2ade74dd6feba7dba0a4b6f38fe134a8" args="(RECON_T *recon, const PARMS_T *parms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="setup__recon_8c.html#a2ade74dd6feba7dba0a4b6f38fe134a8">setup_recon_tomo_prep</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structRECON__T.html">RECON_T</a> *&#160;</td>
          <td class="paramname"><em>recon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&#160;</td>
          <td class="paramname"><em>parms</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Prepares for tomography. </p>
<p>ALlow it to be called multiple times for Cn2 update. </p>

</div>
</div>
<a class="anchor" id="a6315a2cf8494166cf646588f94ce894b"></a><!-- doxytag: member="setup_recon.c::setup_recon_tomo_matrix" ref="a6315a2cf8494166cf646588f94ce894b" args="(RECON_T *recon, const PARMS_T *parms, APER_T *aper)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="setup__recon_8c.html#a6315a2cf8494166cf646588f94ce894b">setup_recon_tomo_matrix</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structRECON__T.html">RECON_T</a> *&#160;</td>
          <td class="paramname"><em>recon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&#160;</td>
          <td class="paramname"><em>parms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structAPER__T.html">APER_T</a> *&#160;</td>
          <td class="paramname"><em>aper</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>assemble tomography matrix. </p>
<p>In CG mode, this function is not executed if tomo.assemble=0, Instead, the algorithm is contained in <a class="el" href="recon_8c.html" title="Wavefront reconstruction and DM fitting routines.">recon.c</a>. When you modify anything, make sure you also do it there.</p>
<p>For integrated tomograhy:</p>
<p><img class="formulaInl" alt="$\hat{x}=(G_{lgs}^{T}C_{lgs}^{-1}G_{lgs}+C_{x}^{-1}+G_{ngs}^{T}C_{ngs}^{-1} G_{ngs})^{-1}(G_{lgs}^{T}C_{lgs}^{-1}s_{lgs}+G_{ngs}^{T}C_{ngs}^{-1}s_{ngs}){\equiv}RL^{-1}RR s.$" src="form_40.png"/></p>
<p>For split tomography, the terms regarding NGS are dropped:</p>
<p><img class="formulaInl" alt="$\hat{x}_{lgs}=(G_{lgs}^{T}C_{lgs}^{-1}G_{lgs}+C_{x}^{-1})^{-1} G_{lgs}^{T}C_{lgs}^{-1}s_{lgs}\equiv R_L^{-1} R_R s.$" src="form_41.png"/></p>
<p>The left hand side of linear equation (inside the inverse) is stored in RL. The right hand side of the linear equation (outside of the inverse) is stored in RR. The terms regarding the NGS are handled using low rank terms. The gradients from LGS and NGS and concatenated to <img class="formulaInl" alt="$s$" src="form_42.png"/>.</p>
<p>In the LGS part, there is a global tip/tilt removal operator because LGS is insensitive to global tip/tilts.</p>
<p>For details see www.opticsinfobase.org/abstract.cfm?URI=josaa-19-9-1803 </p>

</div>
</div>
<a class="anchor" id="aa860829623f5076a779fa20d62f5b6d9"></a><!-- doxytag: member="setup_recon.c::setup_recon_tomo_update" ref="aa860829623f5076a779fa20d62f5b6d9" args="(RECON_T *recon, const PARMS_T *parms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="setup__recon_8c.html#aa860829623f5076a779fa20d62f5b6d9">setup_recon_tomo_update</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structRECON__T.html">RECON_T</a> *&#160;</td>
          <td class="paramname"><em>recon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&#160;</td>
          <td class="paramname"><em>parms</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Update assembled tomography matrix with new L2. </p>
<p>Called from cn2est when new profiles are available. </p>

</div>
</div>
<a class="anchor" id="a855fa8cdbea7f506b823e00f362f06c5"></a><!-- doxytag: member="setup_recon.c::setup_recon_HXF" ref="a855fa8cdbea7f506b823e00f362f06c5" args="(RECON_T *recon, const PARMS_T *parms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void <a class="el" href="setup__recon_8c.html#a855fa8cdbea7f506b823e00f362f06c5">setup_recon_HXF</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structRECON__T.html">RECON_T</a> *&#160;</td>
          <td class="paramname"><em>recon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&#160;</td>
          <td class="paramname"><em>parms</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Setup ray tracing operator HXF from xloc to aperture ploc along DM fiting directions. </p>

</div>
</div>
<a class="anchor" id="a99b595aebae8532a2893e98edd9356c2"></a><!-- doxytag: member="setup_recon.c::setup_recon_HA" ref="a99b595aebae8532a2893e98edd9356c2" args="(RECON_T *recon, const PARMS_T *parms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void <a class="el" href="setup__recon_8c.html#a99b595aebae8532a2893e98edd9356c2">setup_recon_HA</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structRECON__T.html">RECON_T</a> *&#160;</td>
          <td class="paramname"><em>recon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&#160;</td>
          <td class="paramname"><em>parms</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Setup ray tracing operator HA from aloc to aperture ploc along DM fiting direction. </p>

</div>
</div>
<a class="anchor" id="a630c6d5a66160c402a727df359300f20"></a><!-- doxytag: member="setup_recon.c::fit_prep_lrt" ref="a630c6d5a66160c402a727df359300f20" args="(RECON_T *recon, const PARMS_T *parms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void <a class="el" href="setup__recon_8c.html#a630c6d5a66160c402a727df359300f20">fit_prep_lrt</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structRECON__T.html">RECON_T</a> *&#160;</td>
          <td class="paramname"><em>recon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&#160;</td>
          <td class="paramname"><em>parms</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Setup fitting low rank terms that are in the NULL space of DM fitting operator. </p>
<p>typically include piston on each DM and tip/tilt on certain DMs. Becareful with tip/tilt contraint when using CBS. </p>

</div>
</div>
<a class="anchor" id="af7a8a7478b06b8b4f0d27784819f41c2"></a><!-- doxytag: member="setup_recon.c::setup_recon_fit_matrix" ref="af7a8a7478b06b8b4f0d27784819f41c2" args="(RECON_T *recon, const PARMS_T *parms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void <a class="el" href="setup__recon_8c.html#af7a8a7478b06b8b4f0d27784819f41c2">setup_recon_fit_matrix</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structRECON__T.html">RECON_T</a> *&#160;</td>
          <td class="paramname"><em>recon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&#160;</td>
          <td class="paramname"><em>parms</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Assemble the DM fitting matrix. </p>
<p>The fitting is done by minimizing <img class="formulaInl" alt="$||H_X x - H_A a||^2_W$" src="form_43.png"/> where <img class="formulaInl" alt="$H_X, H_A$" src="form_44.png"/> are ray tracing operator from tomography grid xloc, and deformable mirror grid aloc to pupil grid ploc. The norm is weighted using bilinear influence functions within the telescope aperture. We have</p>
<p><img class="formulaInl" alt="$a=\left[H_A^T(W_0-W_1 W_1^T)H_A\right]^{-1} H_A^T (W_0-W_1) H_X x$" src="form_45.png"/></p>
<p>For details see www.opticsinfobase.org/abstract.cfm?URI=josaa-19-9-1803 </p>

</div>
</div>
<a class="anchor" id="a4f4abf13c9b0972de67fab348bb9f470"></a><!-- doxytag: member="setup_recon.c::setup_recon_focus" ref="a4f4abf13c9b0972de67fab348bb9f470" args="(RECON_T *recon, POWFS_T *powfs, const PARMS_T *parms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void <a class="el" href="setup__recon_8c.html#a4f4abf13c9b0972de67fab348bb9f470">setup_recon_focus</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structRECON__T.html">RECON_T</a> *&#160;</td>
          <td class="paramname"><em>recon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structPOWFS__T.html">POWFS_T</a> *&#160;</td>
          <td class="paramname"><em>powfs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&#160;</td>
          <td class="paramname"><em>parms</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Create the reconstructor to reconstruct the residual focus error due to LGS sodium tracking error. </p>
<p>Need to average out the focus error caused by atmosphere when applying (a low pass filter is applied to the output). </p>

</div>
</div>
<a class="anchor" id="a73a310c15901ee437d44af53a66b22a6"></a><!-- doxytag: member="setup_recon.c::setup_recon_mvst" ref="a73a310c15901ee437d44af53a66b22a6" args="(RECON_T *recon, const PARMS_T *parms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="setup__recon_8c.html#a73a310c15901ee437d44af53a66b22a6">setup_recon_mvst</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structRECON__T.html">RECON_T</a> *&#160;</td>
          <td class="paramname"><em>recon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&#160;</td>
          <td class="paramname"><em>parms</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>compute the MVST split tomography NGS mode reconstructor. </p>
<p>2010-03-16: New Implementation.</p>
<p>Definition:</p>
<ul>
<li><img class="formulaInl" alt="$G_{lgs}$" src="form_46.png"/> is LGS gradient operator from xloc, contained in recon-&gt;GXtomo as spcell</li>
<li><img class="formulaInl" alt="$G_{ngs}$" src="form_47.png"/> is NGS gradient operator from xloc, contained in recon-&gt;GXL as dense matrix</li>
<li><img class="formulaInl" alt="$C_{lgs}, C_{ngs}$" src="form_48.png"/> is the LGS, and NGS measurement noise covariance matrix.</li>
<li><img class="formulaInl" alt="$\hat{x}_{lgs}$" src="form_49.png"/> is LGS tomography output</li>
<li><img class="formulaInl" alt="$\hat{x}_{ngs}$" src="form_50.png"/> is NGS minimum variance split tomography output</li>
<li><img class="formulaInl" alt="$a_{ngs}$" src="form_51.png"/> is NGS minimum variance DM output.</li>
<li><img class="formulaInl" alt="$F$" src="form_52.png"/> is the fitting operator</li>
<li><img class="formulaInl" alt="$H_A$" src="form_53.png"/> is the ray tracing operator from aloc to ploc, contained in recon-&gt;HA.</li>
<li><img class="formulaInl" alt="$MVModes$" src="form_54.png"/> is the MVST NGS modes</li>
<li><img class="formulaInl" alt="$MVRngs$" src="form_55.png"/> is the MVST NGS reconstructor</li>
</ul>
<p>We have</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} \hat{x}_{lgs}&amp;=&amp;A^{-1}G^{T}_{lgs}C_{lgs}^{-1}s_{lgs}\\ Uw&amp;=&amp;A^{-1}G_{ngs}^TC_{ngs}\\ \hat{x}_{ngs}&amp;=&amp;Uw(1+G_{ngs}Uw)^{-1}(s_{ngs}-G_{ngs}\hat{x}_{lgs});\\ a_{NGS}&amp;=&amp;F\hat{x}_{ngs}\\ MVModes&amp;=&amp;F\cdot Uw\\ MVRngs&amp;=&amp;(1+G_{ngs}Uw)^{-1} \end{eqnarray*}" src="form_56.png"/>
</p>
<p>We need to orthnormalize the NGS modes. Propagate the NGS modes <img class="formulaInl" alt="$F\cdot Uw$" src="form_57.png"/> to fitting directions and compute the cross-coupling matrix with weighting on <img class="formulaInl" alt="$W_0, W_1$" src="form_58.png"/>, we have</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} Q&amp;=&amp;H_A\cdot F \cdot Uw\\ M_{CC}&amp;=&amp;Q^T(W_0-W_1 W_1^T)Q\\ \end{eqnarray*}" src="form_59.png"/>
</p>
<p>Do SVD on <img class="formulaInl" alt="$MCC$" src="form_60.png"/> we have <img class="formulaInl" alt="$M_{CC}=u\Sigma v^T $" src="form_61.png"/> where <img class="formulaInl" alt="$u{\equiv}v$" src="form_62.png"/> because <img class="formulaInl" alt="$MCC$" src="form_60.png"/> is symmetric. Redefine the NGS modes and reconstructor as</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} MVModes&amp;=&amp;F\cdot Uw\cdot u \Sigma^{-1/2}\\ MVRngs&amp;=&amp;\Sigma^{1/2}u^T (1+G_{ngs}A^{-1}G_{ngs}^T C_{ngs}^{-1})^{-1} \end{eqnarray*}" src="form_63.png"/>
</p>
 
</div>
</div>
<a class="anchor" id="a95eec4dfd4e6369d1c7165b340f8217a"></a><!-- doxytag: member="setup_recon.c::setup_recon_mvr_fit" ref="a95eec4dfd4e6369d1c7165b340f8217a" args="(RECON_T *recon, const PARMS_T *parms, APER_T *aper)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void <a class="el" href="setup__recon_8c.html#a95eec4dfd4e6369d1c7165b340f8217a">setup_recon_mvr_fit</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structRECON__T.html">RECON_T</a> *&#160;</td>
          <td class="paramname"><em>recon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&#160;</td>
          <td class="paramname"><em>parms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structAPER__T.html">APER_T</a> *&#160;</td>
          <td class="paramname"><em>aper</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Sets up the tomogrpahy turbulence reconstruction structs including wavefront reconstructor and DM fitting operator. </p>
<p>Calls <a class="el" href="setup__recon_8c.html#a6315a2cf8494166cf646588f94ce894b" title="assemble tomography matrix.">setup_recon_tomo_matrix()</a> and <a class="el" href="setup__recon_8c.html#af7a8a7478b06b8b4f0d27784819f41c2" title="Assemble the DM fitting matrix.">setup_recon_fit_matrix()</a> to setup the tomography and DM fitting matrix.</p>
<p>AHST is handled in <a class="el" href="ahst_8c.html#a55c65679c193d90bc7f5175ebb17733f" title="setup NGS modes and reconstructor using AHST for one or two DMs.">setup_ngsmod()</a>.</p>
<p>MVST is handled in <a class="el" href="setup__recon_8c.html#a73a310c15901ee437d44af53a66b22a6" title="compute the MVST split tomography NGS mode reconstructor.">setup_recon_mvst()</a>.</p>
<p>MOAO is handled in <a class="el" href="moao_8c.html#ac70e508023f8816854d7d4eaf0452aa6" title="Prepare the propagation H matrix for MOAO and compute the reconstructor.">setup_recon_moao()</a>. </p>

</div>
</div>
<a class="anchor" id="a7f4e89b0190b622d12b9f2276b94ec47"></a><!-- doxytag: member="setup_recon.c::setup_recon_lsr" ref="a7f4e89b0190b622d12b9f2276b94ec47" args="(RECON_T *recon, const PARMS_T *parms, POWFS_T *powfs, APER_T *aper)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="setup__recon_8c.html#a7f4e89b0190b622d12b9f2276b94ec47">setup_recon_lsr</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structRECON__T.html">RECON_T</a> *&#160;</td>
          <td class="paramname"><em>recon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&#160;</td>
          <td class="paramname"><em>parms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structPOWFS__T.html">POWFS_T</a> *&#160;</td>
          <td class="paramname"><em>powfs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structAPER__T.html">APER_T</a> *&#160;</td>
          <td class="paramname"><em>aper</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Setup the least square reconstruct by directly inverting GA matrix. </p>
<p>The reconstructor is simply the pseudo inverse of GA matrix: </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[\hat{x}=(G_a^TC_g^{-1}G_a)^{-1}G_a^TC_g^{-1}\]" src="form_64.png"/>
</p>
<p>This is very close to RR except replacing GX with GA.</p>
<p>We use the tomogrpahy parameters for lsr, since lsr is simply "tomography" onto DM directly. </p>

</div>
</div>
<a class="anchor" id="a1863adc60520febdb733930f3bf32e5a"></a><!-- doxytag: member="setup_recon.c::setup_recon_lsr_mvm" ref="a1863adc60520febdb733930f3bf32e5a" args="(RECON_T *recon, const PARMS_T *parms, POWFS_T *powfs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="setup__recon_8c.html#a1863adc60520febdb733930f3bf32e5a">setup_recon_lsr_mvm</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structRECON__T.html">RECON_T</a> *&#160;</td>
          <td class="paramname"><em>recon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&#160;</td>
          <td class="paramname"><em>parms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structPOWFS__T.html">POWFS_T</a> *&#160;</td>
          <td class="paramname"><em>powfs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Use the various algorithms recon.alg to assemble a final matrix to multiply to gradients to get DM commands. </p>

</div>
</div>
<a class="anchor" id="a14a4f6e974e84b54eeff66aba40ba5d5"></a><!-- doxytag: member="setup_recon.c::setup_recon_mvr_mvm" ref="a14a4f6e974e84b54eeff66aba40ba5d5" args="(RECON_T *recon, const PARMS_T *parms, POWFS_T *powfs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="setup__recon_8c.html#a14a4f6e974e84b54eeff66aba40ba5d5">setup_recon_mvr_mvm</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structRECON__T.html">RECON_T</a> *&#160;</td>
          <td class="paramname"><em>recon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&#160;</td>
          <td class="paramname"><em>parms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structPOWFS__T.html">POWFS_T</a> *&#160;</td>
          <td class="paramname"><em>powfs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Use the various algorithms recon.alg to assemble a final matrix to multiply to gradients to get DM commands. </p>

</div>
</div>
<a class="anchor" id="a6ec32666222d37047d7775b874969a2e"></a><!-- doxytag: member="setup_recon.c::setup_recon" ref="a6ec32666222d37047d7775b874969a2e" args="(const PARMS_T *parms, POWFS_T *powfs, APER_T *aper)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structRECON__T.html">RECON_T</a>* <a class="el" href="setup__recon_8c.html#a6ec32666222d37047d7775b874969a2e">setup_recon</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&#160;</td>
          <td class="paramname"><em>parms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structPOWFS__T.html">POWFS_T</a> *&#160;</td>
          <td class="paramname"><em>powfs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structAPER__T.html">APER_T</a> *&#160;</td>
          <td class="paramname"><em>aper</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Setup either the minimum variance reconstructor by calling setup_recon_mvr() or least square reconstructor by calling <a class="el" href="setup__recon_8c.html#a7f4e89b0190b622d12b9f2276b94ec47" title="Setup the least square reconstruct by directly inverting GA matrix.">setup_recon_lsr()</a> </p>

</div>
</div>
<a class="anchor" id="a810c17bd7027feae0decafb93f48efcf"></a><!-- doxytag: member="setup_recon.c::free_recon" ref="a810c17bd7027feae0decafb93f48efcf" args="(const PARMS_T *parms, RECON_T *recon)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="setup__recon_8c.html#a810c17bd7027feae0decafb93f48efcf">free_recon</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&#160;</td>
          <td class="paramname"><em>parms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structRECON__T.html">RECON_T</a> *&#160;</td>
          <td class="paramname"><em>recon</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Free the recon struct. </p>

</div>
</div>
</div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="setup__recon_8c.html">setup_recon.c</a>      </li>

    <li class="footer">Generated on Tue Aug 14 2012 09:47:57 for maos-1.2.0 by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
