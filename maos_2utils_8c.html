<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>maos-1.2.0: maos/utils.c File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="/home/lianqiw/work/programming/aos/doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">maos-1.2.0
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript" src="dynsections.js"></script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('maos_2utils_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">maos/utils.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>A few utility routines.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a6ddefc7009bf723f3d8e13466a902f03"></a><!-- doxytag: member="maos/utils.c::PSFCOMP_T" ref="a6ddefc7009bf723f3d8e13466a902f03" args="" -->
typedef struct PSFCOMP_T&#160;</td><td class="memItemRight" valign="bottom"><b>PSFCOMP_T</b></td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2utils_8c.html#a25c26cc7bf98368cc8e5b86e7dff8849">addnoise</a> (<a class="el" href="structdmat.html">dmat</a> *A, <a class="el" href="structmt__state.html">rand_t</a> *rstat, const double bkgrnd, const double pcalib, const double *bkgrnd2, const double *bkgrnd2c, const double rne)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">add photon and read out noise.  <a href="#a25c26cc7bf98368cc8e5b86e7dff8849"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structmap__t.html">map_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2utils_8c.html#a8d09c1d4e25788f3c2bda232ef257eba">create_metapupil_wrap</a> (const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, double ht, double dx, double offset, double guard, long ninx, long niny, int pad, int square)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Calls create_metapupil is simplified interface by returning a <a class="el" href="structmap__t.html" title="OPD or Amplitude map defined on square/rectangular grids.">map_t</a> object.  <a href="#a8d09c1d4e25788f3c2bda232ef257eba"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2utils_8c.html#a3f2c82d60281e9d95e31fd76d44ff113">create_metapupil</a> (const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, double ht, double dx, double offset, long *nxout, long *nyout, double *oxout, double *oyout, double **map, double guard, long ninx, long niny, int pad, int square)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">create a metapupil map, with size nx*ny, origin at (ox,oy), sampling of dx, height of ht, that can cover all the WFS and science beams.  <a href="#a3f2c82d60281e9d95e31fd76d44ff113"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2utils_8c.html#aa6846a7e8753720495fab427eb73a333">plotloc</a> (char *fig, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, <a class="el" href="structloc__t.html">loc_t</a> *loc, double ht, char *format,...)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Plot the projection of all the different FoVs on a certain grid.  <a href="#aa6846a7e8753720495fab427eb73a333"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2utils_8c.html#a17f83b9d00296996ebdaff0335ef4340">plotdir</a> (char *fig, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, double totfov, char *format,...)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">ploted all the different beam directions as points.  <a href="#a17f83b9d00296996ebdaff0335ef4340"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2utils_8c.html#af83a1d1fc29af913013c954d41d34490">rename_file</a> (int sig)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Rename the log files when simulation exits.  <a href="#af83a1d1fc29af913013c954d41d34490"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2utils_8c.html#a6331baae7550213ee98a12f9c3bbc5ce">maos_signal_handler</a> (int sig)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles signals.  <a href="#a6331baae7550213ee98a12f9c3bbc5ce"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2utils_8c.html#a0edd37fe65f6a8b1e530370f6e6402f3">print_usage</a> (void)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Print out usage information.  <a href="#a0edd37fe65f6a8b1e530370f6e6402f3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structARG__T.html">ARG_T</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2utils_8c.html#acb9c938dc842d5c52a16c7443fdb4ae3">parse_args</a> (int argc, char **argv)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Parse command line arguments argc, argv.  <a href="#acb9c938dc842d5c52a16c7443fdb4ae3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structcmat.html">cmat</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2utils_8c.html#afac016dcc985dec7741db2ff6118f8de">strehlcomp</a> (const <a class="el" href="structdmat.html">dmat</a> *iopdevl, const double *amp, const double wvl)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Computes strehl from OPD without doing FFT.  <a href="#afac016dcc985dec7741db2ff6118f8de"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structccell.html">ccell</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2utils_8c.html#adb8db3a2777ac6e30bb47af9101324b8">psfcomp</a> (const <a class="el" href="structdmat.html">dmat</a> *iopdevl, const double *amp, long **embeds, const long *nembeds, const int *psfsize, const int nwvl, const double *wvl)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Call psfcomp_iwvl in parallel to compute PSF in each wvl.  <a href="#adb8db3a2777ac6e30bb47af9101324b8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2utils_8c.html#aa25aba0a3101a4f153c4752b31513a91">psfcomp_iwvl</a> (<a class="el" href="structthread__t.html">thread_t</a> *thdata)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Computes PSF from OPD by doing FFT.  <a href="#aa25aba0a3101a4f153c4752b31513a91"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2utils_8c.html#abd8c62a4ca2f063bea3a863d2f7e0107">embed_in</a> (double *out, const double *in, long nin, long *embed)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Simple embed and accumulation.  <a href="#abd8c62a4ca2f063bea3a863d2f7e0107"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2utils_8c.html#a82fb97c6bab04cdbdc0867c62c76626a">embed_out</a> (const double *out, double *in, long nin, long *embed)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Simple embed and accumulation.  <a href="#a82fb97c6bab04cdbdc0867c62c76626a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2utils_8c.html#aae42946e50ae83f2aaf0a9b138495b04">embedc_in</a> (dcomplex *out, const double *in, long nin, long *embed)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Simple embed and accumulation.  <a href="#aae42946e50ae83f2aaf0a9b138495b04"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2utils_8c.html#a388084f54494bcbeb13bf14450771203">embedc_out</a> (const dcomplex *out, double *in, long nin, long *embed)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Simple embed and accumulation.  <a href="#a388084f54494bcbeb13bf14450771203"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2utils_8c.html#a5c7b446004c896c4369a93a863815d77">calc_aniso</a> (double r0, int nht, double *ht, double *wt)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Estimate anisoplanatic angle theta0 from Fried parameter r0, layer height and weights.  <a href="#a5c7b446004c896c4369a93a863815d77"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2utils_8c.html#a066f38258e20d362d1e184a397697828">calc_aniso2</a> (double r0, int nht, double *ht, double *wt, double hc1, double hc2)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Estimate generalized aniso angle theta2 from Fried parameter r0, and layer height and weights, and deformable mirror conjugation heights hc1 hc2 of the ground and altitude DMs.  <a href="#a066f38258e20d362d1e184a397697828"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a42587bb89ea768b120b893036125bd92"></a><!-- doxytag: member="maos/utils.c::evl_header" ref="a42587bb89ea768b120b893036125bd92" args="(const PARMS_T *parms, const APER_T *aper, int ievl, int iwvl)" -->
char *&#160;</td><td class="memItemRight" valign="bottom"><b>evl_header</b> (const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, const <a class="el" href="structAPER__T.html">APER_T</a> *aper, int ievl, int iwvl)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="afc4d170177b3cdad0db1efefa5386bc7"></a><!-- doxytag: member="maos/utils.c::apply_fieldstop" ref="afc4d170177b3cdad0db1efefa5386bc7" args="(dmat *opd, dmat *amp, long *embed, long nembed, dmat *fieldstop, double wvl)" -->
void&#160;</td><td class="memItemRight" valign="bottom"><b>apply_fieldstop</b> (<a class="el" href="structdmat.html">dmat</a> *opd, <a class="el" href="structdmat.html">dmat</a> *amp, long *embed, long nembed, <a class="el" href="structdmat.html">dmat</a> *fieldstop, double wvl)</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>A few utility routines. </p>
</div><hr/><h2>Function Documentation</h2>
<a class="anchor" id="a25c26cc7bf98368cc8e5b86e7dff8849"></a><!-- doxytag: member="utils.c::addnoise" ref="a25c26cc7bf98368cc8e5b86e7dff8849" args="(dmat *A, rand_t *rstat, const double bkgrnd, const double pcalib, const double *bkgrnd2, const double *bkgrnd2c, const double rne)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="skysim__utils_8c.html#adf5e26bd725524c1a800351e6322a6ed">addnoise</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdmat.html">dmat</a> *&#160;</td>
          <td class="paramname"><em>A</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structmt__state.html">rand_t</a> *&#160;</td>
          <td class="paramname"><em>rstat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>bkgrnd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>pcalib</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double *&#160;</td>
          <td class="paramname"><em>bkgrnd2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double *&#160;</td>
          <td class="paramname"><em>bkgrnd2c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>rne</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>add photon and read out noise. </p>
<p>pcalib part of bkgrnd is calibrated out. pcalib2 part of bkgrnd2 is calibrated out. </p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">A</td><td>The pixel intensity array </td></tr>
    <tr><td class="paramname">rstat</td><td>The random stream </td></tr>
    <tr><td class="paramname">bkgrnd</td><td>background in PDEs per pixel per frame </td></tr>
    <tr><td class="paramname">pcalib</td><td>Fraction of bkgrnd that is calibrated out </td></tr>
    <tr><td class="paramname">bkgrnd2</td><td>background in PDEs of each pixel per frame. </td></tr>
    <tr><td class="paramname">bkgrnd2c</td><td>calibration bkgrnd2 </td></tr>
    <tr><td class="paramname">rne</td><td>Read out noise per pixel per read </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a8d09c1d4e25788f3c2bda232ef257eba"></a><!-- doxytag: member="utils.c::create_metapupil_wrap" ref="a8d09c1d4e25788f3c2bda232ef257eba" args="(const PARMS_T *parms, double ht, double dx, double offset, double guard, long ninx, long niny, int pad, int square)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structmap__t.html">map_t</a>* <a class="el" href="maos_2utils_8c.html#a8d09c1d4e25788f3c2bda232ef257eba">create_metapupil_wrap</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&#160;</td>
          <td class="paramname"><em>parms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>ht</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>dx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>guard</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>ninx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>niny</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>pad</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>square</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Calls create_metapupil is simplified interface by returning a <a class="el" href="structmap__t.html" title="OPD or Amplitude map defined on square/rectangular grids.">map_t</a> object. </p>

</div>
</div>
<a class="anchor" id="a3f2c82d60281e9d95e31fd76d44ff113"></a><!-- doxytag: member="utils.c::create_metapupil" ref="a3f2c82d60281e9d95e31fd76d44ff113" args="(const PARMS_T *parms, double ht, double dx, double offset, long *nxout, long *nyout, double *oxout, double *oyout, double **map, double guard, long ninx, long niny, int pad, int square)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="maos_2utils_8c.html#a3f2c82d60281e9d95e31fd76d44ff113">create_metapupil</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&#160;</td>
          <td class="paramname"><em>parms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>ht</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>dx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long *&#160;</td>
          <td class="paramname"><em>nxout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long *&#160;</td>
          <td class="paramname"><em>nyout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>oxout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>oyout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double **&#160;</td>
          <td class="paramname"><em>map</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>guard</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>ninx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>niny</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>pad</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>square</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>create a metapupil map, with size nx*ny, origin at (ox,oy), sampling of dx, height of ht, that can cover all the WFS and science beams. </p>
<p>offset: distance in pixel from the point closest to the origin to origin (right side). 0: there is a point on the origin. 1/2: the closest point to origin is 1/2 pixel.</p>
<p>pad: 1: round nx, ny to power of 2. </p>

</div>
</div>
<a class="anchor" id="aa6846a7e8753720495fab427eb73a333"></a><!-- doxytag: member="utils.c::plotloc" ref="aa6846a7e8753720495fab427eb73a333" args="(char *fig, const PARMS_T *parms, loc_t *loc, double ht, char *format,...)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="maos_2utils_8c.html#aa6846a7e8753720495fab427eb73a333">plotloc</a> </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>fig</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&#160;</td>
          <td class="paramname"><em>parms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structloc__t.html">loc_t</a> *&#160;</td>
          <td class="paramname"><em>loc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>ht</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>format</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Plot the projection of all the different FoVs on a certain grid. </p>
<p>used in setup_recon </p>

</div>
</div>
<a class="anchor" id="a17f83b9d00296996ebdaff0335ef4340"></a><!-- doxytag: member="utils.c::plotdir" ref="a17f83b9d00296996ebdaff0335ef4340" args="(char *fig, const PARMS_T *parms, double totfov, char *format,...)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="maos_2utils_8c.html#a17f83b9d00296996ebdaff0335ef4340">plotdir</a> </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>fig</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&#160;</td>
          <td class="paramname"><em>parms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>totfov</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>format</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>ploted all the different beam directions as points. </p>
<p>used in setup_parms </p>

</div>
</div>
<a class="anchor" id="af83a1d1fc29af913013c954d41d34490"></a><!-- doxytag: member="utils.c::rename_file" ref="af83a1d1fc29af913013c954d41d34490" args="(int sig)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="maos_2utils_8c.html#af83a1d1fc29af913013c954d41d34490">rename_file</a> </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>sig</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Rename the log files when simulation exits. </p>

</div>
</div>
<a class="anchor" id="a6331baae7550213ee98a12f9c3bbc5ce"></a><!-- doxytag: member="utils.c::maos_signal_handler" ref="a6331baae7550213ee98a12f9c3bbc5ce" args="(int sig)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="maos_2utils_8c.html#a6331baae7550213ee98a12f9c3bbc5ce">maos_signal_handler</a> </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>sig</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Handles signals. </p>
<p>We don't want to exit the simulation when SIGPIPE happens (when we are writing to closed sockets) </p>

</div>
</div>
<a class="anchor" id="a0edd37fe65f6a8b1e530370f6e6402f3"></a><!-- doxytag: member="utils.c::print_usage" ref="a0edd37fe65f6a8b1e530370f6e6402f3" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void <a class="el" href="maos_2utils_8c.html#a0edd37fe65f6a8b1e530370f6e6402f3">print_usage</a> </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Print out usage information. </p>

</div>
</div>
<a class="anchor" id="acb9c938dc842d5c52a16c7443fdb4ae3"></a><!-- doxytag: member="utils.c::parse_args" ref="acb9c938dc842d5c52a16c7443fdb4ae3" args="(int argc, char **argv)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structARG__T.html">ARG_T</a>* <a class="el" href="maos_2utils_8c.html#acb9c938dc842d5c52a16c7443fdb4ae3">parse_args</a> </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>argv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Parse command line arguments argc, argv. </p>

</div>
</div>
<a class="anchor" id="afac016dcc985dec7741db2ff6118f8de"></a><!-- doxytag: member="utils.c::strehlcomp" ref="afac016dcc985dec7741db2ff6118f8de" args="(const dmat *iopdevl, const double *amp, const double wvl)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structcmat.html">cmat</a>* <a class="el" href="maos_2utils_8c.html#afac016dcc985dec7741db2ff6118f8de">strehlcomp</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structdmat.html">dmat</a> *&#160;</td>
          <td class="paramname"><em>iopdevl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double *&#160;</td>
          <td class="paramname"><em>amp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>wvl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Computes strehl from OPD without doing FFT. </p>
<p>The strehl is simply</p>
<p><img class="formulaInl" alt="$s=\sum(A*exp[\frac{2\pi i}{\lambda}*\textrm{OPD}]) $" src="form_67.png"/></p>
<p>where A is the amplitude map. </p>

</div>
</div>
<a class="anchor" id="adb8db3a2777ac6e30bb47af9101324b8"></a><!-- doxytag: member="utils.c::psfcomp" ref="adb8db3a2777ac6e30bb47af9101324b8" args="(const dmat *iopdevl, const double *amp, long **embeds, const long *nembeds, const int *psfsize, const int nwvl, const double *wvl)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structccell.html">ccell</a>* <a class="el" href="maos_2utils_8c.html#adb8db3a2777ac6e30bb47af9101324b8">psfcomp</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structdmat.html">dmat</a> *&#160;</td>
          <td class="paramname"><em>iopdevl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double *&#160;</td>
          <td class="paramname"><em>amp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long **&#160;</td>
          <td class="paramname"><em>embeds</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const long *&#160;</td>
          <td class="paramname"><em>nembeds</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int *&#160;</td>
          <td class="paramname"><em>psfsize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>nwvl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double *&#160;</td>
          <td class="paramname"><em>wvl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Call psfcomp_iwvl in parallel to compute PSF in each wvl. </p>

</div>
</div>
<a class="anchor" id="aa25aba0a3101a4f153c4752b31513a91"></a><!-- doxytag: member="utils.c::psfcomp_iwvl" ref="aa25aba0a3101a4f153c4752b31513a91" args="(thread_t *thdata)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="maos_2utils_8c.html#aa25aba0a3101a4f153c4752b31513a91">psfcomp_iwvl</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structthread__t.html">thread_t</a> *&#160;</td>
          <td class="paramname"><em>thdata</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Computes PSF from OPD by doing FFT. </p>
<p>The PSF is computed as</p>
<p><img class="formulaInl" alt="$\textrm{PSF}=\mathcal{F}[A\times exp[\frac{2\pi i}{\lambda}*\textrm{OPD}]]$" src="form_68.png"/></p>
<p>The peak value (center) in the computed PSF is normalized by the peak value in the differaction limited PSF. In other words, the peak value in the computed PSF is the Strehl. Keep this in mind when you compute enclosed energy. </p>

</div>
</div>
<a class="anchor" id="abd8c62a4ca2f063bea3a863d2f7e0107"></a><!-- doxytag: member="utils.c::embed_in" ref="abd8c62a4ca2f063bea3a863d2f7e0107" args="(double *out, const double *in, long nin, long *embed)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="maos_2utils_8c.html#abd8c62a4ca2f063bea3a863d2f7e0107">embed_in</a> </td>
          <td>(</td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double *&#160;</td>
          <td class="paramname"><em>in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>nin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long *&#160;</td>
          <td class="paramname"><em>embed</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Simple embed and accumulation. </p>

</div>
</div>
<a class="anchor" id="a82fb97c6bab04cdbdc0867c62c76626a"></a><!-- doxytag: member="utils.c::embed_out" ref="a82fb97c6bab04cdbdc0867c62c76626a" args="(const double *out, double *in, long nin, long *embed)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="maos_2utils_8c.html#a82fb97c6bab04cdbdc0867c62c76626a">embed_out</a> </td>
          <td>(</td>
          <td class="paramtype">const double *&#160;</td>
          <td class="paramname"><em>out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>nin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long *&#160;</td>
          <td class="paramname"><em>embed</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Simple embed and accumulation. </p>

</div>
</div>
<a class="anchor" id="aae42946e50ae83f2aaf0a9b138495b04"></a><!-- doxytag: member="utils.c::embedc_in" ref="aae42946e50ae83f2aaf0a9b138495b04" args="(dcomplex *out, const double *in, long nin, long *embed)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="maos_2utils_8c.html#aae42946e50ae83f2aaf0a9b138495b04">embedc_in</a> </td>
          <td>(</td>
          <td class="paramtype">dcomplex *&#160;</td>
          <td class="paramname"><em>out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double *&#160;</td>
          <td class="paramname"><em>in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>nin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long *&#160;</td>
          <td class="paramname"><em>embed</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Simple embed and accumulation. </p>
<p>for complex output </p>

</div>
</div>
<a class="anchor" id="a388084f54494bcbeb13bf14450771203"></a><!-- doxytag: member="utils.c::embedc_out" ref="a388084f54494bcbeb13bf14450771203" args="(const dcomplex *out, double *in, long nin, long *embed)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="maos_2utils_8c.html#a388084f54494bcbeb13bf14450771203">embedc_out</a> </td>
          <td>(</td>
          <td class="paramtype">const dcomplex *&#160;</td>
          <td class="paramname"><em>out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>nin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long *&#160;</td>
          <td class="paramname"><em>embed</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Simple embed and accumulation. </p>
<p>for real output. </p>

</div>
</div>
<a class="anchor" id="a5c7b446004c896c4369a93a863815d77"></a><!-- doxytag: member="utils.c::calc_aniso" ref="a5c7b446004c896c4369a93a863815d77" args="(double r0, int nht, double *ht, double *wt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="maos_2utils_8c.html#a5c7b446004c896c4369a93a863815d77">calc_aniso</a> </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>r0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nht</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>ht</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>wt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Estimate anisoplanatic angle theta0 from Fried parameter r0, layer height and weights. </p>

</div>
</div>
<a class="anchor" id="a066f38258e20d362d1e184a397697828"></a><!-- doxytag: member="utils.c::calc_aniso2" ref="a066f38258e20d362d1e184a397697828" args="(double r0, int nht, double *ht, double *wt, double hc1, double hc2)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="maos_2utils_8c.html#a066f38258e20d362d1e184a397697828">calc_aniso2</a> </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>r0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nht</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>ht</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>wt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>hc1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>hc2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Estimate generalized aniso angle theta2 from Fried parameter r0, and layer height and weights, and deformable mirror conjugation heights hc1 hc2 of the ground and altitude DMs. </p>

</div>
</div>
</div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="maos_2utils_8c.html">utils.c</a>      </li>

    <li class="footer">Generated on Tue Aug 14 2012 09:47:57 for maos-1.2.0 by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
