<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>maos-0.7.1: maos/setup_powfs.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>maos/setup_powfs.c File Reference</h1>Setting up WFS geometry.  
<a href="#_details">More...</a>
<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="e2f2638a878b96a88d02c346d003a0fa"></a><!-- doxytag: member="maos/setup_powfs.c::TEST_POWFS" ref="e2f2638a878b96a88d02c346d003a0fa" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>TEST_POWFS</b></td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__powfs_8c.html#f500bd9800a3b3f47a36b855a9f88ae9">free_powfs_geom</a> (<a class="el" href="structPOWFS__T.html">POWFS_T</a> *powfs, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, int ipowfs)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Free the powfs geometric parameters.  <a href="#f500bd9800a3b3f47a36b855a9f88ae9"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__powfs_8c.html#77b6fd986d6105964adf2c844ee9df87">setup_powfs_geom</a> (<a class="el" href="structPOWFS__T.html">POWFS_T</a> *powfs, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, <a class="el" href="structAPER__T.html">APER_T</a> *aper, int ipowfs)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">setting up subaperture geometry.  <a href="#77b6fd986d6105964adf2c844ee9df87"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__powfs_8c.html#e92ae33f8f650cb9c7975044bd82432f">setup_powfs_grad</a> (<a class="el" href="structPOWFS__T.html">POWFS_T</a> *powfs, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, int ipowfs)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Creating geometric wavefront gradient operator GS0 and ZA0 from WFS OPD to subaperture grads.  <a href="#e92ae33f8f650cb9c7975044bd82432f"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__powfs_8c.html#b1409e69dddf8131559ea35731109bda">setup_powfs_prep_phy</a> (<a class="el" href="structPOWFS__T.html">POWFS_T</a> *powfs, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, int ipowfs)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Prepare the parameters for physical optics setup.  <a href="#b1409e69dddf8131559ea35731109bda"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__powfs_8c.html#2589e29c8b5c4bd05b33da3638e8ae53">setup_powfs_ncpa</a> (<a class="el" href="structPOWFS__T.html">POWFS_T</a> *powfs, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, int ipowfs)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set up NCPA maps for each WFS.  <a href="#2589e29c8b5c4bd05b33da3638e8ae53"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__powfs_8c.html#692825f333d5738b213e2d6d4f1ab5d5">free_powfs_dtf</a> (<a class="el" href="structPOWFS__T.html">POWFS_T</a> *powfs, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, int ipowfs)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Free the detector transfer function.  <a href="#692825f333d5738b213e2d6d4f1ab5d5"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__powfs_8c.html#b1890fbc6facc2013338054962b1398a">setup_powfs_dtf</a> (<a class="el" href="structPOWFS__T.html">POWFS_T</a> *powfs, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, int ipowfs)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Setting up Detector transfer function used to translate PSFs from FFTs to detector pixel images.  <a href="#b1890fbc6facc2013338054962b1398a"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__powfs_8c.html#7bbae2bc69e06f553d55c7c2d8c68ff3">setup_powfs_focus</a> (<a class="el" href="structPOWFS__T.html">POWFS_T</a> *powfs, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, int ipowfs)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">setup the range to sodium layer as an additional parameter.  <a href="#7bbae2bc69e06f553d55c7c2d8c68ff3"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__powfs_8c.html#e2eab1b8ad97f659e38afe630140834e">setup_powfs_sodium</a> (<a class="el" href="structPOWFS__T.html">POWFS_T</a> *powfs, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, int ipowfs)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Load and smooth out sodium profile.  <a href="#e2eab1b8ad97f659e38afe630140834e"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__powfs_8c.html#bd59ad37c2a3372a70066e4b5cf34ac1">setup_powfs_etf</a> (<a class="el" href="structPOWFS__T.html">POWFS_T</a> *powfs, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, int ipowfs, int mode, int istep)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Compute Elongation Transfer function.  <a href="#bd59ad37c2a3372a70066e4b5cf34ac1"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__powfs_8c.html#a8ee626a374ebefb84c2d560793c4c1e">setup_powfs_llt</a> (<a class="el" href="structPOWFS__T.html">POWFS_T</a> *powfs, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, int ipowfs)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">setting up uplink pts/amp lotf  <a href="#a8ee626a374ebefb84c2d560793c4c1e"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__powfs_8c.html#a16bf88378b48f5765294689df77c22f">setup_powfs_mtch</a> (<a class="el" href="structPOWFS__T.html">POWFS_T</a> *powfs, const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, int ipowfs)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Setup the matched filter pixel processing parameters for physical optics wfs.  <a href="#a16bf88378b48f5765294689df77c22f"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structPOWFS__T.html">POWFS_T</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__powfs_8c.html#c7b704504acb96d7fbcbdd60f15c6cf8">setup_powfs</a> (const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, <a class="el" href="structAPER__T.html">APER_T</a> *aper)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Setup the powfs struct based on parms and aper.  <a href="#c7b704504acb96d7fbcbdd60f15c6cf8"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="maos_2setup__powfs_8c.html#4fdd29141f0d60af1fd7c6b2385f0031">free_powfs</a> (const <a class="el" href="structPARMS__T.html">PARMS_T</a> *parms, <a class="el" href="structPOWFS__T.html">POWFS_T</a> *powfs)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Free all parameters of powfs at the end of simulation.  <a href="#4fdd29141f0d60af1fd7c6b2385f0031"></a><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Setting up WFS geometry. 
<p>
like the subaperture location, subaperture grid points, physical optics detection transfer function, LGS elongation transfer function, etc.<p>
<dl compact><dt><b><a class="el" href="todo.html#_todo000009">Todo:</a></b></dt><dd>isolate DTF, ETF, routines, make then generic interface and relocate to the lib folder.</dd></dl>
Do not use sparse interpolation to replace ray tracing for fine sampled destination grid, especially cubic splines. The interpolation marix takes too much space. <hr><h2>Function Documentation</h2>
<a class="anchor" name="f500bd9800a3b3f47a36b855a9f88ae9"></a><!-- doxytag: member="setup_powfs.c::free_powfs_geom" ref="f500bd9800a3b3f47a36b855a9f88ae9" args="(POWFS_T *powfs, const PARMS_T *parms, int ipowfs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void free_powfs_geom           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structPOWFS__T.html">POWFS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>powfs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>parms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>ipowfs</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Free the powfs geometric parameters. 
<p>

</div>
</div><p>
<a class="anchor" name="77b6fd986d6105964adf2c844ee9df87"></a><!-- doxytag: member="setup_powfs.c::setup_powfs_geom" ref="77b6fd986d6105964adf2c844ee9df87" args="(POWFS_T *powfs, const PARMS_T *parms, APER_T *aper, int ipowfs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void setup_powfs_geom           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structPOWFS__T.html">POWFS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>powfs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>parms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structAPER__T.html">APER_T</a> *&nbsp;</td>
          <td class="paramname"> <em>aper</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>ipowfs</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
setting up subaperture geometry. 
<p>
<ul>
<li>powfs-&gt;pts: the location of the lower left grid coordinate in this subaperture &gt;=saloc.</li></ul>
<p>
<ul>
<li>powfs-&gt;saloc: the lower left corner of the subaperture</li></ul>
<p>
<ul>
<li>powfs-&gt;loc: the x,y coordinates of all the points, ordered acoording to subaperture. </li></ul>

</div>
</div><p>
<a class="anchor" name="e92ae33f8f650cb9c7975044bd82432f"></a><!-- doxytag: member="setup_powfs.c::setup_powfs_grad" ref="e92ae33f8f650cb9c7975044bd82432f" args="(POWFS_T *powfs, const PARMS_T *parms, int ipowfs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void setup_powfs_grad           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structPOWFS__T.html">POWFS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>powfs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>parms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>ipowfs</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Creating geometric wavefront gradient operator GS0 and ZA0 from WFS OPD to subaperture grads. 
<p>
Use loc, not locm. locm is only used to do ray tracing. 
</div>
</div><p>
<a class="anchor" name="b1409e69dddf8131559ea35731109bda"></a><!-- doxytag: member="setup_powfs.c::setup_powfs_prep_phy" ref="b1409e69dddf8131559ea35731109bda" args="(POWFS_T *powfs, const PARMS_T *parms, int ipowfs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void setup_powfs_prep_phy           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structPOWFS__T.html">POWFS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>powfs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>parms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>ipowfs</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Prepare the parameters for physical optics setup. 
<p>
<dl compact><dt><b><a class="el" href="todo.html#_todo000010">Todo:</a></b></dt><dd>Make LGS number of pixels depend on subapertue elongation in radial coordinate CCD mode. Make ncompx, ncompy dependent on number of pixels for radial ccd.</dd></dl>

</div>
</div><p>
<a class="anchor" name="2589e29c8b5c4bd05b33da3638e8ae53"></a><!-- doxytag: member="setup_powfs.c::setup_powfs_ncpa" ref="2589e29c8b5c4bd05b33da3638e8ae53" args="(POWFS_T *powfs, const PARMS_T *parms, int ipowfs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void setup_powfs_ncpa           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structPOWFS__T.html">POWFS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>powfs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>parms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>ipowfs</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Set up NCPA maps for each WFS. 
<p>
Load NCPA maps and ray trace to grid of loc 
</div>
</div><p>
<a class="anchor" name="692825f333d5738b213e2d6d4f1ab5d5"></a><!-- doxytag: member="setup_powfs.c::free_powfs_dtf" ref="692825f333d5738b213e2d6d4f1ab5d5" args="(POWFS_T *powfs, const PARMS_T *parms, int ipowfs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void free_powfs_dtf           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structPOWFS__T.html">POWFS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>powfs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>parms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>ipowfs</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Free the detector transfer function. 
<p>

</div>
</div><p>
<a class="anchor" name="b1890fbc6facc2013338054962b1398a"></a><!-- doxytag: member="setup_powfs.c::setup_powfs_dtf" ref="b1890fbc6facc2013338054962b1398a" args="(POWFS_T *powfs, const PARMS_T *parms, int ipowfs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void setup_powfs_dtf           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structPOWFS__T.html">POWFS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>powfs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>parms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>ipowfs</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Setting up Detector transfer function used to translate PSFs from FFTs to detector pixel images. 
<p>
Integration over pixel size and leaking between pixels are considered.<p>
We are going to sample the PSF <img class="formulaInl" alt="$\phi(\theta)$" src="form_22.png"> onto detectors. For a detector pixel <img class="formulaInl" alt="$i$" src="form_23.png"> at <img class="formulaInl" alt="$\theta_{i}$" src="form_24.png">, oriented along angle <img class="formulaInl" alt="$\alpha$" src="form_25.png">, we have <p class="formulaDsp">
<img class="formulaDsp" alt="\[ I(\theta_{i})=\int\textrm{d}\theta\phi(\theta)S(\theta-\theta_{i})=\int\textrm{d}\theta\phi(\theta-\theta_{i})S(\theta)\]" src="form_26.png">
<p>
 where <img class="formulaInl" alt="$S(\theta)$" src="form_27.png"> is the pixel weighting function. Rewrite the equation in Fourier domain,<p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} I(\theta_{i}) &amp; = &amp; \int\textrm{d}\theta\int\textrm{d} u\hat{\phi}(u)e^{2\pi i(\theta-\theta_{i})u}S(\theta)\\ &amp; = &amp; \int\textrm{d} u\hat{\phi}(u)\hat{S}(-u)e^{2\pi i\theta_{i}u}\\ &amp; = &amp; \mathcal{F}^{-1}[\hat{\phi}(u)\hat{S}(-u)](\theta_{i})\end{eqnarray*}" src="form_28.png">
<p>
<p>
For a polar coordinate CCD with pixel edges alonging , we have<p>
The detector pixels can be modeled as a square, convolved with a Gaussian to model the pixel blurring (charge leaking) <p class="formulaDsp">
<img class="formulaDsp" alt="\[ S(\theta)=S^{\prime}(\theta_{ra})=\sqcap(\theta_{r}/\Delta)\sqcap(\theta_{a}/\Delta)*\frac{1}{2\pi \theta_b^2}\exp(-\frac{\theta_r^2+\theta_u^2}{2\theta_b^2}) \]" src="form_29.png">
<p>
, where <img class="formulaInl" alt="$R$" src="form_30.png"> is the rotation matrix and <img class="formulaInl" alt="$\theta_{ra}=R^{T}\theta$" src="form_31.png"> is the coordinate in the local radial-azimuthal coordinate system for a Polar coordinate CCD, <img class="formulaInl" alt="$\theta_b$" src="form_32.png"> is a measure of the blurring of the pixel. For a pixel aligned along <img class="formulaInl" alt="$x/y$" src="form_33.png"> directions, <img class="formulaInl" alt="$R$" src="form_30.png"> is simply identity.<p>
The Fourier transform of the detector pixel function <img class="formulaInl" alt="$S(\theta)$" src="form_27.png"> is then<p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} \hat{S}(u) &amp; = &amp; \int\textrm{d}\theta S(\theta)e^{-2\pi i\theta^{T}u}\\ &amp; = &amp; \int\textrm{d}\theta S^{\prime}(R^{T}\theta)e^{-2\pi i\theta^{T}u}\\ &amp; = &amp;\int\textrm{d}(R^{T}\theta)S^{\prime}(R^{T}\theta)e^{-2\pi i(R^{T}\theta)^{T}(R^{T}u)}\\ &amp; = &amp; \hat{S^{\prime}}(R^{T}u)\end{eqnarray*}" src="form_34.png">
<p>
<p>
The Fourier transform of <img class="formulaInl" alt="$\hat{S^{\prime}}$" src="form_35.png"> is <p class="formulaDsp">
<img class="formulaDsp" alt="\[ \hat{S^{\prime}}(u_{ra})=\Delta^{2}\textrm{sinc}(u_{r}\Delta)\textrm{sinc}(u_{\theta}\Delta) \exp[-2\pi^2\theta_b^2(u_r^2+u_a^2)] \]" src="form_36.png">
<p>
<p>
Finally, we have <p class="formulaDsp">
<img class="formulaDsp" alt="\[ I(\theta_{i})=\mathcal{F}^{-1}[\hat{\phi}(u)\Delta^{2}\textrm{sinc}(\Delta(u_{x}\cos\theta+u_{y}\sin\theta))\textrm{sinc}(\Delta(-u_{x}\sin\theta+u_{y}\cos\theta))\exp[-2\pi^2\theta_b^2(u_r^2+u_a^2)](\theta_{i})\]" src="form_37.png">
<p>
 the last <img class="formulaInl" alt="$\theta_{i}$" src="form_24.png"> means evaluate the function at <img class="formulaInl" alt="$\theta_{i}$" src="form_24.png"> by interpolation. When there is leaking between actuators. We can multiply the sinc functions with a Gaussian blurring function. 
</div>
</div><p>
<a class="anchor" name="7bbae2bc69e06f553d55c7c2d8c68ff3"></a><!-- doxytag: member="setup_powfs.c::setup_powfs_focus" ref="7bbae2bc69e06f553d55c7c2d8c68ff3" args="(POWFS_T *powfs, const PARMS_T *parms, int ipowfs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void setup_powfs_focus           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structPOWFS__T.html">POWFS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>powfs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>parms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>ipowfs</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
setup the range to sodium layer as an additional parameter. 
<p>

</div>
</div><p>
<a class="anchor" name="e2eab1b8ad97f659e38afe630140834e"></a><!-- doxytag: member="setup_powfs.c::setup_powfs_sodium" ref="e2eab1b8ad97f659e38afe630140834e" args="(POWFS_T *powfs, const PARMS_T *parms, int ipowfs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void setup_powfs_sodium           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structPOWFS__T.html">POWFS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>powfs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>parms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>ipowfs</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Load and smooth out sodium profile. 
<p>

</div>
</div><p>
<a class="anchor" name="bd59ad37c2a3372a70066e4b5cf34ac1"></a><!-- doxytag: member="setup_powfs.c::setup_powfs_etf" ref="bd59ad37c2a3372a70066e4b5cf34ac1" args="(POWFS_T *powfs, const PARMS_T *parms, int ipowfs, int mode, int istep)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setup_powfs_etf           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structPOWFS__T.html">POWFS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>powfs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>parms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>ipowfs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>istep</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Compute Elongation Transfer function. 
<p>
<ul>
<li>mode=0: for preparation.</li><li>mode=1: for simulation. </li></ul>

</div>
</div><p>
<a class="anchor" name="a8ee626a374ebefb84c2d560793c4c1e"></a><!-- doxytag: member="setup_powfs.c::setup_powfs_llt" ref="a8ee626a374ebefb84c2d560793c4c1e" args="(POWFS_T *powfs, const PARMS_T *parms, int ipowfs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void setup_powfs_llt           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structPOWFS__T.html">POWFS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>powfs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>parms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>ipowfs</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
setting up uplink pts/amp lotf 
<p>

</div>
</div><p>
<a class="anchor" name="a16bf88378b48f5765294689df77c22f"></a><!-- doxytag: member="setup_powfs.c::setup_powfs_mtch" ref="a16bf88378b48f5765294689df77c22f" args="(POWFS_T *powfs, const PARMS_T *parms, int ipowfs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void setup_powfs_mtch           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structPOWFS__T.html">POWFS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>powfs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>parms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>ipowfs</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Setup the matched filter pixel processing parameters for physical optics wfs. 
<p>

</div>
</div><p>
<a class="anchor" name="c7b704504acb96d7fbcbdd60f15c6cf8"></a><!-- doxytag: member="setup_powfs.c::setup_powfs" ref="c7b704504acb96d7fbcbdd60f15c6cf8" args="(const PARMS_T *parms, APER_T *aper)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structPOWFS__T.html">POWFS_T</a>* setup_powfs           </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>parms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structAPER__T.html">APER_T</a> *&nbsp;</td>
          <td class="paramname"> <em>aper</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Setup the powfs struct based on parms and aper. 
<p>
Everything about wfs are setup here. 
<p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<p><center><img src="maos_2setup__powfs_8c_c7b704504acb96d7fbcbdd60f15c6cf8_cgraph.png" border="0" usemap="#maos_2setup__powfs_8c_c7b704504acb96d7fbcbdd60f15c6cf8_cgraph_map" alt=""></center>
<map name="maos_2setup__powfs_8c_c7b704504acb96d7fbcbdd60f15c6cf8_cgraph_map">
<area shape="rect" id="node3" href="maos_2setup__powfs_8c.html#b1890fbc6facc2013338054962b1398a" title="Setting up Detector transfer function used to translate PSFs from FFTs to detector..." alt="" coords="169,5,284,35"><area shape="rect" id="node5" href="maos_2setup__powfs_8c.html#bd59ad37c2a3372a70066e4b5cf34ac1" title="Compute Elongation Transfer function." alt="" coords="169,59,284,88"><area shape="rect" id="node7" href="maos_2setup__powfs_8c.html#7bbae2bc69e06f553d55c7c2d8c68ff3" title="setup the range to sodium layer as an additional parameter." alt="" coords="161,112,292,141"><area shape="rect" id="node9" href="maos_2setup__powfs_8c.html#77b6fd986d6105964adf2c844ee9df87" title="setting up subaperture geometry." alt="" coords="160,165,293,195"><area shape="rect" id="node11" href="maos_2setup__powfs_8c.html#e92ae33f8f650cb9c7975044bd82432f" title="Creating geometric wavefront gradient operator GS0 and ZA0 from WFS OPD to subaperture..." alt="" coords="164,219,289,248"><area shape="rect" id="node13" href="maos_2setup__powfs_8c.html#a8ee626a374ebefb84c2d560793c4c1e" title="setting up uplink pts/amp lotf" alt="" coords="172,272,281,301"><area shape="rect" id="node15" href="maos_2setup__powfs_8c.html#a16bf88378b48f5765294689df77c22f" title="Setup the matched filter pixel processing parameters for physical optics wfs." alt="" coords="161,325,292,355"><area shape="rect" id="node17" href="maos_2setup__powfs_8c.html#2589e29c8b5c4bd05b33da3638e8ae53" title="Set up NCPA maps for each WFS." alt="" coords="163,379,291,408"><area shape="rect" id="node19" href="maos_2setup__powfs_8c.html#b1409e69dddf8131559ea35731109bda" title="Prepare the parameters for physical optics setup." alt="" coords="149,432,304,461"><area shape="rect" id="node21" href="maos_2setup__powfs_8c.html#e2eab1b8ad97f659e38afe630140834e" title="Load and smooth out sodium profile." alt="" coords="156,485,297,515"></map>
</div>

</div>
</div><p>
<a class="anchor" name="4fdd29141f0d60af1fd7c6b2385f0031"></a><!-- doxytag: member="setup_powfs.c::free_powfs" ref="4fdd29141f0d60af1fd7c6b2385f0031" args="(const PARMS_T *parms, POWFS_T *powfs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void free_powfs           </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structPARMS__T.html">PARMS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>parms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structPOWFS__T.html">POWFS_T</a> *&nbsp;</td>
          <td class="paramname"> <em>powfs</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Free all parameters of powfs at the end of simulation. 
<p>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Wed Nov 3 13:02:52 2010 for maos-0.7.1 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
