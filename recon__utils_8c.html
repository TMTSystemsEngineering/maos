<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>maos-0.9.3: maos/recon_utils.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.3 -->
<script type="text/javascript">
function hasClass(ele,cls) {
  return ele.className.match(new RegExp('(\\s|^)'+cls+'(\\s|$)'));
}

function addClass(ele,cls) {
  if (!this.hasClass(ele,cls)) ele.className += " "+cls;
}

function removeClass(ele,cls) {
  if (hasClass(ele,cls)) {
    var reg = new RegExp('(\\s|^)'+cls+'(\\s|$)');
    ele.className=ele.className.replace(reg,' ');
  }
}

function toggleVisibility(linkObj) {
 var base = linkObj.getAttribute('id');
 var summary = document.getElementById(base + '-summary');
 var content = document.getElementById(base + '-content');
 var trigger = document.getElementById(base + '-trigger');
 if ( hasClass(linkObj,'closed') ) {
   summary.style.display = 'none';
   content.style.display = 'block';
   trigger.src = 'open.png';
   removeClass(linkObj,'closed');
   addClass(linkObj,'opened');
 } else if ( hasClass(linkObj,'opened') ) {
   summary.style.display = 'block';
   content.style.display = 'none';
   trigger.src = 'closed.png';
   removeClass(linkObj,'opened');
   addClass(linkObj,'closed');
 }
 return false;
}
</script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">maos-0.9.3</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('recon__utils_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#define-members">Defines</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<h1>maos/recon_utils.c File Reference</h1>  </div>
</div>
<div class="contents">

<p>Reusable utilities for wavefront reconstruction and DM fitting.  
<a href="#_details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__utils_8c.html#a97488232f6be5c7f5e41b64ff936187c">USE_PROP</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Speed up TomoL by gathering the first part of operations (GP*HXW) belonging to each WFS to facilitate threading.  <a href="#a97488232f6be5c7f5e41b64ff936187c"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ac0846a43d5d29570425f514e31ad3624"></a><!-- doxytag: member="recon_utils.c::Tomo_T" ref="ac0846a43d5d29570425f514e31ad3624" args="" -->
typedef struct Tomo_T&#160;</td><td class="memItemRight" valign="bottom"><b>Tomo_T</b></td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__utils_8c.html#a3691a5ab478320df78f3c0cff4412860">apply_L2</a> (<a class="el" href="structdcell.html">dcell</a> **xout, const <a class="el" href="structspcell.html">spcell</a> *L2, const <a class="el" href="structdcell.html">dcell</a> *xin, double alpha, int nthread)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Apply Laplacian2 to xin and accumulates to xout.  <a href="#a3691a5ab478320df78f3c0cff4412860"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__utils_8c.html#a666275101e117d56e1cf2908b18e0278">apply_invpsd</a> (<a class="el" href="structdcell.html">dcell</a> **xout, const void *A, const <a class="el" href="structdcell.html">dcell</a> *xin, double alpha, int xb, int yb)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Apply turbulence invpsd to xin in Fourier space, scaled by alpha and add to xout.  <a href="#a666275101e117d56e1cf2908b18e0278"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__utils_8c.html#a68ea00a9c6e3e064ff6b613e9718cf54">apply_fractal</a> (<a class="el" href="structdcell.html">dcell</a> **xout, const void *A, const <a class="el" href="structdcell.html">dcell</a> *xin, double alpha, int xb, int yb)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Apply fractal regularization to x, scaled by alpha.  <a href="#a68ea00a9c6e3e064ff6b613e9718cf54"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__utils_8c.html#a08347b75d2ff1eb95c0a179873921e98">TTFR</a> (<a class="el" href="structdcell.html">dcell</a> *x, const <a class="el" href="structdcell.html">dcell</a> *TTF, const <a class="el" href="structdcell.html">dcell</a> *PTTF)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Removing Tip/Tilt/Focus from LGS grads.  <a href="#a08347b75d2ff1eb95c0a179873921e98"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__utils_8c.html#a39b00d4db78618dec7b4a508b46331e3">applyWeach</a> (<a class="el" href="structdmat.html">dmat</a> *xin, const <a class="el" href="structdsp.html">dsp</a> *W0, const <a class="el" href="structdmat.html">dmat</a> *W1, const double wt)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Apply weighting W0/W1 to a vector.  <a href="#a39b00d4db78618dec7b4a508b46331e3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__utils_8c.html#aac31a93d205900027f62a385a321de0b">applyW</a> (<a class="el" href="structdcell.html">dcell</a> *xin, const <a class="el" href="structdsp.html">dsp</a> *W0, const <a class="el" href="structdmat.html">dmat</a> *W1, const double *wt)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">apply weighting W0/W1 with weighting wt for each block.  <a href="#aac31a93d205900027f62a385a321de0b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structdcell.html">dcell</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__utils_8c.html#ac2bca0565f72973497ae8d589a8be63d">calcWmcc</a> (const <a class="el" href="structdcell.html">dcell</a> *A, const <a class="el" href="structdcell.html">dcell</a> *B, const <a class="el" href="structdsp.html">dsp</a> *W0, const <a class="el" href="structdmat.html">dmat</a> *W1, const <a class="el" href="structdmat.html">dmat</a> *wt)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Compute W0/W1 weighting dot product: <img class="formulaInl" alt="$A^T(W0 B-W1 (W1^T B))$" src="form_23.png"/>.  <a href="#ac2bca0565f72973497ae8d589a8be63d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a5fd17a3391aa039aa387ecef4a5d14b0"></a><!-- doxytag: member="recon_utils.c::Tomo_prop" ref="a5fd17a3391aa039aa387ecef4a5d14b0" args="(thread_t *info)" -->
static void&#160;</td><td class="memItemRight" valign="bottom"><b>Tomo_prop</b> (<a class="el" href="structthread__t.html">thread_t</a> *info)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__utils_8c.html#a187ecf7ab34d0e125bb9c372ed2639e9">Tomo_nea</a> (<a class="el" href="structthread__t.html">thread_t</a> *info)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Speed up TomoL by gathering the second part of operations (GP') belonging to each WFS to facilitate threading.  <a href="#a187ecf7ab34d0e125bb9c372ed2639e9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__utils_8c.html#ab849736d0f99e67f7b5cb402f3aa767b">Tomo_iprop</a> (<a class="el" href="structthread__t.html">thread_t</a> *info)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Speed up TomoL by gathering the third part of operations (GP') belonging to each WFS to facilitate threading.  <a href="#ab849736d0f99e67f7b5cb402f3aa767b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__utils_8c.html#a98112ae2ee582d001eb0307d79eda59a">TomoR</a> (<a class="el" href="structdcell.html">dcell</a> **xout, const void *A, const <a class="el" href="structdcell.html">dcell</a> *gin, const double alpha)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Apply tomography right hand operator without using assembled matrix.  <a href="#a98112ae2ee582d001eb0307d79eda59a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__utils_8c.html#a3099e480359dfa43b2fe6b4868f1a704">TomoL</a> (<a class="el" href="structdcell.html">dcell</a> **xout, const void *A, const <a class="el" href="structdcell.html">dcell</a> *xin, const double alpha)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Apply tomography left hand side operator without using assembled matrix.  <a href="#a3099e480359dfa43b2fe6b4868f1a704"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__utils_8c.html#a168e09881164d7f61ac8e0620ec7135b">FitR</a> (<a class="el" href="structdcell.html">dcell</a> **xout, const void *A, const <a class="el" href="structdcell.html">dcell</a> *xin, const double alpha)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Apply fit right hand side matrix in CG mode without using assembled matrix.  <a href="#a168e09881164d7f61ac8e0620ec7135b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__utils_8c.html#a4a4842b145e88d09b903f986fe8951f2">FitL</a> (<a class="el" href="structdcell.html">dcell</a> **xout, const void *A, const <a class="el" href="structdcell.html">dcell</a> *xin, const double alpha)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Apply fit left hand side matrix in CG mode without using assembled matrix.  <a href="#a4a4842b145e88d09b903f986fe8951f2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__utils_8c.html#a3c8efd1ec94a9fdaae9021172da85d7a">focus_tracking</a> (<a class="el" href="structSIM__T.html">SIM_T</a> *simu)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Update LGS focus or reference vector.  <a href="#a3c8efd1ec94a9fdaae9021172da85d7a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__utils_8c.html#a7c33d35c2db2900c7439731319ffaf67">windest</a> (<a class="el" href="structSIM__T.html">SIM_T</a> *simu)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Experimental routine to do wind estimation using correlation tracking of tomography outputs.  <a href="#a7c33d35c2db2900c7439731319ffaf67"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structdsp.html">dsp</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__utils_8c.html#a8275bff1050a3bf784cbf75b0ed42092">nea2sp</a> (<a class="el" href="structdmat.html">dmat</a> **nea, long nsa)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Convert block of 2x2 neas to sparse matrix.  <a href="#a8275bff1050a3bf784cbf75b0ed42092"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__utils_8c.html#ad788e53dd64065c0991bba52acbfb0ad">psfr_calc</a> (<a class="el" href="structSIM__T.html">SIM_T</a> *simu, <a class="el" href="structdcell.html">dcell</a> *opdr, <a class="el" href="structdcell.html">dcell</a> *dmpsol, <a class="el" href="structdcell.html">dcell</a> *dmerr_hi, <a class="el" href="structdcell.html">dcell</a> *dmerr_lo)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Compute and save PSF reconstruction telemetry.  <a href="#ad788e53dd64065c0991bba52acbfb0ad"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__utils_8c.html#a9cdd8da33de20c241e64bdf98cae94bf">shift_grad</a> (<a class="el" href="structSIM__T.html">SIM_T</a> *simu)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Shift gradient when new gradients are ready (in the end of parallel section in sim in CL or wfsgrad in OL).  <a href="#a9cdd8da33de20c241e64bdf98cae94bf"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structimat.html">imat</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__utils_8c.html#a7cbdb30dc3f0245abb989ae2e72b0c6a">act_coord2ind</a> (<a class="el" href="structloc__t.html">loc_t</a> *aloc, const char *fndead)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Parse the input dead actuator location to actuator indices based on aloc.  <a href="#a7cbdb30dc3f0245abb989ae2e72b0c6a"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Reusable utilities for wavefront reconstruction and DM fitting. </p>
</div><hr/><h2>Define Documentation</h2>
<a class="anchor" id="a97488232f6be5c7f5e41b64ff936187c"></a><!-- doxytag: member="recon_utils.c::USE_PROP" ref="a97488232f6be5c7f5e41b64ff936187c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define USE_PROP</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Speed up TomoL by gathering the first part of operations (GP*HXW) belonging to each WFS to facilitate threading. </p>
<p>gg = GP * HXW * xin </p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a3691a5ab478320df78f3c0cff4412860"></a><!-- doxytag: member="recon_utils.c::apply_L2" ref="a3691a5ab478320df78f3c0cff4412860" args="(dcell **xout, const spcell *L2, const dcell *xin, double alpha, int nthread)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void apply_L2 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdcell.html">dcell</a> **&#160;</td>
          <td class="paramname"><em>xout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structspcell.html">spcell</a> *&#160;</td>
          <td class="paramname"><em>L2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structdcell.html">dcell</a> *&#160;</td>
          <td class="paramname"><em>xin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>alpha</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nthread</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Apply Laplacian2 to xin and accumulates to xout. </p>

</div>
</div>
<a class="anchor" id="a666275101e117d56e1cf2908b18e0278"></a><!-- doxytag: member="recon_utils.c::apply_invpsd" ref="a666275101e117d56e1cf2908b18e0278" args="(dcell **xout, const void *A, const dcell *xin, double alpha, int xb, int yb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void apply_invpsd </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdcell.html">dcell</a> **&#160;</td>
          <td class="paramname"><em>xout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>A</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structdcell.html">dcell</a> *&#160;</td>
          <td class="paramname"><em>xin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>alpha</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>xb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>yb</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Apply turbulence invpsd to xin in Fourier space, scaled by alpha and add to xout. </p>
<p>do nothing if xb != yb, since we apply to diagonal only. if xb==-1, do all blocks. </p>

</div>
</div>
<a class="anchor" id="a68ea00a9c6e3e064ff6b613e9718cf54"></a><!-- doxytag: member="recon_utils.c::apply_fractal" ref="a68ea00a9c6e3e064ff6b613e9718cf54" args="(dcell **xout, const void *A, const dcell *xin, double alpha, int xb, int yb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void apply_fractal </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdcell.html">dcell</a> **&#160;</td>
          <td class="paramname"><em>xout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>A</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structdcell.html">dcell</a> *&#160;</td>
          <td class="paramname"><em>xin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>alpha</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>xb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>yb</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Apply fractal regularization to x, scaled by alpha. </p>
<p>do nothing if xb != yb, since we apply to diagonal only. if xb==-1, do all blocks. </p>

</div>
</div>
<a class="anchor" id="a08347b75d2ff1eb95c0a179873921e98"></a><!-- doxytag: member="recon_utils.c::TTFR" ref="a08347b75d2ff1eb95c0a179873921e98" args="(dcell *x, const dcell *TTF, const dcell *PTTF)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TTFR </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdcell.html">dcell</a> *&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structdcell.html">dcell</a> *&#160;</td>
          <td class="paramname"><em>TTF</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structdcell.html">dcell</a> *&#160;</td>
          <td class="paramname"><em>PTTF</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Removing Tip/Tilt/Focus from LGS grads. </p>
<p>TTF is the Tip/tilt/focus modes, and PTTF is the pseudo inverse of it, weighted by subaperture noise. </p>

</div>
</div>
<a class="anchor" id="a39b00d4db78618dec7b4a508b46331e3"></a><!-- doxytag: member="recon_utils.c::applyWeach" ref="a39b00d4db78618dec7b4a508b46331e3" args="(dmat *xin, const dsp *W0, const dmat *W1, const double wt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void applyWeach </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdmat.html">dmat</a> *&#160;</td>
          <td class="paramname"><em>xin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structdsp.html">dsp</a> *&#160;</td>
          <td class="paramname"><em>W0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structdmat.html">dmat</a> *&#160;</td>
          <td class="paramname"><em>W1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>wt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Apply weighting W0/W1 to a vector. </p>
<p>W0*x-W1*(W1'*x) </p>

</div>
</div>
<a class="anchor" id="aac31a93d205900027f62a385a321de0b"></a><!-- doxytag: member="recon_utils.c::applyW" ref="aac31a93d205900027f62a385a321de0b" args="(dcell *xin, const dsp *W0, const dmat *W1, const double *wt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void applyW </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdcell.html">dcell</a> *&#160;</td>
          <td class="paramname"><em>xin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structdsp.html">dsp</a> *&#160;</td>
          <td class="paramname"><em>W0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structdmat.html">dmat</a> *&#160;</td>
          <td class="paramname"><em>W1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double *&#160;</td>
          <td class="paramname"><em>wt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>apply weighting W0/W1 with weighting wt for each block. </p>
<p>W0*xin-W1*(W1'*xin); </p>

</div>
</div>
<a class="anchor" id="ac2bca0565f72973497ae8d589a8be63d"></a><!-- doxytag: member="recon_utils.c::calcWmcc" ref="ac2bca0565f72973497ae8d589a8be63d" args="(const dcell *A, const dcell *B, const dsp *W0, const dmat *W1, const dmat *wt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structdcell.html">dcell</a>* calcWmcc </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structdcell.html">dcell</a> *&#160;</td>
          <td class="paramname"><em>A</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structdcell.html">dcell</a> *&#160;</td>
          <td class="paramname"><em>B</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structdsp.html">dsp</a> *&#160;</td>
          <td class="paramname"><em>W0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structdmat.html">dmat</a> *&#160;</td>
          <td class="paramname"><em>W1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structdmat.html">dmat</a> *&#160;</td>
          <td class="paramname"><em>wt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Compute W0/W1 weighting dot product: <img class="formulaInl" alt="$A^T(W0 B-W1 (W1^T B))$" src="form_23.png"/>. </p>

</div>
</div>
<a class="anchor" id="a187ecf7ab34d0e125bb9c372ed2639e9"></a><!-- doxytag: member="recon_utils.c::Tomo_nea" ref="a187ecf7ab34d0e125bb9c372ed2639e9" args="(thread_t *info)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void Tomo_nea </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structthread__t.html">thread_t</a> *&#160;</td>
          <td class="paramname"><em>info</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Speed up TomoL by gathering the second part of operations (GP') belonging to each WFS to facilitate threading. </p>
<p>gg = GP' * NEAI * gg; </p>

</div>
</div>
<a class="anchor" id="ab849736d0f99e67f7b5cb402f3aa767b"></a><!-- doxytag: member="recon_utils.c::Tomo_iprop" ref="ab849736d0f99e67f7b5cb402f3aa767b" args="(thread_t *info)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void Tomo_iprop </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structthread__t.html">thread_t</a> *&#160;</td>
          <td class="paramname"><em>info</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Speed up TomoL by gathering the third part of operations (GP') belonging to each WFS to facilitate threading. </p>
<p>gg-&gt;xout.</p>
<p>xout = Cxx^-1 * xin + HXW * gg; </p>

</div>
</div>
<a class="anchor" id="a98112ae2ee582d001eb0307d79eda59a"></a><!-- doxytag: member="recon_utils.c::TomoR" ref="a98112ae2ee582d001eb0307d79eda59a" args="(dcell **xout, const void *A, const dcell *gin, const double alpha)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TomoR </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdcell.html">dcell</a> **&#160;</td>
          <td class="paramname"><em>xout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>A</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structdcell.html">dcell</a> *&#160;</td>
          <td class="paramname"><em>gin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>alpha</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Apply tomography right hand operator without using assembled matrix. </p>
<p>Fast and saves memory. The operation is the same as the Tomo_nea and Tomo_iprop in TomoL, so merge the implemenations.</p>
<p>xout=HXW'*GP'*NEAI*(1-TTF*PTTF)*gin. </p>

</div>
</div>
<a class="anchor" id="a3099e480359dfa43b2fe6b4868f1a704"></a><!-- doxytag: member="recon_utils.c::TomoL" ref="a3099e480359dfa43b2fe6b4868f1a704" args="(dcell **xout, const void *A, const dcell *xin, const double alpha)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TomoL </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdcell.html">dcell</a> **&#160;</td>
          <td class="paramname"><em>xout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>A</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structdcell.html">dcell</a> *&#160;</td>
          <td class="paramname"><em>xin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>alpha</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Apply tomography left hand side operator without using assembled matrix. </p>
<p>Fast and saves memory. Only useful in CG. Accumulates to xout;</p>
<p>Some timing information: Generated in T410s with Intel Core i5 520 M @ 2.4 GHz (1 T is 1 thread, 2 T is 2 thread) and Poweredge with dual Xeon X5355 2.66Ghz (1 P is 1 thread, 8 P is 8 thread) Time 1 T 2 T 1 P 8 P HXW: 7.8 5.4 7.7 5.0 GP: 4.3 2.6 3.6 1.4 TTFR: 0.3 0.3 0.4 0.6 neai: 0.5 0.3 0.5 0.4 GP': 3.2 2.1 3.4 1.0 HXW': 5.5 4.7 7.4 4.9 cxx: 3.2 2.5 3.5 2.7 </p>

</div>
</div>
<a class="anchor" id="a168e09881164d7f61ac8e0620ec7135b"></a><!-- doxytag: member="recon_utils.c::FitR" ref="a168e09881164d7f61ac8e0620ec7135b" args="(dcell **xout, const void *A, const dcell *xin, const double alpha)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void FitR </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdcell.html">dcell</a> **&#160;</td>
          <td class="paramname"><em>xout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>A</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structdcell.html">dcell</a> *&#160;</td>
          <td class="paramname"><em>xin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>alpha</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Apply fit right hand side matrix in CG mode without using assembled matrix. </p>
<p>Slow. don't use. Assembled matrix is faster because of multiple directions. </p>

</div>
</div>
<a class="anchor" id="a4a4842b145e88d09b903f986fe8951f2"></a><!-- doxytag: member="recon_utils.c::FitL" ref="a4a4842b145e88d09b903f986fe8951f2" args="(dcell **xout, const void *A, const dcell *xin, const double alpha)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void FitL </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdcell.html">dcell</a> **&#160;</td>
          <td class="paramname"><em>xout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>A</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structdcell.html">dcell</a> *&#160;</td>
          <td class="paramname"><em>xin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>alpha</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Apply fit left hand side matrix in CG mode without using assembled matrix. </p>
<p>Slow. don't use. Assembled matrix is faster because of multiple directions. </p>

</div>
</div>
<a class="anchor" id="a3c8efd1ec94a9fdaae9021172da85d7a"></a><!-- doxytag: member="recon_utils.c::focus_tracking" ref="a3c8efd1ec94a9fdaae9021172da85d7a" args="(SIM_T *simu)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void focus_tracking </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSIM__T.html">SIM_T</a> *&#160;</td>
          <td class="paramname"><em>simu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Update LGS focus or reference vector. </p>
<p>: what if dtrat!=1 </p>
<div class="fragment"><pre class="fragment">
   LGS: CL grads works, but not as good.
   LGS: CL grads + DM grads does not work
   LGS: CL grads + DM grads - Xhat grad is the choice.

   mffocus is 0: no focus tracking.
   mffocus is 1: use CL grads + DM grads - Xhat grad for LGS and NGS
   mffocus is 2: use CL grads + DM grads - Xhat grad for LGS; 
   CL grads for NGS.
   </pre></div> 
</div>
</div>
<a class="anchor" id="a7c33d35c2db2900c7439731319ffaf67"></a><!-- doxytag: member="recon_utils.c::windest" ref="a7c33d35c2db2900c7439731319ffaf67" args="(SIM_T *simu)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void windest </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSIM__T.html">SIM_T</a> *&#160;</td>
          <td class="paramname"><em>simu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Experimental routine to do wind estimation using correlation tracking of tomography outputs. </p>
<p>Not finished. Not verified. </p>

</div>
</div>
<a class="anchor" id="a8275bff1050a3bf784cbf75b0ed42092"></a><!-- doxytag: member="recon_utils.c::nea2sp" ref="a8275bff1050a3bf784cbf75b0ed42092" args="(dmat **nea, long nsa)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structdsp.html">dsp</a>* nea2sp </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdmat.html">dmat</a> **&#160;</td>
          <td class="paramname"><em>nea</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>nsa</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Convert block of 2x2 neas to sparse matrix. </p>

</div>
</div>
<a class="anchor" id="ad788e53dd64065c0991bba52acbfb0ad"></a><!-- doxytag: member="recon_utils.c::psfr_calc" ref="ad788e53dd64065c0991bba52acbfb0ad" args="(SIM_T *simu, dcell *opdr, dcell *dmpsol, dcell *dmerr_hi, dcell *dmerr_lo)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void psfr_calc </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSIM__T.html">SIM_T</a> *&#160;</td>
          <td class="paramname"><em>simu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structdcell.html">dcell</a> *&#160;</td>
          <td class="paramname"><em>opdr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structdcell.html">dcell</a> *&#160;</td>
          <td class="paramname"><em>dmpsol</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structdcell.html">dcell</a> *&#160;</td>
          <td class="paramname"><em>dmerr_hi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structdcell.html">dcell</a> *&#160;</td>
          <td class="paramname"><em>dmerr_lo</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Compute and save PSF reconstruction telemetry. </p>
<p>For pseudo open loop estimations, like high order loop, we add opdr to, and subtract dmpsol from the OPD. For closed loop estimations, like ahst low order or lsr, we add dmerr_lo, and dmerr_hi to the OPD. </p>

</div>
</div>
<a class="anchor" id="a9cdd8da33de20c241e64bdf98cae94bf"></a><!-- doxytag: member="recon_utils.c::shift_grad" ref="a9cdd8da33de20c241e64bdf98cae94bf" args="(SIM_T *simu)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void shift_grad </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSIM__T.html">SIM_T</a> *&#160;</td>
          <td class="paramname"><em>simu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Shift gradient when new gradients are ready (in the end of parallel section in sim in CL or wfsgrad in OL). </p>
<p>Do not execute in parallel with other routines. In GLAO mode, also averaged gradients from the same type of powfs. </p>

</div>
</div>
<a class="anchor" id="a7cbdb30dc3f0245abb989ae2e72b0c6a"></a><!-- doxytag: member="recon_utils.c::act_coord2ind" ref="a7cbdb30dc3f0245abb989ae2e72b0c6a" args="(loc_t *aloc, const char *fndead)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structimat.html">imat</a>* act_coord2ind </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structloc__t.html">loc_t</a> *&#160;</td>
          <td class="paramname"><em>aloc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>fndead</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Parse the input dead actuator location to actuator indices based on aloc. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">aloc</td><td>Aloc </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fndead</td><td>File containing dead actuators </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="recon__utils_8c.html">recon_utils.c</a>      </li>
      <li class="footer">Generated on Fri Sep 23 2011 10:43:45 for maos-0.9.3 by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </li>
    </ul>
  </div>

</body>
</html>
