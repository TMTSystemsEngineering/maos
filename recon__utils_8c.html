<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>maos-1.2.0: maos/recon_utils.c File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="/home/lianqiw/work/programming/aos/doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">maos-1.2.0
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript" src="dynsections.js"></script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('recon__utils_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#define-members">Defines</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">maos/recon_utils.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Reusable utilities for wavefront reconstruction and DM fitting.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__utils_8c.html#a3f7acaaabd294c80ab0f3540b010a1b2">test_TomoL</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Apply tomography left hand side operator without using assembled matrix.  <a href="#a3f7acaaabd294c80ab0f3540b010a1b2"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ac0846a43d5d29570425f514e31ad3624"></a><!-- doxytag: member="recon_utils.c::Tomo_T" ref="ac0846a43d5d29570425f514e31ad3624" args="" -->
typedef struct Tomo_T&#160;</td><td class="memItemRight" valign="bottom"><b>Tomo_T</b></td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__utils_8c.html#a3691a5ab478320df78f3c0cff4412860">apply_L2</a> (<a class="el" href="structdcell.html">dcell</a> **xout, const <a class="el" href="structspcell.html">spcell</a> *L2, const <a class="el" href="structdcell.html">dcell</a> *xin, double alpha, int nthread)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Apply Laplacian2 to xin and accumulates to xout.  <a href="#a3691a5ab478320df78f3c0cff4412860"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__utils_8c.html#a666275101e117d56e1cf2908b18e0278">apply_invpsd</a> (<a class="el" href="structdcell.html">dcell</a> **xout, const void *A, const <a class="el" href="structdcell.html">dcell</a> *xin, double alpha, int xb, int yb)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Apply turbulence invpsd to xin in Fourier space, scaled by alpha and add to xout.  <a href="#a666275101e117d56e1cf2908b18e0278"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__utils_8c.html#a68ea00a9c6e3e064ff6b613e9718cf54">apply_fractal</a> (<a class="el" href="structdcell.html">dcell</a> **xout, const void *A, const <a class="el" href="structdcell.html">dcell</a> *xin, double alpha, int xb, int yb)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Apply fractal regularization to x, scaled by alpha.  <a href="#a68ea00a9c6e3e064ff6b613e9718cf54"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__utils_8c.html#a08347b75d2ff1eb95c0a179873921e98">TTFR</a> (<a class="el" href="structdcell.html">dcell</a> *x, const <a class="el" href="structdcell.html">dcell</a> *TTF, const <a class="el" href="structdcell.html">dcell</a> *PTTF)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Removing Tip/Tilt/Focus from LGS grads.  <a href="#a08347b75d2ff1eb95c0a179873921e98"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__utils_8c.html#a248c9770547232db990ea4a34db3deb9">TTFRt</a> (<a class="el" href="structdcell.html">dcell</a> *x, const <a class="el" href="structdcell.html">dcell</a> *TTF, const <a class="el" href="structdcell.html">dcell</a> *PTTF)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Removing Tip/Tilt/Focus from LGS grads.  <a href="#a248c9770547232db990ea4a34db3deb9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__utils_8c.html#a39b00d4db78618dec7b4a508b46331e3">applyWeach</a> (<a class="el" href="structdmat.html">dmat</a> *xin, const <a class="el" href="structdsp.html">dsp</a> *W0, const <a class="el" href="structdmat.html">dmat</a> *W1, const double wt)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Apply weighting W0/W1 to a vector.  <a href="#a39b00d4db78618dec7b4a508b46331e3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__utils_8c.html#aac31a93d205900027f62a385a321de0b">applyW</a> (<a class="el" href="structdcell.html">dcell</a> *xin, const <a class="el" href="structdsp.html">dsp</a> *W0, const <a class="el" href="structdmat.html">dmat</a> *W1, const double *wt)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">apply weighting W0/W1 with weighting wt for each block.  <a href="#aac31a93d205900027f62a385a321de0b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structdcell.html">dcell</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__utils_8c.html#ac2bca0565f72973497ae8d589a8be63d">calcWmcc</a> (const <a class="el" href="structdcell.html">dcell</a> *A, const <a class="el" href="structdcell.html">dcell</a> *B, const <a class="el" href="structdsp.html">dsp</a> *W0, const <a class="el" href="structdmat.html">dmat</a> *W1, const <a class="el" href="structdmat.html">dmat</a> *wt)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Compute W0/W1 weighting dot product: <img class="formulaInl" alt="$A^T(W0 B-W1 (W1^T B))$" src="form_23.png"/>.  <a href="#ac2bca0565f72973497ae8d589a8be63d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__utils_8c.html#af59e12e8fada71768bc65ffb5e464350">Tomo_prop_do</a> (<a class="el" href="structthread__t.html">thread_t</a> *info)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Speed up TomoL by gathering the first part of operations (GP*HXW) belonging to each WFS to facilitate threading.  <a href="#af59e12e8fada71768bc65ffb5e464350"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__utils_8c.html#a79b68f8c7f9f674956e8ae419690a7fc">Tomo_prop</a> (Tomo_T *data, int nthread)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Wrapper of Tomo_prop_do.  <a href="#a79b68f8c7f9f674956e8ae419690a7fc"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__utils_8c.html#a796eee452b154319c74dd4f412bf1cec">Tomo_nea_gpt_do</a> (<a class="el" href="structthread__t.html">thread_t</a> *info)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Speed up TomoL by gathering the second part of operations (GP') belonging to each WFS to facilitate threading.  <a href="#a796eee452b154319c74dd4f412bf1cec"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aec9447cb660394ecce04a7c8c86584d4"></a><!-- doxytag: member="recon_utils.c::Tomo_nea_do" ref="aec9447cb660394ecce04a7c8c86584d4" args="(thread_t *info)" -->
static void&#160;</td><td class="memItemRight" valign="bottom"><b>Tomo_nea_do</b> (<a class="el" href="structthread__t.html">thread_t</a> *info)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a71ed0c35482fc4e04f94662151c867a7"></a><!-- doxytag: member="recon_utils.c::Tomo_nea" ref="a71ed0c35482fc4e04f94662151c867a7" args="(Tomo_T *data, int nthread, int gpt)" -->
void&#160;</td><td class="memItemRight" valign="bottom"><b>Tomo_nea</b> (Tomo_T *data, int nthread, int gpt)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__utils_8c.html#a9a7c7b8da2eb4a5f121292f3cde7ebe5">Tomo_iprop_do</a> (<a class="el" href="structthread__t.html">thread_t</a> *info)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Speed up TomoL by gathering the third part of operations (GP') belonging to each WFS to facilitate threading.  <a href="#a9a7c7b8da2eb4a5f121292f3cde7ebe5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__utils_8c.html#adb00630a5d336d108082c8f7c1409a16">Tomo_iprop</a> (Tomo_T *data, int nthread)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Wrapper of Tomo_iprop_do.  <a href="#adb00630a5d336d108082c8f7c1409a16"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__utils_8c.html#a98112ae2ee582d001eb0307d79eda59a">TomoR</a> (<a class="el" href="structdcell.html">dcell</a> **xout, const void *A, const <a class="el" href="structdcell.html">dcell</a> *gin, const double alpha)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Apply tomography right hand operator without using assembled matrix.  <a href="#a98112ae2ee582d001eb0307d79eda59a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__utils_8c.html#ad52c3cc4883b219477bd9e5dea89eeae">TomoRt</a> (<a class="el" href="structdcell.html">dcell</a> **gout, const void *A, const <a class="el" href="structdcell.html">dcell</a> *xin, const double alpha)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Transpose operation of TomoRt.  <a href="#ad52c3cc4883b219477bd9e5dea89eeae"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a3099e480359dfa43b2fe6b4868f1a704"></a><!-- doxytag: member="recon_utils.c::TomoL" ref="a3099e480359dfa43b2fe6b4868f1a704" args="(dcell **xout, const void *A, const dcell *xin, const double alpha)" -->
void&#160;</td><td class="memItemRight" valign="bottom"><b>TomoL</b> (<a class="el" href="structdcell.html">dcell</a> **xout, const void *A, const <a class="el" href="structdcell.html">dcell</a> *xin, const double alpha)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__utils_8c.html#a168e09881164d7f61ac8e0620ec7135b">FitR</a> (<a class="el" href="structdcell.html">dcell</a> **xout, const void *A, const <a class="el" href="structdcell.html">dcell</a> *xin, const double alpha)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Apply fit right hand side matrix in CG mode without using assembled matrix.  <a href="#a168e09881164d7f61ac8e0620ec7135b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__utils_8c.html#a4a4842b145e88d09b903f986fe8951f2">FitL</a> (<a class="el" href="structdcell.html">dcell</a> **xout, const void *A, const <a class="el" href="structdcell.html">dcell</a> *xin, const double alpha)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Apply fit left hand side matrix in CG mode without using assembled matrix.  <a href="#a4a4842b145e88d09b903f986fe8951f2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__utils_8c.html#a3c8efd1ec94a9fdaae9021172da85d7a">focus_tracking</a> (<a class="el" href="structSIM__T.html">SIM_T</a> *simu)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Replace the low frequency part of focus correction by NGS measurement.  <a href="#a3c8efd1ec94a9fdaae9021172da85d7a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structdsp.html">dsp</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__utils_8c.html#a8275bff1050a3bf784cbf75b0ed42092">nea2sp</a> (<a class="el" href="structdmat.html">dmat</a> **nea, long nsa)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Convert block of 2x2 neas to sparse matrix.  <a href="#a8275bff1050a3bf784cbf75b0ed42092"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__utils_8c.html#a107d696093a361bb8d4d30b32b7ec6a7">psfr_calc</a> (<a class="el" href="structSIM__T.html">SIM_T</a> *simu, <a class="el" href="structdcell.html">dcell</a> *opdr, <a class="el" href="structdcell.html">dcell</a> *dmpsol, <a class="el" href="structdcell.html">dcell</a> *dmerr, <a class="el" href="structdcell.html">dcell</a> *dmerr_lo)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Compute and save PSF reconstruction telemetry.  <a href="#a107d696093a361bb8d4d30b32b7ec6a7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__utils_8c.html#a9cdd8da33de20c241e64bdf98cae94bf">shift_grad</a> (<a class="el" href="structSIM__T.html">SIM_T</a> *simu)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Shift gradient when new gradients are ready (in the end of parallel section in sim in CL or wfsgrad in OL).  <a href="#a9cdd8da33de20c241e64bdf98cae94bf"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structimat.html">imat</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__utils_8c.html#a7cbdb30dc3f0245abb989ae2e72b0c6a">act_coord2ind</a> (<a class="el" href="structloc__t.html">loc_t</a> *aloc, const char *fndead)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Parse the input dead actuator location to actuator indices based on aloc.  <a href="#a7cbdb30dc3f0245abb989ae2e72b0c6a"></a><br/></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Reusable utilities for wavefront reconstruction and DM fitting. </p>
</div><hr/><h2>Define Documentation</h2>
<a class="anchor" id="a3f7acaaabd294c80ab0f3540b010a1b2"></a><!-- doxytag: member="recon_utils.c::test_TomoL" ref="a3f7acaaabd294c80ab0f3540b010a1b2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="recon__utils_8c.html#a3f7acaaabd294c80ab0f3540b010a1b2">test_TomoL</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Apply tomography left hand side operator without using assembled matrix. </p>
<p>Fast and saves memory. Only useful in CG. Accumulates to xout;</p>
<p>Some timing information: Generated in T410s with Intel Core i5 520 M @ 2.4 GHz (1 T is 1 thread, 2 T is 2 thread) and Poweredge with dual Xeon X5355 2.66Ghz (1 P is 1 thread, 8 P is 8 thread) Time 1 T 2 T 1 P 8 P HXW: 7.8 5.4 7.7 5.0 GP: 4.3 2.6 3.6 1.4 TTFR: 0.3 0.3 0.4 0.6 neai: 0.5 0.3 0.5 0.4 GP': 3.2 2.1 3.4 1.0 HXW': 5.5 4.7 7.4 4.9 cxx: 3.2 2.5 3.5 2.7 </p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a3691a5ab478320df78f3c0cff4412860"></a><!-- doxytag: member="recon_utils.c::apply_L2" ref="a3691a5ab478320df78f3c0cff4412860" args="(dcell **xout, const spcell *L2, const dcell *xin, double alpha, int nthread)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="recon__utils_8c.html#a3691a5ab478320df78f3c0cff4412860">apply_L2</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdcell.html">dcell</a> **&#160;</td>
          <td class="paramname"><em>xout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structspcell.html">spcell</a> *&#160;</td>
          <td class="paramname"><em>L2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structdcell.html">dcell</a> *&#160;</td>
          <td class="paramname"><em>xin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>alpha</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nthread</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Apply Laplacian2 to xin and accumulates to xout. </p>

</div>
</div>
<a class="anchor" id="a666275101e117d56e1cf2908b18e0278"></a><!-- doxytag: member="recon_utils.c::apply_invpsd" ref="a666275101e117d56e1cf2908b18e0278" args="(dcell **xout, const void *A, const dcell *xin, double alpha, int xb, int yb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="recon__utils_8c.html#a666275101e117d56e1cf2908b18e0278">apply_invpsd</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdcell.html">dcell</a> **&#160;</td>
          <td class="paramname"><em>xout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>A</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structdcell.html">dcell</a> *&#160;</td>
          <td class="paramname"><em>xin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>alpha</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>xb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>yb</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Apply turbulence invpsd to xin in Fourier space, scaled by alpha and add to xout. </p>
<p>do nothing if xb != yb, since we apply to diagonal only. if xb==-1, do all blocks. </p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000008">Todo:</a></b></dt><dd>: this is not thread safe. </dd></dl>

</div>
</div>
<a class="anchor" id="a68ea00a9c6e3e064ff6b613e9718cf54"></a><!-- doxytag: member="recon_utils.c::apply_fractal" ref="a68ea00a9c6e3e064ff6b613e9718cf54" args="(dcell **xout, const void *A, const dcell *xin, double alpha, int xb, int yb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="recon__utils_8c.html#a68ea00a9c6e3e064ff6b613e9718cf54">apply_fractal</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdcell.html">dcell</a> **&#160;</td>
          <td class="paramname"><em>xout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>A</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structdcell.html">dcell</a> *&#160;</td>
          <td class="paramname"><em>xin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>alpha</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>xb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>yb</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Apply fractal regularization to x, scaled by alpha. </p>
<p>do nothing if xb != yb, since we apply to diagonal only. if xb==-1, do all blocks. </p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000009">Todo:</a></b></dt><dd>: this is not thread safe. </dd></dl>

</div>
</div>
<a class="anchor" id="a08347b75d2ff1eb95c0a179873921e98"></a><!-- doxytag: member="recon_utils.c::TTFR" ref="a08347b75d2ff1eb95c0a179873921e98" args="(dcell *x, const dcell *TTF, const dcell *PTTF)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="recon__utils_8c.html#a08347b75d2ff1eb95c0a179873921e98">TTFR</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdcell.html">dcell</a> *&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structdcell.html">dcell</a> *&#160;</td>
          <td class="paramname"><em>TTF</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structdcell.html">dcell</a> *&#160;</td>
          <td class="paramname"><em>PTTF</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Removing Tip/Tilt/Focus from LGS grads. </p>
<p>TTF is the Tip/tilt/focus modes, and PTTF is the pseudo inverse of it, weighted by subaperture noise. It is not diagonal if differential focus is removed. So cannot be in Tomo_nea </p>

</div>
</div>
<a class="anchor" id="a248c9770547232db990ea4a34db3deb9"></a><!-- doxytag: member="recon_utils.c::TTFRt" ref="a248c9770547232db990ea4a34db3deb9" args="(dcell *x, const dcell *TTF, const dcell *PTTF)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="recon__utils_8c.html#a248c9770547232db990ea4a34db3deb9">TTFRt</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdcell.html">dcell</a> *&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structdcell.html">dcell</a> *&#160;</td>
          <td class="paramname"><em>TTF</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structdcell.html">dcell</a> *&#160;</td>
          <td class="paramname"><em>PTTF</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Removing Tip/Tilt/Focus from LGS grads. </p>
<p>TTF is the Tip/tilt/focus modes, and PTTF is the pseudo inverse of it, weighted by subaperture noise. It is not diagonal if differential focus is removed. So cannot be in Tomo_nea </p>

</div>
</div>
<a class="anchor" id="a39b00d4db78618dec7b4a508b46331e3"></a><!-- doxytag: member="recon_utils.c::applyWeach" ref="a39b00d4db78618dec7b4a508b46331e3" args="(dmat *xin, const dsp *W0, const dmat *W1, const double wt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void <a class="el" href="recon__utils_8c.html#a39b00d4db78618dec7b4a508b46331e3">applyWeach</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdmat.html">dmat</a> *&#160;</td>
          <td class="paramname"><em>xin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structdsp.html">dsp</a> *&#160;</td>
          <td class="paramname"><em>W0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structdmat.html">dmat</a> *&#160;</td>
          <td class="paramname"><em>W1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>wt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Apply weighting W0/W1 to a vector. </p>
<p>W0*x-W1*(W1'*x) </p>

</div>
</div>
<a class="anchor" id="aac31a93d205900027f62a385a321de0b"></a><!-- doxytag: member="recon_utils.c::applyW" ref="aac31a93d205900027f62a385a321de0b" args="(dcell *xin, const dsp *W0, const dmat *W1, const double *wt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="recon__utils_8c.html#aac31a93d205900027f62a385a321de0b">applyW</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdcell.html">dcell</a> *&#160;</td>
          <td class="paramname"><em>xin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structdsp.html">dsp</a> *&#160;</td>
          <td class="paramname"><em>W0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structdmat.html">dmat</a> *&#160;</td>
          <td class="paramname"><em>W1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double *&#160;</td>
          <td class="paramname"><em>wt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>apply weighting W0/W1 with weighting wt for each block. </p>
<p>W0*xin-W1*(W1'*xin); </p>

</div>
</div>
<a class="anchor" id="ac2bca0565f72973497ae8d589a8be63d"></a><!-- doxytag: member="recon_utils.c::calcWmcc" ref="ac2bca0565f72973497ae8d589a8be63d" args="(const dcell *A, const dcell *B, const dsp *W0, const dmat *W1, const dmat *wt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structdcell.html">dcell</a>* <a class="el" href="recon__utils_8c.html#ac2bca0565f72973497ae8d589a8be63d">calcWmcc</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structdcell.html">dcell</a> *&#160;</td>
          <td class="paramname"><em>A</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structdcell.html">dcell</a> *&#160;</td>
          <td class="paramname"><em>B</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structdsp.html">dsp</a> *&#160;</td>
          <td class="paramname"><em>W0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structdmat.html">dmat</a> *&#160;</td>
          <td class="paramname"><em>W1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structdmat.html">dmat</a> *&#160;</td>
          <td class="paramname"><em>wt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Compute W0/W1 weighting dot product: <img class="formulaInl" alt="$A^T(W0 B-W1 (W1^T B))$" src="form_23.png"/>. </p>

</div>
</div>
<a class="anchor" id="af59e12e8fada71768bc65ffb5e464350"></a><!-- doxytag: member="recon_utils.c::Tomo_prop_do" ref="af59e12e8fada71768bc65ffb5e464350" args="(thread_t *info)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void <a class="el" href="recon__utils_8c.html#af59e12e8fada71768bc65ffb5e464350">Tomo_prop_do</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structthread__t.html">thread_t</a> *&#160;</td>
          <td class="paramname"><em>info</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Speed up TomoL by gathering the first part of operations (GP*HXW) belonging to each WFS to facilitate threading. </p>
<p>gg = GP * HXW * xin </p>

</div>
</div>
<a class="anchor" id="a79b68f8c7f9f674956e8ae419690a7fc"></a><!-- doxytag: member="recon_utils.c::Tomo_prop" ref="a79b68f8c7f9f674956e8ae419690a7fc" args="(Tomo_T *data, int nthread)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="recon__utils_8c.html#a79b68f8c7f9f674956e8ae419690a7fc">Tomo_prop</a> </td>
          <td>(</td>
          <td class="paramtype">Tomo_T *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nthread</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Wrapper of Tomo_prop_do. </p>

</div>
</div>
<a class="anchor" id="a796eee452b154319c74dd4f412bf1cec"></a><!-- doxytag: member="recon_utils.c::Tomo_nea_gpt_do" ref="a796eee452b154319c74dd4f412bf1cec" args="(thread_t *info)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void <a class="el" href="recon__utils_8c.html#a796eee452b154319c74dd4f412bf1cec">Tomo_nea_gpt_do</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structthread__t.html">thread_t</a> *&#160;</td>
          <td class="paramname"><em>info</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Speed up TomoL by gathering the second part of operations (GP') belonging to each WFS to facilitate threading. </p>
<p>gg = GP' * NEAI * gg; </p>

</div>
</div>
<a class="anchor" id="a9a7c7b8da2eb4a5f121292f3cde7ebe5"></a><!-- doxytag: member="recon_utils.c::Tomo_iprop_do" ref="a9a7c7b8da2eb4a5f121292f3cde7ebe5" args="(thread_t *info)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void <a class="el" href="recon__utils_8c.html#a9a7c7b8da2eb4a5f121292f3cde7ebe5">Tomo_iprop_do</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structthread__t.html">thread_t</a> *&#160;</td>
          <td class="paramname"><em>info</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Speed up TomoL by gathering the third part of operations (GP') belonging to each WFS to facilitate threading. </p>
<p>gg-&gt;xout.</p>
<p>xout = Cxx^-1 * xin + HXW * gg; </p>

</div>
</div>
<a class="anchor" id="adb00630a5d336d108082c8f7c1409a16"></a><!-- doxytag: member="recon_utils.c::Tomo_iprop" ref="adb00630a5d336d108082c8f7c1409a16" args="(Tomo_T *data, int nthread)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="recon__utils_8c.html#adb00630a5d336d108082c8f7c1409a16">Tomo_iprop</a> </td>
          <td>(</td>
          <td class="paramtype">Tomo_T *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nthread</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Wrapper of Tomo_iprop_do. </p>

</div>
</div>
<a class="anchor" id="a98112ae2ee582d001eb0307d79eda59a"></a><!-- doxytag: member="recon_utils.c::TomoR" ref="a98112ae2ee582d001eb0307d79eda59a" args="(dcell **xout, const void *A, const dcell *gin, const double alpha)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="recon__utils_8c.html#a98112ae2ee582d001eb0307d79eda59a">TomoR</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdcell.html">dcell</a> **&#160;</td>
          <td class="paramname"><em>xout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>A</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structdcell.html">dcell</a> *&#160;</td>
          <td class="paramname"><em>gin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>alpha</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Apply tomography right hand operator without using assembled matrix. </p>
<p>Fast and saves memory. The operation is the same as the Tomo_nea and Tomo_iprop in TomoL, so merge the implemenations.</p>
<p>xout=HXW'*GP'*NEAI*(1-TTF*PTTF)*gin. </p>

</div>
</div>
<a class="anchor" id="ad52c3cc4883b219477bd9e5dea89eeae"></a><!-- doxytag: member="recon_utils.c::TomoRt" ref="ad52c3cc4883b219477bd9e5dea89eeae" args="(dcell **gout, const void *A, const dcell *xin, const double alpha)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="recon__utils_8c.html#ad52c3cc4883b219477bd9e5dea89eeae">TomoRt</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdcell.html">dcell</a> **&#160;</td>
          <td class="paramname"><em>gout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>A</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structdcell.html">dcell</a> *&#160;</td>
          <td class="paramname"><em>xin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>alpha</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Transpose operation of TomoRt. </p>
<p>From xout -&gt; gin </p>

</div>
</div>
<a class="anchor" id="a168e09881164d7f61ac8e0620ec7135b"></a><!-- doxytag: member="recon_utils.c::FitR" ref="a168e09881164d7f61ac8e0620ec7135b" args="(dcell **xout, const void *A, const dcell *xin, const double alpha)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="recon__utils_8c.html#a168e09881164d7f61ac8e0620ec7135b">FitR</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdcell.html">dcell</a> **&#160;</td>
          <td class="paramname"><em>xout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>A</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structdcell.html">dcell</a> *&#160;</td>
          <td class="paramname"><em>xin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>alpha</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Apply fit right hand side matrix in CG mode without using assembled matrix. </p>
<p>Slow. don't use. Assembled matrix is faster because of multiple directions. </p>

</div>
</div>
<a class="anchor" id="a4a4842b145e88d09b903f986fe8951f2"></a><!-- doxytag: member="recon_utils.c::FitL" ref="a4a4842b145e88d09b903f986fe8951f2" args="(dcell **xout, const void *A, const dcell *xin, const double alpha)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="recon__utils_8c.html#a4a4842b145e88d09b903f986fe8951f2">FitL</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdcell.html">dcell</a> **&#160;</td>
          <td class="paramname"><em>xout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>A</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structdcell.html">dcell</a> *&#160;</td>
          <td class="paramname"><em>xin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>alpha</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Apply fit left hand side matrix in CG mode without using assembled matrix. </p>
<p>Slow. don't use. Assembled matrix is faster because of multiple directions. </p>

</div>
</div>
<a class="anchor" id="a3c8efd1ec94a9fdaae9021172da85d7a"></a><!-- doxytag: member="recon_utils.c::focus_tracking" ref="a3c8efd1ec94a9fdaae9021172da85d7a" args="(SIM_T *simu)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="recon__utils_8c.html#a3c8efd1ec94a9fdaae9021172da85d7a">focus_tracking</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSIM__T.html">SIM_T</a> *&#160;</td>
          <td class="paramname"><em>simu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Replace the low frequency part of focus correction by NGS measurement. </p>
<p>a_focus = HPF * a_flgs + LPF * a_fngs = a_flgs + LPF*(a_fngs - a_flgs)</p>
<p>a_focus is the focus correction on the DM to reduce global focus on the science a_flgs is the focus reconstruction from LGS measurements. a_fngs is the focus reconstruction from NGS measurements.</p>
<p>a_flgs can be estimated from sim.mffocus=1: closed loop LGS gradients. sim.mffocus=2: f_opdr-f_dm where f_opdr is focus in tomography output and f_dm is the focus correction in the dm. a_fngs is jointly estimated with the 5 NGS modes.  </p>

</div>
</div>
<a class="anchor" id="a8275bff1050a3bf784cbf75b0ed42092"></a><!-- doxytag: member="recon_utils.c::nea2sp" ref="a8275bff1050a3bf784cbf75b0ed42092" args="(dmat **nea, long nsa)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structdsp.html">dsp</a>* <a class="el" href="recon__utils_8c.html#a8275bff1050a3bf784cbf75b0ed42092">nea2sp</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdmat.html">dmat</a> **&#160;</td>
          <td class="paramname"><em>nea</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>nsa</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Convert block of 2x2 neas to sparse matrix. </p>

</div>
</div>
<a class="anchor" id="a107d696093a361bb8d4d30b32b7ec6a7"></a><!-- doxytag: member="recon_utils.c::psfr_calc" ref="a107d696093a361bb8d4d30b32b7ec6a7" args="(SIM_T *simu, dcell *opdr, dcell *dmpsol, dcell *dmerr, dcell *dmerr_lo)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="recon__utils_8c.html#a107d696093a361bb8d4d30b32b7ec6a7">psfr_calc</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSIM__T.html">SIM_T</a> *&#160;</td>
          <td class="paramname"><em>simu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structdcell.html">dcell</a> *&#160;</td>
          <td class="paramname"><em>opdr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structdcell.html">dcell</a> *&#160;</td>
          <td class="paramname"><em>dmpsol</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structdcell.html">dcell</a> *&#160;</td>
          <td class="paramname"><em>dmerr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structdcell.html">dcell</a> *&#160;</td>
          <td class="paramname"><em>dmerr_lo</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Compute and save PSF reconstruction telemetry. </p>
<p>For pseudo open loop estimations, like high order loop, we add opdr to, and subtract dmpsol from the OPD. For closed loop estimations, like ahst low order or lsr, we add dmerr_lo, and dmerr to the OPD. </p>

</div>
</div>
<a class="anchor" id="a9cdd8da33de20c241e64bdf98cae94bf"></a><!-- doxytag: member="recon_utils.c::shift_grad" ref="a9cdd8da33de20c241e64bdf98cae94bf" args="(SIM_T *simu)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="recon__utils_8c.html#a9cdd8da33de20c241e64bdf98cae94bf">shift_grad</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSIM__T.html">SIM_T</a> *&#160;</td>
          <td class="paramname"><em>simu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Shift gradient when new gradients are ready (in the end of parallel section in sim in CL or wfsgrad in OL). </p>
<p>Do not execute in parallel with other routines. In GLAO mode, also averaged gradients from the same type of powfs. </p>

</div>
</div>
<a class="anchor" id="a7cbdb30dc3f0245abb989ae2e72b0c6a"></a><!-- doxytag: member="recon_utils.c::act_coord2ind" ref="a7cbdb30dc3f0245abb989ae2e72b0c6a" args="(loc_t *aloc, const char *fndead)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structimat.html">imat</a>* <a class="el" href="recon__utils_8c.html#a7cbdb30dc3f0245abb989ae2e72b0c6a">act_coord2ind</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structloc__t.html">loc_t</a> *&#160;</td>
          <td class="paramname"><em>aloc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>fndead</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Parse the input dead actuator location to actuator indices based on aloc. </p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">aloc</td><td>Aloc </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fndead</td><td>File containing dead actuators </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="recon__utils_8c.html">recon_utils.c</a>      </li>

    <li class="footer">Generated on Tue Aug 14 2012 09:57:34 for maos-1.2.0 by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
